# 와이어프레임 종합 리디자인 플랜

> **작성일:** 2026-02-15
> **기준:** 2차 미팅 피드백 + 설계 논의 + 방법론 리서치
> **목적:** 인터뷰 반영 누락분까지 전부 포함한 최종 설계 문서

---

## Part 1. 설계 원칙 (확정)

### 원칙 1: 모드 없음
Retro/Pro/Mixed 같은 "모드"는 UI에 존재하지 않는다. 모든 데이터는 타임라인 위의 점이다. Prospective로 수집한 데이터도 시간이 지나면 과거 데이터가 된다. 구분은 시스템이 내부적으로 한다.

### 원칙 2: 연결하고, 탐색한다
연구자의 행위는 두 가지뿐: 데이터 소스를 연결한다. 타임라인 위의 데이터를 본다. 설정, 토글, 앵커 지정, 해상도 조절 — 전부 시스템이 한다.

### 원칙 3: 시간 축은 전제다
시간 축 자동 감지, 해상도 자동 조절, 소스별 시각화 자동 레이어링 — 이것은 이 플랫폼의 기술적 핵심이다. 이걸 만드는 게 우리의 일이지, "어렵다"고 타협할 대상이 아니다.

### 원칙 4: 하나의 뷰
Overview와 Table은 단일 레이아웃. 데이터 소스가 추가되면 레이어가 쌓인다.

---

## Part 2. 시간 축 자동화 — 방법론

### 2.1 데이터 레이어별 시각화 타입 자동 매칭

시간 해상도가 다른 데이터를 하나의 타임라인에 통합할 때, "하나의 해상도로 통일"하지 않는다. 소스 특성에 맞는 시각화 타입을 자동 매칭한다.

| 데이터 소스 | 시간 특성 | 시각화 타입 | 집계 방식 |
|------------|----------|-----------|----------|
| EMR 방문 기록 | 불규칙 (수일~수개월 간격) | **점 (Event dot)** | 없음 — 이벤트 그대로 표시 |
| 처방/약물 | 기간 (시작~종료) | **바 (Duration bar)** | 기간 범위 표시 |
| 연속 측정 (CGM, 웨어러블) | 고빈도 연속 (5분~1시간) | **라인 (Continuous line)** | 줌 레벨에 따라 time_bucket 집계 |
| EMA/설문 | 고정 이산 (하루 3회 등) | **바 (Discrete bar)** | 윈도우별 평균/합계 |
| Lab 결과 | 불규칙 단발 | **점 + 참조선 (Dot + ref range)** | 없음 — 값 그대로 |

**자동 매칭 로직:**
1. 데이터 소스 연결 시 → 타임스탬프 간격 통계 자동 계산 (median interval)
2. median interval < 1시간 → 연속형 (라인)
3. median interval 1시간~7일 + 고정 간격 → 이산형 (바)
4. median interval > 7일 또는 불규칙 → 이벤트형 (점)
5. start_date + end_date 둘 다 있음 → 기간형 (듀레이션 바)

### 2.2 시간 범위 자동 감지

```
데이터 소스 연결 시:
1. 전체 데이터의 min(timestamp), max(timestamp) 추출
2. 타임라인 범위 = min - 5% 여유 ~ max + 5% 여유
3. 신규 수집 소스 있으면:
   - 첫 데이터 도착 시점 = 분기선 자동 생성
   - 분기선 왼쪽: 과거 데이터 (회색 톤)
   - 분기선 오른쪽: 진행 중 (컬러)
4. 데이터가 실시간으로 추가되면 → 타임라인 우측 자동 확장
```

### 2.3 자동 분기선 감지

분기선 = 신규 수집이 시작된 시점. 연구자가 지정하는 게 아니라, **첫 번째 신규 수집 데이터의 타임스탬프**가 분기선이 된다.

- 기존 데이터만 연결 → 분기선 없음 (전체가 과거)
- 신규 수집 시작 → 첫 데이터 도착 시점이 분기선
- 시간이 지나면 분기선 오른쪽도 과거 데이터가 됨 → 분기선은 역사적 마커로 남음

### 2.4 Time Bucketing 전략 (TimescaleDB 기반)

타임라인 줌 레벨에 따라 자동 집계:

| 줌 레벨 | 시간 범위 | Bucket 크기 | 표시 방식 |
|---------|----------|------------|----------|
| 최대 줌아웃 | 전체 (수년) | 월별 | EMR 점 + 웨어러블 월평균 라인 |
| 중간 | 6개월 | 주별 | EMR 점 + 웨어러블 주평균 라인 + EMA 주합계 바 |
| 상세 | 1개월 | 일별 | EMR 점 + 웨어러블 일평균 + EMA 일별 바 |
| 최대 줌인 | 1주 | 시간별 | 웨어러블 시간별 라인 + EMA 개별 응답 |

```sql
-- TimescaleDB time_bucket 활용
SELECT
  time_bucket('1 day', measurement_datetime) AS bucket,
  measurement_concept_id,
  source_type, -- 'emr', 'wearable', 'ema'
  AVG(value_as_number) AS avg_value,
  COUNT(*) AS data_points
FROM unified_measurements
WHERE person_id = :person_id
GROUP BY bucket, measurement_concept_id, source_type
ORDER BY bucket;
```

Gap이 있는 구간 처리:
```sql
-- gap filling: 마지막 관측치 유지 (LOCF)
SELECT
  time_bucket_gapfill('1 day', measurement_datetime) AS bucket,
  locf(avg(value_as_number)) AS value_filled
FROM wearable_data
GROUP BY bucket;
```

### 2.5 OMOP CDM 시간 구조 활용

OMOP CDM의 시간 관련 핵심 필드:

```
VISIT_OCCURRENCE: visit_start_date, visit_end_date
CONDITION_OCCURRENCE: condition_start_date, condition_end_date
DRUG_EXPOSURE: drug_exposure_start_date, drug_exposure_end_date
MEASUREMENT: measurement_date, measurement_datetime
OBSERVATION: observation_date, observation_datetime
OBSERVATION_PERIOD: observation_period_start_date, observation_period_end_date
```

이 필드들을 통합 타임라인에 매핑:
- `_start_date` + `_end_date` 있는 테이블 → 듀레이션 바
- `_datetime` 있는 테이블 → 이벤트 점 또는 연속 라인 (간격에 따라)
- `OBSERVATION_PERIOD` → 환자의 전체 관찰 가능 기간 (타임라인 배경)

### 2.6 AI 투명성 — 판단 근거 자연어 표시

시스템이 자동으로 한 모든 판단을 AI 패널에서 설명:

```
📊 타임라인 구성 안내

• 기존 데이터: 2020.01.03 ~ 2025.11.28 (5년 11개월)
  - Person: 2,340명 | Condition: 892K records | Drug: 2.3M records

• 신규 수집: 2026.02.15~ (수집 중)
  - 웨어러블 심박수: 5분 간격 → 연속 라인으로 표시
  - EMA 식단: 3회/일 → 일별 바 차트로 표시

• 분기선: 2026.02.15 (첫 웨어러블 데이터 도착 시점)
• 현재 줌 레벨: 월별 집계

ℹ️ IRB 자동 판단: 신규 수집 포함 → 일반 심의 필요
```

---

## Part 3. 인터뷰 반영 누락분 — 전체 목록

### 🔴 CRITICAL — v2에서 빠진 것

#### 3.1 비선형 네비게이션 — 구체적 UI 스펙 없음

**인터뷰:** "순서가 딱 일직선으로 쭉 가는게 아니라 진짜 오락가락"

**필요한 스펙:**
- Step Bar에서 아무 스텝이나 클릭 가능 (완료 여부 무관)
- 각 스텝에 필수 필드 있음 → 미완성 시 경고는 하되, 이동은 허용
- 완료/미완성/진행중 3가지 상태 표시 (✅ / ⚠️ / 🔵)
- Step 건너뛰기 가능 → 예: Step 3 미완성인데 Step 5(IRB)로 갈 수 있음
  - 단, IRB 자동 판단에 필요한 정보가 없으면 "Step 3 데이터 소스 연결 필요" 안내
- 뒤로 가기도 자유 → Step 5에서 Step 2로 돌아가 가설 수정 가능

#### 3.2 OMOP CDM 반영 — 구현 제로

**인터뷰:** Yohan이 OMOP CDM 구조 직접 공유 (Person, Concept, Condition, Drug 테이블)

**필요한 작업:**
- data-table: OMOP 테이블 컬럼을 실제 예시 데이터로 교체
  - Person: person_id, gender_concept_id, year_of_birth, race_concept_id
  - Condition: condition_concept_id, condition_start_date, condition_type_concept_id
  - Drug: drug_concept_id, drug_exposure_start_date, quantity, days_supply
  - Measurement: measurement_concept_id, value_as_number, unit_concept_id, range_low, range_high
- data-overview: KPI 카드를 OMOP 기반으로 변경
  - 현재: "참여자 74/80", "수집률 94%" (Prospective 특화)
  - 변경: "레코드 수", "기간 커버리지", "결측률", "소스별 분포" (범용)
- Step 3: CDM 테이블 선택 UI (이건 v2에서 언급됨, 구현만 없음)

#### 3.3 범용 데이터 예시 — 와이어프레임 전체 하드코딩

**인터뷰:** "너무 특정 데이터에만 맞춰서 만들어진 거 같은 느낌"

**하드코딩 목록 (전체 정리):**

| 페이지 | 하드코딩 내용 | 변경 방향 |
|--------|-------------|----------|
| create.html | "저탄수화물 식단 혈당 연구" | 범용 예시 또는 빈 상태 |
| create-step2 | MAGE, HbA1c, TIR, 저탄수화물 식단 | 범용 outcome 플레이스홀더 |
| create-step3 | CGM, 심박수, 걸음수, 식단 사진 | 범용 "웨어러블", "참여자 입력" |
| create-step4 | T2DM 1,200명, CGM 340명 | 범용 필터 + 동적 숫자 |
| create-step5 | CGM=L4, 복약=L4 근거 | 데이터 소스 기반 자동 판단 |
| create-step6 | IRB 1,000XRP, 참여자 6,400XRP | 동적 비용 계산 |
| data-overview | 체중 트렌드, HbA1c, Phase1/2 | 범용 시계열 + 히스토그램 |
| data-table | MAGE, HbA1c, 공복혈당, CGM TIR% | OMOP 기반 동적 컬럼 |
| action-center | "혈당 이상치 5건", "수면 완료율" | 범용 알림 시스템 |
| list.html | "당뇨병 복약 순응도" 카드 | 다양한 질환 예시 |
| analysis-discovery | 당뇨 기반 AI 분석 예시 | 범용 분석 예시 |

### 🟡 IMPORTANT — v2에서 언급만 된 것

#### 3.4 의사 PI 타겟팅 — 전혀 미반영

**인터뷰:** "MD가 아닌 이상은 좀 인정을 안 해주는 그런 것도 있기도 하고"

**필요한 작업:**
- 의사 PI 페르소나 추가 (현재 "연구자" 일반으로만 설계)
- 의사 전용 온보딩 플로우 가능성 검토
- 권한 모델: PI(의사) vs 연구보조(비의사) 역할 분리
- IRB 서명 권한 = PI만 가능 → Step 5에 반영

#### 3.5 환자 vs 연구자 우선 — 미결정

**김정연 피드백:** "환자 우선 vs 연구자 우선 → 아직 미결정 상태 우려"

**현재 상태:**
- 와이어프레임 전체가 연구자 중심
- 환자/참여자 앱 UI = 현재 없음
- 데이터 제공자(환자) 입장의 플로우 = 없음

**결정 필요:** 이것은 스코프 결정(Part 5)과 직결됨

#### 3.6 과거 데이터 판매 모델 — 법적 검토 대기

**인터뷰:** "내가 당뇨병 환자야. 내 기록이 있어. 그 부분을 갔다 팔 수 있다."

**변호사 미팅에서 확인할 것:**
- 익명화된 과거 건강데이터 판매의 합법성
- ZKP 기반 익명 매칭 → IRB 통과 가능 여부
- 포괄동의(broad consent) 기반 데이터 재활용 가능 여부

**와이어프레임 영향:** 승인 시 완전히 새로운 페이지 필요 (사용자 데이터 업로드 → 가격 설정 → 매칭)

#### 3.7 병원 효율화 프레이밍 — 마케팅 전략

**인터뷰:** "적당히 돈 받으면서 공무원처럼 살고 싶은 사람한테 최고" / "혁신보다 효율화 프레이밍"

**필요한 작업:**
- 병원 대상 pitch 시 "혁신 플랫폼" → "IRB 처리 시간 50% 절감" 식으로 프레이밍
- 효율화 지표: IRB 작성 시간, 데이터 시각화 시간, 코호트 정의 시간
- 이건 와이어프레임보다 GTM 전략 문서에 해당

#### 3.8 데이터 마켓플레이스 수요 — 타겟 재설정

**인터뷰:** 병원 소속 연구자는 원내 데이터 접근 가능 → 외부 데이터 불필요

**시사점:**
- 마켓플레이스 타겟 = 병원 밖 (헬스케어 스타트업, 건기식 기업, 대학 연구실)
- 병원 소속 연구자에게는 "시각화/분석 도구" + "IRB 자동화"가 가치
- 두 타겟의 니즈가 다름 → 하나만 선택해야 함

### 🟢 CONTEXT — 와이어프레임 직접 영향은 작지만 알아야 하는 것

#### 3.9 Yohan 이탈 대비
- 곧 병원 떠날 예정 → 추가 인터뷰어 확보 필요
- 수요일 저녁 미팅 (소전한전자) 예정
- 장기 관계 불확실

#### 3.10 전남대병원 CD 스캐너 해킹 사례
- 개인 의료영상 클라우드 보관 서비스 → 잠재적 기회
- 단, "뚫어야 할 벽이 크다"
- 현재 스코프에서는 후순위

#### 3.11 경쟁자 현황
- IRB 포털 플랫폼 이미 존재
- GenSpark 등 연구 설계 AI 진입 중
- 차별화: **규제/IRB에 특화** (Yohan 제안)

---

## Part 4. 페이지별 최종 변경 명세

### Step 1: AI 인터뷰 (create.html)
| 항목 | 현재 | 변경 |
|------|------|------|
| 연구 유형 선택 | 없음 | ❌ 추가하지 않음 (모드 없음 원칙) |
| Step Bar | 선형 강제 | 비선형 클릭 가능 + 상태 표시 |
| 사이드바 예시 | 당뇨 중심 | 다양한 질환 (고혈압, 천식, ADHD 등) |
| AI 인터뷰 예시 | 저탄수화물-혈당 | 범용 예시 또는 빈 상태 |

### Step 2: 연구 설계 (create-step2.html)
| 항목 | 현재 | 변경 |
|------|------|------|
| Primary outcome | MAGE (혈당변동성) | 범용 플레이스홀더 |
| Secondary outcome | HbA1c, TIR | 범용 플레이스홀더 |
| 개입 | 저탄수화물 50g/일 | 범용 예시 |
| 방법론 | RCT 중심 | 유지 (범용적) |
| IRB 커버리지 가이드 | 없음 | 추가: "IRB를 넓게 잡아라" 안내 |

### Step 3: 데이터 소스 연결 (create-step3.html) ← 이름 변경
| 항목 | 현재 (v1) | Step 3 v2 (폐기) | 최종 (v3) |
|------|----------|-----------------|----------|
| 구조 | Prospective 전용 | 카드 A/B 토글 | **통합 소스 목록** |
| 기존 데이터 | 없음 | 카드 A (EMR/CDM) | 소스 목록 내 EMR/CDM 항목 |
| 신규 수집 | CGM/심박수/식단 | 카드 B (웨어러블/EMA) | 소스 목록 내 웨어러블/EMA 항목 |
| 시간 표시 | 없음 | 없음 | **각 소스 연결 시 시간 범위 자동 표시** |
| 모드 표시 | 없음 | Mixed/Retro/Pro 인디케이터 | **없음** (모드 개념 제거) |
| EMA 빈도 | 항상 표시 | B 토글 시만 | 신규 수집 소스 있으면 자동 표시 |
| 부담도 | 항상 표시 | B 토글 시만 | 신규 수집 소스 있으면 자동 표시 |

### Step 4: 대상 정의 (create-step4.html) ← 이름 변경
| 항목 | 현재 | 변경 |
|------|------|------|
| 이름 | "타겟 설정" | "대상 정의" |
| 모집 슬라이더 | 항상 표시 | 신규 수집 소스 있을 때만 자동 표시 |
| 코호트 필터 | 없음 | 포함/제외 기준 설정 (모든 연구 공통) |
| 데이터 볼륨 프리뷰 | T2DM 1,200명 | 연결된 데이터 기반 동적 표시 |
| 임상의사 협력 | 없음 | **추가 필요** (신규 수집 시) |
| 모집 프리뷰 (폰) | 항상 표시 | 신규 수집 소스 있을 때만 |

### Step 5: IRB 심의 (create-step5.html)
| 항목 | 현재 | 변경 |
|------|------|------|
| 유형 분류 | 연구자가 선택 | **시스템 자동 판단** (데이터 소스 기반) |
| 판단 근거 | CGM=L4, 복약=L4 | 연결된 소스의 민감도 자동 분석 |
| IRB 초안 | 약한 | **강화** — AI 초안 자동 생성 |
| 넓게 잡기 가이드 | 없음 | **추가** — "향후 추가 가능 항목도 포함" 안내 |
| PI 서명 | 없음 | **추가 검토** — 의사 PI 권한 |

### Step 6: 에스크로 (create-step6.html)
| 항목 | 현재 | 변경 |
|------|------|------|
| 참여자 보상 | 항상 표시 (6,400 XRP) | 신규 수집 소스 있을 때만 자동 표시 |
| IRB 수수료 | 고정 | 자동 판단된 IRB 유형 기반 |
| 모집 실행 | 항상 표시 | 신규 수집 소스 있을 때만 |
| XRP 금액 | 하드코딩 | 동적 계산 |

### data-overview.html
| 항목 | 현재 | 변경 |
|------|------|------|
| 타임라인 | Phase 1/2 고정 | **통합 타임라인** + 자동 분기선 |
| KPI 카드 | 참여자 74/80, 수집률 94% | 범용: 레코드 수, 기간 커버리지, 결측률, 소스별 분포 |
| 트렌드 차트 | 체중 트렌드 (고정) | **변수 선택 드롭다운** + 소스 라벨 |
| 기본 시각화 | 라인 차트 1개 | **시계열 + 히스토그램 (디폴트)** |
| 그룹 비교 | Δ체중, ΔHbA1c | 연구 데이터 기반 동적 |
| AI 인사이트 | 유지 | 유지 + 타임라인 구성 안내 추가 |
| 시간 해상도 | 주별 고정 | **줌 레벨에 따라 자동** (월/주/일/시간) |

### data-table.html
| 항목 | 현재 | 변경 |
|------|------|------|
| 컬럼 | MAGE, HbA1c, 공복혈당, TIR%, 복약순응도 | **OMOP 기반 동적 컬럼** |
| 소스 태그 | 없음 | [EMR], [웨어러블], [EMA] 등 |
| 행 구조 | 환자 1행 | **환자 × 시간 윈도우** |
| 시간 윈도우 | 없음 | 시스템이 데이터 밀도 기반 자동 결정 |
| 빈 셀 | 없음 | 과거에 소스 없었으면 자연스럽게 빈 칸 |
| 파일 크기 | 107KB | 최적화 필요 |

### list.html
| 항목 | 현재 | 변경 |
|------|------|------|
| 연구 카드 태그 | 상태만 (모집중/진행중) | **데이터 소스 아이콘** (🗄️📱✍️🔬) |
| 모드 라벨 | 없음 | 없음 (모드 개념 없으므로) |
| 예시 연구 | 당뇨 중심 | 다양한 질환 |
| 진행률 | 6스텝 진행바 | 완료항목 체크 방식 |

### action-center.html
| 항목 | 현재 | 변경 |
|------|------|------|
| 알림 예시 | "혈당 이상치 5건", "수면 완료율" | 범용: "이상치 감지", "수집률 변화" |
| 데이터 소스 알림 | 없음 | 추가: "EMR 데이터 동기화 완료", "새 웨어러블 데이터 도착" |

### analysis-discovery.html
| 항목 | 현재 | 변경 |
|------|------|------|
| AI 분석 예시 | 당뇨 기반 | 범용 분석 예시 |
| 파일 크기 | 83KB | 최적화 필요 |

### research-amend.html
| 항목 | 현재 | 변경 |
|------|------|------|
| 수정 이력 | 기본 | 유지 + IRB 재승인 vs 수정보고 판단 로직 추가 |

### clean-room.html
| 결정 | MVP 제외 또는 "Coming Soon" |

---

## Part 5. 미결정 사항 (변호사 미팅 + 추가 인터뷰 후)

| 결정 사항 | 선택지 | 영향 범위 | 시기 |
|----------|--------|----------|------|
| 스코프 결정 | A: IRB 자동화 / B: 데이터 시각화 / C: 데이터 마켓 | 전체 | 이번 주 |
| 환자 vs 연구자 우선 | 연구자 우선 (현재) / 환자도 포함 | 새 페이지 필요 여부 | 이번 주 |
| 과거 데이터 판매 합법성 | 가능 / 불가능 | 마켓 페이지 설계 | 변호사 미팅 후 |
| ZKP 익명화 IRB 통과 | 가능 / 불가능 | Step 5 로직 | 변호사 미팅 후 |
| 포괄동의 데이터 재활용 | 가능 / 불가능 | Step 3 소스 범위 | 변호사 미팅 후 |

---

## Part 5.5. 외부 데이터 칼럼 인젝션 — 유즈케이스 & 아키텍처

### 시나리오: 헬스케어 스타트업 (운동 격려 앱)

**배경:**
- 헬스케어 스타트업이 "운동 격려 앱"을 만들었다
- 임상적 효과 검증이 필요 → UniQdata 플랫폼에서 연구를 설계하고 싶다
- 앱 사용 전 건강 데이터 (과거) + 앱 사용 후 건강 데이터 (미래) 비교

**데이터 구조:**

| 소스 | 유형 | 시간 특성 | 칼럼 예시 |
|------|------|----------|----------|
| 병원 EMR | 기존 연결 | 과거 수년 | 체중, 혈압, 혈당, 진단코드 |
| 웨어러블 | 기존 연결 + 신규 수집 | 과거~현재~미래 | 심박수, 걸음수, 수면 |
| **스타트업 앱 데이터** | **외부 인젝션** | 앱 사용 기간 | **일별 앱 사용시간, 운동 완료 횟수, 앱 내 목표 달성률** |
| EMA 설문 | 신규 수집 | 앱 사용 기간 | 운동 의지, 피로도, 만족도 |

**핵심: "칼럼이 붙는다"**

스타트업은 자사 앱에서 수집한 per-user 데이터를 가져온다. 이 데이터가 플랫폼의 기존 테이블에 **칼럼으로 인젝션**된다:

```
기존 테이블:
| person_id | visit_date | 체중 | 혈압 | 심박수 | ...

외부 데이터 인젝션 후:
| person_id | visit_date | 체중 | 혈압 | 심박수 | [외부] 앱사용시간 | [외부] 운동횟수 | ...
                                                  ↑ 스타트업이 가져온 칼럼
```

### 동적 칼럼 인젝션 아키텍처

**Step 3 (데이터 소스 연결)에서:**
1. 기존 소스: EMR/CDM 연결 → 자동으로 Person, Condition, Drug, Measurement 칼럼 생성
2. 신규 소스: 웨어러블/EMA 설정 → 해당 metric 칼럼 자동 추가
3. **외부 소스: 스타트업이 CSV/API로 데이터 업로드** → `[외부]` 태그 칼럼으로 자동 추가
   - person_id 매칭 (앱 유저 ↔ 연구 참여자)
   - 시간 축 자동 정렬 (앱 데이터의 timestamp → 통합 타임라인에 매핑)
   - 데이터 타입 자동 감지 → 시각화 타입 자동 매칭

**data-table에서:**
- 고정 칼럼: person_id, 기본 인구통계
- 동적 칼럼 Layer 1 [EMR]: 체중, 혈압, 진단코드...
- 동적 칼럼 Layer 2 [웨어러블]: 심박수, 걸음수, 수면...
- 동적 칼럼 Layer 3 [EMA]: 운동의지, 피로도...
- **동적 칼럼 Layer 4 [외부]: 앱사용시간, 운동횟수, 목표달성률...**

각 칼럼 헤더에 소스 태그가 붙어서 데이터 출처를 즉시 식별:
```
체중 [EMR] | 심박수 [웨어러블] | 피로도 [EMA] | 앱사용시간 [외부]
```

**data-overview 타임라인에서:**
- EMR 체중 = 점 (불규칙 방문)
- 웨어러블 심박수 = 라인 (연속)
- EMA 피로도 = 바 (하루 n회)
- **앱 사용시간 = 바 또는 라인 (시스템이 데이터 간격 기반 자동 판단)**
- 분기선: 앱 사용 시작일 = 첫 외부 데이터 도착 시점

### 외부 데이터 연결 플로우 (Step 3)

```
1. "외부 데이터 소스 연결" 클릭
2. 업로드 방식 선택: CSV / API endpoint / 직접 입력
3. 시스템이 자동으로:
   - 칼럼명 감지
   - person_id 매칭 키 식별
   - 타임스탬프 칼럼 식별
   - 데이터 타입 추론 (숫자/범주/날짜)
   - 시간 해상도 계산 (median interval)
   - 시각화 타입 자동 매칭
4. 연구자에게 요약 표시:
   "3개 칼럼 감지: 앱사용시간(분/일, 연속형), 운동횟수(회/일, 이산형), 목표달성률(%/일, 연속형)"
   "234명 참여자 중 198명 매칭 (84.6%)"
   "기간: 2026.01.15 ~ 2026.02.14 (31일)"
5. 확인 → data-table과 data-overview에 즉시 반영
```

### 이 패턴이 보편적인 이유

헬스케어 스타트업뿐 아니라:
- 건기식 회사: 자사 제품 복용 기록 데이터 인젝션
- 디지털 치료제 업체: 앱 사용 로그 인젝션
- 보험사: 보험 청구 데이터 인젝션
- 대학 연구실: 자체 설문/실험 데이터 인젝션

**모두 같은 패턴:** 외부 엔티티가 per-user 데이터를 가져와서 칼럼으로 붙인다. 이것이 데이터 마켓플레이스의 실체 — 데이터가 "칼럼 단위로 거래"되는 구조.

---

## Part 6. 즉시 실행 목록

### 이번 주 — ✅ 완료 (2026-02-15)

1. ✅ **Step 3 v3 와이어프레임** — 통합 소스 연결 UI (카드 A/B 토글 제거) → `create-step3.html` (985줄, 35.9KB)
2. ✅ **비선형 네비게이션 Step Bar 재설계** — 모든 create 페이지 적용 (이전 기술부채에서 완료)
3. ✅ **data-table v2** — OMOP 기반 동적 컬럼 + 소스 태그 + 시간 윈도우 → `data-table.html` (870줄, 43.4KB)
4. ✅ **data-overview v2** — 통합 타임라인 + 자동 분기선 + 줌 레벨 → `data-overview.html` (925줄, 46.3KB)
5. ✅ **전체 하드코딩 당뇨 콘텐츠 제거** — 범용 예시로 교체 (이전 기술부채에서 완료, 430+ 인스턴스 → 0)

**v2 검증 결과 (전체 PASS):**
- 모드 관련 용어 0건, 당뇨 하드코딩 0건
- 소스 태그 [EMR]/[웨어러블]/[EMA]/[외부] 54+ 인스턴스
- 접근성 (skip-link, semantic HTML, ARIA) 전체 적용
- 사이드바 일관성 (김연구/서울대학교병원) 확인

### 다음 주

6. 변호사 미팅 결과 반영
7. Step 5 IRB 자동 판단 로직 상세 설계
8. 추가 인터뷰 (프로스펙티브 연구자, 병원 밖 스타트업)
9. 스코프 최종 확정
10. 의사 PI 페르소나 검토
