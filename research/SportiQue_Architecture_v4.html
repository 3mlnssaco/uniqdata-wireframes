<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>SportiQue Architecture v4</title>
<style>
  * { margin: 0; padding: 0; box-sizing: border-box; }
  body {
    font-family: 'SF Mono', 'Fira Code', 'Consolas', monospace;
    background: #0d1117;
    color: #e6edf3;
    padding: 24px;
    line-height: 1.5;
    overflow-x: hidden;
  }
  h1 { text-align: center; font-size: 20px; margin-bottom: 4px; letter-spacing: 1px; }
  .subtitle { text-align: center; font-size: 11px; color: #8b949e; margin-bottom: 28px; }

  .section-divider { display: flex; align-items: center; gap: 14px; margin: 28px 0 16px; }
  .section-divider::before, .section-divider::after { content: ''; flex: 1; height: 1px; background: #30363d; }
  .section-divider span { font-size: 15px; font-weight: 700; white-space: nowrap; letter-spacing: 1px; }

  .layer { border: 1px solid #30363d; border-radius: 8px; margin-bottom: 14px; overflow: hidden; }
  .layer-header { padding: 8px 16px; font-size: 13px; font-weight: 700; }
  .layer-body { padding: 14px 16px; }

  .input-layer .layer-header { background: #1a3a2a; color: #3fb950; }
  .data-layer .layer-header { background: #1a1a2a; color: #79c0ff; }
  .output-layer .layer-header { background: #1a2a2a; color: #56d4dd; }
  .server-layer .layer-header { background: #161b22; color: #8b949e; }
  .enterprise-layer .layer-header { background: #2a2a1a; color: #e3b341; }

  .cards { display: flex; gap: 10px; flex-wrap: wrap; }
  .card {
    background: #0d1117;
    border: 1px solid #21262d;
    border-radius: 4px;
    padding: 10px;
    flex: 1;
    min-width: 130px;
    font-size: 11px;
  }
  .card-title { font-size: 11px; font-weight: 700; margin-bottom: 4px; display: flex; align-items: center; gap: 5px; }
  .card ul { padding-left: 14px; font-size: 10px; color: #8b949e; }
  .card li { margin-bottom: 2px; }

  .routing-banner {
    background: #161b22;
    border: 1px solid #30363d;
    border-radius: 8px;
    padding: 12px;
    margin-top: 10px;
  }
  .routing-title { font-size: 12px; font-weight: 700; color: #e3b341; margin-bottom: 6px; }
  .routing-pills { display: flex; flex-wrap: wrap; gap: 8px; }
  .pill { padding: 6px 10px; border-radius: 6px; font-size: 10px; }
  .pill-s { background: #2a1a3a; border: 1px solid #bc8cff44; }
  .pill-n { background: #1a2a3a; border: 1px solid #58a6ff44; }
  .pill-ai { background: #3a2a1a; border: 1px solid #d2992244; }

  .route-grid { display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 8px; margin-top: 8px; }
  .route-node { background: #161b22; border: 1px solid #30363d; border-radius: 6px; padding: 8px; font-size: 10px; color: #8b949e; }
  .route-node strong { display: block; margin-bottom: 3px; }

  .server-mini-grid { display: grid; grid-template-columns: repeat(3, minmax(0, 1fr)); gap: 10px; }
  .mini-box { background: #0d1117; border: 1px solid #21262d; border-radius: 6px; padding: 10px; }
  .mini-box h4 { font-size: 11px; margin-bottom: 5px; }
  .mini-box ul { padding-left: 14px; font-size: 10px; color: #8b949e; }

  .db-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 12px; }
  .db-box { background: #161b22; border: 1px solid #30363d; border-radius: 6px; padding: 10px; }
  .db-box h4 { font-size: 11px; margin-bottom: 5px; }
  .db-box ul { padding-left: 14px; font-size: 10px; color: #8b949e; }

  .flow-focus { background: #161b22; border: 1px solid #30363d; border-radius: 8px; padding: 12px; margin-bottom: 12px; }
  .flow-focus h3 { font-size: 12px; color: #79c0ff; margin-bottom: 8px; }
  .flow-focus-grid { display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 8px; }
  .flow-focus-node { background: #0d1117; border: 1px solid #21262d; border-radius: 6px; padding: 8px; font-size: 10px; color: #8b949e; }

  .role-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 12px; }
  .role-card { background: #0d1117; border: 1px solid #21262d; border-radius: 6px; padding: 12px; }
  .role-card h4 { font-size: 12px; margin-bottom: 6px; }
  .role-row { display: flex; justify-content: space-between; font-size: 10px; padding: 2px 0; border-bottom: 1px solid #21262d; }
  .role-name { color: #79c0ff; font-weight: 600; }
  .role-desc { color: #8b949e; }

  .flows-grid { display: grid; grid-template-columns: repeat(4, minmax(0, 1fr)); gap: 12px; align-items: start; }
  .flow-panel { border-radius: 8px; overflow: hidden; }
  .flow-header { padding: 10px 12px; font-size: 11px; font-weight: 700; text-align: center; }
  .flow-body { padding: 10px; background: #0d1117; }

  .fp-nonsensitive { border: 2px solid #58a6ff44; }
  .fp-nonsensitive .flow-header { background: #1a2a3a; color: #58a6ff; }
  .fp-sensitive { border: 2px solid #bc8cff44; }
  .fp-sensitive .flow-header { background: #2a1a3a; color: #bc8cff; }
  .fp-ai { border: 2px solid #d2992244; }
  .fp-ai .flow-header { background: #3a2a1a; color: #d29922; }
  .fp-audit { border: 2px solid #3fb95044; }
  .fp-audit .flow-header { background: #1a3a2a; color: #3fb950; }

  .step { background: #161b22; border: 1px solid #30363d; border-radius: 5px; padding: 8px; margin-bottom: 4px; }
  .step-num { font-size: 9px; font-weight: 800; margin-bottom: 2px; }
  .step-title { font-size: 10px; font-weight: 700; margin-bottom: 2px; }
  .step-desc { font-size: 9px; color: #8b949e; }
  .step-code {
    font-size: 8px;
    color: #79c0ff;
    background: #0d1117;
    padding: 2px 5px;
    border-radius: 3px;
    margin-top: 3px;
    display: inline-block;
    word-break: break-word;
  }
  .step-arrow { text-align: center; padding: 1px 0; font-size: 11px; color: #484f58; }

  .subflow-box { border: 1px dashed #30363d; border-radius: 6px; padding: 6px; margin-top: 6px; background: #10151d; }
  .subflow-title { font-size: 9px; font-weight: 700; margin-bottom: 2px; color: #bc8cff; }
  .subflow-text { font-size: 9px; color: #8b949e; }

  .warn-box { background: #161b22; border-left: 3px solid #f85149; padding: 8px 10px; font-size: 9px; color: #8b949e; border-radius: 0 4px 4px 0; margin-top: 7px; }
  .warn-box strong { color: #f85149; }
  .info-box { background: #161b22; border-left: 3px solid #58a6ff; padding: 8px 10px; font-size: 9px; color: #8b949e; border-radius: 0 4px 4px 0; margin-top: 7px; }
  .info-box strong { color: #58a6ff; }
  .success-box { background: #161b22; border-left: 3px solid #3fb950; padding: 8px 10px; font-size: 9px; color: #8b949e; border-radius: 0 4px 4px 0; margin-top: 7px; }
  .success-box strong { color: #3fb950; }

  .t { width: 100%; font-size: 9px; border-collapse: collapse; background: #161b22; border-radius: 6px; overflow: hidden; }
  .t th { padding: 5px 8px; text-align: left; border-bottom: 1px solid #30363d; color: #8b949e; font-weight: 600; font-size: 8px; }
  .t td { padding: 4px 8px; border-bottom: 1px solid #21262d; word-break: break-word; }
  .t tr:last-child td { border: none; }

  .ent-flow-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 12px; align-items: start; }

  .summary-table { width: 100%; font-size: 10px; border-collapse: collapse; }
  .summary-table th { padding: 5px 10px; text-align: left; border-bottom: 1px solid #30363d; color: #8b949e; font-weight: 600; font-size: 9px; background: #161b22; }
  .summary-table td { padding: 4px 10px; border-bottom: 1px solid #21262d; }

  .tag-s { color: #bc8cff; font-weight: 600; }
  .tag-n { color: #58a6ff; font-weight: 600; }
  .tag-ai { color: #d29922; font-weight: 600; }
  .tag-e { color: #e3b341; font-weight: 600; }

  .legend { margin-top: 14px; padding: 10px 14px; background: #161b22; border: 1px solid #30363d; border-radius: 6px; font-size: 10px; color: #8b949e; display: flex; gap: 16px; flex-wrap: wrap; }

  @media (max-width: 1024px) {
    body { padding: 14px; }
    .flows-grid { grid-template-columns: 1fr; }
    .flow-focus-grid { grid-template-columns: 1fr; }
    .route-grid { grid-template-columns: 1fr; }
    .db-grid { grid-template-columns: 1fr; }
    .server-mini-grid { grid-template-columns: 1fr; }
    .role-grid { grid-template-columns: 1fr; }
    .ent-flow-grid { grid-template-columns: 1fr; }
    .summary-table th, .summary-table td { font-size: 9px; }
  }
</style>
</head>
<body>

<h1>SportiQue í†µí•© ì•„í‚¤í…ì²˜ v4</h1>
<p class="subtitle">í”Œë¡œìš° ì¤‘ì‹¬ êµ¬ì¡° + ì…ë ¥/ì¶œë ¥ ë¶„ë¦¬ + ë¬´ê°€ë¡œìŠ¤í¬ë¡¤ Â· 2026-02-08</p>

<!-- PART 1 -->
<div class="section-divider"><span style="color:#79c0ff;">PART 1 â€” ì…ë ¥ â†’ DB â†’ ì¶œë ¥ êµ¬ì¡°</span></div>

<div class="layer input-layer">
  <div class="layer-header">ğŸ“¥ ì…ë ¥ë‹¨ (Data Ingestion)</div>
  <div class="layer-body">
    <div class="cards">
      <div class="card"><div class="card-title">ğŸ“± UniQdata ì•± SDK</div><ul><li>ì›¨ì–´ëŸ¬ë¸”/ì„¤ë¬¸/PRO ë°ì´í„°</li><li>ë¯¼ê°ë„ ë¶„ê¸°: sensitive/non_sensitive</li></ul></div>
      <div class="card"><div class="card-title">ğŸ–¥ï¸ UniQdata ì›¹</div><ul><li>íŒ€/ì—”í„°í”„ë¼ì´ì¦ˆ ì—…ë¡œë“œ</li><li>íŒŒì¼ + ë©”íƒ€ + ë¯¼ê°ë„ ì§€ì •</li></ul></div>
      <div class="card"><div class="card-title">ğŸ¥ ê¸°ê´€ ì—°ë™</div><ul><li>Nest(ìš”ì–‘)Â·EMRÂ·IoT</li><li>FHIR R4/API ìˆ˜ì§‘</li></ul></div>
      <div class="card"><div class="card-title">ğŸ”Œ ì™¸ë¶€ ë°ì´í„°</div><ul><li>ê³µê³µ ë°ì´í„°/ì•½ë¬¼ DB</li><li>ë°ì´í„°ì…‹ ë³‘í•©ìš© ì†ŒìŠ¤</li></ul></div>
    </div>

    <div class="routing-banner">
      <div class="routing-title">ğŸ”€ ì…ë ¥ ë¼ìš°íŒ… ê·œì¹™ (ë¬¸ì„œ ê³ ì •)</div>
      <div class="routing-pills">
        <div class="pill pill-s">ê·œì¹™ 1: ì•± SDKì˜ <strong style="color:#bc8cff;">ë¯¼ê° ë°ì´í„°</strong>ëŠ” ë¸”ë¡ì²´ì¸ ì„œë²„ ê²½ìœ </div>
        <div class="pill pill-s">ê·œì¹™ 2: ì›¹(íŒ€/ì—”í„°í”„ë¼ì´ì¦ˆ) <strong style="color:#bc8cff;">ë¯¼ê° ì—…ë¡œë“œ</strong>ë„ ë¸”ë¡ì²´ì¸ ì„œë²„ ê²½ìœ </div>
        <div class="pill pill-n">ê·œì¹™ 3: <strong style="color:#58a6ff;">ë¹„ë¯¼ê° ì…ë ¥</strong>ì€ ë°±ì—”ë“œ ì§í–‰ í—ˆìš©</div>
      </div>
      <div class="route-grid">
        <div class="route-node"><strong style="color:#bc8cff;">sensitivity = sensitive</strong>ì…ë ¥ â†’ ë¸”ë¡ì²´ì¸ ê¶Œí•œ/ê°ì‚¬ â†’ ì €ì¥ + ì•µì»¤ë§</div>
        <div class="route-node"><strong style="color:#58a6ff;">sensitivity = non_sensitive</strong>ì…ë ¥ â†’ ë°±ì—”ë“œ ê²€ì¦/ì¹´íƒˆë¡œê·¸ â†’ ì €ì¥ (DB ë¡œê·¸)</div>
        <div class="route-node"><strong style="color:#d29922;">AI ì…ë ¥</strong>ë¸”ë¡ì²´ì¸ì—ì„œ ê²€ì¦/í•„í„° í›„ AI ì„œë²„ ì „ë‹¬</div>
      </div>
    </div>
  </div>
</div>

<div class="layer data-layer">
  <div class="layer-header">ğŸ—„ï¸ UniQdata DB ë°ì´í„° ë ˆì´ì–´ (ì¤‘ì•™)</div>
  <div class="layer-body">
    <div class="flow-focus">
      <h3>ì…ë ¥ ì €ì¥ ê²½ë¡œ</h3>
      <div class="flow-focus-grid">
        <div class="flow-focus-node"><strong style="color:#bc8cff;">ë¯¼ê° ì…ë ¥</strong><br>ì•±/ì›¹ â†’ ë¸”ë¡ì²´ì¸ ì„œë²„ â†’ Patient/Enterprise ë¯¼ê° í…Œì´ë¸” + XRPL</div>
        <div class="flow-focus-node"><strong style="color:#58a6ff;">ë¹„ë¯¼ê° ì…ë ¥</strong><br>ì•±/ì›¹ â†’ ë°±ì—”ë“œ ì„œë²„ â†’ ì¹´íƒˆë¡œê·¸/ë¹„ë¯¼ê° ë°ì´í„°ì…‹ í…Œì´ë¸”</div>
        <div class="flow-focus-node"><strong style="color:#79c0ff;">í•©ì„± ì¡°íšŒ ì¤€ë¹„</strong><br>Flow2-3ì—ì„œ ë¸”ë¡ì²´ì¸ ì„œë²„ê°€ Patient + Enterprise/Team ë°ì´í„°ë¥¼ ì¡°í•©</div>
      </div>
    </div>

    <div class="db-grid">
      <div class="db-box">
        <h4 style="color:#bc8cff;">ğŸŸ£ Patient Sensitive Layer (blockchain_role)</h4>
        <ul>
          <li>data_points</li>
          <li>agreements</li>
          <li>consents</li>
          <li>data_usage_records</li>
          <li>anchor_logs</li>
        </ul>
      </div>
      <div class="db-box">
        <h4 style="color:#e3b341;">ğŸŸ¡ Enterprise/Team Layer</h4>
        <ul>
          <li><span style="color:#58a6ff;">dataset_catalog</span> (backend_role)</li>
          <li><span style="color:#58a6ff;">researcher_datasets</span> (ë¹„ë¯¼ê°, backend_role)</li>
          <li><span style="color:#bc8cff;">enterprise_datasets</span> (ë¯¼ê°, blockchain_role)</li>
          <li><span style="color:#bc8cff;">dataset_access_logs</span> (ë¯¼ê° ì ‘ê·¼ ê°ì‚¬)</li>
        </ul>
      </div>
    </div>
  </div>
</div>

<div class="layer output-layer">
  <div class="layer-header">ğŸ“¤ ì¶œë ¥ë‹¨ (Data Usage)</div>
  <div class="layer-body">
    <div class="cards">
      <div class="card"><div class="card-title">ğŸ“± í™˜ì ì•± ì¶œë ¥</div><ul><li>ë‚´ ë°ì´í„° ì¡°íšŒ</li><li>ë‚´ ì ‘ê·¼ ê°ì‚¬ê¸°ë¡(Flow 4)</li></ul></div>
      <div class="card"><div class="card-title">ğŸ–¥ï¸ ì—°êµ¬/ì—”í„°í”„ë¼ì´ì¦ˆ ì¶œë ¥</div><ul><li>ë¹„ë¯¼ê° ì¡°íšŒ(Flow 1)</li><li>ë¯¼ê°/í•©ì„± ì¡°íšŒ(Flow 2)</li></ul></div>
      <div class="card"><div class="card-title">ğŸ¤– ë¶„ì„ ì¶œë ¥</div><ul><li>AI ë¶„ì„ ê²°ê³¼(Flow 3)</li><li>ê²°ê³¼ í•´ì‹œ/ê°ì‚¬ ì¦ëª…</li></ul></div>
    </div>
  </div>
</div>

<div class="layer server-layer">
  <div class="layer-header">ğŸ§± ì„œë²„ ë ˆì´ì–´ (ë³´ì¡° ë³´ê¸°)</div>
  <div class="layer-body">
    <div class="server-mini-grid">
      <div class="mini-box">
        <h4 style="color:#bc8cff;">â›“ï¸ ë¸”ë¡ì²´ì¸ ì„œë²„</h4>
        <ul><li>Passkey/WebAuthn ê²€ì¦</li><li>ë™ì˜/ê¶Œí•œ/ê°ì‚¬</li><li>ë¯¼ê° ì¡°íšŒ + í•©ì„± ì¡°íšŒ(Flow2-3)</li></ul>
      </div>
      <div class="mini-box">
        <h4 style="color:#58a6ff;">ğŸ–¥ï¸ ë°±ì—”ë“œ ì„œë²„</h4>
        <ul><li>í”„ë¡œì íŠ¸/ì¹´íƒˆë¡œê·¸ CRUD</li><li>ë¹„ë¯¼ê° ë°ì´í„° ì¡°íšŒ</li><li>ì—…ë¡œë“œ ë©”íƒ€/ìš”ì²­/ìŠ¹ì¸ ê´€ë¦¬</li></ul>
      </div>
      <div class="mini-box">
        <h4 style="color:#d29922;">ğŸ¤– AI ì„œë²„</h4>
        <ul><li>Stateless ë¶„ì„ ì²˜ë¦¬</li><li>DB ì§ì ‘ ì ‘ê·¼ ì—†ìŒ</li><li>ë¸”ë¡ì²´ì¸ ì „ë‹¬ ë°ì´í„°ë§Œ ì‚¬ìš©</li></ul>
      </div>
    </div>
  </div>
</div>

<div class="layer" style="border-color:#30363d;">
  <div class="layer-header" style="background:#161b22; color:#79c0ff;">ğŸ“Š ì—­í•  êµ¬ì¡°</div>
  <div class="layer-body">
    <div class="role-grid">
      <div class="role-card">
        <h4>ğŸ¢ Workspace (ì—”í„°í”„ë¼ì´ì¦ˆ)</h4>
        <div class="role-row"><span class="role-name">OWNER</span><span class="role-desc">ì›Œí¬ìŠ¤í˜ì´ìŠ¤ ìƒì„±ì</span></div>
        <div class="role-row"><span class="role-name">ADMIN</span><span class="role-desc">ì˜ˆì‚°/í”„ë¡œì íŠ¸/ë°ì´í„°ì…‹ ê´€ë¦¬</span></div>
        <div class="role-row"><span class="role-name">MEMBER</span><span class="role-desc">í”„ë¡œì íŠ¸ ì°¸ì—¬/ë°ì´í„° ìš”ì²­</span></div>
        <div class="role-row"><span class="role-name">AUDITOR</span><span class="role-desc">ê°ì‚¬ ë¡œê·¸ ì½ê¸° ì „ìš©</span></div>
      </div>
      <div class="role-card">
        <h4>ğŸ”¬ Project (ì—°êµ¬)</h4>
        <div class="role-row"><span class="role-name">owner</span><span class="role-desc">PI/ê²°ì •ê¶Œì</span></div>
        <div class="role-row"><span class="role-name">member</span><span class="role-desc">ì¡°íšŒ/ë¶„ì„ ì‹¤í–‰</span></div>
      </div>
    </div>
  </div>
</div>

<!-- PART 2 -->
<div class="section-divider"><span style="color:#79c0ff;">PART 2 â€” ì¶œë ¥ í”Œë¡œìš° (FLOW 1~4 ë³‘ë ¬)</span></div>

<div class="routing-banner">
  <div class="routing-title">API ì¸í„°í˜ì´ìŠ¤ ê³ ì • (ë¬¸ì„œ ê¸°ì¤€)</div>
  <div class="routing-pills">
    <div class="pill pill-s">GET /blockchain/data/patient/* (Flow2-1)</div>
    <div class="pill pill-s">GET /blockchain/data/enterprise/* (Flow2-2)</div>
    <div class="pill pill-s">POST /blockchain/data/composite/query (Flow2-3)</div>
    <div class="pill pill-ai">POST /blockchain/ai/analyze (Flow3)</div>
    <div class="pill pill-s">GET /blockchain/my-data/access-log (Flow4)</div>
  </div>
</div>

<div class="flows-grid">

  <div class="flow-panel fp-nonsensitive">
    <div class="flow-header">ğŸ”µ FLOW 1 â€” ë¹„ë¯¼ê° ë°ì´í„° ì¡°íšŒ</div>
    <div class="flow-body">
      <div class="step"><div class="step-num" style="color:#58a6ff;">1</div><div class="step-title" style="color:#58a6ff;">í´ë¼ì´ì–¸íŠ¸ ìš”ì²­</div><div class="step-desc">ì„¸ì…˜ í† í° ê¸°ë°˜ ì¡°íšŒ</div><div class="step-code">GET /api/projects/:id/overview</div></div>
      <div class="step-arrow">â–¼</div>
      <div class="step"><div class="step-num" style="color:#58a6ff;">2</div><div class="step-title" style="color:#58a6ff;">ë°±ì—”ë“œ ê²€ì¦ + ì¡°íšŒ</div><div class="step-desc">backend_role ë¹„ë¯¼ê° í…Œì´ë¸” ì¡°íšŒ</div></div>
      <div class="step-arrow">â–¼</div>
      <div class="step"><div class="step-num" style="color:#58a6ff;">3</div><div class="step-title" style="color:#58a6ff;">ì‘ë‹µ ë°˜í™˜</div><div class="step-desc">ë°±ì—”ë“œ â†’ ì›¹/ì•±</div></div>
      <div class="info-box"><strong>ëŒ€ìƒ:</strong> í”„ë¡œì íŠ¸, ì¹´íƒˆë¡œê·¸ ë©”íƒ€, ë¹„ë¯¼ê° ë°ì´í„°ì…‹ ì¡°íšŒ</div>
      <table class="t" style="margin-top:8px;">
        <tr><th>í•­ëª©</th><th>ê°’</th></tr>
        <tr><td>ê²½ìœ </td><td>ë°±ì—”ë“œ</td></tr>
        <tr><td>ë™ì˜ ê²€ì‚¬</td><td>ì„ íƒ(ë¯¼ê° ì•„ë‹˜)</td></tr>
        <tr><td>ì•µì»¤ë§</td><td>ì—†ìŒ</td></tr>
      </table>
    </div>
  </div>

  <div class="flow-panel fp-sensitive">
    <div class="flow-header">ğŸŸ£ FLOW 2 â€” ë¯¼ê° ë°ì´í„° ì¡°íšŒ (2-1/2-2/2-3)</div>
    <div class="flow-body">
      <div class="step"><div class="step-num" style="color:#bc8cff;">1</div><div class="step-title" style="color:#bc8cff;">ë¸”ë¡ì²´ì¸ ì„œë²„ ìš”ì²­</div><div class="step-desc">Passkey + ë™ì˜ ë²”ìœ„ ê¸°ë°˜</div></div>
      <div class="step-arrow">â–¼</div>
      <div class="step"><div class="step-num" style="color:#bc8cff;">2</div><div class="step-title" style="color:#bc8cff;">ì¸ì¦/ê¶Œí•œ/ë™ì˜ ê²€ì¦</div><div class="step-desc">ì—­í•  + scope + ê¸°ê°„ ê²€ì‚¬</div></div>

      <div class="subflow-box">
        <div class="subflow-title">Flow2-1: í™˜ì(UniQdata) ë°ì´í„° ì¡°íšŒ</div>
        <div class="subflow-text">GET /blockchain/data/patient/* â†’ data_points/agreements ì¡°íšŒ</div>
      </div>
      <div class="subflow-box">
        <div class="subflow-title">Flow2-2: ì—”í„°í”„ë¼ì´ì¦ˆ/íŒ€ ë¯¼ê° DB ì¡°íšŒ</div>
        <div class="subflow-text">GET /blockchain/data/enterprise/* â†’ enterprise_datasets ì¡°íšŒ</div>
      </div>
      <div class="subflow-box">
        <div class="subflow-title">Flow2-3: í•©ì„± ë°ì´í„° ì¡°íšŒ (ì„œë²„ì¸¡ ì¡°í•©)</div>
        <div class="subflow-text">POST /blockchain/data/composite/query â†’ patient + enterprise/team ì¡°í•© í›„ ë‹¨ì¼ ì‘ë‹µ</div>
      </div>

      <div class="step-arrow">â–¼</div>
      <div class="step"><div class="step-num" style="color:#bc8cff;">3</div><div class="step-title" style="color:#bc8cff;">ê°ì‚¬ ê¸°ë¡</div><div class="step-desc">data_usage_records + anchor_logs ê¸°ë¡</div></div>
      <div class="warn-box"><strong>ì›ì¹™:</strong> ë¯¼ê° ì¡°íšŒëŠ” ë°±ì—”ë“œ ì§ì ‘ ì ‘ê·¼ ë¶ˆê°€, ë¸”ë¡ì²´ì¸ ê²½ìœ  ê³ ì •</div>
      <table class="t" style="margin-top:8px;">
        <tr><th>í•­ëª©</th><th>ê°’</th></tr>
        <tr><td>ê²½ìœ </td><td>ë¸”ë¡ì²´ì¸</td></tr>
        <tr><td>ë™ì˜ ê²€ì‚¬</td><td>ë§¤ ìš”ì²­</td></tr>
        <tr><td>í•©ì„± ìœ„ì¹˜</td><td>ë¸”ë¡ì²´ì¸ ì„œë²„</td></tr>
      </table>
    </div>
  </div>

  <div class="flow-panel fp-ai">
    <div class="flow-header">ğŸŸ¡ FLOW 3 â€” ë¸”ë¡ì²´ì¸ ê²½ìœ  AI ë¶„ì„</div>
    <div class="flow-body">
      <div class="step"><div class="step-num" style="color:#d29922;">1</div><div class="step-title" style="color:#d29922;">ë¶„ì„ ìš”ì²­</div><div class="step-desc">ë¯¼ê° ë°ì´í„° ì§ì ‘ ì „ë‹¬ ê¸ˆì§€</div><div class="step-code">POST /blockchain/ai/analyze</div></div>
      <div class="step-arrow">â–¼</div>
      <div class="step"><div class="step-num" style="color:#bc8cff;">2</div><div class="step-title" style="color:#bc8cff;">ë¸”ë¡ì²´ì¸ ê²€ì¦/í•„í„°</div><div class="step-desc">ê¶Œí•œ + ë™ì˜ + ì»¬ëŸ¼ ìµœì†Œí™” + ë¹„ì‹ë³„</div></div>
      <div class="step-arrow">â–¼</div>
      <div class="step"><div class="step-num" style="color:#d29922;">3</div><div class="step-title" style="color:#d29922;">AI ì„œë²„ ë¶„ì„</div><div class="step-desc">Stateless ì²˜ë¦¬ í›„ ì›ë³¸ íê¸°</div></div>
      <div class="step-arrow">â–¼</div>
      <div class="step"><div class="step-num" style="color:#bc8cff;">4</div><div class="step-title" style="color:#bc8cff;">ê²°ê³¼ í•´ì‹œ/ë¡œê·¸</div><div class="step-desc">anchor_logsì— ê²°ê³¼ ì¦ì  ì €ì¥</div></div>
      <div class="success-box"><strong>ë³´ì•ˆ:</strong> AI ì„œë²„ëŠ” DB direct access ì—†ìŒ</div>
      <table class="t" style="margin-top:8px;">
        <tr><th>í•­ëª©</th><th>ê°’</th></tr>
        <tr><td>ê²½ìœ </td><td>ë¸”ë¡ì²´ì¸ â†’ AI</td></tr>
        <tr><td>ì…ë ¥ ë°ì´í„°</td><td>í•„í„°/ë¹„ì‹ë³„ë§Œ</td></tr>
        <tr><td>ì•µì»¤ë§</td><td>ê²°ê³¼ í•´ì‹œ</td></tr>
      </table>
    </div>
  </div>

  <div class="flow-panel fp-audit">
    <div class="flow-header">ğŸŸ¢ FLOW 4 â€” í™˜ì ì•± ê°ì‚¬ê¸°ë¡ ì¡°íšŒ</div>
    <div class="flow-body">
      <div class="step"><div class="step-num" style="color:#3fb950;">1</div><div class="step-title" style="color:#3fb950;">í™˜ì ë³¸ì¸ ìš”ì²­</div><div class="step-desc">Passkey ì¬ê²€ì¦ ê°€ëŠ¥</div><div class="step-code">GET /blockchain/my-data/access-log</div></div>
      <div class="step-arrow">â–¼</div>
      <div class="step"><div class="step-num" style="color:#bc8cff;">2</div><div class="step-title" style="color:#bc8cff;">ë¸”ë¡ì²´ì¸ ë³¸ì¸í™•ì¸</div><div class="step-desc">íƒ€ì¸ ë¡œê·¸ ì ‘ê·¼ ì°¨ë‹¨</div></div>
      <div class="step-arrow">â–¼</div>
      <div class="step"><div class="step-num" style="color:#bc8cff;">3</div><div class="step-title" style="color:#bc8cff;">ì ‘ê·¼ê¸°ë¡ ì¡°íšŒ</div><div class="step-desc">data_usage_records + anchor ì°¸ì¡°</div></div>
      <div class="step-arrow">â–¼</div>
      <div class="step"><div class="step-num" style="color:#3fb950;">4</div><div class="step-title" style="color:#3fb950;">ì•±ì— ê°ì‚¬ê¸°ë¡ ì¶œë ¥</div><div class="step-desc">ëˆ„ê°€/ì–¸ì œ/ì–´ë–¤ ë²”ìœ„ ì¡°íšŒí–ˆëŠ”ì§€ ì œê³µ</div></div>
      <div class="success-box"><strong>íš¨ê³¼:</strong> ì°¸ì—¬ì íˆ¬ëª…ì„± í™•ë³´ + ë¶„ìŸ ì¦ì  ì œê³µ</div>
      <table class="t" style="margin-top:8px;">
        <tr><th>í•­ëª©</th><th>ê°’</th></tr>
        <tr><td>ê²½ìœ </td><td>ë¸”ë¡ì²´ì¸</td></tr>
        <tr><td>ëŒ€ìƒ</td><td>ë³¸ì¸ ì ‘ê·¼ê¸°ë¡ë§Œ</td></tr>
        <tr><td>ì¶œë ¥</td><td>ê¸°ë¡ + anchor_tx</td></tr>
      </table>
    </div>
  </div>
</div>

<!-- PART 3 -->
<div class="section-divider"><span style="color:#e3b341;">PART 3 â€” ì—”í„°í”„ë¼ì´ì¦ˆ ë°ì´í„° ë ˆì´ì–´</span></div>

<div class="layer enterprise-layer">
  <div class="layer-header">ğŸ“¦ ì›Œí¬ìŠ¤í˜ì´ìŠ¤ ë°ì´í„° ì¹´íƒˆë¡œê·¸ + ì—…ë¡œë“œ/ì ‘ê·¼</div>
  <div class="layer-body">
    <div class="cards" style="margin-bottom:10px;">
      <div class="card">
        <div class="card-title" style="color:#e3b341;">ë¶„ë¥˜ ê·œì¹™</div>
        <table class="t">
          <tr><th>ë¶„ë¥˜</th><th>ì €ì¥/ì¡°íšŒ ê²½ë¡œ</th><th>ê°ì‚¬</th></tr>
          <tr><td class="tag-s">ë¯¼ê°</td><td>ë¸”ë¡ì²´ì¸ ì„œë²„</td><td>XRPL ì•µì»¤ë§</td></tr>
          <tr><td class="tag-n">ë¹„ë¯¼ê°</td><td>ë°±ì—”ë“œ ì„œë²„</td><td>DB ë¡œê·¸</td></tr>
        </table>
      </div>
      <div class="card">
        <div class="card-title" style="color:#e3b341;">í•µì‹¬ í…Œì´ë¸”</div>
        <table class="t">
          <tr><th>í…Œì´ë¸”</th><th>ì—­í• </th></tr>
          <tr><td>dataset_catalog</td><td>ë©”íƒ€/ê²€ìƒ‰</td></tr>
          <tr><td>researcher_datasets</td><td>ë¹„ë¯¼ê° ì‹¤ì œ ë°ì´í„°</td></tr>
          <tr><td>enterprise_datasets</td><td>ë¯¼ê° ì‹¤ì œ ë°ì´í„°</td></tr>
          <tr><td>dataset_access_logs</td><td>ì ‘ê·¼ ê°ì‚¬/ì¦ì </td></tr>
        </table>
      </div>
    </div>

    <div class="ent-flow-grid">
      <div style="border:2px solid #e3b34144; border-radius:8px; overflow:hidden;">
        <div style="padding:9px 12px; background:#2a2a1a; color:#e3b341; font-size:11px; font-weight:700; text-align:center;">ğŸ“¤ FLOW A â€” ì›¹ ì—…ë¡œë“œ</div>
        <div style="padding:10px; background:#0d1117;">
          <div class="step"><div class="step-num" style="color:#3fb950;">1</div><div class="step-title" style="color:#3fb950;">UniQdata ì›¹ ì—…ë¡œë“œ</div><div class="step-desc">POST /api/datasets/upload + sensitivity ì§€ì •</div></div>
          <div class="step-arrow">â–¼</div>
          <div class="step"><div class="step-num" style="color:#58a6ff;">2</div><div class="step-title" style="color:#58a6ff;">ë°±ì—”ë“œ ì¹´íƒˆë¡œê·¸ ë“±ë¡</div><div class="step-desc">dataset_catalog ìƒì„±</div></div>
          <div class="step-arrow">â–¼</div>
          <div class="step"><div class="step-num" style="color:#e3b341;">3</div><div class="step-title" style="color:#e3b341;">ë¯¼ê°ë„ ë¶„ê¸° ì €ì¥</div><div class="step-desc">ë¯¼ê°â†’BC/enterprise_datasets, ë¹„ë¯¼ê°â†’BE/researcher_datasets</div></div>
        </div>
      </div>
      <div style="border:2px solid #3fb95044; border-radius:8px; overflow:hidden;">
        <div style="padding:9px 12px; background:#1a3a2a; color:#3fb950; font-size:11px; font-weight:700; text-align:center;">ğŸ”“ FLOW B â€” ì ‘ê·¼ ìš”ì²­/ìŠ¹ì¸/ê°ì‚¬</div>
        <div style="padding:10px; background:#0d1117;">
          <div class="step"><div class="step-num" style="color:#3fb950;">1</div><div class="step-title" style="color:#3fb950;">ì ‘ê·¼ ìš”ì²­</div><div class="step-desc">/api/datasets/{id}/request-access</div></div>
          <div class="step-arrow">â–¼</div>
          <div class="step"><div class="step-num" style="color:#58a6ff;">2</div><div class="step-title" style="color:#58a6ff;">ìŠ¹ì¸/ê±°ì ˆ ê¸°ë¡</div><div class="step-desc">grant ê¸°ê°„/ë²”ìœ„ ì €ì¥</div></div>
          <div class="step-arrow">â–¼</div>
          <div class="step"><div class="step-num" style="color:#bc8cff;">3</div><div class="step-title" style="color:#bc8cff;">ì‹¤ì œ ì ‘ê·¼ ê°ì‚¬</div><div class="step-desc">ë¯¼ê° ì ‘ê·¼ì€ BC + anchor, ë¹„ë¯¼ê°ì€ BE ë¡œê·¸</div></div>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- ROUTING MATRIX -->
<div class="section-divider"><span style="color:#e3b341;">ğŸ“‹ ì „ì²´ ë¼ìš°íŒ… ë§¤íŠ¸ë¦­ìŠ¤</span></div>

<table class="summary-table">
  <tr><th>êµ¬ë¶„</th><th>ì‘ì—…</th><th>ê²½ë¡œ</th><th>ì„œë²„</th><th>ì•µì»¤ë§/ê°ì‚¬</th></tr>
  <tr style="background:#58a6ff08;"><td>ì…ë ¥(ì“°ê¸°)</td><td>ì•± ë¹„ë¯¼ê° ì…ë ¥</td><td class="tag-n">ğŸ”µ</td><td>ë°±ì—”ë“œ</td><td>DB ë¡œê·¸</td></tr>
  <tr style="background:#bc8cff08;"><td>ì…ë ¥(ì“°ê¸°)</td><td>ì•± ë¯¼ê° ì…ë ¥</td><td class="tag-s">ğŸŸ£</td><td>ë¸”ë¡ì²´ì¸</td><td>DATA_SUBMIT + anchor</td></tr>
  <tr style="background:#58a6ff08;"><td>ì…ë ¥(ì“°ê¸°)</td><td>ì›¹ ë¹„ë¯¼ê° ì—…ë¡œë“œ</td><td class="tag-n">ğŸ”µ</td><td>ë°±ì—”ë“œ</td><td>ì¹´íƒˆë¡œê·¸/ë¡œê·¸</td></tr>
  <tr style="background:#bc8cff08;"><td>ì…ë ¥(ì“°ê¸°)</td><td>ì›¹ ë¯¼ê° ì—…ë¡œë“œ</td><td class="tag-s">ğŸŸ£</td><td>ë¸”ë¡ì²´ì¸</td><td>DATASET_UPLOAD + anchor</td></tr>
  <tr><td>ì¶œë ¥(ì¡°íšŒ/í™œìš©)</td><td>FLOW 1 ë¹„ë¯¼ê° ì¡°íšŒ</td><td class="tag-n">ğŸ”µ</td><td>ë°±ì—”ë“œ</td><td>ì¼ë°˜ ë¡œê·¸</td></tr>
  <tr><td>ì¶œë ¥(ì¡°íšŒ/í™œìš©)</td><td>FLOW 2-1 í™˜ì ë°ì´í„° ì¡°íšŒ</td><td class="tag-s">ğŸŸ£</td><td>ë¸”ë¡ì²´ì¸</td><td>DATA_ACCESS</td></tr>
  <tr><td>ì¶œë ¥(ì¡°íšŒ/í™œìš©)</td><td>FLOW 2-2 ì—”í„°í”„ë¼ì´ì¦ˆ ë¯¼ê° ì¡°íšŒ</td><td class="tag-s">ğŸŸ£</td><td>ë¸”ë¡ì²´ì¸</td><td>DATASET_ACCESS</td></tr>
  <tr><td>ì¶œë ¥(ì¡°íšŒ/í™œìš©)</td><td>FLOW 2-3 í•©ì„± ì¡°íšŒ</td><td class="tag-s">ğŸŸ£</td><td>ë¸”ë¡ì²´ì¸(í•©ì„±)</td><td>DATA_ACCESS + DATASET_ACCESS</td></tr>
  <tr><td>ì¶œë ¥(ì¡°íšŒ/í™œìš©)</td><td>FLOW 3 AI ë¶„ì„</td><td class="tag-ai">ğŸŸ¡</td><td>BC â†’ AI</td><td>AI_ANALYSIS + ê²°ê³¼ í•´ì‹œ</td></tr>
  <tr><td>ì¶œë ¥(ì¡°íšŒ/í™œìš©)</td><td>FLOW 4 í™˜ì ê°ì‚¬ê¸°ë¡ ì¡°íšŒ</td><td class="tag-s">ğŸŸ£</td><td>ë¸”ë¡ì²´ì¸</td><td>data_usage_records + anchor_tx</td></tr>
</table>

<div class="legend">
  <span><span style="color:#bc8cff;">ğŸŸ£</span> ë¯¼ê°: ë¸”ë¡ì²´ì¸ ê²½ìœ </span>
  <span><span style="color:#58a6ff;">ğŸ”µ</span> ë¹„ë¯¼ê°: ë°±ì—”ë“œ ì§ì ‘</span>
  <span><span style="color:#d29922;">ğŸŸ¡</span> AI: BC â†’ AI</span>
  <span><span style="color:#79c0ff;">íƒ€ì…</span> sensitivity = sensitive | non_sensitive</span>
</div>

</body>
</html>
