<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>연구 생성 Step 3 - 데이터 수집 - Wireframe</title>
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body { font-family: -apple-system, sans-serif; background: #f5f5f5; }

    /* ===== 레이아웃 ===== */
    .layout { display: flex; min-height: 100vh; width: 100%; }

    /* Nav (좌측 사이드바) */
    .sidebar {
      width: 240px;
      background: linear-gradient(180deg, #0f172a 0%, #1e293b 100%);
      color: white;
      display: flex;
      flex-direction: column;
      flex-shrink: 0;
    }
    .logo {
      padding: 20px 24px;
      font-size: 20px;
      font-weight: 700;
      border-bottom: 1px solid rgba(255,255,255,0.1);
      display: flex;
      align-items: center;
      gap: 10px;
    }
    .logo-icon {
      width: 32px; height: 32px;
      background: linear-gradient(135deg, #3b82f6, #8b5cf6);
      border-radius: 8px;
      display: flex; align-items: center; justify-content: center;
      font-size: 16px; font-weight: bold;
    }
    .nav-section { padding: 16px 12px; border-bottom: 1px solid rgba(255,255,255,0.05); }
    .nav-section-title { font-size: 11px; text-transform: uppercase; color: #64748b; padding: 8px 12px; letter-spacing: 0.5px; }
    .nav-item {
      display: flex; align-items: center; gap: 12px;
      padding: 10px 12px; border-radius: 8px; color: #94a3b8;
      cursor: pointer; font-size: 14px; text-decoration: none; transition: all 0.15s;
    }
    .nav-item:hover { background: rgba(255,255,255,0.05); color: #e2e8f0; }
    .nav-item.active { background: rgba(59, 130, 246, 0.2); color: #60a5fa; }
    .nav-item .icon { width: 20px; text-align: center; }

    /* Workspace wrapper */
    .workspace-wrap {
      flex: 1;
      display: flex;
      flex-direction: column;
      min-width: 0;
    }
    .workspace {
      flex: 1;
      display: flex;
      min-height: 0;
    }

    /* Step Bar */
    .step-bar {
      background: #1e293b;
      border-bottom: 1px solid #334155;
      padding: 10px 0;
      flex-shrink: 0;
    }
    .step-bar-inner {
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 0;
      max-width: 600px;
      margin: 0 auto;
    }
    .sb-step {
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 4px;
    }
    .sb-num {
      width: 24px;
      height: 24px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 11px;
      font-weight: 600;
    }
    .sb-step.done .sb-num { background: #22c55e; color: white; }
    .sb-step.active .sb-num { background: #8b5cf6; color: white; }
    .sb-step.pending .sb-num { background: #334155; color: #64748b; }
    .sb-label {
      font-size: 10px;
      color: #64748b;
      white-space: nowrap;
    }
    .sb-step.active .sb-label { color: #e2e8f0; }
    a.sb-step { text-decoration: none; color: inherit; cursor: pointer; }
    a.sb-step:hover .sb-num:not(.active) { transform: scale(1.1); transition: transform 0.15s; }
    a.sb-step:hover .sb-label { color: #e2e8f0; }
    .sb-line {
      width: 40px;
      height: 2px;
      background: #334155;
      margin: 0 4px;
      margin-bottom: 18px;
    }
    .sb-line.done { background: #22c55e; }

    .sidebar-footer {
      margin-top: auto; padding: 16px; border-top: 1px solid rgba(255,255,255,0.05);
    }
    .user-info-sidebar { display: flex; align-items: center; gap: 12px; padding: 8px; }
    .user-avatar-sidebar {
      width: 36px; height: 36px;
      background: linear-gradient(135deg, #3b82f6, #8b5cf6);
      border-radius: 50%; display: flex; align-items: center; justify-content: center;
      font-size: 14px; color: white;
    }
    .user-name-sidebar { font-size: 14px; color: #e2e8f0; }
    .user-org-sidebar { font-size: 12px; color: #64748b; }

    /* 에디터 패널 (중앙) */
    .editor-panel {
      flex: 1;
      overflow-y: auto;
      padding: 28px 32px;
      background: white;
    }

    /* 카드 */
    .card { background: white; border: 1px solid #e5e7eb; border-radius: 12px; margin-bottom: 20px; overflow: hidden; }
    .card-header { background: #f9fafb; padding: 16px 20px; border-bottom: 1px solid #e5e7eb; display: flex; justify-content: space-between; align-items: center; }
    .card-header h3 { font-size: 16px; font-weight: 600; }
    .card-body { padding: 20px; }
    .ai-badge { font-size: 11px; color: #7c3aed; background: #f3e8ff; padding: 4px 10px; border-radius: 12px; }

    /* 데이터 카테고리 섹션 */
    .data-category { margin-bottom: 24px; }
    .data-category-title { font-size: 14px; font-weight: 600; color: #374151; margin-bottom: 12px; display: flex; align-items: center; gap: 8px; }
    .data-category-title .icon { font-size: 18px; }
    .data-category-desc { font-size: 12px; color: #6b7280; margin-bottom: 12px; }

    /* 데이터 항목 그리드 */
    .data-grid { display: grid; grid-template-columns: repeat(2, 1fr); gap: 10px; }
    .data-item { padding: 14px 16px; border: 2px solid #e5e7eb; border-radius: 10px; cursor: pointer; transition: all 0.2s; display: flex; align-items: center; gap: 12px; }
    .data-item:hover { border-color: #c4b5fd; }
    .data-item.selected { border-color: #8b5cf6; background: #faf5ff; }
    .data-item .icon { font-size: 20px; }
    .data-item .info { flex: 1; }
    .data-item .name { font-size: 14px; font-weight: 500; margin-bottom: 2px; }
    .data-item .desc { font-size: 11px; color: #6b7280; }
    .data-item .ai-reason { font-size: 10px; color: #7c3aed; margin-top: 4px; line-height: 1.3; background: #f5f3ff; padding: 3px 8px; border-radius: 4px; border-left: 2px solid #8b5cf6; }
    .ema-row .ai-reason { font-size: 10px; color: #7c3aed; margin-top: 2px; margin-left: 112px; background: #f5f3ff; padding: 2px 8px; border-radius: 4px; border-left: 2px solid #8b5cf6; }
    .data-item .check {
      width: 36px;
      height: 20px;
      border-radius: 999px;
      background: #e5e7eb;
      position: relative;
      flex-shrink: 0;
    }
    .data-item .check::after {
      content: "";
      width: 16px;
      height: 16px;
      background: #fff;
      position: absolute;
      top: 2px;
      left: 2px;
      border-radius: 50%;
      box-shadow: 0 1px 2px rgba(0,0,0,0.2);
      transition: all 0.2s;
    }
    .data-item.selected .check { background: #8b5cf6; }
    .data-item.selected .check::after { left: 18px; }

    /* EMA 설정 */
    .ema-settings { background: #f9fafb; border: 1px solid #e5e7eb; border-radius: 8px; padding: 16px; margin-top: 12px; }
    .ema-settings h4 { font-size: 13px; font-weight: 600; margin-bottom: 12px; }
    .ema-row { display: flex; align-items: center; gap: 12px; margin-bottom: 8px; }
    .ema-row label { font-size: 13px; color: #374151; min-width: 100px; }
    .ema-select { padding: 8px 12px; border: 1px solid #e5e7eb; border-radius: 6px; font-size: 13px; }
    .ema-select.ai-filled { border-color: #8b5cf6; background: #faf5ff; }

    /* 맥락/정성 섹션 */
    .context-section { background: #f8fafc; border: 1px dashed #cbd5f5; border-radius: 8px; padding: 12px; margin-top: 12px; }
    .context-section h4 { font-size: 13px; font-weight: 600; margin-bottom: 10px; color: #334155; }

    /* 레포트 보기 버튼 (각 섹션 헤더 오른쪽) */
    .report-btn {
      display: inline-flex; align-items: center; gap: 6px;
      padding: 6px 14px; border-radius: 8px; font-size: 12px; font-weight: 600;
      cursor: pointer; border: 1px solid #ddd6fe; background: white; color: #7c3aed;
      transition: all 0.15s;
    }
    .report-btn:hover { background: #f5f3ff; border-color: #a78bfa; }
    .report-btn .icon { font-size: 14px; }
    .header-right { display: flex; align-items: center; gap: 8px; }

    /* ===== 모달 오버레이 ===== */
    .modal-overlay {
      display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%;
      background: rgba(0,0,0,0.4); z-index: 1000; justify-content: center; align-items: center;
    }
    .modal-overlay.show { display: flex; }
    .modal {
      background: white; border-radius: 16px; width: 640px; max-height: 80vh;
      overflow: hidden; box-shadow: 0 25px 50px rgba(0,0,0,0.25);
      display: flex; flex-direction: column;
    }
    .modal-header {
      padding: 16px 24px; border-bottom: 1px solid #e5e7eb;
      display: flex; align-items: center; justify-content: space-between;
      background: #f9fafb;
    }
    .modal-header h3 { font-size: 16px; font-weight: 600; }
    .modal-header .badge { font-size: 11px; color: #6b7280; background: #f3f4f6; padding: 3px 10px; border-radius: 8px; }
    .modal-close { width: 32px; height: 32px; border: 1px solid #e5e7eb; border-radius: 8px; background: white; cursor: pointer; font-size: 16px; display: flex; align-items: center; justify-content: center; }
    .modal-body { padding: 24px; overflow-y: auto; flex: 1; }

    /* 모달 내부 콘텐츠 */
    .rationale-item { display: flex; gap: 12px; padding: 14px; border: 1px solid #e5e7eb; border-radius: 10px; margin-bottom: 10px; }
    .rationale-item:hover { background: #f9fafb; }
    .rationale-icon { width: 40px; height: 40px; border-radius: 10px; background: #f3e8ff; display: flex; align-items: center; justify-content: center; font-size: 18px; flex-shrink: 0; }
    .rationale-info { flex: 1; }
    .rationale-title { font-size: 13px; font-weight: 600; color: #7c3aed; margin-bottom: 4px; }
    .rationale-desc { font-size: 12px; color: #6b7280; line-height: 1.5; }
    .rationale-stat { font-size: 11px; color: #059669; font-weight: 600; margin-top: 4px; }
    .method-note { background: #eff6ff; border: 1px solid #bfdbfe; border-radius: 8px; padding: 12px 14px; font-size: 12px; color: #1e40af; margin-top: 12px; line-height: 1.6; }

    /* 요약 박스 */
    .summary-box { background: #eff6ff; border: 1px solid #bfdbfe; padding: 16px; border-radius: 8px; margin-top: 20px; }
    .summary-box h4 { font-size: 14px; margin-bottom: 12px; color: #1d4ed8; }
    .summary-grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: 12px; }
    .summary-item { text-align: center; }
    .summary-item .value { font-size: 24px; font-weight: 700; color: #1e40af; }
    .summary-item .label { font-size: 11px; color: #6b7280; }

    /* 상태 뱃지 */
    .status-badge { display: inline-flex; align-items: center; gap: 6px; padding: 6px 14px; border-radius: 20px; font-size: 13px; font-weight: 500; }

    /* 버튼 */
    .btn { padding: 14px 28px; border-radius: 8px; font-size: 15px; font-weight: 600; cursor: pointer; text-decoration: none; display: inline-flex; align-items: center; justify-content: center; border: none; text-align: center; transition: all 0.15s; }
    .btn-secondary { background: white; border: 1px solid #e5e7eb; color: #374151; }
    .btn-secondary:hover { background: #f9fafb; }
    .btn-primary { background: #8b5cf6; color: white; }
    .btn-primary:hover { background: #7c3aed; }
    .btn-row { display: flex; justify-content: space-between; align-items: center; margin-top: 24px; padding-top: 24px; border-top: 1px solid #e5e7eb; }

    /* AI 채팅 패널 (우측) */
    .chat-panel {
      width: 360px;
      flex-shrink: 0;
      display: flex;
      flex-direction: column;
      border-left: 1px solid #e5e7eb;
      background: #fafafa;
    }
    .chat-panel-inner {
      flex: 1;
      display: flex;
      flex-direction: column;
      background: linear-gradient(180deg, #0f172a 0%, #1e293b 100%);
      color: #e5e7eb;
    }
    .chat-header {
      padding: 16px 20px;
      border-bottom: 1px solid #334155;
      background: rgba(139, 92, 246, 0.1);
    }
    .chat-header .title {
      font-size: 15px; font-weight: 700;
      display: flex; align-items: center; gap: 8px;
    }
    .chat-header .title .icon {
      width: 28px; height: 28px;
      background: linear-gradient(135deg, #8b5cf6, #6366f1);
      border-radius: 8px;
      display: flex; align-items: center; justify-content: center; font-size: 14px;
    }
    .chat-header .sub { font-size: 12px; color: #94a3b8; margin-top: 4px; }

    .chat-context {
      margin: 12px; padding: 12px;
      background: #1e293b; border: 1px solid #334155; border-radius: 10px;
    }
    .chat-context .label { font-size: 11px; color: #64748b; margin-bottom: 6px; }
    .chat-context .value { font-size: 13px; color: #e2e8f0; line-height: 1.5; }
    .chat-context-chips { display: flex; flex-wrap: wrap; gap: 6px; margin-top: 8px; }
    .chat-context-chip {
      padding: 4px 10px; background: #8b5cf6; border-radius: 12px;
      font-size: 11px; color: white;
    }

    .chat-messages {
      flex: 1; overflow-y: auto; padding: 16px;
      display: flex; flex-direction: column; gap: 12px;
    }
    .msg {
      max-width: 90%; padding: 12px 14px; border-radius: 12px;
      font-size: 13px; line-height: 1.5;
    }
    .msg.ai {
      background: #1e293b; border: 1px solid #334155;
      align-self: flex-start; border-bottom-left-radius: 4px;
    }
    .msg.user {
      background: #3b82f6; color: white;
      align-self: flex-end; border-bottom-right-radius: 4px;
    }
    .msg .sender { font-size: 11px; color: #64748b; margin-bottom: 4px; }
    .msg.user .sender { color: rgba(255,255,255,0.7); }

    .chat-quick {
      padding: 12px; border-top: 1px solid #334155; background: rgba(0,0,0,0.2);
    }
    .chat-quick .label { font-size: 11px; color: #64748b; margin-bottom: 8px; }
    .chat-quick-chips { display: flex; flex-wrap: wrap; gap: 6px; }
    .chat-quick-chip {
      padding: 6px 12px; background: #334155; border: 1px solid #475569;
      border-radius: 16px; font-size: 12px; color: #cbd5e1; cursor: pointer;
    }
    .chat-quick-chip:hover { background: #475569; border-color: #8b5cf6; }

    .chat-input {
      padding: 16px; border-top: 1px solid #334155; background: #0f172a;
    }
    .chat-input-wrapper {
      display: flex; gap: 8px;
      background: #1e293b; border: 1px solid #334155;
      border-radius: 12px; padding: 4px;
    }
    .chat-input-wrapper:focus-within { border-color: #8b5cf6; }
    .chat-input input {
      flex: 1; background: transparent; border: none;
      padding: 10px 12px; font-size: 13px; color: #e2e8f0; outline: none;
    }
    .chat-input input::placeholder { color: #64748b; }
    .chat-send-btn {
      width: 40px; height: 40px;
      background: linear-gradient(135deg, #8b5cf6, #6366f1);
      border: none; border-radius: 8px; color: white; cursor: pointer;
      display: flex; align-items: center; justify-content: center; font-size: 16px;
    }

    /* 디자이너 노트 (하단 오버레이) */
    .designer-notes {
      position: fixed; bottom: 0; left: 0; right: 0;
      background: linear-gradient(135deg, #fdf4ff, #fae8ff);
      border-top: 2px solid #d946ef;
      padding: 20px 32px;
      max-height: 400px; overflow-y: auto;
      z-index: 100;
      display: none;
    }
    .designer-notes.show { display: block; }
    .designer-notes h3 { color: #a21caf; margin-bottom: 12px; font-size: 14px; }
    .designer-notes .content { font-size: 12px; color: #374151; line-height: 1.7; columns: 2; column-gap: 32px; }

    .toggle-notes {
      position: fixed; bottom: 16px; right: 16px;
      padding: 10px 16px; background: #d946ef; color: white;
      border: none; border-radius: 8px; font-size: 13px; font-weight: 600;
      cursor: pointer; z-index: 101; box-shadow: 0 4px 12px rgba(217,70,239,0.3);
    }

  </style>
</head>
<body>
  <div class="layout">
    <!-- Nav -->
    <div class="sidebar">
      <div class="logo">
        <div class="logo-icon">U</div>
        UniQdata
      </div>

      <div class="nav-section">
        <a href="list.html" class="nav-item">
          <span class="icon">&#x1F3E0;</span> 연구 허브
        </a>
      </div>

      <div class="nav-section">
        <div class="nav-section-title">연구</div>
        <a href="create.html" class="nav-item active">
          <span class="icon">&#x2795;</span> 새 연구
        </a>
      </div>

      <!-- 내 연구 (접힌 상태) -->
      <div class="nav-section" style="flex:1; overflow-y:auto;">
        <div class="nav-section-title" style="display:flex; align-items:center; justify-content:space-between;">
          내 연구
          <span style="background:#3b82f6; color:white; font-size:11px; padding:2px 8px; border-radius:10px; font-weight:600;">3</span>
        </div>
        <div style="display:flex; align-items:center; gap:10px; padding:10px 12px; border-radius:8px; cursor:pointer; margin-bottom:4px;" onmouseover="this.style.background='rgba(255,255,255,0.05)'" onmouseout="this.style.background='transparent'">
          <span style="font-size:14px;">&#x1F4C1;</span>
          <span style="flex:1; font-size:13px; color:#94a3b8;">당뇨병 복약 순응도</span>
          <span style="width:8px; height:8px; background:#22c55e; border-radius:50%;"></span>
        </div>
        <div style="display:flex; align-items:center; gap:10px; padding:10px 12px; border-radius:8px; cursor:pointer; margin-bottom:4px;" onmouseover="this.style.background='rgba(255,255,255,0.05)'" onmouseout="this.style.background='transparent'">
          <span style="font-size:14px;">&#x1F4C1;</span>
          <span style="flex:1; font-size:13px; color:#94a3b8;">노인 수면 패턴</span>
          <span style="width:8px; height:8px; background:#3b82f6; border-radius:50%;"></span>
        </div>
        <div style="display:flex; align-items:center; gap:10px; padding:10px 12px; border-radius:8px; cursor:pointer;" onmouseover="this.style.background='rgba(255,255,255,0.05)'" onmouseout="this.style.background='transparent'">
          <span style="font-size:14px;">&#x1F4C4;</span>
          <span style="flex:1; font-size:13px; color:#94a3b8;">ADHD 생활습관</span>
          <span style="width:8px; height:8px; background:#64748b; border-radius:50%;"></span>
        </div>

        <!-- 임시저장 -->
        <div style="margin-top:16px; padding-top:12px; border-top:1px solid #1e293b;">
          <div style="display:flex; align-items:center; justify-content:space-between; padding:0 12px; margin-bottom:8px;">
            <span style="font-size:11px; font-weight:600; color:#64748b; text-transform:uppercase; letter-spacing:0.5px;">임시저장</span>
            <span style="background:#334155; color:#94a3b8; font-size:10px; padding:2px 6px; border-radius:8px;">2</span>
          </div>
          <a href="#" style="display:flex; align-items:center; gap:10px; padding:8px 12px; border-radius:8px; text-decoration:none; margin-bottom:4px; background:rgba(251,191,36,0.08);">
            <span style="width:6px; height:6px; background:#fbbf24; border-radius:50%; flex-shrink:0;"></span>
            <div style="flex:1; min-width:0;">
              <div style="font-size:12px; color:#e2e8f0; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;">소아 비만 개입 연구</div>
              <div style="font-size:10px; color:#64748b; margin-top:2px;">Step 3 &middot; 2일 전</div>
            </div>
          </a>
          <a href="#" style="display:flex; align-items:center; gap:10px; padding:8px 12px; border-radius:8px; text-decoration:none;">
            <span style="width:6px; height:6px; background:#64748b; border-radius:50%; flex-shrink:0;"></span>
            <div style="flex:1; min-width:0;">
              <div style="font-size:12px; color:#94a3b8; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;">직장인 스트레스 코르티솔</div>
              <div style="font-size:10px; color:#64748b; margin-top:2px;">Step 1 &middot; 5일 전</div>
            </div>
          </a>
        </div>
      </div>

      <div class="sidebar-footer">
        <div class="user-info-sidebar">
          <div class="user-avatar-sidebar">김</div>
          <div>
            <div class="user-name-sidebar">김연구</div>
            <div class="user-org-sidebar">서울대학교병원</div>
          </div>
        </div>
      </div>
    </div>

    <!-- Workspace Wrap -->
    <div class="workspace-wrap">
      <!-- Step Bar -->
      <div class="step-bar">
        <div class="step-bar-inner">
          <a class="sb-step done" href="create.html"><div class="sb-num">&#x2713;</div><div class="sb-label">AI 인터뷰</div></a>
          <div class="sb-line done"></div>
          <a class="sb-step done" href="create-step2.html"><div class="sb-num">&#x2713;</div><div class="sb-label">연구 설계</div></a>
          <div class="sb-line done"></div>
          <a class="sb-step active" href="create-step3.html"><div class="sb-num">3</div><div class="sb-label">데이터 수집</div></a>
          <div class="sb-line"></div>
          <a class="sb-step pending" href="create-step4.html"><div class="sb-num">4</div><div class="sb-label">타겟 설정</div></a>
          <div class="sb-line"></div>
          <a class="sb-step pending" href="create-step5.html"><div class="sb-num">5</div><div class="sb-label">IRB 심의</div></a>
          <div class="sb-line"></div>
          <a class="sb-step pending" href="create-step6.html"><div class="sb-num">6</div><div class="sb-label">에스크로</div></a>
        </div>
      </div>

      <!-- Workspace (editor + chat) -->
      <div class="workspace">

        <!-- 에디터 패널 -->
        <div class="editor-panel">

          <!-- 페이지 헤더 -->
          <div style="display: flex; align-items: center; gap: 16px; margin-bottom: 8px;">
            <h1 style="font-size: 24px; font-weight: 700;">데이터 수집 설계</h1>
            <span class="status-badge" style="background:#ede9fe; color:#7c3aed;">Step 3</span>
          </div>
          <p style="color: #6b7280; margin-bottom: 28px; font-size: 14px;">연구에 필요한 데이터 항목을 선택하세요</p>

          <!-- 패시브 데이터 -->
          <div class="card">
            <div class="card-header">
              <h3>&#x1F4F1; 패시브 데이터 (자동 수집)</h3>
              <div class="header-right">
                <span class="ai-badge">AI 추천</span>
                <button class="report-btn" onclick="openModal('passive-modal')">
                  <span class="icon">&#x1F916;</span> AI 추천 근거
                </button>
              </div>
            </div>
            <div class="card-body">
              <p class="data-category-desc">앱 백그라운드에서 자동으로 수집되는 데이터입니다. 참여자 부담이 거의 없습니다.</p>

              <div class="data-grid">
                <div class="data-item selected" data-group="passive" data-id="cgm" data-ai="true">
                  <span class="icon">&#x1F4C8;</span>
                  <div class="info">
                    <div class="name">CGM (연속혈당)</div>
                    <div class="desc">5분 간격 혈당 데이터</div>
                    <div class="ai-reason">&#x1F916; 주 outcome(MAGE) 측정 필수 · 유사 RCT 93% 사용</div>
                  </div>
                  <div class="check"></div>
                </div>
                <div class="data-item selected" data-group="passive" data-id="heart_rate" data-ai="true">
                  <span class="icon">&#x2764;&#xFE0F;</span>
                  <div class="info">
                    <div class="name">심박수</div>
                    <div class="desc">웨어러블 기기 연동</div>
                    <div class="ai-reason">&#x1F916; 저혈당 에피소드 감지 보조지표 · 식이개입 RCT 67% 수집</div>
                  </div>
                  <div class="check"></div>
                </div>
                <div class="data-item selected" data-group="passive" data-id="steps">
                  <span class="icon">&#x1F6B6;</span>
                  <div class="info">
                    <div class="name">활동량/걸음수</div>
                    <div class="desc">일일 활동 데이터</div>
                  </div>
                  <div class="check"></div>
                </div>
                <div class="data-item selected" data-group="passive" data-id="sleep" data-ai="true">
                  <span class="icon">&#x1F634;</span>
                  <div class="info">
                    <div class="name">수면</div>
                    <div class="desc">수면 시간, 품질, 단계</div>
                    <div class="ai-reason">&#x1F916; 인슐린 저항성 상관 r=0.42 · 새벽현상 분석 필요</div>
                  </div>
                  <div class="check"></div>
                </div>
                <div class="data-item" data-group="passive" data-id="temperature">
                  <span class="icon">&#x1F321;&#xFE0F;</span>
                  <div class="info">
                    <div class="name">체온</div>
                    <div class="desc">웨어러블 체온 측정</div>
                  </div>
                  <div class="check"></div>
                </div>
                <div class="data-item" data-group="passive" data-id="location">
                  <span class="icon">&#x1F4CD;</span>
                  <div class="info">
                    <div class="name">위치/이동</div>
                    <div class="desc">활동 패턴 분석용</div>
                  </div>
                  <div class="check"></div>
                </div>
              </div>
            </div>
          </div>

          <!-- 능동 데이터 (EMA) -->
          <div class="card">
            <div class="card-header">
              <h3>&#x270D;&#xFE0F; 능동 데이터 (EMA/설문)</h3>
              <div class="header-right">
                <span class="ai-badge">AI 추천</span>
                <button class="report-btn" onclick="openModal('active-modal')">
                  <span class="icon">&#x1F916;</span> AI 추천 근거
                </button>
              </div>
            </div>
            <div class="card-body">
              <p class="data-category-desc">참여자가 직접 입력하는 데이터입니다. 빈도를 적절히 설정해 부담을 줄이세요.</p>

              <div class="data-grid">
                <div class="data-item selected" data-group="active" data-id="diet" data-ai="true">
                  <span class="icon">&#x1F37D;&#xFE0F;</span>
                  <div class="info">
                    <div class="name">식단 기록</div>
                    <div class="desc">탄수화물/식사 유형</div>
                    <div class="ai-reason">&#x1F916; 저탄수화물 개입 순응도 핵심 · 매 식사 기록 권장</div>
                  </div>
                  <div class="check"></div>
                </div>
                <div class="data-item selected" data-group="active" data-id="medication" data-ai="true">
                  <span class="icon">&#x1F48A;</span>
                  <div class="info">
                    <div class="name">복약 기록</div>
                    <div class="desc">복용 시간, 순응도</div>
                    <div class="ai-reason">&#x1F916; 혈당강하제 순응도 → 결과 해석 필수 변수</div>
                  </div>
                  <div class="check"></div>
                </div>
                <div class="data-item selected" data-group="active" data-id="mood" data-ai="true">
                  <span class="icon">&#x1F60A;</span>
                  <div class="info">
                    <div class="name">기분/컨디션</div>
                    <div class="desc">1-5점 스케일</div>
                    <div class="ai-reason">&#x1F916; 식단 개입의 삶의질 영향 측정 · PRO 지표</div>
                  </div>
                  <div class="check"></div>
                </div>
                <div class="data-item" data-group="active" data-id="exercise">
                  <span class="icon">&#x1F3C3;</span>
                  <div class="info">
                    <div class="name">운동 기록</div>
                    <div class="desc">운동 종류, 시간</div>
                  </div>
                  <div class="check"></div>
                </div>
                <div class="data-item" data-group="active" data-id="water">
                  <span class="icon">&#x1F4A7;</span>
                  <div class="info">
                    <div class="name">수분 섭취</div>
                    <div class="desc">일일 물 섭취량</div>
                  </div>
                  <div class="check"></div>
                </div>
                <div class="data-item" data-group="active" data-id="symptoms">
                  <span class="icon">&#x1F613;</span>
                  <div class="info">
                    <div class="name">증상 기록</div>
                    <div class="desc">저혈당, 피로 등</div>
                  </div>
                  <div class="check"></div>
                </div>
              </div>

              <!-- EMA 빈도 설정 -->
              <div class="ema-settings">
                <h4>&#x1F4CA; EMA 빈도 설정</h4>
                <div class="ema-row">
                  <label>식단 기록:</label>
                  <select class="ema-select ai-filled">
                    <option>매 식사 후 (1일 3회)</option>
                    <option>1일 1회 (저녁)</option>
                    <option>1일 2회 (점심/저녁)</option>
                  </select>
                </div>
                <div class="ema-row">
                  <label>기분/컨디션:</label>
                  <select class="ema-select ai-filled">
                    <option>1일 2회 (아침/저녁)</option>
                    <option>1일 1회</option>
                    <option>1일 3회</option>
                  </select>
                </div>
                <div class="ema-row">
                  <label>복약 기록:</label>
                  <select class="ema-select ai-filled">
                    <option>복용 시마다</option>
                    <option>1일 1회 요약</option>
                  </select>
                </div>
              </div>

              <div class="context-section">
                <h4>&#x1F4DD; 맥락/정성 입력 (선택)</h4>
                <div class="data-grid">
                  <div class="data-item" data-group="qual" data-id="meal_photo" data-ai="true">
                    <span class="icon">&#x1F4F7;</span>
                    <div class="info">
                      <div class="name">식사 사진</div>
                      <div class="desc">실제 식사/구성 기록</div>
                      <div class="ai-reason">&#x1F916; AI 탄수화물 자동 추정으로 식단 기록 정확도 ↑</div>
                    </div>
                    <div class="check"></div>
                  </div>
                  <div class="data-item" data-group="qual" data-id="diary">
                    <span class="icon">&#x1F5D2;&#xFE0F;</span>
                    <div class="info">
                      <div class="name">일기/자유서술</div>
                      <div class="desc">오늘의 상태, 이유, 맥락</div>
                    </div>
                    <div class="check"></div>
                  </div>
                  <div class="data-item" data-group="qual" data-id="life_events">
                    <span class="icon">&#x1F9E9;</span>
                    <div class="info">
                      <div class="name">생활 사건 로그</div>
                      <div class="desc">스트레스/변화 이벤트</div>
                    </div>
                    <div class="check"></div>
                  </div>
                  <div class="data-item" data-group="qual" data-id="voice_memo">
                    <span class="icon">&#x1F399;&#xFE0F;</span>
                    <div class="info">
                      <div class="name">음성 메모 (선택)</div>
                      <div class="desc">주 1회 1~2분 요약</div>
                    </div>
                    <div class="check"></div>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <!-- 바이오마커 -->
          <div class="card">
            <div class="card-header">
              <h3>&#x1F52C; 바이오마커 (고급)</h3>
            </div>
            <div class="card-body">
              <p class="data-category-desc">AI 분석을 위한 고급 바이오마커 데이터입니다. 특수 장비나 검사가 필요할 수 있습니다.</p>

              <div class="data-grid">
                <div class="data-item" data-group="biomarker" data-id="voice_biomarker">
                  <span class="icon">&#x1F3A4;</span>
                  <div class="info">
                    <div class="name">음성 바이오마커</div>
                    <div class="desc">음성 패턴 AI 분석</div>
                  </div>
                  <div class="check"></div>
                </div>
                <div class="data-item" data-group="biomarker" data-id="cognitive_test">
                  <span class="icon">&#x1F9E0;</span>
                  <div class="info">
                    <div class="name">인지 기능 테스트</div>
                    <div class="desc">반응속도, 기억력</div>
                  </div>
                  <div class="check"></div>
                </div>
                <div class="data-item" data-group="biomarker" data-id="hba1c">
                  <span class="icon">&#x1FA78;</span>
                  <div class="info">
                    <div class="name">HbA1c</div>
                    <div class="desc">당화혈색소 (연구 전후)</div>
                  </div>
                  <div class="check"></div>
                </div>
                <div class="data-item" data-group="biomarker" data-id="blood_test">
                  <span class="icon">&#x1F4CA;</span>
                  <div class="info">
                    <div class="name">혈액 검사</div>
                    <div class="desc">지질, 간기능 등</div>
                  </div>
                  <div class="check"></div>
                </div>
              </div>
            </div>
          </div>

          <!-- 요약 -->
          <div class="summary-box">
            <h4>선택된 데이터 요약</h4>
            <div class="summary-grid">
              <div class="summary-item">
                <div class="value" id="summary-passive">4</div>
                <div class="label">패시브 데이터</div>
              </div>
              <div class="summary-item">
                <div class="value" id="summary-active">3</div>
                <div class="label">능동 데이터</div>
              </div>
              <div class="summary-item">
                <div class="value" id="summary-qual">1</div>
                <div class="label">맥락 데이터</div>
              </div>
              <div class="summary-item">
                <div class="value" id="summary-frequency">~9회/일</div>
                <div class="label">예상 입력 빈도</div>
              </div>
            </div>
          </div>

          <!-- 네비게이션 버튼 -->
          <div class="btn-row">
            <a href="create-step2.html" class="btn btn-secondary">&#x2190; 이전</a>
            <a href="create-step4.html" class="btn btn-primary">다음 &#x2192;</a>
          </div>

        </div><!-- /.editor-panel -->

        <!-- AI 데이터 어시스턴트 -->
        <div class="chat-panel">
          <div class="chat-panel-inner">
            <div class="chat-header">
              <div class="title">
                <span class="icon">&#x1F916;</span>
                AI 데이터 어시스턴트
              </div>
              <div class="sub">데이터 수집 설계를 도와드립니다</div>
            </div>

            <div class="chat-context">
              <div class="label">현재 연구</div>
              <div class="value">저탄수화물 식단 혈당 변동 RCT &#x2014; 데이터 수집 설계 중</div>
              <div class="chat-context-chips">
                <span class="chat-context-chip">RCT</span>
                <span class="chat-context-chip">8주</span>
                <span class="chat-context-chip">CGM 기반</span>
                <span class="chat-context-chip">n=100</span>
              </div>
            </div>

            <div class="chat-messages">
              <div class="msg ai">
                <div class="sender">AI 어시스턴트</div>
                연구 설계를 분석했습니다. CGM 데이터가 핵심이므로, 다음 패시브 데이터를 추천합니다:<br><br>
                &#x2713; CGM 연속혈당<br>
                &#x2713; 활동량 (만보기)<br>
                &#x2713; 수면 패턴<br><br>
                추가로 식단 기록은 액티브 데이터로 수집하는 것을 권장합니다.
              </div>

              <div class="msg user">
                <div class="sender">김연구</div>
                식단 기록 빈도는?
              </div>

              <div class="msg ai">
                <div class="sender">AI 어시스턴트</div>
                RCT 특성상 매 식사(3회/일) 기록을 권장합니다. 사진 촬영 + AI 분석으로 탄수화물 섭취량을 자동 추정하면 참여자 부담을 줄일 수 있습니다.<br><br>
                <strong>추천 EMA 빈도:</strong><br>
                &#x2713; 식단: 매 식사 후 (3회/일)<br>
                &#x2713; 기분: 아침/저녁 (2회/일)<br>
                &#x2713; 복약: 복용 시마다
              </div>
            </div>

            <div class="chat-quick">
              <div class="label">빠른 질문</div>
              <div class="chat-quick-chips">
                <span class="chat-quick-chip">수집 빈도 추천</span>
                <span class="chat-quick-chip">필수 vs 선택</span>
                <span class="chat-quick-chip">참여자 부담 분석</span>
                <span class="chat-quick-chip">민감도 레벨 확인</span>
              </div>
            </div>

            <div class="chat-input">
              <div class="chat-input-wrapper">
                <input type="text" placeholder="예: 수면 데이터도 추가해줘">
                <button class="chat-send-btn">&#x27A4;</button>
              </div>
            </div>
          </div>
        </div><!-- /.chat-panel -->

      </div><!-- /.workspace -->
    </div><!-- /.workspace-wrap -->
  </div><!-- /.layout -->

  <!-- ========== 모달: 패시브 데이터 AI 추천 근거 ========== -->
  <div class="modal-overlay" id="passive-modal" onclick="if(event.target===this)closeModal('passive-modal')">
    <div class="modal">
      <div class="modal-header">
        <h3>&#x1F916; 패시브 데이터 AI 추천 근거</h3>
        <div style="display:flex; align-items:center; gap: 8px;">
          <span class="badge">AI 분석</span>
          <button class="modal-close" onclick="closeModal('passive-modal')">&#x2715;</button>
        </div>
      </div>
      <div class="modal-body">
        <div style="background: #f0fdf4; border: 1px solid #bbf7d0; border-radius: 10px; padding: 14px 16px; margin-bottom: 16px; font-size: 13px; color: #166534; line-height: 1.6;">
          연구 설계(RCT, 저탄수화물 식단, CGM 기반 혈당 변동)를 분석하여 <strong>4개 패시브 데이터 항목</strong>을 추천합니다. 유사 RCT 41건의 데이터 수집 패턴을 참고했습니다.
        </div>

        <div class="rationale-item">
          <div class="rationale-icon">&#x1F4C8;</div>
          <div class="rationale-info">
            <div class="rationale-title">CGM (연속혈당) &#x2014; 필수</div>
            <div class="rationale-desc">MAGE 계산에 최소 14일 연속 측정 필요. 5분 간격 데이터로 혈당 변동성(MAGE, CV%, TIR)을 정밀 측정합니다.</div>
            <div class="rationale-stat">유사 RCT 41건 중 38건(93%)이 CGM을 1차 데이터로 사용</div>
          </div>
        </div>

        <div class="rationale-item">
          <div class="rationale-icon">&#x2764;&#xFE0F;</div>
          <div class="rationale-info">
            <div class="rationale-title">심박수 &#x2014; 권장</div>
            <div class="rationale-desc">저혈당 에피소드 시 심박수 변화 감지. 야간 저혈당 탐지 보조 지표로 활용 가능합니다.</div>
            <div class="rationale-stat">식이 개입 RCT의 67%가 심박수를 보조 지표로 수집</div>
          </div>
        </div>

        <div class="rationale-item">
          <div class="rationale-icon">&#x1F6B6;</div>
          <div class="rationale-info">
            <div class="rationale-title">활동량/걸음수 &#x2014; 권장</div>
            <div class="rationale-desc">신체 활동은 혈당에 직접 영향. 식단 효과를 분리하기 위한 통제 변수로 필수적입니다.</div>
            <div class="rationale-stat">운동량 미통제 시 MAGE 효과크기 과대추정 위험 (bias ~15%)</div>
          </div>
        </div>

        <div class="rationale-item">
          <div class="rationale-icon">&#x1F634;</div>
          <div class="rationale-info">
            <div class="rationale-title">수면 &#x2014; 권장</div>
            <div class="rationale-desc">수면 품질/시간은 인슐린 저항성과 직결. Dawn phenomenon(새벽 현상) 분석에 수면 데이터가 필요합니다.</div>
            <div class="rationale-stat">수면-혈당 상관 r=0.42 (Park et al. 2024)</div>
          </div>
        </div>

        <div class="method-note">
          <strong>참고:</strong> 체온, 위치/이동 데이터는 본 연구 설계에서 직접적 분석 가치가 낮아 선택 사항으로 분류했습니다. 필요 시 탐색적 분석용으로 추가 가능합니다.
        </div>
      </div>
    </div>
  </div>

  <!-- ========== 모달: 능동 데이터 AI 추천 근거 ========== -->
  <div class="modal-overlay" id="active-modal" onclick="if(event.target===this)closeModal('active-modal')">
    <div class="modal">
      <div class="modal-header">
        <h3>&#x1F916; 능동 데이터 AI 추천 근거</h3>
        <div style="display:flex; align-items:center; gap: 8px;">
          <span class="badge">AI 분석</span>
          <button class="modal-close" onclick="closeModal('active-modal')">&#x2715;</button>
        </div>
      </div>
      <div class="modal-body">
        <div style="background: #fef3c7; border: 1px solid #fcd34d; border-radius: 10px; padding: 14px 16px; margin-bottom: 16px; font-size: 13px; color: #92400e; line-height: 1.6;">
          능동 데이터는 참여자 부담과 직결됩니다. <strong>3개 필수 항목</strong>을 추천하며, EMA 빈도는 완료율을 고려하여 최적화했습니다.
        </div>

        <div class="rationale-item">
          <div class="rationale-icon">&#x1F37D;&#xFE0F;</div>
          <div class="rationale-info">
            <div class="rationale-title">식단 기록 &#x2014; 필수 (3회/일)</div>
            <div class="rationale-desc">저탄수화물 식단 순응도를 직접 측정하는 핵심 변수. 매 식사 후 탄수화물 섭취량을 기록합니다. 사진 촬영 + AI 분석으로 자동 추정하면 입력 시간을 70% 단축 가능합니다.</div>
            <div class="rationale-stat">3회/일 기록 시 순응도 측정 정확도 92% (vs 1회/일 64%)</div>
          </div>
        </div>

        <div class="rationale-item">
          <div class="rationale-icon">&#x1F48A;</div>
          <div class="rationale-info">
            <div class="rationale-title">복약 기록 &#x2014; 필수 (복용 시)</div>
            <div class="rationale-desc">혈당 강하제/인슐린 사용 여부는 혈당 변동의 주요 교란변수. 복약 시간과 용량을 기록하여 식단 효과를 분리합니다.</div>
            <div class="rationale-stat">복약 미기록 시 MAGE 효과크기 해석 불가 (교란 위험)</div>
          </div>
        </div>

        <div class="rationale-item">
          <div class="rationale-icon">&#x1F60A;</div>
          <div class="rationale-info">
            <div class="rationale-title">기분/컨디션 &#x2014; 권장 (2회/일)</div>
            <div class="rationale-desc">식단 개입의 삶의 질 영향을 2차 결과변수로 측정. 저탄수화물 식단 초기 피로감/짜증 등 부작용 모니터링에도 활용됩니다.</div>
            <div class="rationale-stat">EMA 2회/일(아침/저녁)이 부담 대비 데이터 품질 최적</div>
          </div>
        </div>

        <div class="method-note">
          <strong>참여자 부담 분석:</strong> 현재 설정(식단 3회 + 복약 수시 + 기분 2회)으로 하루 약 9회 입력, 예상 소요 시간 12분/일. 완료율 유지를 위해 운동/수분 기록은 선택 사항으로 분류했습니다.
        </div>
      </div>
    </div>
  </div>

  <!-- 디자이너 노트 토글 -->
  <button class="toggle-notes" onclick="toggleNotes()">&#x1F4CB; 디자이너 노트</button>

  <!-- 디자이너 노트 -->
  <div class="designer-notes" id="designer-note">
    <h3>&#x1F4CB; 디자이너 노트: Step 3 - 데이터 수집</h3>
    <div class="content">
      <strong>레이아웃:</strong><br>
      &#x2460; Nav (240px) | &#x2461; 데이터 수집 에디터 (flex:1) | &#x2462; AI 데이터 어시스턴트 (360px)<br>
      Step 6과 동일한 workspace-wrap 패턴 (step-bar &#x2192; workspace &#x2192; editor + chat)<br><br>

      <strong>데이터 분류:</strong><br>
      &bull; <strong>패시브</strong>: 자동 수집 (CGM, 활동량, 수면, 심박수) - 참여자 부담 최소<br>
      &bull; <strong>능동 (EMA)</strong>: 직접 입력 (식단, 복약, 기분) - 빈도 설정 중요<br>
      &bull; <strong>맥락 (Qual)</strong>: 식사 사진/일기/사건 로그 등 (정량 해석 보완)<br>
      &bull; <strong>바이오마커</strong>: 고급 분석용 (음성, 인지, 혈액검사)<br><br>

      <strong>EMA 빈도 설정:</strong><br>
      &bull; 연구 방법론에 따라 AI가 적정 빈도 추천<br>
      &bull; MRT: 하루 여러 번 무작위<br>
      &bull; 코호트: 하루 1-2회 고정<br><br>

      <strong>참여자 부담 계산:</strong><br>
      &bull; 예상 일일 입력 횟수 표시<br>
      &bull; 너무 많으면 완료율 하락 경고
    </div>
  </div>

  <!-- 기능 명세 -->
  <div class="designer-notes" id="func-spec">
    <h3 style="color: #047857;">&#x2699;&#xFE0F; 기능 명세: Step 3 - 데이터 수집</h3>
    <div class="content" style="columns: 1;">
      <strong>핵심 기능:</strong><br>
      &bull; 수집 데이터 항목 선택 (토글)<br>
      &bull; 4개 카테고리: 패시브/능동(EMA)/맥락/바이오마커<br>
      &bull; EMA 빈도 설정 (하루 N회)<br>
      &bull; 참여자 부담 점수 실시간 계산<br><br>

      <strong>데이터 민감도 레벨 (L1-L4):</strong><br>
      &bull; <strong>L1 (Public)</strong>: app_id, 타임스탬프 - At Rest 암호화<br>
      &bull; <strong>L2 (Internal)</strong>: 연령대, 성별 - At Rest 암호화<br>
      &bull; <strong>L3 (Confidential)</strong>: 이메일, 전화 - At Rest + 필드 암호화<br>
      &bull; <strong>L4 (Restricted)</strong>: 진단코드, 처방, 바이오마커 - At Rest + 필드 암호화 + 접근 로그<br><br>

      <strong>동의 스코프 (Consent Scope):</strong><br>
      &bull; 형식: <code>{domain}:{metric}:{permission}:{range}</code><br>
      &bull; 예시: <code>health:heart_rate:read:30d</code><br>
      &bull; 예시: <code>med:medication:write:7d</code><br>
      &bull; 수집 항목별로 필요한 동의 스코프 자동 생성<br><br>

      <strong>AI 어시스턴트:</strong><br>
      &bull; 연구 목적 기반 추천 항목 표시<br>
      &bull; "추천 적용" 버튼으로 일괄 선택<br>
      &bull; 인과 연결 예상 설명
    </div>
  </div>

  <!-- 백엔드 호출 -->
  <div class="designer-notes" id="backend-spec">
    <h3 style="color: #6d28d9;">&#x1F517; 백엔드 호출: Step 3</h3>
    <div class="content" style="columns: 1;">
      <strong>1. 데이터 수집 설정 저장 (민감도 레벨 포함)</strong><br>
      <code style="background: #1f2937; color: #a5b4fc; padding: 6px 10px; border-radius: 6px; display: block; margin: 6px 0; font-size: 11px; font-family: 'SF Mono', Monaco, monospace;">
PATCH /api/v2/projects/:id<br>
Headers: Authorization: Bearer {jwt}<br><br>
Request Body:<br>
{<br>
&nbsp;&nbsp;"data_collection": {<br>
&nbsp;&nbsp;&nbsp;&nbsp;"passive": [<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ "type": "cgm", "sensitivity_level": "L4", "consent_scope": "health:blood_glucose:read:60d", "frequency": "5min" },<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ "type": "heart_rate", "sensitivity_level": "L2", "consent_scope": "health:heart_rate:read:60d", "frequency": "continuous" },<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ "type": "sleep", "sensitivity_level": "L2", "consent_scope": "health:sleep:read:60d", "frequency": "daily" },<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ "type": "steps", "sensitivity_level": "L1", "consent_scope": "health:activity:read:60d", "frequency": "daily" }<br>
&nbsp;&nbsp;&nbsp;&nbsp;],<br>
&nbsp;&nbsp;&nbsp;&nbsp;"active": [<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ "type": "medication", "sensitivity_level": "L4", "consent_scope": "med:medication:read:60d", "ema_frequency": "per_dose" },<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ "type": "mood", "sensitivity_level": "L2", "consent_scope": "health:mood:read:60d", "ema_frequency": "2_per_day" },<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ "type": "diet", "sensitivity_level": "L2", "consent_scope": "health:nutrition:read:60d", "ema_frequency": "3_per_day" }<br>
&nbsp;&nbsp;&nbsp;&nbsp;],<br>
&nbsp;&nbsp;&nbsp;&nbsp;"qualitative": [<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ "type": "meal_photo", "sensitivity_level": "L3", "consent_scope": "media:photo:read:60d" }<br>
&nbsp;&nbsp;&nbsp;&nbsp;]<br>
&nbsp;&nbsp;}<br>
}<br>
&#x2192; 200 OK { "project_id": "uuid", "data_collection_updated": true, "estimated_burden_score": 7.5, "l4_data_included": true }
      </code><br>

      <strong>2. AI 추천 데이터 항목 조회</strong><br>
      <code style="background: #1f2937; color: #a5b4fc; padding: 6px 10px; border-radius: 6px; display: block; margin: 6px 0; font-size: 11px; font-family: 'SF Mono', Monaco, monospace;">
POST /api/v2/ai/recommend-data-collection<br>
{ "project_id": "uuid", "research_question": "복약 순응도와 혈당 변동의 상관관계", "methodology": "prospective_cohort" }<br>
&#x2192; 200 OK { "recommendations": [...], "causal_graph_preview": { "edges": [...] } }
      </code><br>

      <strong>3. 참여자 부담 점수 계산</strong><br>
      <code style="background: #1f2937; color: #a5b4fc; padding: 6px 10px; border-radius: 6px; display: block; margin: 6px 0; font-size: 11px; font-family: 'SF Mono', Monaco, monospace;">
POST /api/v2/projects/:id/calculate-burden<br>
&#x2192; 200 OK { "burden_score": 7.5, "daily_prompts": 9, "time_per_day_minutes": 12, "warning": "daily_prompts > 8: 완료율 하락 위험" }
      </code><br>

      <strong>4. 동의서 템플릿 미리보기 생성</strong><br>
      <code style="background: #1f2937; color: #a5b4fc; padding: 6px 10px; border-radius: 6px; display: block; margin: 6px 0; font-size: 11px; font-family: 'SF Mono', Monaco, monospace;">
POST /api/v2/projects/:id/consent-preview<br>
&#x2192; 200 OK { "consent_template": { "title": "연구 참여 동의서", "sections": [...], "passkey_required": true } }
      </code>
    </div>
  </div>

  <script>
    // 모달 열기/닫기
    function openModal(id) {
      document.getElementById(id).classList.add('show');
    }
    function closeModal(id) {
      document.getElementById(id).classList.remove('show');
    }
    document.addEventListener('keydown', function(e) {
      if (e.key === 'Escape') {
        document.querySelectorAll('.modal-overlay.show').forEach(function(m) { m.classList.remove('show'); });
      }
    });

    // 데이터 항목 토글 및 요약 업데이트
    var items = document.querySelectorAll('.data-item');

    function updateSummary() {
      var counts = { passive: 0, active: 0, qual: 0 };
      items.forEach(function(item) {
        var group = item.getAttribute('data-group');
        if (item.classList.contains('selected') && counts[group] !== undefined) {
          counts[group] += 1;
        }
      });

      var passive = document.getElementById('summary-passive');
      var active = document.getElementById('summary-active');
      var qual = document.getElementById('summary-qual');

      if (passive) passive.textContent = String(counts.passive);
      if (active) active.textContent = String(counts.active);
      if (qual) qual.textContent = String(counts.qual);
    }

    function setSelected(item, selected) {
      item.classList.toggle('selected', selected);
      item.setAttribute('aria-pressed', selected ? 'true' : 'false');
    }

    items.forEach(function(item) {
      item.setAttribute('role', 'button');
      item.setAttribute('aria-pressed', item.classList.contains('selected') ? 'true' : 'false');
      item.addEventListener('click', function(e) {
        if (!e.isTrusted || e.detail !== 'ai-trigger') {
          setSelected(item, !item.classList.contains('selected'));
          updateSummary();
        }
      });
    });

    updateSummary();

    // 디자이너 노트 토글 (3개 패널 순환)
    var notesPanels = ['designer-note', 'func-spec', 'backend-spec'];
    function toggleNotes() {
      var currentShown = -1;
      for (var i = 0; i < notesPanels.length; i++) {
        if (document.getElementById(notesPanels[i]).classList.contains('show')) {
          currentShown = i;
          break;
        }
      }
      for (var i = 0; i < notesPanels.length; i++) {
        document.getElementById(notesPanels[i]).classList.remove('show');
      }
      if (currentShown === -1) {
        document.getElementById(notesPanels[0]).classList.add('show');
      } else if (currentShown < notesPanels.length - 1) {
        document.getElementById(notesPanels[currentShown + 1]).classList.add('show');
      }
    }
  </script>

  <script src="page-spec.js"></script>
  <link rel="stylesheet" href="../tooltip-spec.css">
  <script src="../tooltip-spec.js"></script>
</body>
</html>
