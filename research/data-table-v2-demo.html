<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>í…Œì´ë¸” íƒ­ v2 ë°ëª¨ â€” ì—­í•  ë¶„ë¦¬</title>
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif; background: #f5f5f5; color: #1f2937; }
    .layout { display: flex; min-height: 100vh; }

    /* ===== SIDEBAR 240px ===== */
    .sidebar {
      width: 240px; background: linear-gradient(180deg, #0f172a, #1e293b);
      color: white; display: flex; flex-direction: column; flex-shrink: 0;
    }
    .logo { padding: 20px 24px; font-size: 20px; font-weight: 700; border-bottom: 1px solid rgba(255,255,255,0.1); display: flex; align-items: center; gap: 10px; }
    .logo-icon { width: 32px; height: 32px; background: linear-gradient(135deg, #3b82f6, #8b5cf6); border-radius: 8px; display: flex; align-items: center; justify-content: center; font-size: 16px; }
    .nav-section { padding: 16px 12px; border-bottom: 1px solid rgba(255,255,255,0.05); }
    .nav-section-title { font-size: 11px; text-transform: uppercase; color: #64748b; padding: 8px 12px; letter-spacing: 0.5px; }
    .nav-item { display: flex; align-items: center; gap: 12px; padding: 10px 12px; border-radius: 8px; color: #94a3b8; cursor: pointer; font-size: 14px; text-decoration: none; }
    .nav-item:hover { background: rgba(255,255,255,0.05); color: #e2e8f0; }
    .research-nav-header { display: flex; align-items: center; gap: 8px; padding: 8px 12px; border-radius: 8px; font-size: 13px; color: #60a5fa; background: rgba(59,130,246,0.1); cursor: pointer; }
    .research-title { flex: 1; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
    .status-dot { width: 7px; height: 7px; border-radius: 50%; background: #22c55e; flex-shrink: 0; }
    .research-nav-sub { padding-left: 20px; margin-top: 4px; border-left: 2px solid rgba(255,255,255,0.1); margin-left: 18px; }
    .nav-sub-item { display: flex; align-items: center; gap: 8px; padding: 8px 12px; border-radius: 6px; color: #94a3b8; font-size: 12px; cursor: pointer; text-decoration: none; margin-bottom: 2px; }
    .nav-sub-item:hover { background: rgba(255,255,255,0.05); color: #e2e8f0; }
    .nav-sub-item.active { background: rgba(59,130,246,0.15); color: #60a5fa; border-left: 2px solid #3b82f6; margin-left: -2px; padding-left: 14px; }
    .nav-sub-item .dot { width: 6px; height: 6px; border-radius: 50%; background: currentColor; opacity: 0.5; }
    .nav-sub-item.active .dot { background: #3b82f6; opacity: 1; }
    .sidebar-footer { margin-top: auto; padding: 16px; border-top: 1px solid rgba(255,255,255,0.05); }
    .user-info { display: flex; align-items: center; gap: 12px; padding: 8px; }
    .user-avatar { width: 36px; height: 36px; background: linear-gradient(135deg, #3b82f6, #8b5cf6); border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 14px; }

    /* ===== MAIN ===== */
    .main { flex: 1; overflow-y: auto; }
    .content { padding: 24px; max-width: 100%; }

    .breadcrumb { display: flex; align-items: center; gap: 8px; margin-bottom: 16px; font-size: 14px; color: #6b7280; }
    .breadcrumb a { color: #3b82f6; text-decoration: none; }
    .title-row { display: flex; justify-content: space-between; align-items: flex-start; gap: 24px; margin-bottom: 20px; }
    .page-title { font-size: 20px; font-weight: 700; margin-bottom: 4px; }
    .page-sub { color: #6b7280; font-size: 13px; }

    /* íƒ­ */
    .tabs { display: flex; gap: 0; border-bottom: 2px solid #e5e7eb; margin-bottom: 20px; }
    .tab { padding: 12px 24px; font-size: 14px; color: #6b7280; cursor: pointer; border-bottom: 2px solid transparent; margin-bottom: -2px; text-decoration: none; font-weight: 500; }
    .tab.active { color: #3b82f6; border-bottom-color: #3b82f6; }
    .tab:hover { color: #374151; }

    /* ===== ì»¨íŠ¸ë¡¤ (ê°„ì†Œí™”) ===== */
    .controls-section { background: white; border: 1px solid #e5e7eb; border-radius: 12px; padding: 14px 20px; margin-bottom: 16px; }
    .controls-row { display: flex; gap: 16px; align-items: center; flex-wrap: wrap; }
    .control-group { display: flex; align-items: center; gap: 8px; }
    .control-group label { font-size: 12px; color: #6b7280; font-weight: 600; }
    .toggle-btn { padding: 6px 12px; border: 1px solid #e5e7eb; border-radius: 6px; background: white; color: #6b7280; cursor: pointer; font-size: 12px; }
    .toggle-btn.active { background: #3b82f6; color: white; border-color: #3b82f6; }
    .select-small { padding: 6px 10px; border: 1px solid #e5e7eb; border-radius: 6px; font-size: 12px; color: #374151; background: white; cursor: pointer; }
    .date-nav { display: flex; align-items: center; gap: 8px; padding: 6px 12px; background: #f9fafb; border: 1px solid #e5e7eb; border-radius: 6px; font-size: 12px; color: #374151; }
    .date-nav button { background: none; border: none; cursor: pointer; font-size: 14px; color: #3b82f6; padding: 0 4px; }
    .search-input { padding: 6px 10px; border: 1px solid #e5e7eb; border-radius: 6px; font-size: 12px; width: 160px; }
    .search-input::placeholder { color: #9ca3af; }

    /* ===== ì†ŒìŠ¤ ë²”ë¡€ (ì¶•ì•½) ===== */
    .source-legend { display: flex; gap: 14px; align-items: center; margin-bottom: 12px; font-size: 11px; color: #6b7280; }
    .source-dot { width: 8px; height: 8px; border-radius: 2px; display: inline-block; }
    .source-dot.emr { background: #3b82f6; }
    .source-dot.wear { background: #22c55e; }
    .source-dot.ema { background: #a855f7; }
    .source-dot.ext { background: #f97316; }

    /* ===== í…Œì´ë¸” ===== */
    .table-section { background: white; border: 1px solid #e5e7eb; border-radius: 12px; overflow: hidden; margin-bottom: 16px; }
    .table-wrapper { overflow-x: auto; }
    table.patient-table { width: 100%; border-collapse: collapse; font-size: 13px; }
    table.patient-table thead th {
      text-align: left; font-size: 11px; color: #6b7280; font-weight: 600;
      padding: 10px 8px; border-bottom: 2px solid #e5e7eb; background: #f9fafb;
      position: sticky; top: 0; z-index: 10; white-space: nowrap; cursor: pointer;
    }
    table.patient-table thead th .col-source {
      display: inline-block; width: 6px; height: 6px; border-radius: 2px; margin-right: 4px; vertical-align: middle;
    }
    table.patient-table tbody td { padding: 10px 8px; border-bottom: 1px solid #f1f5f9; font-size: 12px; }
    table.patient-table tbody tr { cursor: pointer; transition: background 0.1s; }
    table.patient-table tbody tr:hover { background: #f8fafc; }
    table.patient-table tbody tr.selected { background: #eff6ff; }
    table.patient-table tbody tr.alert-row { background: #fffbeb; }
    table.patient-table tbody tr.alert-row:hover { background: #fef3c7; }

    /* í™˜ì ID ì…€ */
    .patient-id { font-weight: 600; color: #374151; white-space: nowrap; }
    .group-badge { display: inline-block; padding: 1px 6px; border-radius: 4px; font-size: 10px; font-weight: 600; margin-left: 6px; }
    .group-badge.exp { background: #dbeafe; color: #1d4ed8; }
    .group-badge.ctrl { background: #fce7f3; color: #be185d; }
    .severity-dot { display: inline-block; width: 6px; height: 6px; border-radius: 50%; margin-right: 6px; }
    .severity-dot.good { background: #22c55e; }
    .severity-dot.warn { background: #f59e0b; }
    .severity-dot.bad { background: #ef4444; }

    /* ë¸íƒ€ ì…€ */
    .cell-delta { font-weight: 700; font-family: 'SF Mono', Monaco, monospace; font-size: 12px; }
    .cell-delta.good { color: #16a34a; }
    .cell-delta.bad { color: #dc2626; }
    .cell-delta.neutral { color: #6b7280; }
    .cell-raw { font-size: 11px; color: #9ca3af; display: block; margin-top: 1px; }
    .cell-empty { color: #d1d5db; font-style: italic; }

    /* ===== ì¸ë¼ì¸ í™•ì¥ (ì•„ì½”ë””ì–¸) ===== */
    tr.expand-row { display: none; }
    tr.expand-row.open { display: table-row; }
    tr.expand-row td { padding: 0; border-bottom: 2px solid #e5e7eb; background: #f9fafb; }
    .expand-content {
      padding: 20px; display: flex; gap: 20px; flex-wrap: wrap;
    }
    .expand-chart-card {
      flex: 1; min-width: 280px; background: white; border: 1px solid #e5e7eb;
      border-radius: 10px; padding: 16px;
    }
    .expand-chart-title { font-size: 12px; font-weight: 600; color: #374151; margin-bottom: 12px; display: flex; align-items: center; gap: 6px; }
    .expand-chart-title .col-source { display: inline-block; width: 6px; height: 6px; border-radius: 2px; }
    .chart-area { position: relative; height: 120px; }
    .chart-area svg { width: 100%; height: 100%; }
    .chart-x-labels { display: flex; justify-content: space-between; font-size: 10px; color: #9ca3af; margin-top: 4px; padding: 0 2px; }
    .expand-summary { display: flex; gap: 16px; margin-top: 10px; font-size: 11px; }
    .expand-summary-item { display: flex; align-items: center; gap: 4px; color: #6b7280; }
    .expand-summary-item strong { color: #374151; }

    /* í”Œë¡œìš°ì‹œíŠ¸ ë¯¸ë‹ˆ (í™•ì¥ ë‚´) */
    .flowsheet-mini { width: 100%; border-collapse: collapse; font-size: 11px; margin-top: 12px; }
    .flowsheet-mini th { font-size: 10px; color: #9ca3af; font-weight: 600; padding: 4px 6px; border-bottom: 1px solid #e5e7eb; text-align: center; }
    .flowsheet-mini th:first-child { text-align: left; }
    .flowsheet-mini td { padding: 5px 6px; text-align: center; border-bottom: 1px solid #f1f5f9; font-family: 'SF Mono', Monaco, monospace; }
    .flowsheet-mini td:first-child { text-align: left; font-weight: 600; color: #374151; font-family: -apple-system, sans-serif; }
    .fm-good { color: #16a34a; background: rgba(34,197,94,0.06); }
    .fm-warn { color: #d97706; background: rgba(245,158,11,0.06); }
    .fm-bad { color: #dc2626; background: rgba(239,68,68,0.06); }
    .fm-current { font-weight: 700; border: 1.5px solid #3b82f6; border-radius: 4px; }

    /* ===== í˜ì´ì§€ë„¤ì´ì…˜ ===== */
    .pagination-row { display: flex; align-items: center; justify-content: space-between; padding: 14px 20px; background: white; border: 1px solid #e5e7eb; border-radius: 12px; font-size: 12px; color: #6b7280; }
    .pagination-buttons { display: flex; gap: 4px; }
    .page-btn { padding: 5px 9px; border: 1px solid #e5e7eb; border-radius: 4px; background: white; color: #6b7280; cursor: pointer; font-size: 11px; }
    .page-btn.active { background: #3b82f6; color: white; border-color: #3b82f6; }

    /* ===== ë””ìì´ë„ˆ ë…¸íŠ¸ ===== */
    .designer-notes { margin-top: 32px; }
    .designer-notes summary { cursor: pointer; font-size: 14px; font-weight: 600; color: #6b7280; padding: 12px 16px; background: #f9fafb; border: 1px solid #e5e7eb; border-radius: 8px; }
    .notes-content { margin-top: 12px; padding: 20px; background: #f9fafb; border: 1px solid #e5e7eb; border-radius: 12px; font-size: 12px; line-height: 1.8; color: #374151; }
    .notes-content h4 { font-size: 13px; margin: 16px 0 8px; color: #1f2937; font-weight: 600; }
    .notes-content h4:first-child { margin-top: 0; }
    .notes-content code { background: #0f172a; color: #a5b4fc; padding: 10px; border-radius: 6px; display: block; margin: 8px 0; font-size: 11px; font-family: 'SF Mono', Monaco, monospace; white-space: pre-wrap; }

    .step-nav { display: flex; gap: 10px; margin-top: 24px; }
    .step-nav a { padding: 8px 16px; background: #eee; border-radius: 6px; text-decoration: none; color: #333; font-size: 14px; }

    /* ë°˜ì‘í˜• */
    @media (max-width: 1200px) {
      .controls-row { flex-direction: column; align-items: flex-start; }
      .expand-content { flex-direction: column; }
    }
  </style>
</head>
<body>
<div class="layout">

  <!-- ===== SIDEBAR ===== -->
  <nav class="sidebar">
    <div class="logo"><div class="logo-icon">U</div> UniQdata</div>
    <div class="nav-section">
      <a class="nav-item"><span class="icon">ğŸ </span> ì—°êµ¬ í—ˆë¸Œ</a>
    </div>
    <div class="nav-section" style="flex:1; overflow-y:auto;">
      <div class="nav-section-title">ë‚´ ì—°êµ¬</div>
      <div style="margin-bottom:2px;">
        <div class="research-nav-header">
          <span style="font-size:14px;">ğŸ“</span>
          <span class="research-title">ëŒ€ì‚¬ê°œì„  ì•½ë¬¼ ì—°êµ¬</span>
          <span class="status-dot"></span>
        </div>
        <div class="research-nav-sub">
          <a class="nav-sub-item"><span class="dot"></span> ê°œìš”</a>
          <a class="nav-sub-item active"><span class="dot"></span> í…Œì´ë¸”</a>
          <a class="nav-sub-item"><span class="dot"></span> ğŸ”’ í´ë¦°ë£¸</a>
        </div>
      </div>
    </div>
    <div class="sidebar-footer">
      <div class="user-info">
        <div class="user-avatar">ê¹€</div>
        <div>
          <div style="font-size:14px; color:#e2e8f0;">ê¹€ì—°êµ¬</div>
          <div style="font-size:12px; color:#64748b;">ì„œìš¸ëŒ€í•™êµë³‘ì›</div>
        </div>
      </div>
    </div>
  </nav>

  <!-- ===== MAIN ===== -->
  <main class="main">
    <div class="content">

      <div class="breadcrumb">
        <a href="#">ì—°êµ¬ ê´€ë¦¬</a> / <a href="#">ëŒ€ì‚¬ê°œì„  ì•½ë¬¼ ì—°êµ¬</a> / <span>í…Œì´ë¸”</span>
      </div>

      <div class="title-row">
        <div>
          <div class="page-title">ì—°êµ¬ ë°ì´í„°</div>
          <div class="page-sub">ì²˜ë°© ì•½ë¬¼(2.4mg) ëŒ€ì‚¬ê°œì„  ì—°êµ¬ Â· OMOP CDM ê¸°ë°˜ Â· ë‹¤ì¤‘ ì†ŒìŠ¤ í†µí•©</div>
        </div>
      </div>

      <div class="tabs">
        <a class="tab">ê°œìš”</a>
        <a class="tab active">í…Œì´ë¸”</a>
        <a class="tab">ğŸ”’ í´ë¦°ë£¸</a>
      </div>

      <!-- ===== ì»¨íŠ¸ë¡¤ (ê°„ì†Œí™”: pê°’ ìŠ¤íŠ¸ë¦½ ì œê±°, ë·° í† ê¸€ ì œê±°) ===== -->
      <div class="controls-section">
        <div class="controls-row">
          <div class="control-group">
            <label>ì‹œê°„</label>
            <div style="display:flex; gap:4px;">
              <button class="toggle-btn">ì¼ê°„</button>
              <button class="toggle-btn active">ì£¼ê°„</button>
              <button class="toggle-btn">ì›”ê°„</button>
            </div>
          </div>
          <div class="control-group">
            <label>ì†ŒìŠ¤</label>
            <select class="select-small">
              <option>ì „ì²´</option>
              <option>[EMR]</option>
              <option>[ì›¨ì–´ëŸ¬ë¸”]</option>
              <option>[EMA]</option>
            </select>
          </div>
          <div class="control-group">
            <div class="date-nav">
              <button>â—€</button>
              <span>2ì›” 2ì£¼ì°¨ (W6)</span>
              <button>â–¶</button>
            </div>
          </div>
          <div class="control-group" style="margin-left:auto;">
            <input type="text" class="search-input" placeholder="í™˜ì ê²€ìƒ‰ (ID, ì´ë¦„)">
          </div>
        </div>
      </div>

      <!-- ì†ŒìŠ¤ ë²”ë¡€ (ì¶•ì•½) -->
      <div class="source-legend">
        <span><span class="source-dot emr"></span> EMR</span>
        <span><span class="source-dot wear"></span> ì›¨ì–´ëŸ¬ë¸”</span>
        <span><span class="source-dot ema"></span> EMA</span>
        <span><span class="source-dot ext"></span> ì™¸ë¶€</span>
        <span style="margin-left:auto; color:#9ca3af;">í–‰ í´ë¦­ â†’ ì‹œê³„ì—´ ìƒì„¸</span>
      </div>

      <!-- ===== í…Œì´ë¸” (ë‹¨ì¼ ë¦¬ìŠ¤íŠ¸, êµ° ë±ƒì§€ë¡œ êµ¬ë¶„) ===== -->
      <div class="table-section">
        <div class="table-wrapper">
          <table class="patient-table">
            <thead>
              <tr>
                <th style="width:14%;">í™˜ì</th>
                <th><span class="col-source" style="background:#3b82f6;"></span>ì²´ì¤‘ (kg)</th>
                <th><span class="col-source" style="background:#3b82f6;"></span>SBP</th>
                <th><span class="col-source" style="background:#22c55e;"></span>ì‹¬ë°•ìˆ˜</th>
                <th><span class="col-source" style="background:#22c55e;"></span>ê±¸ìŒìˆ˜</th>
                <th><span class="col-source" style="background:#22c55e;"></span>ìˆ˜ë©´ (h)</th>
                <th><span class="col-source" style="background:#a855f7;"></span>ìˆœì‘ë„</th>
                <th><span class="col-source" style="background:#f97316;"></span>ì•±ì‚¬ìš©</th>
              </tr>
            </thead>
            <tbody id="tableBody">
            </tbody>
          </table>
        </div>
      </div>

      <!-- í˜ì´ì§€ë„¤ì´ì…˜ -->
      <div class="pagination-row">
        <span>1-10 / 80ëª…</span>
        <div class="pagination-buttons">
          <button class="page-btn">â—€</button>
          <button class="page-btn active">1</button>
          <button class="page-btn">2</button>
          <button class="page-btn">3</button>
          <button class="page-btn">â€¦</button>
          <button class="page-btn">8</button>
          <button class="page-btn">â–¶</button>
        </div>
      </div>

      <div class="step-nav">
        <a href="#">â† ê°œìš”</a>
        <a href="#">í´ë¦°ë£¸ â†’</a>
      </div>

      <!-- ===== ë””ìì´ë„ˆ ë…¸íŠ¸ ===== -->
      <div class="designer-notes">
        <details>
          <summary>ë””ìì´ë„ˆ ë…¸íŠ¸ â€” v2 ì „ëµ ë³€ê²½ì‚¬í•­</summary>
          <div class="notes-content">

            <h4>0. í•µì‹¬ ë³€ê²½: ì—­í•  ë¶„ë¦¬</h4>
            <strong>ì œê±°í•œ ê²ƒë“¤ (â†’ ê°œìš” íƒ­ì´ ë‹´ë‹¹):</strong><br>
            - âŒ pê°’ ìŠ¤íŠ¸ë¦½ â†’ ê°œìš”ì˜ êµ°ê°„ ë¹„êµ í…Œì´ë¸”ì´ pê°’ í¬í•¨<br>
            - âŒ ë·° í† ê¸€ (ê°œì¸/êµ°ë¹„êµ) â†’ ì´ íƒ­ì€ í•­ìƒ ê°œì¸ ë·°<br>
            - âŒ ì‹¤í—˜êµ°/ëŒ€ì¡°êµ° ë‚˜ë€íˆ ë°°ì¹˜ â†’ ë‹¨ì¼ ë¦¬ìŠ¤íŠ¸, êµ° ë±ƒì§€ë¡œ êµ¬ë¶„<br>
            - âŒ êµ° í‰ê· í–‰ â†’ ê°œìš”ì˜ ë¹„êµ í…Œì´ë¸”ì´ ì»¤ë²„<br>
            <br>
            <strong>ìœ ì§€í•œ ê²ƒë“¤:</strong><br>
            - âœ… ì‹œê°„ ìœˆë„ìš° (ì¼/ì£¼/ì›”)<br>
            - âœ… ì†ŒìŠ¤ í•„í„°<br>
            - âœ… ë‚ ì§œ ë„¤ë¹„ê²Œì´ì…˜ (â—€ W6 â–¶)<br>
            - âœ… delta + raw ì…€ (ë°°ê²½ìƒ‰ìœ¼ë¡œ good/bad êµ¬ë¶„)<br>
            - âœ… alert í–‰ (âš ï¸)<br>
            - âœ… í˜ì´ì§€ë„¤ì´ì…˜<br>
            <br>
            <strong>ì¶”ê°€í•œ ê²ƒ:</strong><br>
            - ğŸ†• í–‰ í´ë¦­ â†’ ì¸ë¼ì¸ í™•ì¥ (ì•„ì½”ë””ì–¸)<br>
            - ğŸ†• í™•ì¥ ë‚´ìš©: ì£¼ì°¨ë³„ ì°¨íŠ¸ 2~3ê°œ + ë¯¸ë‹ˆ í”Œë¡œìš°ì‹œíŠ¸<br>
            - ğŸ†• í™˜ì ê²€ìƒ‰<br>
            - ğŸ†• ìƒíƒœ ë„íŠ¸ (green/amber/red)<br>

            <h4>1. 3ì¶• ì»¤ë²„ë¦¬ì§€</h4>
            <code>ì¶•1: í™˜ì (Patient)  â†’ í…Œì´ë¸” í–‰
ì¶•2: ì§€í‘œ (Metric)   â†’ í…Œì´ë¸” ì—´
ì¶•3: ì‹œê°„ (Time)     â†’ â—€W6â–¶ ë‚ ì§œ ë„¤ë¹„ + í–‰ í™•ì¥ ì‹œ ì°¨íŠ¸

ì¶”ê°€ ì°¨ì›:
ì†ŒìŠ¤ (Source)        â†’ ì—´ í—¤ë” ì»¬ëŸ¬ ë„íŠ¸
êµ° (Group)          â†’ í–‰ ë±ƒì§€ (ì‹¤í—˜/ëŒ€ì¡°)
í†µê³„ (pê°’)          â†’ ê°œìš” íƒ­ ì „ë‹´</code>

            <h4>2. ì…€ êµ¬ì¡°</h4>
            ì…€ ì•ˆì— ê·¸ë˜í”„ NO. delta + rawê°’ë§Œ.<br>
            ë°°ê²½ìƒ‰ìœ¼ë¡œ ìƒíƒœ í‘œì‹œ (ì—°ë…¹/ì—°ë¹¨/íˆ¬ëª…).<br>
            ì‹œê°„ ì¶”ì„¸ëŠ” í–‰ í™•ì¥ì—ì„œë§Œ ì°¨íŠ¸ë¡œ ì œê³µ.<br>

            <h4>3. ì¸ë¼ì¸ í™•ì¥ íŒ¨í„´</h4>
            - í–‰ í´ë¦­ â†’ ë°”ë¡œ ì•„ë˜ì— í™•ì¥ í–‰ ì—´ë¦¼<br>
            - í™•ì¥ ë‚´ìš©: í•µì‹¬ ì§€í‘œ 2~3ê°œì˜ 6ì£¼ ì¶”ì„¸ ì°¨íŠ¸ + ë¯¸ë‹ˆ í”Œë¡œìš°ì‹œíŠ¸<br>
            - ì‚¬ì´ë“œ íŒ¨ë„ ì•„ë‹˜ â†’ ë ˆì´ì•„ì›ƒ ì•ˆ ê¹¨ì§<br>
            - í•œ ë²ˆì— í•˜ë‚˜ë§Œ ì—´ë¦¼ (ë‹¤ë¥¸ ê²ƒ í´ë¦­í•˜ë©´ ì´ì „ ê²ƒ ë‹«í˜)<br>

            <h4>4. ê°œìš”â†”í…Œì´ë¸” ì—­í•  ë¶„ë¦¬</h4>
            <code>ê°œìš” = "ì´ ì—°êµ¬ ê´œì°®ì•„?"
  â†’ KPI, íƒ€ì„ë¼ì¸ ê·¸ë˜í”„, êµ°ê°„ ë¹„êµ+pê°’, AI ì¸ì‚¬ì´íŠ¸, ìš´ì˜í˜„í™©

í…Œì´ë¸” = "ì´ í™˜ì ê´œì°®ì•„?"
  â†’ í™˜ì ë¦¬ìŠ¤íŠ¸, í˜„ì¬ ì‹œì  ê°’, í´ë¦­â†’ì‹œê³„ì—´ ìƒì„¸

ê²¹ì¹˜ëŠ” ê²ƒ = ì—†ìŒ</code>

          </div>
        </details>
      </div>

    </div>
  </main>
</div>

<script>
// ===== í™˜ì ë°ì´í„° =====
const PATIENTS = [
  { id:'P001', name:'ê¹€ë¯¼ìˆ˜', group:'exp', severity:'good',
    wt:[87.3,85.8,84.2,82.5,80.8,79.2], sbp:[134,132,128,126,124,122], hr:[72,71,69,68,67,66],
    steps:[7340,7800,8200,8600,8900,9104], sleep:[6.2,6.5,6.8,7.0,7.1,7.3], comp:[86,88,90,92,93,94], app:[40,42,48,52,56,62] },
  { id:'P005', name:'ì´ìˆ˜ì§„', group:'exp', severity:'good',
    wt:[88.3,87.1,85.8,84.5,83.2,82.1], sbp:[132.5,131,129,127,125.5,124], hr:[72,71,70,70,69,69],
    steps:[6800,7100,7400,7600,7800,7812], sleep:[6.0,6.2,6.5,6.7,6.9,7.0], comp:[85,87,88,89,90,90], app:[32,35,38,40,42,45] },
  { id:'P011', name:'ë°•ì§€í›ˆ', group:'exp', severity:'good',
    wt:[88.3,86.8,85.2,83.5,82.0,80.8], sbp:[134.2,132,130,128,126.5,125], hr:[72,71,69,68,68,67],
    steps:[7000,7500,7800,8100,8300,8512], sleep:[6.5,6.6,6.8,7.0,7.2,7.4], comp:[86,88,90,91,92,92], app:[36,40,44,48,52,54] },
  { id:'P018', name:'ìµœì˜ˆë¦°', group:'exp', severity:'warn', alert:true,
    wt:[87.4,86.2,85.0,83.8,82.6,81.6], sbp:[137.9,136,135,138,139,140], hr:[70,69,null,null,68,null],
    steps:[5800,6000,6100,6200,6200,6234], sleep:[5.8,6.0,6.2,6.0,5.9,5.8], comp:[82,84,86,88,89,89], app:[28,30,34,36,40,42] },
  { id:'P023', name:'ì •í•˜ëŠ˜', group:'exp', severity:'good',
    wt:[87.6,86.4,85.0,83.6,82.4,81.2], sbp:[134.1,132,130,129,128,127], hr:[72,71,70,69,68,68],
    steps:[6900,7200,7500,7800,8000,8234], sleep:[6.3,6.5,6.7,6.9,7.1,7.2], comp:[85,87,89,90,91,91], app:[34,36,40,44,46,48] },
  { id:'P002', name:'ìœ¤ì„œì—°', group:'ctrl', severity:'warn',
    wt:[87.7,87.8,87.9,88.0,88.1,88.2], sbp:[135.9,136,136.5,137,137.5,138], hr:[72,72,71,71,70,70],
    steps:[4600,4650,4700,4750,4800,4821], sleep:[6.1,6.0,6.0,5.9,5.9,5.8], comp:[85,86,86,87,87,88], app:[null,null,null,null,null,null] },
  { id:'P008', name:'í•œë„ìœ¤', group:'ctrl', severity:'good',
    wt:[87.9,87.8,87.6,87.4,87.2,87.1], sbp:[133.1,133.5,133.8,134,134.2,134], hr:[72,72,72,72,72,72],
    steps:[4200,4200,4180,4190,4200,4201], sleep:[6.5,6.4,6.4,6.3,6.3,6.2], comp:[85,85,86,86,86,86], app:[40,39,38,38,38,38] },
  { id:'P014', name:'ì†¡ì§€ì•„', group:'ctrl', severity:'good',
    wt:[87.9,87.8,87.8,87.8,87.8,87.8], sbp:[134.5,134.5,135,135,135,135], hr:[72,72,71,71,71,71],
    steps:[4500,4520,4550,4580,4600,4621], sleep:[6.2,6.2,6.1,6.1,6.0,6.0], comp:[85,85,86,86,87,87], app:[34,34,33,33,32,32] },
  { id:'P031', name:'ì„ì±„ì›', group:'ctrl', severity:'bad', alert:true,
    wt:[87.9,88.0,88.3,88.5,88.8,89.1], sbp:[134.2,135,136,137,137.5,138], hr:[73,73,74,74,75,75],
    steps:[4100,4000,3900,3850,3820,3821], sleep:[5.8,5.7,5.5,5.4,5.3,5.2], comp:[84,82,80,78,75,72], app:[28,26,25,24,23,22] },
  { id:'P036', name:'ê°•ì‹œìš°', group:'ctrl', severity:'good',
    wt:[87.0,87.0,86.9,86.9,86.8,86.8], sbp:[131.8,132,132.5,132.8,133,133], hr:[74,74,73,73,72,72],
    steps:[4400,4420,4450,4480,4500,4521], sleep:[6.4,6.3,6.3,6.2,6.2,6.1], comp:[85,86,86,87,88,88], app:[40,39,38,38,38,38] },
];

const WEEKS = ['W1','W2','W3','W4','W5','W6'];
const METRICS = [
  { key:'wt', name:'ì²´ì¤‘', unit:'kg', dir:'down', th:[82,90], src:'emr', srcColor:'#3b82f6' },
  { key:'sbp', name:'SBP', unit:'mmHg', dir:'down', th:[130,140], src:'emr', srcColor:'#3b82f6' },
  { key:'hr', name:'ì‹¬ë°•ìˆ˜', unit:'bpm', dir:'down', th:[65,80], src:'wear', srcColor:'#22c55e' },
  { key:'steps', name:'ê±¸ìŒìˆ˜', unit:'ë³´', dir:'up', th:[5000,8000], src:'wear', srcColor:'#22c55e' },
  { key:'sleep', name:'ìˆ˜ë©´', unit:'h', dir:'up', th:[6,8], src:'wear', srcColor:'#22c55e' },
  { key:'comp', name:'ìˆœì‘ë„', unit:'%', dir:'up', th:[80,95], src:'ema', srcColor:'#a855f7' },
  { key:'app', name:'ì•±ì‚¬ìš©', unit:'ë¶„', dir:'up', th:[20,50], src:'ext', srcColor:'#f97316' },
];

function getVal(p, key, week) {
  return p[key] ? p[key][week] : null;
}

function delta(arr) {
  if (!arr || arr[0]==null || arr[5]==null) return null;
  return arr[5] - arr[0];
}

function fmtDelta(d, m) {
  if (d==null) return '<span class="cell-empty">â€”</span>';
  const isGood = (m.dir==='down' && d<0) || (m.dir==='up' && d>0);
  const isBad = (m.dir==='down' && d>2) || (m.dir==='up' && d<-2);
  const arrow = d>0?'â†‘':d<0?'â†“':'';
  const cls = isGood?'good':isBad?'bad':'neutral';
  const val = m.key==='steps'? (d>0?'+':'')+Math.round(d).toLocaleString() :
              m.key==='comp'||m.key==='app'? (d>0?'+':'')+d.toFixed(0)+'%' :
              (d>0?'+':'')+d.toFixed(1);
  return `<span class="cell-delta ${cls}">${arrow}${val}</span>`;
}

function fmtRaw(v, m) {
  if (v==null) return '';
  if (m.key==='steps') return `<span class="cell-raw">${Math.round(v).toLocaleString()}</span>`;
  if (m.key==='comp'||m.key==='app') return `<span class="cell-raw">${v.toFixed(0)}${m.unit}</span>`;
  return `<span class="cell-raw">${v.toFixed(1)}${m.unit}</span>`;
}

function cellBg(d, m) {
  if (d==null) return '';
  const isGood = (m.dir==='down' && d<-2) || (m.dir==='up' && d>2);
  const isBad = (m.dir==='down' && d>2) || (m.dir==='up' && d<-5);
  if (isGood) return 'background:rgba(34,197,94,0.06);';
  if (isBad) return 'background:rgba(239,68,68,0.06);';
  return '';
}

// ===== ì°¨íŠ¸ SVG ìƒì„± =====
function sparkSVG(arr, color, w, h) {
  const valid = arr.map((v,i)=>v!=null?{v,i}:null).filter(Boolean);
  if (valid.length < 2) return `<svg width="${w}" height="${h}"><text x="${w/2}" y="${h/2+4}" text-anchor="middle" fill="#d1d5db" font-size="10">ë°ì´í„° ì—†ìŒ</text></svg>`;
  const min = Math.min(...valid.map(d=>d.v));
  const max = Math.max(...valid.map(d=>d.v));
  const range = max-min || 1;
  const pad = 8;
  const pts = valid.map(d => {
    const x = pad + (d.i/(arr.length-1))*(w-pad*2);
    const y = pad + (1-(d.v-min)/range)*(h-pad*2);
    return `${x},${y}`;
  });
  const areaStart = `${pad},${h-pad}`;
  const areaEnd = `${pad+(valid[valid.length-1].i/(arr.length-1))*(w-pad*2)},${h-pad}`;
  return `<svg width="${w}" height="${h}">
    <polygon points="${areaStart} ${pts.join(' ')} ${areaEnd}" fill="${color}" opacity="0.08"/>
    <polyline points="${pts.join(' ')}" fill="none" stroke="${color}" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
    ${valid.map(d=>{
      const x = pad + (d.i/(arr.length-1))*(w-pad*2);
      const y = pad + (1-(d.v-min)/range)*(h-pad*2);
      return `<circle cx="${x}" cy="${y}" r="3" fill="white" stroke="${color}" stroke-width="1.5"/>`;
    }).join('')}
  </svg>`;
}

// ===== í…Œì´ë¸” ë Œë” =====
const tbody = document.getElementById('tableBody');
let openRow = null;

PATIENTS.forEach((p, pi) => {
  // ë°ì´í„° í–‰
  const tr = document.createElement('tr');
  if (p.alert) tr.className = 'alert-row';

  // í™˜ì ID ì…€
  let idHtml = `<td class="patient-id">
    <span class="severity-dot ${p.severity}"></span>
    ${p.id}${p.alert?'âš ï¸':''}
    <span class="group-badge ${p.group}">${p.group==='exp'?'ì‹¤í—˜':'ëŒ€ì¡°'}</span>
  </td>`;

  // ì§€í‘œ ì…€ë“¤
  let cellsHtml = '';
  METRICS.forEach(m => {
    const d = delta(p[m.key]);
    const cur = getVal(p, m.key, 5);
    cellsHtml += `<td style="${cellBg(d,m)}">${fmtDelta(d,m)}${fmtRaw(cur,m)}</td>`;
  });

  tr.innerHTML = idHtml + cellsHtml;
  tr.addEventListener('click', () => toggleExpand(pi));
  tbody.appendChild(tr);

  // í™•ì¥ í–‰
  const expandTr = document.createElement('tr');
  expandTr.className = 'expand-row';
  expandTr.id = `expand-${pi}`;
  const expandTd = document.createElement('td');
  expandTd.colSpan = 8;
  expandTr.appendChild(expandTd);
  tbody.appendChild(expandTr);
});

function toggleExpand(pi) {
  const expandEl = document.getElementById(`expand-${pi}`);
  const dataRow = expandEl.previousElementSibling;

  // ë‹¤ë¥¸ ì—´ë ¤ìˆëŠ” ê²ƒ ë‹«ê¸°
  if (openRow !== null && openRow !== pi) {
    const prev = document.getElementById(`expand-${openRow}`);
    prev.classList.remove('open');
    prev.previousElementSibling.classList.remove('selected');
  }

  if (expandEl.classList.contains('open')) {
    expandEl.classList.remove('open');
    dataRow.classList.remove('selected');
    openRow = null;
    return;
  }

  // ì—´ê¸°
  const p = PATIENTS[pi];
  const td = expandEl.querySelector('td');

  // í•µì‹¬ ì°¨íŠ¸ 3ê°œ ì„ íƒ (ì²´ì¤‘, ê±¸ìŒìˆ˜, ìˆœì‘ë„)
  const chartMetrics = [
    METRICS.find(m=>m.key==='wt'),
    METRICS.find(m=>m.key==='steps'),
    METRICS.find(m=>m.key==='comp'),
  ];

  let chartsHtml = chartMetrics.map(m => {
    const arr = p[m.key] || [];
    const d = delta(arr);
    const dStr = d!=null ? (d>0?'+':'')+( m.key==='steps'? Math.round(d).toLocaleString() : m.key==='comp'? d.toFixed(0)+'%' : d.toFixed(1)+m.unit ) : 'â€”';
    return `<div class="expand-chart-card">
      <div class="expand-chart-title">
        <span class="col-source" style="background:${m.srcColor};"></span>
        ${m.name} (${m.unit}) â€” W1â†’W6
      </div>
      <div class="chart-area">${sparkSVG(arr, m.srcColor, 260, 120)}</div>
      <div class="chart-x-labels">${WEEKS.map(w=>`<span>${w}</span>`).join('')}</div>
      <div class="expand-summary">
        <div class="expand-summary-item">W1: <strong>${arr[0]!=null?(m.key==='steps'?Math.round(arr[0]).toLocaleString():arr[0].toFixed(1)):'â€”'}</strong></div>
        <div class="expand-summary-item">W6: <strong>${arr[5]!=null?(m.key==='steps'?Math.round(arr[5]).toLocaleString():arr[5].toFixed(1)):'â€”'}</strong></div>
        <div class="expand-summary-item">Î”: <strong>${dStr}</strong></div>
      </div>
    </div>`;
  }).join('');

  // ë¯¸ë‹ˆ í”Œë¡œìš°ì‹œíŠ¸
  let fsHtml = '<table class="flowsheet-mini"><thead><tr><th>ì§€í‘œ</th>';
  WEEKS.forEach(w => fsHtml += `<th>${w}</th>`);
  fsHtml += '</tr></thead><tbody>';

  METRICS.forEach(m => {
    const arr = p[m.key] || [];
    fsHtml += `<tr><td><span style="display:inline-block;width:6px;height:6px;border-radius:2px;background:${m.srcColor};margin-right:4px;vertical-align:middle;"></span>${m.name}</td>`;
    arr.forEach((v,i) => {
      if (v == null) { fsHtml += '<td class="cell-empty">â€”</td>'; return; }
      const fmt = m.key==='steps'? Math.round(v).toLocaleString() : m.key==='comp'||m.key==='app'? v.toFixed(0) : v.toFixed(1);
      // íˆíŠ¸ë§µ ìƒ‰ìƒ
      let cls = '';
      if (i > 0 && arr[0] != null) {
        const dd = v - arr[0];
        const isG = (m.dir==='down'&&dd<-1)||(m.dir==='up'&&dd>1);
        const isB = (m.dir==='down'&&dd>1)||(m.dir==='up'&&dd<-1);
        cls = isG?'fm-good':isB?'fm-bad':'';
      }
      if (i===5) cls += ' fm-current';
      fsHtml += `<td class="${cls}">${fmt}</td>`;
    });
    fsHtml += '</tr>';
  });
  fsHtml += '</tbody></table>';

  td.innerHTML = `<div class="expand-content">
    ${chartsHtml}
  </div>
  <div style="padding:0 20px 20px;">
    <div style="font-size:12px; font-weight:600; color:#374151; margin-bottom:8px;">ğŸ“‹ ì „ì²´ ì§€í‘œ í”Œë¡œìš°ì‹œíŠ¸ (W1~W6)</div>
    ${fsHtml}
  </div>`;

  expandEl.classList.add('open');
  dataRow.classList.add('selected');
  openRow = pi;
}
</script>
</body>
</html>
