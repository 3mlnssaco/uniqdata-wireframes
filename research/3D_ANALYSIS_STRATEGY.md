# 3D 다차원 분석툴 전략

**Version:** 1.0
**Date:** 2026-02-01
**Status:** Draft

---

## 1. 문제 정의

### 1.1 다루는 데이터 차원

건강 연구 데이터는 본질적으로 **5차원 이상**:

```
┌─────────────────────────────────────────────────────────────┐
│  차원 1: 참여자 (Participant)    P001, P002, ... P087       │
│  차원 2: 시간 (Time)             t1, t2, ... t60 (60일)     │
│  차원 3: 변수 (Variable)         혈당, 복약, 수면, 심박, 기분 │
│  차원 4: 값 (Value)              연속/범주/이진             │
│  차원 5: 인과관계 (Causality)    A → B, 강도, 방향          │
└─────────────────────────────────────────────────────────────┘
```

### 1.2 k-익명성 제약

- **개인 단위 표시 불가** (k≥5 필수)
- 참여자는 **그룹/클러스터**로만 표현
- 드릴다운 시 **대표 궤적(median trajectory)** 사용

---

## 2. 3D 시각화 모드 (3가지)

### 2.1 Mode A: 변수 공간 (Variable Space)

> **"여러 변수 간 관계를 한눈에"**

```
        Z축: 변수 C (예: 수면시간)
        │
        │    ●●●  클러스터 1
        │   ●●●●●
        │  ●●●●●●●
        │ ●●●●●●●●●
        │●●●●●●●●●●●
        └─────────────────── X축: 변수 A (예: 혈당)
       ╱
      ╱
     Y축: 변수 B (예: 복약 순응도)
```

**축 구성:**
| 축 | 매핑 | 예시 |
|----|------|------|
| X | 연속 변수 1 | 평균 혈당 (mg/dL) |
| Y | 연속 변수 2 | 복약 순응도 (%) |
| Z | 연속 변수 3 | 평균 수면시간 (h) |
| 색상 | 범주 변수 / 클러스터 | 연령대, 성별, 그룹 |
| 크기 | 밀도 / 신뢰도 | 데이터 포인트 수 (k≥5) |
| 투명도 | 시간 (최신=불투명) | 최근 데이터 강조 |

**사용 시나리오:**
- "혈당-복약-수면 3변수 관계 탐색"
- "클러스터별 분포 비교"
- "이상치 그룹 발견"

---

### 2.2 Mode B: 시계열 공간 (Temporal Space)

> **"시간에 따른 변화 패턴"**

```
        Z축: 참여자 그룹 (k-익명 클러스터)
        │
        │   ━━━━━━━━━  그룹 A 궤적
        │  ╱
        │ ╱  ━━━━━━━━━  그룹 B 궤적
        │╱
        └─────────────────── X축: 시간 (Day 1 ~ Day 60)
       ╱
      ╱
     Y축: 변수 값 (예: 혈당)
```

**축 구성:**
| 축 | 매핑 | 예시 |
|----|------|------|
| X | 시간 | Day 1 ~ Day 60 |
| Y | 선택된 변수 값 | 혈당, 복약률, 수면 |
| Z | 참여자 그룹 | 클러스터 1~5 (k≥5 보장) |
| 색상 | 그룹 / 상태 | 순응/비순응, 개선/악화 |
| 선 두께 | 그룹 크기 | n=50이면 두껍게 |
| 밴드 | 불확실성 | 95% CI 표시 |

**사용 시나리오:**
- "그룹별 혈당 변화 추이 비교"
- "이벤트(복약 변경) 전후 비교"
- "계절/요일 패턴 발견"

---

### 2.3 Mode C: 인과 네트워크 (Causal Network)

> **"변수 간 인과관계 탐색"**

```
        Z축: 인과 계층 (Cause → Effect)
        │
        │  Layer 3 (결과)     [혈당변동]
        │       ↑               │
        │  Layer 2 (매개)  [수면] ← [스트레스]
        │       ↑       ↑
        │  Layer 1 (원인) [복약] [식사] [운동]
        │
        └─────────────────────────────── X축: 변수 카테고리
       ╱
      ╱
     Y축: 인과 강도 / 시간지연
```

**축 구성:**
| 축 | 매핑 | 예시 |
|----|------|------|
| X | 변수 카테고리 | 행동/생체/환경/주관 |
| Y | 인과 효과 크기 (CATE) | -1.0 ~ +1.0 |
| Z | 인과 계층 | 원인 → 매개 → 결과 |
| 노드 크기 | 중요도 (SHAP) | 클수록 영향력 큼 |
| 엣지 두께 | 인과 강도 | 강할수록 두껍게 |
| 엣지 색상 | 방향 (+/-) | 양성=파랑, 음성=빨강 |
| 엣지 스타일 | 신뢰도 | 실선=확실, 점선=약함 |

**사용 시나리오:**
- "혈당에 가장 큰 영향 주는 요인 찾기"
- "간접 경로 발견 (복약 → 수면 → 혈당)"
- "개입 포인트 탐색"

---

## 3. 차원 축소 전략

### 3.1 5차원+ → 3차원 매핑 옵션

```
┌─────────────────────────────────────────────────────────────┐
│  원본 차원          │  3D 매핑 방법                          │
├─────────────────────┼─────────────────────────────────────────┤
│  참여자 (N명)       │  • k-익명 클러스터로 그룹화 (k≥5)       │
│                     │  • 대표 궤적 (median) 표시              │
│                     │  • 색상/Z축으로 구분                    │
├─────────────────────┼─────────────────────────────────────────┤
│  시간 (T일)         │  • X축 직접 매핑                        │
│                     │  • 슬라이더로 구간 선택                 │
│                     │  • 애니메이션 재생                      │
├─────────────────────┼─────────────────────────────────────────┤
│  변수 (V개)         │  • 3개 선택 → X/Y/Z축                   │
│                     │  • PCA/t-SNE로 차원 축소               │
│                     │  • 드롭다운으로 축 변경                 │
├─────────────────────┼─────────────────────────────────────────┤
│  값 (연속/범주)     │  • 연속 → 축 위치                       │
│                     │  • 범주 → 색상/마커 모양               │
│                     │  • 이진 → 투명도 on/off                │
├─────────────────────┼─────────────────────────────────────────┤
│  인과관계           │  • 엣지로 연결                          │
│                     │  • 계층적 레이아웃 (원인→결과)          │
│                     │  • 강도 → 두께, 방향 → 색상            │
└─────────────────────────────────────────────────────────────┘
```

### 3.2 추가 차원 인코딩

3축 외에 **시각적 속성**으로 추가 차원 표현:

| 시각 속성 | 적합한 데이터 타입 | 예시 |
|----------|------------------|------|
| **색상 (Hue)** | 범주형 (≤7개) | 클러스터, 성별, 질환타입 |
| **채도 (Saturation)** | 연속형 | 신뢰도, 데이터 품질 |
| **크기 (Size)** | 연속형 | 중요도, 샘플 수 |
| **투명도 (Opacity)** | 연속형/시간 | 최신성, 관련도 |
| **모양 (Shape)** | 범주형 (≤5개) | 데이터 타입, 소스 |
| **애니메이션** | 시간 | 일별 변화 재생 |

---

## 4. 사용자 인터랙션

### 4.1 기본 컨트롤

```
┌─────────────────────────────────────────────────────────────┐
│  [회전] 마우스 드래그 / 터치 드래그                          │
│  [확대/축소] 스크롤 / 핀치                                   │
│  [패닝] Shift + 드래그                                       │
│  [리셋] 더블클릭 / R키                                       │
│  [선택] 클릭 (노드/포인트)                                   │
│  [다중선택] Ctrl + 클릭 / 박스 드래그                        │
└─────────────────────────────────────────────────────────────┘
```

### 4.2 축 설정 패널

```
┌─────────────────────────────────────────────────────────────┐
│  X축 설정                                                    │
│  ┌─────────────────────────────────────────────────────┐    │
│  │ 변수: [혈당 (mg/dL)          ▼]                     │    │
│  │ 범위: [70] ────●──── [200]   Auto ☑               │    │
│  │ 스케일: ○ 선형  ● 로그  ○ 정규화                   │    │
│  └─────────────────────────────────────────────────────┘    │
│                                                              │
│  Y축 설정                                                    │
│  ┌─────────────────────────────────────────────────────┐    │
│  │ 변수: [복약 순응도 (%)       ▼]                     │    │
│  │ 범위: [0] ────●──── [100]                          │    │
│  └─────────────────────────────────────────────────────┘    │
│                                                              │
│  Z축 설정                                                    │
│  ┌─────────────────────────────────────────────────────┐    │
│  │ 변수: [수면시간 (h)          ▼]                     │    │
│  │ 범위: [4] ────●──── [10]                           │    │
│  └─────────────────────────────────────────────────────┘    │
│                                                              │
│  색상 매핑                                                   │
│  ┌─────────────────────────────────────────────────────┐    │
│  │ 변수: [클러스터              ▼]                     │    │
│  │ 팔레트: ● Viridis ○ Plasma ○ Category             │    │
│  └─────────────────────────────────────────────────────┘    │
└─────────────────────────────────────────────────────────────┘
```

### 4.3 시간 컨트롤 (Mode B)

```
┌─────────────────────────────────────────────────────────────┐
│                                                              │
│  Day 1 ════════════●════════════════════════════ Day 60    │
│                   Day 23                                     │
│                                                              │
│  [◀◀] [◀] [▶ 재생] [▶▶]   속도: [1x ▼]   루프 ☑           │
│                                                              │
│  표시 구간: [Day 1] ~ [Day 30]  전체 ☐                      │
│                                                              │
└─────────────────────────────────────────────────────────────┘
```

### 4.4 필터 패널

```
┌─────────────────────────────────────────────────────────────┐
│  필터 (k≥5 보장됨)                                          │
│                                                              │
│  ☑ 연령대                                                   │
│    ☑ 30-39세 (n=23)                                        │
│    ☑ 40-49세 (n=45)                                        │
│    ☐ 50-59세 (n=19)                                        │
│                                                              │
│  ☑ 클러스터                                                 │
│    ☑ 순응 그룹 (n=52)                                      │
│    ☑ 비순응 그룹 (n=35)                                    │
│                                                              │
│  ☐ 데이터 품질                                              │
│    완료율: [70%] ───●─── [100%]                            │
│                                                              │
│  ⚠️ 현재 표시: 68명 (k-check: pass)                        │
│                                                              │
│  [필터 초기화]  [필터 저장]                                  │
└─────────────────────────────────────────────────────────────┘
```

---

## 5. 클릭 인터랙션 & 연동

### 5.1 노드/포인트 클릭 시

```
┌─────────────────────────────────────────────────────────────┐
│  Mode A (산점도 포인트 클릭)                                 │
│  ─────────────────────────────────────────────────────────  │
│  클릭 → 클러스터 상세 패널 표시                              │
│       ├─ 그룹 통계 (n, mean, std)                           │
│       ├─ 대표 궤적 미리보기                                  │
│       ├─ [시계열로 보기] → Mode B 전환                       │
│       └─ [인과 분석] → Mode C에서 해당 그룹 필터            │
└─────────────────────────────────────────────────────────────┘

┌─────────────────────────────────────────────────────────────┐
│  Mode C (인과 노드 클릭)                                     │
│  ─────────────────────────────────────────────────────────  │
│  클릭 → 변수 상세 패널 표시                                  │
│       ├─ SHAP 중요도 (해당 변수)                            │
│       ├─ 연결된 인과관계 목록                                │
│       ├─ [CATE 분석] → analysis-personalized로 이동         │
│       ├─ [What-If] → analysis-whatif로 이동                 │
│       └─ [시계열 보기] → Mode B (해당 변수)                 │
└─────────────────────────────────────────────────────────────┘

┌─────────────────────────────────────────────────────────────┐
│  Mode C (인과 엣지 클릭)                                     │
│  ─────────────────────────────────────────────────────────  │
│  클릭 → 인과관계 상세 패널 표시                              │
│       ├─ 효과 크기 (ATE, CATE)                              │
│       ├─ 95% CI, p-value                                    │
│       ├─ 통제 변수 목록                                      │
│       ├─ 시간 지연 (lag)                                    │
│       ├─ [What-If 시뮬레이션] → 개입 효과 계산              │
│       └─ ⚠️ 인과 면책: "조건부 관측, 확정 아님"            │
└─────────────────────────────────────────────────────────────┘
```

### 5.2 분석 도구 연동

```
┌────────────────────────────────────────────────────────────────────┐
│                                                                    │
│                    3D 분석툴 (Hub)                                 │
│                         │                                          │
│         ┌───────────────┼───────────────┐                          │
│         │               │               │                          │
│         ▼               ▼               ▼                          │
│   ┌──────────┐   ┌──────────┐   ┌──────────┐                       │
│   │  SHAP    │   │   CATE   │   │ What-If  │                       │
│   │ 중요도   │   │ 개인화   │   │ 시뮬레이션│                       │
│   └────┬─────┘   └────┬─────┘   └────┬─────┘                       │
│        │              │              │                              │
│        └──────────────┼──────────────┘                              │
│                       │                                             │
│                       ▼                                             │
│               ┌──────────────┐                                      │
│               │  RootCLAM    │                                      │
│               │  이상 추적    │                                      │
│               └──────────────┘                                      │
│                                                                    │
│  데이터 흐름:                                                       │
│  • 3D에서 노드 선택 → 해당 변수로 SHAP/CATE 분석                   │
│  • 3D에서 엣지 선택 → 해당 관계로 What-If 시뮬레이션              │
│  • 3D에서 이상 클러스터 → RootCLAM으로 원인 추적                   │
│                                                                    │
└────────────────────────────────────────────────────────────────────┘
```

---

## 6. 기술 구현

### 6.1 프론트엔드 스택

```javascript
// 권장 스택
{
  "3D 렌더링": "Three.js + React Three Fiber",
  "그래프 레이아웃": "d3-force-3d / ngraph",
  "차트 연동": "Plotly.js (2D fallback)",
  "상태 관리": "Zustand / Jotai",
  "WebGL 최적화": "instanced rendering, LOD"
}
```

### 6.2 백엔드 API

```
GET /api/v2/projects/:id/3d/variable-space
  ?variables=blood_glucose,medication_adherence,sleep_hours
  &cluster_by=kmeans_5
  &time_range=day_1,day_30

GET /api/v2/projects/:id/3d/temporal
  ?variable=blood_glucose
  &group_by=cluster
  &aggregation=median

GET /api/v2/projects/:id/3d/causal-network
  ?algorithm=pc
  &threshold=0.3
  &layout=hierarchical
```

### 6.3 성능 최적화

| 데이터 크기 | 최적화 전략 |
|------------|------------|
| < 1,000 포인트 | 직접 렌더링 |
| 1,000 ~ 10,000 | Instanced Mesh |
| 10,000 ~ 100,000 | LOD (Level of Detail) + 샘플링 |
| > 100,000 | 서버사이드 집계 + 타일링 |

---

## 7. k-익명성 & 프라이버시

### 7.1 시각화 레벨별 k-check

| 시각화 레벨 | k 요구사항 | 처리 방법 |
|------------|-----------|----------|
| 전체 분포 | k≥5 | 통과 시 표시 |
| 클러스터 | 각 클러스터 k≥5 | 미달 클러스터 숨김 |
| 필터 적용 후 | 필터 결과 k≥5 | 미달 시 "표본 부족" |
| 드릴다운 | 대상 그룹 k≥5 | 대표 궤적만 표시 |

### 7.2 프라이버시 가드레일

```
┌─────────────────────────────────────────────────────────────┐
│  ⚠️ 프라이버시 보호 규칙                                    │
│                                                              │
│  1. 개인 점(individual point) 표시 금지                      │
│     → 항상 클러스터/그룹 집계                                │
│                                                              │
│  2. 필터 조합으로 k<5 도달 시 즉시 차단                      │
│     → "표시할 수 없습니다. 필터를 완화하세요."              │
│                                                              │
│  3. 대표 궤적 = 그룹 중앙값 (median)                         │
│     → 특정 개인 추정 불가                                    │
│                                                              │
│  4. 10분 캐시 윈도우 (differencing attack 방지)              │
│     → 필터 변경 후 동일 그룹 재요청 시 캐시 응답            │
│                                                              │
│  5. 모든 조작 감사 로그 기록                                 │
│     → 축 변경, 필터, 클릭 이벤트 전부 로깅                  │
│                                                              │
└─────────────────────────────────────────────────────────────┘
```

---

## 8. UI 레이아웃

### 8.1 전체 화면 구성

```
┌─────────────────────────────────────────────────────────────────────────┐
│ [← 개요]  인과 구조 발견 (3D)                    [레시피 저장] [공유]  │
├─────────────┬───────────────────────────────────────────┬───────────────┤
│             │                                           │               │
│  설정 패널  │                                           │  상세 패널    │
│  (280px)    │            3D 캔버스                      │  (320px)      │
│             │                                           │               │
│  ┌────────┐ │                                           │  ┌─────────┐  │
│  │모드 선택│ │         ●      ●                         │  │선택 노드│  │
│  │ A B C  │ │       ●   ●  ●                           │  │  상세   │  │
│  └────────┘ │     ●   ●  ●   ●                         │  └─────────┘  │
│             │       ●  ●  ●                             │               │
│  ┌────────┐ │         ●                                 │  ┌─────────┐  │
│  │축 설정 │ │                                           │  │ 관련    │  │
│  │ X Y Z │ │                                           │  │ 분석    │  │
│  └────────┘ │                                           │  │ 도구    │  │
│             │                                           │  └─────────┘  │
│  ┌────────┐ │                                           │               │
│  │필터    │ │                                           │  ┌─────────┐  │
│  └────────┘ │                                           │  │인과 면책│  │
│             │                                           │  └─────────┘  │
│  ┌────────┐ │                                           │               │
│  │시간    │ │  [◀] Day 23/60 [▶]                       │               │
│  │슬라이더│ │  ════════●══════════════════════════════  │               │
│  └────────┘ │                                           │               │
├─────────────┴───────────────────────────────────────────┴───────────────┤
│ Mode: [Variable Space ▼]  k-check: ✓ pass (n=68)  DP: ε=0.15 remaining │
└─────────────────────────────────────────────────────────────────────────┘
```

### 8.2 모바일/태블릿 대응

```
태블릿 (768px~1024px):
- 설정 패널: 하단 시트 (bottom sheet)
- 상세 패널: 우측 오버레이

모바일 (< 768px):
- 3D → 2D 폴백 (Plotly)
- 풀스크린 모드
- 제스처 컨트롤
```

---

## 9. 구현 단계

### Phase 1: MVP (2주)
- [ ] Mode A (변수 공간 산점도) 기본 구현
- [ ] 3축 선택 드롭다운
- [ ] 클러스터 색상 매핑
- [ ] k-익명 체크 연동

### Phase 2: 시계열 (1주)
- [ ] Mode B (시계열 공간)
- [ ] 시간 슬라이더
- [ ] 그룹별 궤적 렌더링
- [ ] 애니메이션 재생

### Phase 3: 인과 네트워크 (2주)
- [ ] Mode C (인과 그래프)
- [ ] 계층적 레이아웃
- [ ] 노드/엣지 클릭 → 상세 패널
- [ ] 분석 도구 연동

### Phase 4: 고급 기능 (1주)
- [ ] 레시피 저장/불러오기
- [ ] 필터 프리셋
- [ ] 성능 최적화 (LOD)
- [ ] 감사 로그 연동

---

## 10. 상관관계 베이스 데이터 (Whitepaper) 전략

> **핵심 아이디어:** 사전 계산된 변수 간 상관관계 매트릭스가 있어야, 사용자가 타겟 변수를 선택했을 때 영향 요인을 탐색할 수 있다.

### 10.1 데이터 소스 계층 구조

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                                                                             │
│   Layer 3: 개인 상관관계 (Personal Correlations)                            │
│   ├─ 소스: 사용자 본인 데이터                                               │
│   ├─ 신뢰도: ★★☆ (n이 작아 통계적 약함)                                    │
│   └─ 갱신: 실시간                                                           │
│                                                                             │
│   Layer 2: 플랫폼 집계 상관관계 (Platform Aggregate)                        │
│   ├─ 소스: UniQdata 전체 사용자 (k-익명 + DP 보호)                          │
│   ├─ 신뢰도: ★★★ (n이 크고 실제 데이터)                                    │
│   └─ 갱신: 주간 배치                                                        │
│                                                                             │
│   Layer 1: 문헌 기반 상관관계 (Literature-Based)                            │
│   ├─ 소스: 학술 연구, 메타 분석, 가이드라인                                 │
│   ├─ 신뢰도: ★★★★ (피어리뷰 검증됨)                                       │
│   └─ 갱신: 분기별 업데이트                                                  │
│                                                                             │
└─────────────────────────────────────────────────────────────────────────────┘
```

### 10.2 외부 데이터 소스 (Layer 1: Literature)

#### A. 대규모 코호트 연구 데이터베이스

| 데이터 소스 | 설명 | 활용 방법 |
|------------|------|----------|
| **UK Biobank** | 50만명, 2,000+ 건강 지표 | 상관계수 매트릭스 추출 (공개 데이터) |
| **NHANES** | 미국 국민건강영양조사 (CDC) | 건강지표-생활습관 상관관계 |
| **All of Us** (NIH) | 100만명 다양성 연구 | 유전-환경-건강 상관관계 |
| **Korean NHIS** | 한국 국민건강보험공단 빅데이터 | 한국인 특화 상관관계 |
| **GWAS Catalog** | 유전자-형질 연관성 | 유전적 인과관계 근거 |

#### B. 메타 분석 & 리뷰 데이터

| 데이터 소스 | 설명 | 활용 방법 |
|------------|------|----------|
| **Cochrane Database** | 체계적 문헌고찰 | 개입-효과 인과관계 (Gold Standard) |
| **PubMed/MEDLINE** | 의학 논문 DB | NLP로 상관관계 추출 |
| **Clinical Guidelines** | 진료 지침 (ACC/AHA 등) | 권고 기반 인과관계 |
| **DrugBank** | 약물 상호작용 | 복약-부작용-효과 네트워크 |

#### C. 특화 데이터셋

| 데이터 소스 | 설명 | 활용 방법 |
|------------|------|----------|
| **Apple Heart Study** | 심방세동 연구 | 웨어러블-심장건강 상관 |
| **MIMIC-IV** | ICU 환자 데이터 | 바이탈-예후 인과관계 |
| **Sleep Heart Health** | 수면-심혈관 코호트 | 수면지표-건강 상관 |
| **SPRINT Trial** | 혈압 개입 연구 | 혈압-심혈관 인과관계 |

### 10.3 내부 데이터 소스 (Layer 2: Platform Aggregate)

#### A. UniQdata 플랫폼 데이터 수집

```
┌─────────────────────────────────────────────────────────────────────────────┐
│  보답 (60+)                                                                  │
│  ├─ 일상 루틴 × 인지기능                                                    │
│  ├─ 음성 바이오마커 × 정서상태                                              │
│  ├─ 복약 순응도 × 증상 변화                                                 │
│  └─ 사회활동 × 건강지표                                                     │
│                                                                             │
│  ready-Q (20-30)                                                            │
│  ├─ ADHD 지표 × 루틴 수행률                                                 │
│  ├─ 수면패턴 × 집중도                                                       │
│  ├─ 에너지레벨 × 생산성                                                     │
│  └─ 스트레스 × 습관 변화                                                    │
│                                                                             │
│  Medi-Q (30-50)                                                             │
│  ├─ 복약 × 바이탈 변화                                                      │
│  ├─ 검진수치 × 생활습관                                                     │
│  ├─ 증상일지 × 복약 반응                                                    │
│  └─ 만성질환 × 합병증                                                       │
│                                                                             │
│  플랫폼 연동 (HealthKit/Health Connect)                                     │
│  ├─ 걸음수 × 수면시간                                                       │
│  ├─ 심박수 × 활동량                                                         │
│  ├─ HRV × 스트레스                                                          │
│  └─ 체중 × 칼로리                                                           │
└─────────────────────────────────────────────────────────────────────────────┘
```

#### B. 플랫폼 집계 상관관계 계산

```python
# 주간 배치 상관관계 계산 (개념)
def compute_platform_correlations():
    """
    k-익명화 + 차등 프라이버시 적용된 상관관계 계산
    """
    correlations = {}

    for var_pair in all_variable_pairs:
        # 1. 최소 n ≥ 1000 (통계적 유의성)
        if count(var_pair) < 1000:
            continue

        # 2. k-익명화된 그룹에서만 계산
        k_anon_groups = get_k_anonymous_groups(var_pair, k=5)

        # 3. 노이즈 추가 (ε=0.5)
        raw_corr = pearson_correlation(var_pair)
        noised_corr = add_laplace_noise(raw_corr, epsilon=0.5)

        # 4. 신뢰구간 계산
        ci_95 = bootstrap_confidence_interval(var_pair)

        correlations[var_pair] = {
            'r': noised_corr,
            'n': count(var_pair),
            'ci_lower': ci_95[0],
            'ci_upper': ci_95[1],
            'p_value': calculate_p_value(var_pair),
            'source': 'platform_aggregate',
            'updated_at': datetime.now()
        }

    return correlations
```

### 10.4 상관관계 매트릭스 구조

```json
{
  "matrix_version": "2026.02",
  "total_variables": 847,
  "total_pairs": 357,481,
  "correlations": [
    {
      "var_a": "blood_glucose",
      "var_b": "medication_adherence",
      "layers": {
        "literature": {
          "r": -0.42,
          "ci_95": [-0.38, -0.46],
          "source": "Cochrane:CD007543",
          "evidence_level": "A",
          "n": 45000,
          "updated": "2025-09"
        },
        "platform": {
          "r": -0.38,
          "ci_95": [-0.32, -0.44],
          "source": "uniqdata_aggregate",
          "n": 12847,
          "epsilon_used": 0.5,
          "updated": "2026-01-28"
        },
        "personal": null
      },
      "combined_r": -0.40,
      "confidence": "high",
      "causal_direction": "medication → blood_glucose",
      "time_lag_days": [1, 7, 30],
      "moderators": ["age", "disease_severity"]
    },
    {
      "var_a": "sleep_duration",
      "var_b": "fasting_glucose",
      "layers": {
        "literature": {
          "r": -0.25,
          "ci_95": [-0.20, -0.30],
          "source": "PMID:35847293",
          "evidence_level": "B",
          "n": 8500,
          "updated": "2024-06"
        },
        "platform": {
          "r": -0.22,
          "ci_95": [-0.18, -0.26],
          "source": "uniqdata_aggregate",
          "n": 5420,
          "epsilon_used": 0.5,
          "updated": "2026-01-28"
        },
        "personal": null
      },
      "combined_r": -0.24,
      "confidence": "medium",
      "causal_direction": "bidirectional",
      "time_lag_days": [1, 3, 7],
      "moderators": ["age", "bmi", "diabetes_status"]
    }
  ]
}
```

### 10.5 상관관계 결합 알고리즘

```
┌─────────────────────────────────────────────────────────────────────────────┐
│  Correlation Fusion Algorithm                                                │
│                                                                             │
│  1. 기본값: 문헌 (Literature)                                               │
│     └─ 문헌에서 발견된 상관관계가 기본 베이스                               │
│                                                                             │
│  2. 보강: 플랫폼 집계 (Platform)                                            │
│     ├─ 문헌과 일치 (+0.1 ~ -0.1): 신뢰도 상승                               │
│     ├─ 문헌과 불일치: 가중 평균 (문헌 70%, 플랫폼 30%)                      │
│     └─ 문헌에 없음: 플랫폼만 사용 (신뢰도 medium)                           │
│                                                                             │
│  3. 개인화: 개인 데이터 (Personal)                                          │
│     ├─ n ≥ 30: 개인 상관관계 별도 표시                                     │
│     ├─ 집단과 다른 경우: "당신은 평균과 다름" 표시                          │
│     └─ 사용자 옵션: 개인 데이터 우선 / 집단 데이터 우선                     │
│                                                                             │
│  Combined Score = w₁×r_lit + w₂×r_plat + w₃×r_personal                     │
│  where w₁+w₂+w₃ = 1, 기본 w₁=0.5, w₂=0.3, w₃=0.2                          │
│                                                                             │
└─────────────────────────────────────────────────────────────────────────────┘
```

### 10.6 변수 카테고리 체계

```
┌─────────────────────────────────────────────────────────────────────────────┐
│  Variable Ontology (847개 변수)                                              │
│                                                                             │
│  1. 생체지표 (Biomarkers) - 187개                                           │
│     ├─ 혈액검사: glucose, HbA1c, cholesterol, triglycerides, ...            │
│     ├─ 바이탈: BP, HR, HRV, SpO2, temperature, ...                          │
│     ├─ 신체계측: weight, BMI, waist_circumference, ...                      │
│     └─ 유전자: polygenic_risk_scores (if available)                         │
│                                                                             │
│  2. 행동 (Behaviors) - 234개                                                │
│     ├─ 수면: duration, quality, latency, wake_times, ...                    │
│     ├─ 활동: steps, exercise_minutes, sedentary_time, ...                   │
│     ├─ 식이: calories, macros, meal_timing, ...                             │
│     └─ 복약: adherence, timing, missed_doses, ...                           │
│                                                                             │
│  3. 주관적 상태 (Subjective) - 156개                                        │
│     ├─ 기분: mood_score, anxiety, stress, ...                               │
│     ├─ 에너지: energy_level, fatigue, alertness, ...                        │
│     ├─ 증상: pain_level, nausea, dizziness, ...                             │
│     └─ 인지: focus, memory, concentration, ...                              │
│                                                                             │
│  4. 환경 (Environment) - 89개                                               │
│     ├─ 날씨: temperature, humidity, air_quality, ...                        │
│     ├─ 사회: social_interaction, isolation, ...                             │
│     └─ 시간: day_of_week, season, holidays, ...                             │
│                                                                             │
│  5. 질병/진단 (Conditions) - 181개                                          │
│     ├─ 만성질환: diabetes, hypertension, heart_disease, ...                 │
│     ├─ 정신건강: depression, ADHD, anxiety_disorder, ...                    │
│     └─ 급성상태: infection, injury, flare_up, ...                           │
│                                                                             │
└─────────────────────────────────────────────────────────────────────────────┘
```

### 10.7 인과관계 경로 탐색

사용자가 타겟 변수를 선택하면, 상관관계 네트워크를 탐색:

```
┌─────────────────────────────────────────────────────────────────────────────┐
│  예시: 사용자가 "혈당 변화 (blood_glucose_variability)" 타겟 설정          │
│                                                                             │
│  Step 1: 직접 연결된 변수 (1차)                                            │
│  blood_glucose_variability                                                  │
│        ↑                                                                    │
│  ┌─────┴─────┬─────────────┬──────────────┬───────────────┐                │
│  │           │             │              │               │                │
│  medication  carb_intake   sleep_quality  stress_level   exercise         │
│  r=-0.42    r=+0.38       r=-0.25        r=+0.32        r=-0.28           │
│                                                                             │
│  Step 2: 2차 연결 (간접 경로)                                               │
│  stress_level (r=+0.32)                                                     │
│        ↑                                                                    │
│  ┌─────┴─────┬─────────────┐                                               │
│  │           │             │                                               │
│  work_hours  sleep_quality  social_support                                 │
│  r=+0.45    r=-0.38        r=-0.29                                         │
│                                                                             │
│  Step 3: 경로 중요도 계산                                                   │
│  Path 1: medication → blood_glucose (직접) = 0.42                          │
│  Path 2: work_hours → stress → blood_glucose = 0.45 × 0.32 = 0.14         │
│  Path 3: sleep_quality → stress → blood_glucose = 0.38 × 0.32 = 0.12      │
│  Path 4: sleep_quality → blood_glucose (직접) = 0.25                       │
│                                                                             │
│  → "복약 순응도"가 가장 큰 영향, 다음으로 "수면", "스트레스"               │
│  → 간접 경로도 중요: "업무시간 → 스트레스 → 혈당" 경로 발견                │
│                                                                             │
└─────────────────────────────────────────────────────────────────────────────┘
```

### 10.8 사용자 인터랙션 흐름

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                                                                             │
│  1. 타겟 변수 선택                                                          │
│     ┌─────────────────────────────────────────────────────────────────┐    │
│     │  🎯 추적하고 싶은 변수: [혈당 변동성 (Blood Glucose Variability) ▼]│    │
│     └─────────────────────────────────────────────────────────────────┘    │
│                                                                             │
│  2. 자동 탐색 결과                                                          │
│     ┌─────────────────────────────────────────────────────────────────┐    │
│     │  📊 혈당 변동성에 영향을 주는 요인들 (상관관계 기반)              │    │
│     │                                                                 │    │
│     │  직접 영향 (1차)                      간접 영향 (2차+)          │    │
│     │  ━━━━━━━━━━━━━━                        ━━━━━━━━━━━━━━           │    │
│     │  🔴 복약 순응도      r=-0.42 ★★★★    💼 업무시간 → 스트레스    │    │
│     │  🟠 탄수화물 섭취    r=+0.38 ★★★     😴 수면 → 스트레스        │    │
│     │  🟡 스트레스         r=+0.32 ★★★     🏃 운동 → 수면            │    │
│     │  🟢 운동량           r=-0.28 ★★                                │    │
│     │  🔵 수면 질          r=-0.25 ★★                                │    │
│     │                                                                 │    │
│     │  [노드 클릭하여 경로 탐색] [What-If 시뮬레이션]                 │    │
│     └─────────────────────────────────────────────────────────────────┘    │
│                                                                             │
│  3. 경로 탐색 모드 (마인드맵 형태)                                          │
│                                                                             │
│                    ┌───────────────┐                                        │
│                    │ 혈당 변동성  │                                        │
│                    │  (TARGET)    │                                        │
│                    └───────┬──────┘                                        │
│           ┌───────────────┼───────────────┬───────────────┐                │
│           ▼               ▼               ▼               ▼                │
│     ┌──────────┐   ┌──────────┐   ┌──────────┐   ┌──────────┐              │
│     │ 복약     │   │ 탄수화물 │   │ 스트레스 │   │ 수면     │              │
│     │ r=-0.42  │   │ r=+0.38  │   │ r=+0.32  │   │ r=-0.25  │              │
│     └────┬─────┘   └──────────┘   └────┬─────┘   └────┬─────┘              │
│          │                              │              │                    │
│          ▼                         ┌────┴────┐         ▼                    │
│     [클릭: 상세]              ┌────┴───┐┌────┴───┐ [클릭: 상세]            │
│                               │ 업무   ││ 카페인 │                         │
│                               │ 시간   ││        │                         │
│                               └────────┘└────────┘                         │
│                                                                             │
│  4. 노드 클릭 시 상세                                                       │
│     ┌─────────────────────────────────────────────────────────────────┐    │
│     │  📋 스트레스 → 혈당 변동성                                       │    │
│     │                                                                 │    │
│     │  상관계수: r = +0.32                                            │    │
│     │  95% CI: [0.28, 0.36]                                           │    │
│     │  근거 레벨: ★★★ (문헌 + 플랫폼 일치)                           │    │
│     │                                                                 │    │
│     │  📚 문헌 근거:                                                   │    │
│     │  • Cochrane Review 2024: 스트레스 호르몬이 인슐린 저항성 증가   │    │
│     │  • PMID:35847293: 8,500명 코호트, 스트레스-혈당 연관성 확인     │    │
│     │                                                                 │    │
│     │  📊 플랫폼 데이터:                                               │    │
│     │  • UniQdata 5,420명 분석, r=+0.30 (문헌과 일치)                 │    │
│     │                                                                 │    │
│     │  🧪 당신의 데이터:                                               │    │
│     │  • 개인 상관관계: r=+0.45 (평균보다 높음)                       │    │
│     │  • 💡 스트레스 관리가 특히 중요할 수 있습니다                    │    │
│     │                                                                 │    │
│     │  [← 이전] [What-If 시뮬레이션] [연결된 변수 보기]               │    │
│     └─────────────────────────────────────────────────────────────────┘    │
│                                                                             │
└─────────────────────────────────────────────────────────────────────────────┘
```

### 10.9 데이터 수집 파이프라인

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                                                                             │
│  Literature Ingestion Pipeline (분기별)                                     │
│  ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━                                    │
│                                                                             │
│  ┌──────────┐   ┌──────────┐   ┌──────────┐   ┌──────────┐   ┌──────────┐  │
│  │ PubMed   │   │ Semantic │   │ Extract  │   │ Validate │   │ Store in │  │
│  │ Search   │──▶│ Parser   │──▶│ Corr     │──▶│ Quality  │──▶│ Matrix   │  │
│  │          │   │ (NLP)    │   │ Values   │   │ Check    │   │ DB       │  │
│  └──────────┘   └──────────┘   └──────────┘   └──────────┘   └──────────┘  │
│                                                                             │
│  Platform Aggregation Pipeline (주간)                                       │
│  ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━                                      │
│                                                                             │
│  ┌──────────┐   ┌──────────┐   ┌──────────┐   ┌──────────┐   ┌──────────┐  │
│  │ User     │   │ k-Anon   │   │ Compute  │   │ Add DP   │   │ Store in │  │
│  │ Data     │──▶│ Group    │──▶│ Pearson  │──▶│ Noise    │──▶│ Matrix   │  │
│  │ Extract  │   │ (k≥5)    │   │ Corr     │   │ (ε=0.5)  │   │ DB       │  │
│  └──────────┘   └──────────┘   └──────────┘   └──────────┘   └──────────┘  │
│                                                                             │
│  Personal Correlation Pipeline (실시간)                                     │
│  ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━                                    │
│                                                                             │
│  ┌──────────┐   ┌──────────┐   ┌──────────┐   ┌──────────┐                 │
│  │ User's   │   │ Rolling  │   │ Compare  │   │ Show     │                 │
│  │ Own Data │──▶│ Window   │──▶│ vs Agg   │──▶│ Personal │                 │
│  │          │   │ (30 days)│   │          │   │ Insight  │                 │
│  └──────────┘   └──────────┘   └──────────┘   └──────────┘                 │
│                                                                             │
└─────────────────────────────────────────────────────────────────────────────┘
```

### 10.10 구현 우선순위

| Phase | 작업 | 기간 |
|-------|------|------|
| **Phase 1** | UK Biobank + NHANES에서 핵심 100개 변수쌍 상관관계 수동 추출 | 1주 |
| **Phase 2** | PubMed NLP 파이프라인 구축 (자동 상관관계 추출) | 2주 |
| **Phase 3** | 플랫폼 집계 상관관계 계산 파이프라인 | 2주 |
| **Phase 4** | 상관관계 결합 알고리즘 + API | 1주 |
| **Phase 5** | 마인드맵 UI 구현 (경로 탐색) | 2주 |

### 10.11 API 설계

```
# 상관관계 매트릭스 API

GET /api/v2/correlations/matrix
  ?variables=blood_glucose,sleep_duration,stress
  &layers=literature,platform

GET /api/v2/correlations/search
  ?target=blood_glucose_variability
  &depth=2  # 2차 연결까지
  &min_r=0.2  # 최소 상관계수

GET /api/v2/correlations/path
  ?from=work_hours
  &to=blood_glucose_variability
  &max_hops=3

GET /api/v2/correlations/personal
  ?user_id=xxx
  ?target=blood_glucose_variability
  &compare_with=aggregate
```

---

## 11. 관련 문서

- `UNIQDATA_ENTERPRISE_SPEC.md` - 전체 스펙
- `DATA_ACCESS_ARCHITECTURE.md` - 데이터 접근 아키텍처
- `analysis-discovery.html` - 현재 와이어프레임 (고도화 대상)

---

*Last Updated: 2026-02-01*
