<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>í´ë¦°ë£¸ - UniQdata</title>
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif; background: #0f0f0f; color: #e5e5e5; }

    .layout { display: flex; min-height: 100vh; }

    /* ===== SIDEBAR ===== */
    .sidebar { width: 240px; background: #1a1a1a; border-right: 1px solid #2a2a2a; padding: 16px 12px; flex-shrink: 0; display: flex; flex-direction: column; }
    .logo { font-size: 17px; font-weight: 700; padding: 8px 12px; margin-bottom: 16px; color: #fff; display: flex; align-items: center; gap: 10px; }
    .logo-icon { width: 32px; height: 32px; background: linear-gradient(135deg, #3b82f6, #8b5cf6); border-radius: 8px; display: flex; align-items: center; justify-content: center; font-size: 14px; }
    .nav-section { margin-bottom: 8px; }
    .nav-item { display: flex; align-items: center; gap: 10px; padding: 10px 12px; border-radius: 8px; margin-bottom: 2px; color: #888; font-size: 13px; cursor: pointer; transition: all 0.15s; text-decoration: none; }
    .nav-item:hover { background: #252525; color: #ccc; }
    .nav-item .icon { width: 18px; text-align: center; font-size: 14px; }
    .research-nav-item { margin-bottom: 2px; }
    .research-nav-header { display: flex; align-items: center; gap: 8px; padding: 8px 12px; border-radius: 8px; cursor: pointer; font-size: 12px; color: #888; transition: all 0.15s; }
    .research-nav-header:hover { background: #252525; color: #ccc; }
    .research-nav-item.expanded .research-nav-header { background: rgba(59, 130, 246, 0.1); color: #60a5fa; }
    .folder-icon { font-size: 13px; }
    .research-title { flex: 1; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
    .status-dot { width: 7px; height: 7px; border-radius: 50%; flex-shrink: 0; }
    .status-dot.active { background: #22c55e; }
    .status-dot.recruiting { background: #3b82f6; }
    .status-dot.draft { background: #6b7280; }
    .research-nav-sub { display: none; padding-left: 20px; margin-top: 4px; border-left: 2px solid #333; margin-left: 18px; }
    .research-nav-item.expanded .research-nav-sub { display: block; }
    .nav-sub-item { display: flex; align-items: center; gap: 8px; padding: 8px 12px; border-radius: 6px; color: #777; font-size: 12px; cursor: pointer; transition: all 0.15s; text-decoration: none; margin-bottom: 2px; }
    .nav-sub-item:hover { background: #252525; color: #ccc; }
    .nav-sub-item.active { background: rgba(59, 130, 246, 0.15); color: #60a5fa; border-left: 2px solid #3b82f6; margin-left: -2px; padding-left: 14px; }
    .nav-sub-item .dot { width: 6px; height: 6px; border-radius: 50%; background: currentColor; opacity: 0.5; }
    .nav-sub-item.active .dot { background: #3b82f6; opacity: 1; }

    /* ===== MAIN ===== */
    .main { flex: 1; display: flex; flex-direction: column; overflow: hidden; }
    .header { padding: 16px 24px; border-bottom: 1px solid #2a2a2a; display: flex; align-items: center; justify-content: space-between; }
    .header-left h1 { font-size: 18px; font-weight: 600; display: flex; align-items: center; gap: 10px; }
    .header-left .sub { font-size: 13px; color: #666; margin-top: 4px; }
    .header-btn { padding: 8px 14px; border-radius: 8px; font-size: 13px; cursor: pointer; border: 1px solid #333; background: #1a1a1a; color: #ccc; }
    .header-btn:hover { border-color: #3b82f6; }
    .header-btn.primary { background: linear-gradient(135deg, #3b82f6, #8b5cf6); border-color: transparent; color: white; font-weight: 600; }
    .header-btn.danger { background: rgba(239,68,68,0.15); border-color: rgba(239,68,68,0.4); color: #ef4444; }

    /* ===== SESSION GATE ===== */
    .session-gate { flex: 1; display: flex; flex-direction: column; align-items: center; padding: 40px 24px; overflow-y: auto; }
    .gate-hero { text-align: center; margin-bottom: 32px; }
    .gate-hero .gate-icon { font-size: 48px; margin-bottom: 12px; }
    .gate-hero h2 { font-size: 24px; font-weight: 700; color: #e5e5e5; margin-bottom: 8px; }
    .gate-desc { font-size: 14px; color: #666; }
    .gate-content { max-width: 720px; width: 100%; display: flex; flex-direction: column; gap: 20px; }
    .gate-card { background: #1a1a1a; border: 1px solid #2a2a2a; border-radius: 12px; overflow: hidden; }
    .gate-card.security { border-color: rgba(245,158,11,0.3); }
    .gate-card-header { padding: 14px 20px; border-bottom: 1px solid #2a2a2a; display: flex; align-items: center; gap: 12px; font-size: 14px; font-weight: 600; }
    .step-badge { width: 26px; height: 26px; background: linear-gradient(135deg, #3b82f6, #8b5cf6); border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 12px; font-weight: 700; color: white; flex-shrink: 0; }
    .irb-badge { margin-left: auto; padding: 4px 10px; background: rgba(34,197,94,0.15); border: 1px solid rgba(34,197,94,0.3); border-radius: 6px; font-size: 11px; color: #22c55e; font-weight: 600; }
    .gate-card-body { padding: 20px; }
    .gate-field { margin-bottom: 16px; }
    .gate-field:last-child { margin-bottom: 0; }
    .gate-field label { display: block; font-size: 12px; color: #888; margin-bottom: 6px; font-weight: 500; }
    .gate-field select, .gate-field input[type="date"] { width: 100%; padding: 10px 14px; background: #252525; border: 1px solid #333; border-radius: 8px; color: #e5e5e5; font-size: 13px; }
    .gate-field-row { display: flex; gap: 12px; margin-bottom: 16px; }
    .gate-field-row .gate-field { flex: 1; margin-bottom: 0; }
    .var-chips { display: flex; flex-wrap: wrap; gap: 6px; }
    .var-chip { padding: 5px 10px; background: #252525; border: 1px solid #333; border-radius: 6px; font-size: 11px; color: #94a3b8; }
    .var-chip.add { border-style: dashed; color: #3b82f6; cursor: pointer; }
    .var-chip.add:hover { border-color: #3b82f6; }

    .security-check { display: flex; align-items: flex-start; gap: 12px; padding: 12px; border: 1px solid #2a2a2a; border-radius: 8px; margin-bottom: 8px; cursor: pointer; transition: all 0.15s; }
    .security-check:last-child { margin-bottom: 0; }
    .security-check:hover { border-color: rgba(245,158,11,0.4); background: rgba(245,158,11,0.03); }
    .security-check input[type="checkbox"] { margin-top: 2px; accent-color: #f59e0b; }
    .check-title { font-size: 13px; color: #e5e5e5; font-weight: 500; }
    .check-desc { font-size: 11px; color: #64748b; margin-top: 2px; line-height: 1.4; }

    .preview-grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: 12px; margin-bottom: 16px; }
    .preview-stat { text-align: center; padding: 12px 8px; background: #252525; border-radius: 8px; }
    .preview-stat .stat-value { font-size: 18px; font-weight: 700; color: #e5e5e5; }
    .preview-stat .stat-label { font-size: 10px; color: #64748b; margin-top: 4px; }
    .privacy-checks { display: flex; gap: 12px; }
    .privacy-item { font-size: 11px; color: #94a3b8; display: flex; align-items: center; gap: 4px; }
    .privacy-item.pass { color: #22c55e; }

    .gate-actions { text-align: center; margin-top: 8px; }
    .gate-enter-btn { width: 100%; padding: 16px; background: linear-gradient(135deg, #3b82f6, #8b5cf6); border: none; border-radius: 12px; color: white; font-size: 16px; font-weight: 700; cursor: pointer; transition: all 0.2s; }
    .gate-enter-btn:hover { transform: translateY(-1px); box-shadow: 0 8px 25px rgba(59,130,246,0.3); }
    .gate-footnote { font-size: 11px; color: #555; margin-top: 10px; }

    /* ===== ACTIVE SESSION ===== */
    .session-bar { display: flex; align-items: center; padding: 8px 24px; background: linear-gradient(135deg, rgba(34,197,94,0.08), rgba(16,185,129,0.04)); border-bottom: 2px solid rgba(34,197,94,0.25); gap: 20px; font-size: 12px; flex-shrink: 0; }
    .session-indicator { display: flex; align-items: center; gap: 6px; }
    .session-live-dot { width: 8px; height: 8px; background: #22c55e; border-radius: 50%; animation: pulse 2s infinite; }
    @keyframes pulse { 0%,100% { opacity: 1; } 50% { opacity: 0.4; } }
    .session-label { color: #22c55e; font-weight: 600; font-size: 12px; }
    .session-meta { display: flex; gap: 16px; color: #64748b; font-size: 11px; }
    .session-meta .val { color: #e5e5e5; font-weight: 500; }
    .session-chips { display: flex; gap: 6px; }
    .session-chip { padding: 3px 10px; background: #252525; border: 1px solid #333; border-radius: 12px; font-size: 10px; color: #94a3b8; }
    .session-right { margin-left: auto; display: flex; align-items: center; gap: 12px; }
    .security-badge { display: flex; align-items: center; gap: 4px; font-size: 11px; color: #22c55e; }
    .session-end-btn { padding: 5px 12px; background: rgba(239,68,68,0.15); border: 1px solid rgba(239,68,68,0.3); border-radius: 6px; color: #ef4444; font-size: 11px; cursor: pointer; }
    .session-end-btn:hover { background: rgba(239,68,68,0.25); }

    .active-content { flex: 1; display: flex; overflow: hidden; }

    /* ===== LEFT: CONFIG PANEL ===== */
    .config-panel { width: 280px; background: #1a1a1a; border-right: 1px solid #2a2a2a; padding: 16px; overflow-y: auto; flex-shrink: 0; }
    .config-section { margin-bottom: 20px; }
    .config-section .title { font-size: 11px; font-weight: 600; color: #64748b; text-transform: uppercase; letter-spacing: 0.5px; margin-bottom: 10px; display: flex; align-items: center; gap: 6px; }
    .scope-summary { background: #252525; border-radius: 10px; padding: 12px; }
    .scope-row { display: flex; justify-content: space-between; font-size: 12px; padding: 5px 0; }
    .scope-row .label { color: #888; }
    .scope-row .value { font-weight: 500; color: #e5e5e5; }
    .scope-locked { margin-top: 8px; padding: 8px; background: rgba(245,158,11,0.08); border: 1px solid rgba(245,158,11,0.2); border-radius: 6px; font-size: 10px; color: #f59e0b; text-align: center; }

    .security-meter { margin-bottom: 14px; }
    .meter-header { display: flex; justify-content: space-between; font-size: 11px; margin-bottom: 6px; }
    .meter-header .m-label { color: #888; }
    .meter-header .m-value { font-weight: 600; color: #e5e5e5; }
    .meter-header .m-value.pass { color: #22c55e; }
    .meter-bar { height: 4px; background: #333; border-radius: 2px; overflow: hidden; }
    .meter-fill { height: 100%; border-radius: 2px; transition: width 0.3s; }
    .meter-fill.pass { background: #22c55e; }
    .meter-fill.dp { background: #3b82f6; }
    .meter-fill.query { background: #f59e0b; }
    .meter-footnote { font-size: 9px; color: #555; margin-top: 4px; }

    .irb-card { background: #252525; border-radius: 10px; padding: 12px; }
    .irb-row { display: flex; justify-content: space-between; font-size: 11px; padding: 4px 0; }
    .irb-row .label { color: #888; }
    .irb-row .value { color: #e5e5e5; font-weight: 500; }
    .irb-row .value.status-ok { color: #22c55e; }

    /* ===== CENTER: ANALYSIS AREA ===== */
    .analysis-area { flex: 1; display: flex; flex-direction: column; overflow: hidden; }
    .cr-tabs { display: flex; gap: 4px; padding: 10px 20px; background: #151515; border-bottom: 1px solid #2a2a2a; align-items: center; }
    .cr-tabs-label { font-size: 10px; color: #555; text-transform: uppercase; letter-spacing: 0.5px; margin-right: 10px; padding-right: 10px; border-right: 1px solid #333; }
    .cr-tab { padding: 8px 16px; border: 1px solid #333; border-radius: 8px; background: #1a1a1a; color: #888; font-size: 12px; cursor: pointer; display: flex; align-items: center; gap: 6px; transition: all 0.15s; }
    .cr-tab:hover { border-color: #3b82f6; color: #ccc; }
    .cr-tab.active { background: linear-gradient(135deg, #3b82f6, #8b5cf6); border-color: transparent; color: white; font-weight: 600; }
    .cr-tabs-note { margin-left: auto; font-size: 10px; color: #444; }
    .tool-content { display: none; flex: 1; overflow: hidden; }
    .tool-content.active { display: flex; flex-direction: column; }

    /* ===== DISCOVERY TOOL ===== */
    .target-bar { padding: 14px 20px; background: linear-gradient(135deg, rgba(59,130,246,0.1), rgba(139,92,246,0.1)); border-bottom: 1px solid #2a2a2a; display: flex; align-items: center; gap: 14px; }
    .target-bar select { padding: 8px 14px; background: #1a1a1a; border: 2px solid #3b82f6; border-radius: 8px; color: #e5e5e5; font-size: 13px; font-weight: 600; min-width: 260px; }
    .target-status { display: flex; align-items: center; gap: 6px; padding: 6px 12px; background: rgba(34,197,94,0.1); border: 1px solid rgba(34,197,94,0.3); border-radius: 6px; font-size: 10px; color: #22c55e; }
    .graph-wrap { flex: 1; display: flex; overflow: hidden; }
    .graph-canvas { flex: 1; position: relative; background: radial-gradient(circle at center, #1a1a1a 0%, #0f0f0f 100%); overflow: hidden; }
    .graph-toolbar { padding: 10px 16px; border-bottom: 1px solid #2a2a2a; display: flex; align-items: center; gap: 14px; background: #151515; font-size: 12px; }
    .view-toggle { display: flex; background: #252525; border-radius: 6px; padding: 2px; }
    .view-toggle button { padding: 5px 10px; border: none; background: transparent; color: #888; font-size: 11px; border-radius: 4px; cursor: pointer; }
    .view-toggle button.active { background: #3b82f6; color: white; }
    .strength-inline { display: flex; align-items: center; gap: 6px; color: #888; font-size: 11px; }
    .strength-inline input { width: 100px; height: 4px; -webkit-appearance: none; background: #333; border-radius: 2px; }
    .strength-inline input::-webkit-slider-thumb { -webkit-appearance: none; width: 12px; height: 12px; background: #3b82f6; border-radius: 50%; cursor: pointer; }
    .graph-stats { display: flex; gap: 14px; margin-left: auto; font-size: 11px; color: #888; }
    .graph-stats .val { color: #fff; font-weight: 600; }
    .graph-3d { width: 100%; height: 100%; position: relative; perspective: 1200px; cursor: grab; }
    .graph-3d:active { cursor: grabbing; }
    .graph-container { position: absolute; top: 50%; left: 50%; transform-style: preserve-3d; transition: transform 0.1s ease-out; }
    .node-3d { position: absolute; transform-style: preserve-3d; cursor: pointer; transition: opacity 0.3s, transform 0.3s; user-select: none; }
    .node-3d .sphere { width: 60px; height: 60px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 11px; font-weight: 600; text-align: center; line-height: 1.2; border: 2px solid; transition: all 0.3s; box-shadow: 0 0 20px rgba(0,0,0,0.5); color: white; }
    .node-3d .label { position: absolute; top: 100%; left: 50%; transform: translateX(-50%); font-size: 10px; color: #666; white-space: nowrap; margin-top: 8px; transition: all 0.3s; }
    .node-3d.dim .sphere { opacity: 0.15; border-color: #333 !important; }
    .node-3d.dim .label { opacity: 0.3; }
    .node-3d.weak .sphere { opacity: 0.2; }
    .node-3d.active .sphere { box-shadow: 0 0 30px currentColor, 0 0 60px currentColor; transform: scale(1.1); }
    .node-3d.active .label { color: #fff; }
    .node-3d:hover:not(.dim) .sphere { transform: scale(1.15); }
    .node-3d.outcome .sphere { background: rgba(59,130,246,0.3); border-color: #3b82f6; color: #93c5fd; }
    .node-3d.treatment .sphere { background: rgba(245,158,11,0.3); border-color: #f59e0b; color: #fcd34d; }
    .node-3d.mediator .sphere { background: rgba(16,185,129,0.3); border-color: #10b981; color: #6ee7b7; }
    .node-3d.confounder .sphere { background: rgba(139,92,246,0.3); border-color: #8b5cf6; color: #c4b5fd; }
    .node-3d.other .sphere { background: rgba(100,100,110,0.2); border-color: #555; color: #999; width: 50px; height: 50px; font-size: 10px; }
    .selection-info { position: absolute; bottom: 16px; left: 16px; background: rgba(20,20,30,0.95); border: 1px solid #2a2a3a; border-radius: 10px; padding: 14px 18px; backdrop-filter: blur(10px); min-width: 280px; z-index: 5; }
    .selection-info .si-title { font-size: 11px; color: #666; margin-bottom: 6px; }
    .selection-info .nodes { display: flex; flex-wrap: wrap; gap: 5px; margin-bottom: 10px; min-height: 24px; }
    .node-tag { padding: 3px 8px; border-radius: 5px; font-size: 10px; font-weight: 500; }
    .node-tag.outcome { background: rgba(59,130,246,0.2); color: #93c5fd; }
    .node-tag.treatment { background: rgba(245,158,11,0.2); color: #fcd34d; }
    .node-tag.mediator { background: rgba(16,185,129,0.2); color: #6ee7b7; }
    .node-tag.confounder { background: rgba(139,92,246,0.2); color: #c4b5fd; }
    .si-stats { display: flex; gap: 16px; font-size: 11px; color: #888; }
    .si-stats .val { color: #fff; font-weight: 600; }
    .graph-legend { position: absolute; bottom: 16px; right: 16px; background: rgba(26,26,26,0.95); border: 1px solid #2a2a2a; border-radius: 8px; padding: 12px 14px; z-index: 5; }
    .graph-legend .lg-title { font-size: 10px; color: #666; margin-bottom: 8px; text-transform: uppercase; letter-spacing: 0.5px; }
    .legend-item { display: flex; align-items: center; gap: 6px; font-size: 11px; color: #888; margin-bottom: 4px; }
    .legend-item:last-child { margin-bottom: 0; }
    .legend-dot { width: 8px; height: 8px; border-radius: 50%; border: 2px solid; }
    .legend-dot.outcome { border-color: #3b82f6; background: rgba(59,130,246,0.3); }
    .legend-dot.treatment { border-color: #f59e0b; background: rgba(245,158,11,0.3); }
    .legend-dot.mediator { border-color: #10b981; background: rgba(16,185,129,0.3); }
    .legend-dot.confounder { border-color: #8b5cf6; background: rgba(139,92,246,0.3); }
    .drag-hint { position: absolute; bottom: 16px; left: 50%; transform: translateX(-50%); font-size: 10px; color: #333; z-index: 5; }

    /* ===== RIGHT: AUDIT PANEL ===== */
    .audit-panel { width: 300px; background: #1a1a1a; border-left: 1px solid #2a2a2a; display: flex; flex-direction: column; flex-shrink: 0; }
    .audit-tabs { display: flex; border-bottom: 1px solid #2a2a2a; }
    .audit-tab { flex: 1; padding: 12px; background: transparent; border: none; border-bottom: 2px solid transparent; color: #666; font-size: 12px; cursor: pointer; display: flex; align-items: center; justify-content: center; gap: 6px; }
    .audit-tab.active { color: #e5e5e5; border-bottom-color: #3b82f6; }
    .audit-tab .badge { font-size: 10px; padding: 1px 6px; border-radius: 8px; background: #333; color: #888; }
    .audit-view { display: none; flex: 1; flex-direction: column; overflow: hidden; }
    .audit-view.active { display: flex; }
    .audit-log { flex: 1; overflow-y: auto; }
    .log-entry { display: flex; gap: 10px; padding: 10px 14px; border-bottom: 1px solid #222; font-size: 11px; align-items: flex-start; }
    .log-time { color: #555; font-family: 'SF Mono', Monaco, monospace; font-size: 10px; min-width: 46px; padding-top: 1px; }
    .log-body { flex: 1; }
    .log-action { color: #e5e5e5; font-weight: 500; }
    .log-detail { color: #555; font-size: 10px; margin-top: 2px; }
    .log-icon { font-size: 14px; }
    .log-footer { padding: 10px 14px; border-top: 1px solid #2a2a2a; display: flex; justify-content: space-between; font-size: 10px; color: #555; }

    .export-content { padding: 14px; flex: 1; overflow-y: auto; }
    .export-rules-header { font-size: 11px; font-weight: 600; color: #64748b; margin-bottom: 8px; text-transform: uppercase; letter-spacing: 0.5px; }
    .export-rule { display: flex; align-items: center; gap: 8px; padding: 6px 0; font-size: 12px; color: #94a3b8; }
    .export-rule .ri { font-size: 12px; }
    .export-rule .ri.ok { color: #22c55e; }
    .export-rule .ri.no { color: #ef4444; }
    .export-rule.blocked { color: #555; }
    .export-divider { height: 1px; background: #2a2a2a; margin: 14px 0; }
    .export-queue-header { font-size: 11px; font-weight: 600; color: #64748b; margin-bottom: 10px; text-transform: uppercase; letter-spacing: 0.5px; }
    .export-empty { font-size: 12px; color: #444; line-height: 1.6; padding: 16px; text-align: center; background: #151515; border-radius: 8px; }
    .export-request-btn { width: 100%; padding: 12px; background: linear-gradient(135deg, #3b82f6, #8b5cf6); border: none; border-radius: 8px; color: white; font-size: 12px; font-weight: 600; cursor: pointer; margin-top: 14px; }
    .export-note { font-size: 10px; color: #555; margin-top: 8px; text-align: center; line-height: 1.4; }

    /* ===== BOTTOM STATUS BAR ===== */
    .bottom-bar { padding: 8px 24px; background: rgba(26,26,26,0.95); border-top: 1px solid #2a2a2a; display: flex; align-items: center; gap: 18px; font-size: 11px; flex-shrink: 0; }
    .bar-item { display: flex; align-items: center; gap: 5px; color: #64748b; }
    .bar-dot { width: 6px; height: 6px; border-radius: 50%; }
    .bar-dot.green { background: #22c55e; }
    .bar-dot.blue { background: #3b82f6; }
    .bar-dot.amber { background: #f59e0b; }
    .bar-dot.purple { background: #8b5cf6; }
    .bar-item .bv { color: #e5e5e5; font-weight: 500; }

    /* Placeholder tool */
    .tool-placeholder { flex: 1; display: flex; align-items: center; justify-content: center; flex-direction: column; gap: 14px; color: #555; }
    .tool-placeholder .tp-icon { font-size: 40px; }
    .tool-placeholder .tp-title { font-size: 16px; font-weight: 600; color: #94a3b8; }
    .tool-placeholder .tp-desc { font-size: 12px; max-width: 360px; text-align: center; line-height: 1.6; color: #555; }

    /* ===== TERMINAL ===== */
    .terminal-wrap { flex:1; display:flex; flex-direction:column; overflow:hidden; }
    .terminal-toolbar { display:flex; align-items:center; gap:10px; padding:10px 16px; background:#151515; border-bottom:1px solid #2a2a2a; }
    .lang-selector { display:flex; background:#252525; border-radius:6px; padding:2px; }
    .lang-btn { padding:5px 12px; border:none; background:transparent; color:#888; font-size:11px; border-radius:4px; cursor:pointer; font-family:'SF Mono',Monaco,monospace; }
    .lang-btn.active { background:#3b82f6; color:white; }
    .terminal-env { font-size:10px; color:#555; margin-left:auto; display:flex; align-items:center; gap:12px; }
    .terminal-env .env-item { display:flex; align-items:center; gap:4px; }
    .terminal-env .env-dot { width:6px; height:6px; border-radius:50%; background:#22c55e; }
    .terminal-cells { flex:1; overflow-y:auto; padding:12px 16px; display:flex; flex-direction:column; gap:8px; }
    .cell { border:1px solid #2a2a2a; border-radius:10px; overflow:hidden; background:#1a1a1a; }
    .cell:hover { border-color:#333; }
    .cell.running { border-color:rgba(59,130,246,0.5); }
    .cell.running .cell-status { color:#3b82f6; }
    .cell-header { display:flex; align-items:center; gap:8px; padding:6px 12px; background:#151515; border-bottom:1px solid #222; font-size:10px; }
    .cell-num { color:#555; font-family:'SF Mono',Monaco,monospace; min-width:40px; }
    .cell-status { color:#22c55e; font-size:9px; }
    .cell-time { margin-left:auto; color:#444; font-family:'SF Mono',Monaco,monospace; }
    .cell-run-btn { padding:3px 10px; background:rgba(34,197,94,0.15); border:1px solid rgba(34,197,94,0.3); border-radius:4px; color:#22c55e; font-size:10px; cursor:pointer; border:none; }
    .cell-run-btn:hover { background:rgba(34,197,94,0.25); }
    .cell-code { padding:12px 16px; font-family:'SF Mono',Monaco,'Courier New',monospace; font-size:12px; line-height:1.7; color:#e5e5e5; white-space:pre; overflow-x:auto; background:#0d1117; }
    .cell-code .kw { color:#ff7b72; }
    .cell-code .fn { color:#d2a8ff; }
    .cell-code .str { color:#a5d6ff; }
    .cell-code .cm { color:#8b949e; font-style:italic; }
    .cell-code .num { color:#79c0ff; }
    .cell-code .var { color:#ffa657; }
    .cell-code .op { color:#ff7b72; }
    .cell-output { padding:12px 16px; background:#111; border-top:1px solid #222; font-family:'SF Mono',Monaco,monospace; font-size:11px; line-height:1.6; color:#94a3b8; overflow-x:auto; }
    .cell-output .out-label { color:#555; font-size:10px; margin-bottom:4px; }
    .cell-output table { border-collapse:collapse; width:100%; margin-top:6px; }
    .cell-output th { text-align:left; padding:4px 10px; font-size:10px; color:#64748b; border-bottom:1px solid #333; font-weight:600; }
    .cell-output td { padding:4px 10px; font-size:11px; color:#e5e5e5; border-bottom:1px solid #1e1e1e; }
    .cell-output .out-chart { height:120px; background:rgba(59,130,246,0.05); border:1px solid #2a2a2a; border-radius:6px; margin-top:8px; display:flex; align-items:flex-end; padding:8px 12px; gap:3px; }
    .cell-output .chart-bar { background:linear-gradient(to top, #3b82f6, #8b5cf6); border-radius:2px 2px 0 0; flex:1; min-width:0; transition:height 0.3s; }
    .cell-output .dp-warn { margin-top:8px; padding:6px 10px; background:rgba(245,158,11,0.08); border:1px solid rgba(245,158,11,0.2); border-radius:6px; font-size:10px; color:#f59e0b; display:flex; align-items:center; gap:6px; }
    .terminal-input-area { padding:12px 16px; border-top:1px solid #2a2a2a; background:#151515; display:flex; align-items:center; gap:8px; }
    .terminal-input-area .prompt-sign { color:#22c55e; font-family:'SF Mono',Monaco,monospace; font-size:13px; font-weight:700; }
    .terminal-input { flex:1; background:#0d1117; border:1px solid #333; border-radius:8px; padding:10px 14px; color:#e5e5e5; font-family:'SF Mono',Monaco,monospace; font-size:12px; outline:none; }
    .terminal-input:focus { border-color:#3b82f6; }
    .terminal-run-btn { padding:10px 20px; background:linear-gradient(135deg, #22c55e, #16a34a); border:none; border-radius:8px; color:white; font-size:12px; font-weight:600; cursor:pointer; }
    .terminal-run-btn:hover { opacity:0.9; }
    .terminal-shortcuts { display:flex; gap:6px; }
    .terminal-shortcut { padding:4px 8px; background:#252525; border:1px solid #333; border-radius:4px; font-size:9px; color:#888; cursor:pointer; font-family:'SF Mono',Monaco,monospace; }
    .terminal-shortcut:hover { border-color:#3b82f6; color:#ccc; }

    /* Nav links */
    .nav-links { display: flex; gap: 10px; padding: 14px 24px; border-top: 1px solid #2a2a2a; }
    .nav-links a { padding: 6px 12px; background: #252525; border-radius: 6px; text-decoration: none; color: #888; font-size: 12px; }
    .nav-links a:hover { background: #333; color: #fff; }

    /* Algo options (for config panel in active session) */
    .algo-option { padding: 10px; border: 1px solid #2a2a2a; border-radius: 8px; margin-bottom: 6px; cursor: pointer; transition: all 0.15s; }
    .algo-option:hover { border-color: #444; }
    .algo-option.selected { border-color: #8b5cf6; background: rgba(139,92,246,0.1); }
    .algo-option .name { font-size: 12px; font-weight: 500; margin-bottom: 3px; display: flex; align-items: center; gap: 6px; }
    .algo-option .name .badge { font-size: 9px; padding: 1px 5px; border-radius: 3px; background: #8b5cf6; color: white; }
    .algo-option .desc { font-size: 10px; color: #666; line-height: 1.3; }
    .threshold-slider { margin-bottom: 12px; }
    .threshold-slider .ts-header { display: flex; justify-content: space-between; font-size: 11px; margin-bottom: 6px; }
    .threshold-slider .ts-label { color: #888; }
    .threshold-slider .ts-value { color: #3b82f6; font-weight: 600; }
    .threshold-slider input[type="range"] { width: 100%; height: 4px; -webkit-appearance: none; background: #333; border-radius: 2px; }
    .threshold-slider input[type="range"]::-webkit-slider-thumb { -webkit-appearance: none; width: 12px; height: 12px; background: #3b82f6; border-radius: 50%; cursor: pointer; }
  </style>
</head>
<body>
  <div class="layout">
    <!-- ===== SIDEBAR ===== -->
    <div class="sidebar">
      <div class="logo">
        <div class="logo-icon">U</div>
        UniQdata
      </div>

      <div class="nav-section">
        <a href="list.html" class="nav-item"><span class="icon">ğŸ </span> ì—°êµ¬ í—ˆë¸Œ</a>
        <a href="create.html" class="nav-item"><span class="icon">â•</span> ìƒˆ ì—°êµ¬</a>
        <a href="irb-submission.html" class="nav-item"><span class="icon">ğŸ“</span> IRB ì‹¬ì˜ ì‹ ì²­</a>
        <a href="irb-status.html" class="nav-item"><span class="icon">ğŸ“Š</span> IRB í˜„í™©</a>
        <a href="action-center.html" class="nav-item"><span class="icon">ğŸ””</span> ì¡°ì¹˜ ì„¼í„°</a>
      </div>

      <div class="nav-section" style="flex: 1; overflow-y: auto; padding-top: 8px; border-top: 1px solid #2a2a2a;">
        <div style="font-size: 10px; color: #64748b; padding: 6px 12px; text-transform: uppercase; letter-spacing: 0.5px;">ë‚´ ì—°êµ¬ <span style="background: #3b82f6; color: white; padding: 1px 6px; border-radius: 8px; font-size: 9px; margin-left: 4px;">3</span></div>

        <div class="research-nav-item expanded">
          <div class="research-nav-header">
            <span class="folder-icon">ğŸ“</span>
            <span class="research-title">ë‹¹ë‡¨ë³‘ ë³µì•½ ìˆœì‘ë„</span>
            <span class="status-dot active"></span>
          </div>
          <div class="research-nav-sub">
            <a href="data-overview.html" class="nav-sub-item"><span class="dot"></span> ê°œìš”</a>
            <a href="data-table.html" class="nav-sub-item"><span class="dot"></span> í…Œì´ë¸”</a>
            <a href="clean-room.html" class="nav-sub-item active"><span class="dot"></span> ğŸ”’ í´ë¦°ë£¸</a>
          </div>
        </div>

        <div class="research-nav-item" style="opacity: 0.6;">
          <div class="research-nav-header">
            <span class="folder-icon">ğŸ“</span>
            <span class="research-title">ë…¸ì¸ ìˆ˜ë©´ íŒ¨í„´</span>
            <span class="status-dot recruiting"></span>
          </div>
        </div>
        <div class="research-nav-item" style="opacity: 0.6;">
          <div class="research-nav-header">
            <span class="folder-icon">ğŸ“„</span>
            <span class="research-title">ADHD ìƒí™œìŠµê´€</span>
            <span class="status-dot draft"></span>
          </div>
        </div>
      </div>

      <div class="nav-section">
        <a href="../team.html" class="nav-item"><span class="icon">ğŸ‘¥</span> íŒ€</a>
        <a href="../billing.html" class="nav-item"><span class="icon">ğŸ’³</span> ê²°ì œ</a>
        <a href="#" class="nav-item"><span class="icon">âš™ï¸</span> ì„¤ì •</a>
      </div>

      <div style="padding: 12px; border-top: 1px solid #2a2a2a;">
        <div style="display: flex; align-items: center; gap: 10px; padding: 8px; border-radius: 8px; cursor: pointer;" onmouseover="this.style.background='#252525'" onmouseout="this.style.background='transparent'">
          <div style="width: 32px; height: 32px; background: linear-gradient(135deg, #3b82f6, #8b5cf6); border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 12px; color: white;">ê¹€</div>
          <div>
            <div style="font-size: 13px; color: #e2e8f0;">ê¹€ì—°êµ¬</div>
            <div style="font-size: 11px; color: #64748b;">ì„œìš¸ëŒ€í•™êµë³‘ì›</div>
          </div>
        </div>
      </div>
    </div>

    <!-- ===== MAIN ===== -->
    <div class="main">
      <div class="header">
        <div class="header-left">
          <h1><span class="icon">ğŸ”’</span> í´ë¦°ë£¸</h1>
          <div class="sub">ë³´ì•ˆ ë¶„ì„ í™˜ê²½ Â· ë‹¹ë‡¨ë³‘ ë³µì•½ ìˆœì‘ë„ ì—°êµ¬</div>
        </div>
        <div class="header-actions">
          <button class="header-btn primary" id="btn-start" onclick="startSession()">ğŸ” ì„¸ì…˜ ì‹œì‘</button>
          <button class="header-btn danger" id="btn-end" onclick="endSession()" style="display:none;">â¹ ì„¸ì…˜ ì¢…ë£Œ</button>
        </div>
      </div>

      <!-- ========== SESSION GATE ========== -->
      <div id="session-gate" class="session-gate">
        <div class="gate-hero">
          <div class="gate-icon">ğŸ”’</div>
          <h2>í´ë¦°ë£¸ ì„¸ì…˜ ì‹œì‘</h2>
          <p class="gate-desc">ë³´ì•ˆ ë¶„ì„ í™˜ê²½ì— ì…ì¥í•©ë‹ˆë‹¤. ë°ì´í„° ë²”ìœ„ë¥¼ ì„¤ì •í•˜ê³  ë³´ì•ˆ ë™ì˜ë¥¼ í™•ì¸í•˜ì„¸ìš”.</p>
        </div>

        <div class="gate-content">
          <!-- Step 1: Data Scope -->
          <div class="gate-card">
            <div class="gate-card-header">
              <span class="step-badge">1</span>
              ë°ì´í„° ë²”ìœ„ ì„¤ì •
            </div>
            <div class="gate-card-body">
              <div class="gate-field">
                <label>ì½”í˜¸íŠ¸</label>
                <select>
                  <option selected>ë‹¹ë‡¨ë³‘ 2í˜• â€” ì„œìš¸ëŒ€ë³‘ì› (n=87)</option>
                  <option>ì „ì²´ ì½”í˜¸íŠ¸ (n=342)</option>
                </select>
              </div>
              <div class="gate-field">
                <label>ë¶„ì„ ë³€ìˆ˜</label>
                <div class="var-chips">
                  <span class="var-chip">í˜ˆë‹¹ ë³€ë™ì„±</span>
                  <span class="var-chip">ë³µì•½ ìˆœì‘ë„</span>
                  <span class="var-chip">ìˆ˜ë©´ ì§ˆ</span>
                  <span class="var-chip">ìŠ¤íŠ¸ë ˆìŠ¤</span>
                  <span class="var-chip">ì²´ì¤‘</span>
                  <span class="var-chip">HbA1c</span>
                  <span class="var-chip">í˜ˆì••</span>
                  <span class="var-chip">ìš´ë™ëŸ‰</span>
                  <span class="var-chip">ì‹ì´ íŒ¨í„´</span>
                  <span class="var-chip">ì¸ìŠë¦°</span>
                  <span class="var-chip">BMI</span>
                  <span class="var-chip">ìœ ë³‘ ê¸°ê°„</span>
                  <span class="var-chip add">+ ë³€ìˆ˜ ì¶”ê°€</span>
                </div>
                <div style="font-size: 10px; color: #64748b; margin-top: 6px;">12ê°œ ì„ íƒ / 847ê°œ ê°€ëŠ¥</div>
              </div>
              <div class="gate-field-row">
                <div class="gate-field">
                  <label>ì‹œì‘ì¼</label>
                  <input type="date" value="2025-06-01">
                </div>
                <div class="gate-field">
                  <label>ì¢…ë£Œì¼</label>
                  <input type="date" value="2026-01-31">
                </div>
              </div>
              <div class="gate-field">
                <label>ê°œì¸ì •ë³´ ë³´í˜¸ ìˆ˜ì¤€</label>
                <select>
                  <option selected>ë¹„ì‹ë³„ ì§‘ê³„ (Aggregated)</option>
                  <option>ê°€ëª…ì²˜ë¦¬ (Pseudonymized)</option>
                  <option>ë ˆì½”ë“œ ìˆ˜ì¤€ (IRB íŠ¹ë³„ ìŠ¹ì¸ í•„ìš”)</option>
                </select>
              </div>
            </div>
          </div>

          <!-- Step 2: Security -->
          <div class="gate-card security">
            <div class="gate-card-header">
              <span class="step-badge">2</span>
              ë³´ì•ˆ ë™ì˜
              <span class="irb-badge">IRB-2025-0847</span>
            </div>
            <div class="gate-card-body">
              <label class="security-check">
                <input type="checkbox" class="sec-check">
                <div>
                  <div class="check-title">ì›ë³¸ ë°ì´í„° ì ‘ê·¼ ë¶ˆê°€</div>
                  <div class="check-desc">ê°œë³„ ë ˆì½”ë“œ ì—´ëŒì´ ë¶ˆê°€í•˜ë©°, ì§‘ê³„ ê²°ê³¼ë§Œ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</div>
                </div>
              </label>
              <label class="security-check">
                <input type="checkbox" class="sec-check">
                <div>
                  <div class="check-title">ê°ì‚¬ ë¡œê·¸ ê¸°ë¡</div>
                  <div class="check-desc">ëª¨ë“  ì¿¼ë¦¬, ë¶„ì„ ì‹¤í–‰, ê²°ê³¼ ì—´ëŒì´ ê¸°ë¡ë©ë‹ˆë‹¤.</div>
                </div>
              </label>
              <label class="security-check">
                <input type="checkbox" class="sec-check">
                <div>
                  <div class="check-title">ë‚´ë³´ë‚´ê¸° ìŠ¹ì¸ í•„ìˆ˜</div>
                  <div class="check-desc">ë¶„ì„ ê²°ê³¼ ë‚´ë³´ë‚´ê¸°ëŠ” PI ìŠ¹ì¸ í›„ì—ë§Œ ê°€ëŠ¥í•©ë‹ˆë‹¤.</div>
                </div>
              </label>
              <label class="security-check">
                <input type="checkbox" class="sec-check">
                <div>
                  <div class="check-title">ì„¸ì…˜ ì¢…ë£Œ ì‹œ ë¡œì»¬ ë°ì´í„° ì‚­ì œ</div>
                  <div class="check-desc">ì„¸ì…˜ ì¢…ë£Œ ì‹œ ë¸Œë¼ìš°ì € ìºì‹œì˜ ë¶„ì„ ë°ì´í„°ê°€ ì‚­ì œë©ë‹ˆë‹¤.</div>
                </div>
              </label>
            </div>
          </div>

          <!-- Step 3: Preview -->
          <div class="gate-card">
            <div class="gate-card-header">
              <span class="step-badge">3</span>
              ë°ì´í„° ìš”ì•½ ë¯¸ë¦¬ë³´ê¸°
            </div>
            <div class="gate-card-body">
              <div class="preview-grid">
                <div class="preview-stat">
                  <div class="stat-value">87ëª…</div>
                  <div class="stat-label">ì°¸ì—¬ì</div>
                </div>
                <div class="preview-stat">
                  <div class="stat-value">12ê°œ</div>
                  <div class="stat-label">ë³€ìˆ˜</div>
                </div>
                <div class="preview-stat">
                  <div class="stat-value">7ê°œì›”</div>
                  <div class="stat-label">ê¸°ê°„</div>
                </div>
                <div class="preview-stat">
                  <div class="stat-value">94.2%</div>
                  <div class="stat-label">ë°ì´í„° í’ˆì§ˆ</div>
                </div>
              </div>
              <div class="privacy-checks">
                <div class="privacy-item pass">âœ“ k-anonymity: k=5</div>
                <div class="privacy-item">Îµ DP ì˜ˆì‚°: 1.00</div>
                <div class="privacy-item">ê²°ì¸¡ì¹˜: 5.8%</div>
              </div>
            </div>
          </div>

          <!-- VPC Architecture -->
          <div class="gate-card">
            <div class="gate-card-header">
              <span class="step-badge">4</span>
              ê°€ìƒ ë¶„ì„ í™˜ê²½ (VPC)
              <span style="margin-left:auto; font-size:10px; color:#22c55e; background:rgba(34,197,94,0.1); padding:3px 8px; border-radius:4px; border:1px solid rgba(34,197,94,0.2);">ì¤€ë¹„ ì™„ë£Œ</span>
            </div>
            <div class="gate-card-body" style="padding:16px;">
              <svg viewBox="0 0 680 320" style="width:100%; height:auto;">
                <!-- Background -->
                <rect x="0" y="0" width="680" height="320" rx="12" fill="#111827"/>

                <!-- VPC Boundary -->
                <rect x="140" y="20" width="400" height="280" rx="10" fill="none" stroke="#22c55e" stroke-width="2" stroke-dasharray="6,3" opacity="0.6"/>
                <rect x="140" y="20" width="400" height="280" rx="10" fill="rgba(34,197,94,0.03)"/>
                <text x="160" y="42" fill="#22c55e" font-size="11" font-weight="700" letter-spacing="0.5">ğŸ›¡ï¸ UniQdata VPC (ap-northeast-2)</text>

                <!-- Subnet: Data Layer -->
                <rect x="160" y="54" width="180" height="110" rx="8" fill="rgba(59,130,246,0.08)" stroke="rgba(59,130,246,0.3)" stroke-width="1"/>
                <text x="176" y="72" fill="#60a5fa" font-size="9" font-weight="600">Private Subnet â€” Data</text>

                <!-- Health DB -->
                <rect x="176" y="82" width="68" height="36" rx="6" fill="#1e293b" stroke="#334155" stroke-width="1"/>
                <text x="210" y="98" fill="#94a3b8" font-size="8" text-anchor="middle" font-weight="600">health_db</text>
                <text x="210" y="110" fill="#64748b" font-size="7" text-anchor="middle">í™˜ì ë°ì´í„°</text>

                <!-- Consent Store -->
                <rect x="258" y="82" width="68" height="36" rx="6" fill="#1e293b" stroke="#334155" stroke-width="1"/>
                <text x="292" y="98" fill="#94a3b8" font-size="8" text-anchor="middle" font-weight="600">consent_db</text>
                <text x="292" y="110" fill="#64748b" font-size="7" text-anchor="middle">ë™ì˜ ê´€ë¦¬</text>

                <!-- k-anon engine -->
                <rect x="176" y="126" width="150" height="28" rx="5" fill="rgba(34,197,94,0.1)" stroke="rgba(34,197,94,0.3)" stroke-width="1"/>
                <text x="251" y="144" fill="#22c55e" font-size="8" text-anchor="middle" font-weight="600">k-Anonymity + DP Engine</text>

                <!-- Subnet: Compute Layer -->
                <rect x="360" y="54" width="164" height="110" rx="8" fill="rgba(139,92,246,0.08)" stroke="rgba(139,92,246,0.3)" stroke-width="1"/>
                <text x="376" y="72" fill="#a78bfa" font-size="9" font-weight="600">Private Subnet â€” Compute</text>

                <!-- Clean Room Container -->
                <rect x="376" y="82" width="132" height="72" rx="6" fill="#1e293b" stroke="#8b5cf6" stroke-width="1.5"/>
                <text x="442" y="98" fill="#c4b5fd" font-size="9" text-anchor="middle" font-weight="700">ğŸ”’ í´ë¦°ë£¸ ì»¨í…Œì´ë„ˆ</text>
                <text x="442" y="112" fill="#64748b" font-size="7" text-anchor="middle">ê²©ë¦¬ëœ ë¶„ì„ í™˜ê²½</text>

                <!-- Tools inside container -->
                <rect x="384" y="120" width="50" height="18" rx="3" fill="rgba(59,130,246,0.15)" stroke="rgba(59,130,246,0.3)" stroke-width="0.5"/>
                <text x="409" y="132" fill="#93c5fd" font-size="6" text-anchor="middle">ì¸ê³¼ë°œê²¬</text>
                <rect x="440" y="120" width="32" height="18" rx="3" fill="rgba(59,130,246,0.15)" stroke="rgba(59,130,246,0.3)" stroke-width="0.5"/>
                <text x="456" y="132" fill="#93c5fd" font-size="6" text-anchor="middle">SHAP</text>
                <rect x="478" y="120" width="26" height="18" rx="3" fill="rgba(59,130,246,0.15)" stroke="rgba(59,130,246,0.3)" stroke-width="0.5"/>
                <text x="491" y="132" fill="#93c5fd" font-size="6" text-anchor="middle">+3</text>

                <!-- Arrow: data â†’ compute -->
                <line x1="340" y1="110" x2="374" y2="110" stroke="#4ade80" stroke-width="1.5" marker-end="url(#arrowG)"/>
                <text x="357" y="104" fill="#4ade80" font-size="6" text-anchor="middle">ë¹„ì‹ë³„</text>

                <!-- Audit & Logging -->
                <rect x="160" y="180" width="360" height="50" rx="8" fill="rgba(245,158,11,0.06)" stroke="rgba(245,158,11,0.25)" stroke-width="1"/>
                <text x="176" y="198" fill="#fbbf24" font-size="9" font-weight="600">ê°ì‚¬ ë¡œê·¸ (Audit Trail)</text>
                <text x="176" y="212" fill="#64748b" font-size="7">ëª¨ë“  ì¿¼ë¦¬ Â· ê²°ê³¼ ì¡°íšŒ Â· ë‚´ë³´ë‚´ê¸° ìš”ì²­ ê¸°ë¡</text>
                <text x="176" y="222" fill="#64748b" font-size="7">CloudTrail + ì»¤ìŠ¤í…€ ì´ë²¤íŠ¸ ë¡œê·¸ â†’ ë³€ê²½ ë¶ˆê°€ ì €ì¥</text>

                <!-- Export Gateway -->
                <rect x="160" y="244" width="360" height="44" rx="8" fill="rgba(139,92,246,0.06)" stroke="rgba(139,92,246,0.25)" stroke-width="1"/>
                <text x="176" y="262" fill="#a78bfa" font-size="9" font-weight="600">ë‚´ë³´ë‚´ê¸° ê²Œì´íŠ¸ì›¨ì´</text>
                <text x="176" y="276" fill="#64748b" font-size="7">ì§‘ê³„ ê²°ê³¼ë§Œ í†µê³¼ Â· ê°œë³„ ë ˆì½”ë“œ ì°¨ë‹¨ Â· PI ìŠ¹ì¸ í•„ìˆ˜</text>

                <!-- Researcher (outside VPC, left) -->
                <rect x="12" y="80" width="108" height="64" rx="8" fill="#1e293b" stroke="#334155" stroke-width="1"/>
                <text x="66" y="100" fill="#e5e5e5" font-size="10" text-anchor="middle" font-weight="600">ğŸ‘©â€ğŸ”¬ ì—°êµ¬ì</text>
                <text x="66" y="114" fill="#64748b" font-size="7" text-anchor="middle">ë¸Œë¼ìš°ì € (HTTPS)</text>
                <text x="66" y="126" fill="#64748b" font-size="7" text-anchor="middle">ê¹€ì—°êµ¬ Â· ì„œìš¸ëŒ€ë³‘ì›</text>
                <!-- Arrow: researcher â†’ VPC -->
                <line x1="120" y1="112" x2="156" y2="112" stroke="#60a5fa" stroke-width="1.5" marker-end="url(#arrowB)"/>
                <text x="138" y="106" fill="#60a5fa" font-size="6" text-anchor="middle">TLS</text>

                <!-- Export output (outside VPC, right) -->
                <rect x="560" y="246" width="108" height="40" rx="8" fill="#1e293b" stroke="#334155" stroke-width="1"/>
                <text x="614" y="264" fill="#e5e5e5" font-size="9" text-anchor="middle" font-weight="600">ğŸ“¥ ìŠ¹ì¸ëœ ê²°ê³¼</text>
                <text x="614" y="276" fill="#64748b" font-size="7" text-anchor="middle">ì§‘ê³„ í†µê³„ Â· ì°¨íŠ¸ ì´ë¯¸ì§€</text>
                <!-- Arrow: gateway â†’ export -->
                <line x1="520" y1="266" x2="558" y2="266" stroke="#a78bfa" stroke-width="1.5" marker-end="url(#arrowP)"/>

                <!-- Blocked indicator -->
                <rect x="560" y="86" width="108" height="40" rx="8" fill="rgba(239,68,68,0.08)" stroke="rgba(239,68,68,0.3)" stroke-width="1"/>
                <text x="614" y="104" fill="#ef4444" font-size="9" text-anchor="middle" font-weight="600">ğŸš« ì°¨ë‹¨ë¨</text>
                <text x="614" y="116" fill="#ef4444" font-size="7" text-anchor="middle" opacity="0.7">ì›ë³¸ ë°ì´í„° ë°˜ì¶œ ë¶ˆê°€</text>
                <line x1="540" y1="106" x2="558" y2="106" stroke="#ef4444" stroke-width="1" stroke-dasharray="3,2"/>

                <!-- Arrow markers -->
                <defs>
                  <marker id="arrowG" markerWidth="6" markerHeight="4" refX="5" refY="2" orient="auto"><path d="M0,0 L6,2 L0,4" fill="#4ade80"/></marker>
                  <marker id="arrowB" markerWidth="6" markerHeight="4" refX="5" refY="2" orient="auto"><path d="M0,0 L6,2 L0,4" fill="#60a5fa"/></marker>
                  <marker id="arrowP" markerWidth="6" markerHeight="4" refX="5" refY="2" orient="auto"><path d="M0,0 L6,2 L0,4" fill="#a78bfa"/></marker>
                </defs>
              </svg>

              <!-- VPC Legend -->
              <div style="display:flex; gap:16px; margin-top:10px; font-size:10px; color:#64748b; flex-wrap:wrap;">
                <span style="display:flex; align-items:center; gap:4px;"><span style="width:10px; height:10px; border:1.5px dashed #22c55e; border-radius:2px;"></span> VPC ê²½ê³„</span>
                <span style="display:flex; align-items:center; gap:4px;"><span style="width:10px; height:10px; background:rgba(59,130,246,0.15); border:1px solid rgba(59,130,246,0.3); border-radius:2px;"></span> ë°ì´í„° ì„œë¸Œë„·</span>
                <span style="display:flex; align-items:center; gap:4px;"><span style="width:10px; height:10px; background:rgba(139,92,246,0.15); border:1px solid rgba(139,92,246,0.3); border-radius:2px;"></span> ì»´í“¨íŠ¸ ì„œë¸Œë„·</span>
                <span style="display:flex; align-items:center; gap:4px;"><span style="width:10px; height:3px; background:#4ade80; border-radius:1px;"></span> ë¹„ì‹ë³„ ë°ì´í„° íë¦„</span>
                <span style="display:flex; align-items:center; gap:4px;"><span style="width:10px; height:3px; background:#ef4444; border-radius:1px; opacity:0.6;"></span> ì°¨ë‹¨</span>
              </div>
            </div>
          </div>

          <!-- Enter -->
          <div class="gate-actions">
            <button class="gate-enter-btn" onclick="startSession()">ğŸ” í´ë¦°ë£¸ ì…ì¥</button>
            <div class="gate-footnote">ì„¸ì…˜ì€ ìµœëŒ€ 4ì‹œê°„ ìœ ì§€ë©ë‹ˆë‹¤. ì´í›„ ìë™ ì¢…ë£Œë©ë‹ˆë‹¤.</div>
          </div>
        </div>
      </div>

      <!-- ========== ACTIVE SESSION ========== -->
      <div id="active-session" style="display:none; flex:1; flex-direction:column; overflow:hidden;">

        <!-- Session Status Bar -->
        <div class="session-bar">
          <div class="session-indicator">
            <span class="session-live-dot"></span>
            <span class="session-label">ì„¸ì…˜ í™œì„±</span>
          </div>
          <div class="session-meta">
            <span>ID: <span class="val">CR-2026-0214-001</span></span>
            <span>ê²½ê³¼: <span class="val" id="session-elapsed">00:00:00</span></span>
            <span>ë§Œë£Œ: <span class="val">3:59:59 ë‚¨ìŒ</span></span>
          </div>
          <div class="session-chips">
            <span class="session-chip">ë‹¹ë‡¨ë³‘ 2í˜•</span>
            <span class="session-chip">87ëª…</span>
            <span class="session-chip">12ë³€ìˆ˜</span>
            <span class="session-chip">7ê°œì›”</span>
          </div>
          <div class="session-right">
            <div class="security-badge">ğŸ›¡ï¸ ë³´ì•ˆ: ë†’ìŒ</div>
            <button class="session-end-btn" onclick="endSession()">â¹ ì¢…ë£Œ</button>
          </div>
        </div>

        <!-- 3-panel content -->
        <div class="active-content">

          <!-- LEFT: Config Panel -->
          <div class="config-panel">
            <div class="config-section">
              <div class="title">ğŸ“‹ ë°ì´í„° ë²”ìœ„</div>
              <div class="scope-summary">
                <div class="scope-row"><span class="label">ì½”í˜¸íŠ¸</span><span class="value">ë‹¹ë‡¨ë³‘ 2í˜•</span></div>
                <div class="scope-row"><span class="label">ì°¸ì—¬ì</span><span class="value">87ëª…</span></div>
                <div class="scope-row"><span class="label">ë³€ìˆ˜</span><span class="value">12ê°œ</span></div>
                <div class="scope-row"><span class="label">ê¸°ê°„</span><span class="value">2025-06 ~ 2026-01</span></div>
                <div class="scope-row"><span class="label">ë³´í˜¸ ìˆ˜ì¤€</span><span class="value">ë¹„ì‹ë³„ ì§‘ê³„</span></div>
              </div>
              <div class="scope-locked">ğŸ”’ ì„¸ì…˜ ì¤‘ ë°ì´í„° ë²”ìœ„ ë³€ê²½ ë¶ˆê°€</div>
            </div>

            <div class="config-section">
              <div class="title">ğŸ›¡ï¸ ë³´ì•ˆ ìƒíƒœ</div>
              <div class="security-meter">
                <div class="meter-header"><span class="m-label">k-anonymity</span><span class="m-value pass">k=5 âœ“</span></div>
                <div class="meter-bar"><div class="meter-fill pass" style="width:100%"></div></div>
              </div>
              <div class="security-meter">
                <div class="meter-header"><span class="m-label">DP ì˜ˆì‚° (Îµ)</span><span class="m-value">0.15 / 1.00</span></div>
                <div class="meter-bar"><div class="meter-fill dp" style="width:15%"></div></div>
                <div class="meter-footnote">ì¿¼ë¦¬ë‹¹ ~0.05Îµ ì†Œëª¨</div>
              </div>
              <div class="security-meter">
                <div class="meter-header"><span class="m-label">ì¿¼ë¦¬ ì‹¤í–‰</span><span class="m-value">3 / 50</span></div>
                <div class="meter-bar"><div class="meter-fill query" style="width:6%"></div></div>
              </div>
            </div>

            <div class="config-section">
              <div class="title">ğŸ“„ IRB ì •ë³´</div>
              <div class="irb-card">
                <div class="irb-row"><span class="label">ìŠ¹ì¸ë²ˆí˜¸</span><span class="value">IRB-2025-0847</span></div>
                <div class="irb-row"><span class="label">PI</span><span class="value">ê¹€ì—°êµ¬ êµìˆ˜</span></div>
                <div class="irb-row"><span class="label">ë§Œë£Œì¼</span><span class="value">2026-08-15</span></div>
                <div class="irb-row"><span class="label">ìƒíƒœ</span><span class="value status-ok">ìŠ¹ì¸ë¨</span></div>
              </div>
            </div>

            <div class="config-section" id="tool-config">
              <div class="title">âš™ï¸ ë¶„ì„ ì„¤ì •</div>
              <div class="algo-option selected">
                <div class="name">PC Algorithm <span class="badge">ì¶”ì²œ</span></div>
                <div class="desc">ì¡°ê±´ë¶€ ë…ë¦½ì„± í…ŒìŠ¤íŠ¸ ê¸°ë°˜. ë¹ ë¥´ê³  í•´ì„ ìš©ì´.</div>
              </div>
              <div class="algo-option">
                <div class="name">FCI</div>
                <div class="desc">ìˆ¨ê²¨ì§„ êµë€ë³€ìˆ˜ í—ˆìš©. ë” ë³´ìˆ˜ì .</div>
              </div>
              <div class="algo-option">
                <div class="name">NOTEARS</div>
                <div class="desc">ë”¥ëŸ¬ë‹ ê¸°ë°˜. ê³ ì°¨ì›ì— ì í•©.</div>
              </div>
              <div class="algo-option">
                <div class="name">GES</div>
                <div class="desc">ìŠ¤ì½”ì–´ ê¸°ë°˜ íƒìƒ‰.</div>
              </div>

              <div class="threshold-slider" style="margin-top: 14px;">
                <div class="ts-header">
                  <span class="ts-label">ìµœì†Œ ì¸ê³¼ ê°•ë„</span>
                  <span class="ts-value" id="threshold-value">0.30</span>
                </div>
                <input type="range" id="threshold-range" min="0" max="1" step="0.05" value="0.3">
              </div>
              <div class="threshold-slider">
                <div class="ts-header">
                  <span class="ts-label">ì‹ ë¢°ë„ ì„ê³„ê°’</span>
                  <span class="ts-value">0.95</span>
                </div>
                <input type="range" min="0.5" max="1" step="0.05" value="0.95">
              </div>
            </div>
          </div>

          <!-- CENTER: Analysis Area -->
          <div class="analysis-area">
            <div class="cr-tabs">
              <span class="cr-tabs-label">ë¶„ì„ ë„êµ¬</span>
              <button class="cr-tab active" onclick="switchTool('discovery')"><span>ğŸ”®</span> ì¸ê³¼ë°œê²¬</button>
              <button class="cr-tab" onclick="switchTool('shap')"><span>ğŸ“Š</span> SHAP</button>
              <button class="cr-tab" onclick="switchTool('cate')"><span>ğŸ‘¤</span> CATE</button>
              <button class="cr-tab" onclick="switchTool('whatif')"><span>ğŸ”„</span> What-If</button>
              <button class="cr-tab" onclick="switchTool('rootcause')"><span>ğŸ”</span> ì´ìƒì¶”ì </button>
              <div style="width:1px; height:20px; background:#333; margin:0 4px;"></div>
              <button class="cr-tab" onclick="switchTool('terminal')" style="border-color:rgba(34,197,94,0.3);"><span>ğŸ’»</span> í„°ë¯¸ë„</button>
              <span class="cr-tabs-note">ğŸ”’ í´ë¦°ë£¸ ë‚´ ë¶„ì„ë§Œ ê°€ëŠ¥</span>
            </div>

            <!-- Discovery Tool -->
            <div class="tool-content active" id="tool-discovery">
              <div class="target-bar">
                <span style="font-size: 16px;">ğŸ¯</span>
                <span style="font-size: 12px; color: #94a3b8;">íƒ€ê²Ÿ:</span>
                <select id="target-variable">
                  <optgroup label="ğŸ©¸ ìƒì²´ì§€í‘œ">
                    <option value="glucose" selected>í˜ˆë‹¹ ë³€ë™ì„± (Blood Glucose Variability)</option>
                    <option>ê³µë³µ í˜ˆë‹¹ (Fasting Glucose)</option>
                    <option>ë‹¹í™”í˜ˆìƒ‰ì†Œ (HbA1c)</option>
                    <option>í˜ˆì•• (Blood Pressure)</option>
                  </optgroup>
                  <optgroup label="ğŸ˜´ ìˆ˜ë©´">
                    <option>ìˆ˜ë©´ ì§ˆ (Sleep Quality)</option>
                  </optgroup>
                  <optgroup label="ğŸ’Š ë³µì•½">
                    <option>ë³µì•½ ìˆœì‘ë„ (Medication Adherence)</option>
                  </optgroup>
                </select>
                <div class="target-status">âœ“ ë§¤íŠ¸ë¦­ìŠ¤ ë¡œë“œë¨ | 42ê°œ ì§ì ‘ ì—°ê²°</div>
                <div style="margin-left:auto;">
                  <button style="padding:6px 12px; background:#252525; border:1px solid #333; border-radius:6px; color:#94a3b8; font-size:11px; cursor:pointer;">ğŸ” ê²½ë¡œ íƒìƒ‰</button>
                </div>
              </div>

              <div class="graph-wrap">
                <div class="graph-canvas">
                  <div class="graph-toolbar">
                    <div class="view-toggle">
                      <button class="active" data-layer="short">ë‹¨ê¸°</button>
                      <button data-layer="long">ì¥ê¸°</button>
                      <button data-layer="cohort">ì½”í˜¸íŠ¸</button>
                    </div>
                    <div class="strength-inline">
                      <span>ì¸ê³¼ê°•ë„ â‰¥</span>
                      <span id="strength-value">0.30</span>
                      <input type="range" id="strength-range" min="0" max="1" step="0.05" value="0.3">
                    </div>
                    <div class="graph-stats">
                      <div>ë…¸ë“œ <span class="val">24</span></div>
                      <div>ì—£ì§€ <span class="val">38</span></div>
                      <div>ì‹ ë¢°ë„ <span class="val">94.2%</span></div>
                    </div>
                  </div>

                  <div class="graph-3d" id="graph-3d">
                    <div class="graph-container" id="graph-container"></div>
                  </div>

                  <div class="selection-info">
                    <div class="si-title">í™œì„± ë…¸ë“œ (<span id="active-count">0</span>ê°œ)</div>
                    <div class="nodes" id="active-nodes"></div>
                    <div class="si-stats">
                      <span>ê²½ë¡œ: <span class="val" id="active-paths">0</span>ê°œ</span>
                      <span>ì í•©ë„: <span class="val" id="model-fit">RÂ² = 0.00</span></span>
                    </div>
                  </div>

                  <div class="drag-hint">ë§ˆìš°ìŠ¤ ë“œë˜ê·¸ë¡œ íšŒì „ | ë…¸ë“œ í´ë¦­ìœ¼ë¡œ on/off</div>

                  <div class="graph-legend">
                    <div class="lg-title">ë²”ë¡€</div>
                    <div class="legend-item"><span class="legend-dot outcome"></span> ê²°ê³¼ ë³€ìˆ˜</div>
                    <div class="legend-item"><span class="legend-dot treatment"></span> ì¹˜ë£Œ/ì›ì¸ ë³€ìˆ˜</div>
                    <div class="legend-item"><span class="legend-dot mediator"></span> ë§¤ê°œ ë³€ìˆ˜</div>
                    <div class="legend-item"><span class="legend-dot confounder"></span> êµë€ ë³€ìˆ˜</div>
                  </div>
                </div>
              </div>
            </div>

            <!-- SHAP placeholder -->
            <div class="tool-content" id="tool-shap">
              <div class="tool-placeholder">
                <div class="tp-icon">ğŸ“Š</div>
                <div class="tp-title">SHAP ê¸°ì—¬ë„ ë¶„ì„</div>
                <div class="tp-desc">ê° ë³€ìˆ˜ê°€ ì˜ˆì¸¡ì— ë¯¸ì¹˜ëŠ” ì˜í–¥ë„ë¥¼ ì‹œê°í™”í•©ë‹ˆë‹¤. Waterfall / Beeswarm / Bar ì°¨íŠ¸ ì œê³µ.</div>
              </div>
            </div>

            <!-- CATE placeholder -->
            <div class="tool-content" id="tool-cate">
              <div class="tool-placeholder">
                <div class="tp-icon">ğŸ‘¤</div>
                <div class="tp-title">CATE ê°œì¸í™” íš¨ê³¼</div>
                <div class="tp-desc">ê°œì¸/ì„¸ê·¸ë¨¼íŠ¸ë³„ ì²˜ì¹˜ íš¨ê³¼(Conditional Average Treatment Effect)ë¥¼ ë¶„ì„í•©ë‹ˆë‹¤.</div>
              </div>
            </div>

            <!-- What-If placeholder -->
            <div class="tool-content" id="tool-whatif">
              <div class="tool-placeholder">
                <div class="tp-icon">ğŸ”„</div>
                <div class="tp-title">What-If ì‹œë®¬ë ˆì´ì…˜</div>
                <div class="tp-desc">ë°˜ì‚¬ì‹¤(Counterfactual) ì‹œë‚˜ë¦¬ì˜¤ë¥¼ ì‹œë®¬ë ˆì´ì…˜í•©ë‹ˆë‹¤. "ë§Œì•½ ë³µì•½ë¥ ì´ 90%ì˜€ë‹¤ë©´?"</div>
              </div>
            </div>

            <!-- Root Cause placeholder -->
            <div class="tool-content" id="tool-rootcause">
              <div class="tool-placeholder">
                <div class="tp-icon">ğŸ”</div>
                <div class="tp-title">ì´ìƒ ì›ì¸ ì¶”ì </div>
                <div class="tp-desc">ë¹„ì •ìƒ íŒ¨í„´ì˜ Root Causeë¥¼ ì¶”ì í•©ë‹ˆë‹¤. ì–´ë–¤ ë³€ìˆ˜ê°€ ì´ìƒì˜ ì›ì¸ì¸ì§€ ê²½ë¡œ ë¶„ì„.</div>
              </div>
            </div>

            <!-- Terminal -->
            <div class="tool-content" id="tool-terminal">
              <div class="terminal-wrap">
                <div class="terminal-toolbar">
                  <div class="lang-selector">
                    <button class="lang-btn active">Python</button>
                    <button class="lang-btn">R</button>
                    <button class="lang-btn">SQL</button>
                  </div>
                  <div class="terminal-shortcuts">
                    <span class="terminal-shortcut">Shift+Enter ì‹¤í–‰</span>
                    <span class="terminal-shortcut">Tab ìë™ì™„ì„±</span>
                  </div>
                  <div class="terminal-env">
                    <span class="env-item"><span class="env-dot"></span> ì»¤ë„ ì—°ê²°ë¨</span>
                    <span class="env-item">Python 3.11</span>
                    <span class="env-item">RAM 4.2 / 16 GB</span>
                    <span class="env-item">GPU â€”</span>
                  </div>
                </div>

                <div class="terminal-cells">
                  <!-- Cell 1: Imports -->
                  <div class="cell">
                    <div class="cell-header">
                      <span class="cell-num">In [1]:</span>
                      <span class="cell-status">âœ“ ì™„ë£Œ</span>
                      <span class="cell-time">0.42s</span>
                      <button class="cell-run-btn">â–¶ Run</button>
                    </div>
                    <div class="cell-code"><span class="kw">import</span> pandas <span class="kw">as</span> pd
<span class="kw">import</span> numpy <span class="kw">as</span> np
<span class="kw">from</span> causallearn.search.ConstraintBased.PC <span class="kw">import</span> <span class="fn">pc</span>
<span class="kw">from</span> uniqdata.cleanroom <span class="kw">import</span> <span class="fn">SecureDataFrame</span>

<span class="cm"># í´ë¦°ë£¸ ë°ì´í„° ë¡œë“œ (ë¹„ì‹ë³„ ì²˜ë¦¬ëœ ë·°)</span>
df = SecureDataFrame.<span class="fn">load</span>(<span class="str">"cohort://diabetes-t2"</span>, k_anon=<span class="num">5</span>)
<span class="fn">print</span>(<span class="str">f"ë¡œë“œ ì™„ë£Œ: </span>{df.shape[<span class="num">0</span>]}<span class="str"> rows Ã— </span>{df.shape[<span class="num">1</span>]}<span class="str"> cols"</span>)</div>
                    <div class="cell-output">
                      <div class="out-label">Out [1]:</div>
                      ë¡œë“œ ì™„ë£Œ: 87 rows Ã— 12 cols
                      <div class="dp-warn">âš ï¸ DP ì˜ˆì‚° ì†Œëª¨: Îµ=0.02 (ì”ì—¬: 0.83)</div>
                    </div>
                  </div>

                  <!-- Cell 2: EDA -->
                  <div class="cell">
                    <div class="cell-header">
                      <span class="cell-num">In [2]:</span>
                      <span class="cell-status">âœ“ ì™„ë£Œ</span>
                      <span class="cell-time">1.18s</span>
                      <button class="cell-run-btn">â–¶ Run</button>
                    </div>
                    <div class="cell-code"><span class="cm"># ì§‘ê³„ í†µê³„ í™•ì¸ (ê°œë³„ ë ˆì½”ë“œ ì ‘ê·¼ ë¶ˆê°€)</span>
summary = df.<span class="fn">describe_secure</span>()   <span class="cm"># k-check ìë™ ì ìš©</span>
summary[[<span class="str">"HbA1c"</span>, <span class="str">"ì²´ì¤‘"</span>, <span class="str">"SBP"</span>, <span class="str">"ë³µì•½ìˆœì‘ë„"</span>]]</div>
                    <div class="cell-output">
                      <div class="out-label">Out [2]:</div>
                      <table>
                        <tr><th></th><th>HbA1c</th><th>ì²´ì¤‘</th><th>SBP</th><th>ë³µì•½ìˆœì‘ë„</th></tr>
                        <tr><td style="color:#64748b;">mean</td><td>7.42</td><td>78.3</td><td>132.1</td><td>0.84</td></tr>
                        <tr><td style="color:#64748b;">std</td><td>1.08</td><td>12.7</td><td>14.8</td><td>0.12</td></tr>
                        <tr><td style="color:#64748b;">min</td><td>5.80</td><td>54.2</td><td>105.0</td><td>0.45</td></tr>
                        <tr><td style="color:#64748b;">50%</td><td>7.30</td><td>76.8</td><td>130.0</td><td>0.87</td></tr>
                        <tr><td style="color:#64748b;">max</td><td>11.20</td><td>118.5</td><td>178.0</td><td>1.00</td></tr>
                      </table>
                    </div>
                  </div>

                  <!-- Cell 3: Causal Discovery -->
                  <div class="cell running">
                    <div class="cell-header">
                      <span class="cell-num">In [3]:</span>
                      <span class="cell-status">âŸ³ ì‹¤í–‰ ì¤‘...</span>
                      <span class="cell-time">2.7s</span>
                      <button class="cell-run-btn" style="background:rgba(239,68,68,0.15); color:#ef4444;">â–  Stop</button>
                    </div>
                    <div class="cell-code"><span class="cm"># PC ì•Œê³ ë¦¬ì¦˜ìœ¼ë¡œ ì¸ê³¼ êµ¬ì¡° íƒìƒ‰</span>
targets = [<span class="str">"HbA1c"</span>, <span class="str">"ì²´ì¤‘"</span>, <span class="str">"SBP"</span>, <span class="str">"ë³µì•½ìˆœì‘ë„"</span>,
           <span class="str">"ìš´ë™ëŸ‰"</span>, <span class="str">"ì‹ì´íŒ¨í„´"</span>, <span class="str">"ìˆ˜ë©´ì‹œê°„"</span>, <span class="str">"ìŠ¤íŠ¸ë ˆìŠ¤"</span>]

X = df[targets].<span class="fn">to_secure_matrix</span>()  <span class="cm"># ë¹„ì‹ë³„ í–‰ë ¬ ë³€í™˜</span>

cg = <span class="fn">pc</span>(X, alpha=<span class="num">0.05</span>, indep_test=<span class="str">"fisherz"</span>)

<span class="cm"># ê²°ê³¼ ì‹œê°í™”</span>
<span class="kw">from</span> uniqdata.viz <span class="kw">import</span> <span class="fn">causal_graph</span>
<span class="fn">causal_graph</span>(cg, labels=targets, highlight=<span class="str">"HbA1c"</span>)</div>
                    <div class="cell-output">
                      <div class="out-label">Out [3]:</div>
                      <span style="color:#3b82f6;">ë°œê²¬ëœ ì¸ê³¼ ì—£ì§€: 14ê°œ</span> | ì‹ ë¢°ë„: 94.2% | ì‹¤í–‰ì‹œê°„: 2.7s
                      <div class="out-chart">
                        <div class="chart-bar" style="height:85%; opacity:0.9;" title="ë³µì•½â†’HbA1c: -0.42"></div>
                        <div class="chart-bar" style="height:65%;" title="ì¸ìŠë¦°ë¯¼ê°ì„±â†’HbA1c: -0.35"></div>
                        <div class="chart-bar" style="height:52%;" title="ì‹ì´â†’HbA1c: 0.28"></div>
                        <div class="chart-bar" style="height:38%;" title="ìŠ¤íŠ¸ë ˆìŠ¤â†’HbA1c: 0.19"></div>
                        <div class="chart-bar" style="height:28%;" title="ì—°ë ¹â†’HbA1c: 0.15"></div>
                        <div class="chart-bar" style="height:22%; opacity:0.5;" title="ìˆ˜ë©´â†’HbA1c: -0.12"></div>
                        <div class="chart-bar" style="height:18%; opacity:0.4;" title="ìš´ë™â†’HbA1c: -0.08"></div>
                        <div class="chart-bar" style="height:72%;" title="ì²´ì¤‘â†’HbA1c: 0.38"></div>
                      </div>
                      <div style="display:flex; justify-content:space-between; font-size:9px; color:#555; margin-top:4px; padding:0 2px;">
                        <span>ë³µì•½</span><span>ì¸ìŠë¦°</span><span>ì‹ì´</span><span>ìŠ¤íŠ¸ë ˆìŠ¤</span><span>ì—°ë ¹</span><span>ìˆ˜ë©´</span><span>ìš´ë™</span><span>ì²´ì¤‘</span>
                      </div>
                      <div class="dp-warn">âš ï¸ DP ì˜ˆì‚° ì†Œëª¨: Îµ=0.08 (ì”ì—¬: 0.75) Â· ì¿¼ë¦¬ 3/50</div>
                    </div>
                  </div>

                  <!-- Cell 4: empty -->
                  <div class="cell">
                    <div class="cell-header">
                      <span class="cell-num">In [4]:</span>
                      <span class="cell-status" style="color:#555;">ëŒ€ê¸°</span>
                      <span class="cell-time"></span>
                      <button class="cell-run-btn">â–¶ Run</button>
                    </div>
                    <div class="cell-code" style="min-height:40px; color:#555;">
<span class="cm"># ë‹¤ìŒ ë¶„ì„ì„ ì…ë ¥í•˜ì„¸ìš”...</span></div>
                  </div>
                </div>

                <div class="terminal-input-area">
                  <span class="prompt-sign">â–¶</span>
                  <input class="terminal-input" type="text" placeholder="Python ì½”ë“œ ì…ë ¥... (Shift+Enterë¡œ ì‹¤í–‰)" />
                  <button class="terminal-run-btn">ì‹¤í–‰</button>
                </div>
              </div>
            </div>
          </div>

          <!-- RIGHT: Audit Panel -->
          <div class="audit-panel">
            <div class="audit-tabs">
              <button class="audit-tab active" onclick="showAuditView('log')">ğŸ“‹ í™œë™ ë¡œê·¸</button>
              <button class="audit-tab" onclick="showAuditView('export')">ğŸ“¤ ë‚´ë³´ë‚´ê¸° <span class="badge">0</span></button>
            </div>

            <!-- Activity Log -->
            <div class="audit-view active" id="view-log">
              <div class="audit-log">
                <div class="log-entry">
                  <div class="log-time">14:32</div>
                  <div class="log-body">
                    <div class="log-action">ì„¸ì…˜ ì‹œì‘</div>
                    <div class="log-detail">ë‹¹ë‡¨ë³‘ 2í˜•, 87ëª…, 12ë³€ìˆ˜</div>
                  </div>
                  <div class="log-icon">ğŸ”</div>
                </div>
                <div class="log-entry">
                  <div class="log-time">14:33</div>
                  <div class="log-body">
                    <div class="log-action">ì¸ê³¼ë°œê²¬ ì‹¤í–‰</div>
                    <div class="log-detail">PC Algorithm, ì„ê³„ê°’ 0.30</div>
                  </div>
                  <div class="log-icon">ğŸ”®</div>
                </div>
                <div class="log-entry">
                  <div class="log-time">14:33</div>
                  <div class="log-body">
                    <div class="log-action">ê²°ê³¼ ì—´ëŒ</div>
                    <div class="log-detail">ê·¸ë˜í”„ ë…¸ë“œ 24ê°œ, ì—£ì§€ 38ê°œ</div>
                  </div>
                  <div class="log-icon">ğŸ‘ï¸</div>
                </div>
                <div class="log-entry">
                  <div class="log-time">14:35</div>
                  <div class="log-body">
                    <div class="log-action">í•„í„° ë³€ê²½</div>
                    <div class="log-detail">ì¸ê³¼ê°•ë„ â‰¥ 0.30 â†’ 0.50</div>
                  </div>
                  <div class="log-icon">ğŸ”§</div>
                </div>
                <div class="log-entry">
                  <div class="log-time">14:36</div>
                  <div class="log-body">
                    <div class="log-action">SHAP ë¶„ì„ ì‹¤í–‰</div>
                    <div class="log-detail">íƒ€ê²Ÿ: í˜ˆë‹¹ ë³€ë™ì„±, 12ë³€ìˆ˜</div>
                  </div>
                  <div class="log-icon">ğŸ“Š</div>
                </div>
              </div>
              <div class="log-footer">
                <span>5ê°œ í™œë™ ê¸°ë¡ë¨</span>
                <span>Îµ ì‚¬ìš©: 0.15</span>
              </div>
            </div>

            <!-- Export View -->
            <div class="audit-view" id="view-export">
              <div class="export-content">
                <div class="export-rules-header">ë‚´ë³´ë‚´ê¸° ê·œì¹™</div>
                <div class="export-rule"><span class="ri ok">âœ“</span> ì§‘ê³„ í†µê³„ (í‰ê· , ì¤‘ìœ„ê°’, ë¶„í¬)</div>
                <div class="export-rule"><span class="ri ok">âœ“</span> ì‹œê°í™” ì´ë¯¸ì§€ (ê·¸ë˜í”„, ì°¨íŠ¸)</div>
                <div class="export-rule blocked"><span class="ri no">âœ•</span> ê°œë³„ ë ˆì½”ë“œ ë°ì´í„°</div>
                <div class="export-rule blocked"><span class="ri no">âœ•</span> n &lt; 5 ê·¸ë£¹ì˜ í†µê³„</div>

                <div class="export-divider"></div>

                <div class="export-queue-header">ë‚´ë³´ë‚´ê¸° ëŒ€ê¸°ì—´</div>
                <div class="export-empty">ì•„ì§ ë‚´ë³´ë‚´ê¸° ìš”ì²­ì´ ì—†ìŠµë‹ˆë‹¤.<br>ë¶„ì„ ê²°ê³¼ì—ì„œ "ë‚´ë³´ë‚´ê¸° ìš”ì²­" ë²„íŠ¼ì„ ì‚¬ìš©í•˜ì„¸ìš”.</div>

                <button class="export-request-btn">ğŸ“¤ í˜„ì¬ ê²°ê³¼ ë‚´ë³´ë‚´ê¸° ìš”ì²­</button>
                <div class="export-note">ë‚´ë³´ë‚´ê¸°ëŠ” PI(ê¹€ì—°êµ¬ êµìˆ˜) ìŠ¹ì¸ í›„ ë‹¤ìš´ë¡œë“œ ê°€ëŠ¥í•©ë‹ˆë‹¤.</div>
              </div>
            </div>
          </div>
        </div>

        <!-- Bottom Bar -->
        <div class="bottom-bar">
          <div class="bar-item"><span class="bar-dot green"></span> k-check: <span class="bv">pass (k=5)</span></div>
          <div class="bar-item"><span class="bar-dot blue"></span> DP ì˜ˆì‚°: <span class="bv">Îµ=0.15 / 0.85 ë‚¨ìŒ</span></div>
          <div class="bar-item"><span class="bar-dot amber"></span> ì¿¼ë¦¬: <span class="bv">3 / 50</span></div>
          <div class="bar-item"><span class="bar-dot purple"></span> ë‚´ë³´ë‚´ê¸°: <span class="bv">0ê±´ ëŒ€ê¸°</span></div>
          <div style="margin-left:auto; color:#555;">ì„¸ì…˜ CR-2026-0214-001</div>
        </div>
      </div>

      <div class="nav-links">
        <a href="../index.html">â† ì™€ì´ì–´í”„ë ˆì„ ëª©ë¡</a>
        <a href="data-table.html">â† í…Œì´ë¸”</a>
        <a href="data-overview.html">ê°œìš” â†’</a>
      </div>
    </div>
  </div>

<script>
  // ===== Session Gate / Active Session Toggle =====
  function startSession() {
    var checks = document.querySelectorAll('.sec-check');
    var allChecked = true;
    checks.forEach(function(c) { if (!c.checked) allChecked = false; });
    if (!allChecked) { alert('ëª¨ë“  ë³´ì•ˆ ë™ì˜ í•­ëª©ì„ í™•ì¸í•´ì£¼ì„¸ìš”.'); return; }

    document.getElementById('session-gate').style.display = 'none';
    document.getElementById('active-session').style.display = 'flex';
    document.getElementById('btn-start').style.display = 'none';
    document.getElementById('btn-end').style.display = 'inline-flex';
    startTimer();
    initGraph();
  }

  function endSession() {
    if (!confirm('ì„¸ì…˜ì„ ì¢…ë£Œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?\në¡œì»¬ ìºì‹œê°€ ì‚­ì œë©ë‹ˆë‹¤.')) return;
    document.getElementById('active-session').style.display = 'none';
    document.getElementById('session-gate').style.display = 'flex';
    document.getElementById('btn-end').style.display = 'none';
    document.getElementById('btn-start').style.display = 'inline-flex';
    stopTimer();
  }

  // ===== Session Timer =====
  var sessionSec = 0, timerInt;
  function startTimer() {
    timerInt = setInterval(function() {
      sessionSec++;
      var h = String(Math.floor(sessionSec/3600)).padStart(2,'0');
      var m = String(Math.floor((sessionSec%3600)/60)).padStart(2,'0');
      var s = String(sessionSec%60).padStart(2,'0');
      document.getElementById('session-elapsed').textContent = h+':'+m+':'+s;
    }, 1000);
  }
  function stopTimer() { clearInterval(timerInt); sessionSec = 0; }

  // ===== Tool Tab Switching =====
  function switchTool(id) {
    document.querySelectorAll('.cr-tab').forEach(function(t) { t.classList.remove('active'); });
    document.querySelectorAll('.tool-content').forEach(function(c) { c.classList.remove('active'); });
    event.target.closest('.cr-tab').classList.add('active');
    var el = document.getElementById('tool-' + id);
    if (el) el.classList.add('active');
  }

  // ===== Audit Panel Tab =====
  function showAuditView(view) {
    document.querySelectorAll('.audit-tab').forEach(function(t) { t.classList.remove('active'); });
    document.querySelectorAll('.audit-view').forEach(function(v) { v.classList.remove('active'); });
    event.target.closest('.audit-tab').classList.add('active');
    var el = document.getElementById('view-' + view);
    if (el) el.classList.add('active');
  }

  // ===== 3D Graph (from analysis-discovery) =====
  var variables = [
    { id:'glucose', name:'í˜ˆë‹¹ (HbA1c)', type:'outcome', connections:12, x:200, y:0, z:0 },
    { id:'medication', name:'ë³µì•½ ìˆœì‘ë„', type:'treatment', coef:-0.42, connections:5, x:-180, y:-30, z:80 },
    { id:'diet', name:'ì‹ì´ íŒ¨í„´', type:'treatment', coef:0.28, connections:4, x:-150, y:120, z:-60 },
    { id:'insulin', name:'ì¸ìŠë¦° ë¯¼ê°ì„±', type:'mediator', coef:-0.35, connections:6, x:20, y:20, z:40 },
    { id:'age', name:'ì—°ë ¹', type:'confounder', coef:0.15, connections:8, x:-80, y:-150, z:20 },
    { id:'exercise', name:'ìš´ë™ëŸ‰', type:'other', coef:-0.08, connections:3, x:-220, y:80, z:100 },
    { id:'sleep', name:'ìˆ˜ë©´ ì‹œê°„', type:'other', coef:-0.12, connections:4, x:-100, y:180, z:80 },
    { id:'stress', name:'ìŠ¤íŠ¸ë ˆìŠ¤', type:'other', coef:0.19, connections:5, x:80, y:150, z:-80 },
    { id:'weight', name:'ì²´ì¤‘', type:'other', coef:0.22, connections:4, x:100, y:-100, z:-100 },
    { id:'bmi', name:'BMI', type:'confounder', coef:0.18, connections:6, x:-50, y:-180, z:-60 },
    { id:'gender', name:'ì„±ë³„', type:'confounder', coef:0.05, connections:3, x:150, y:-150, z:60 },
    { id:'duration', name:'ìœ ë³‘ ê¸°ê°„', type:'confounder', coef:0.25, connections:5, x:-180, y:-120, z:-100 }
  ];
  var paths = [
    { id:'p1', from:'medication', via:'insulin', to:'glucose', effect:-12.4 },
    { id:'p2', from:'medication', to:'glucose', effect:-5.9 },
    { id:'p3', from:'diet', to:'glucose', effect:8.2 },
    { id:'p4', from:'exercise', via:'weight', to:'glucose', effect:-3.2 },
    { id:'p5', from:'stress', to:'glucose', effect:4.8 }
  ];
  var activeNodes = new Set(['glucose']);
  var activePaths = new Set(['p1','p2']);
  var rotX = 15, rotY = -10, dragging = false, lx, ly;
  var sThreshold = 0.3;

  function renderNodes() {
    var c = document.getElementById('graph-container');
    if (!c) return;
    c.innerHTML = variables.map(function(v) {
      var strong = v.coef == null || Math.abs(v.coef) >= sThreshold;
      return '<div class="node-3d '+v.type+(activeNodes.has(v.id)?' active':' dim')+(strong?'':' weak')+'" data-id="'+v.id+'" style="transform:translate3d('+v.x+'px,'+v.y+'px,'+v.z+'px);"><div class="sphere">'+v.name.split(' ')[0]+'</div><div class="label">'+(v.type==='outcome'?'ê²°ê³¼':v.type==='treatment'?'ì¹˜ë£Œ':v.type==='mediator'?'ë§¤ê°œ':v.type==='confounder'?'êµë€':'')+'</div></div>';
    }).join('');
    c.querySelectorAll('.node-3d').forEach(function(el) {
      el.addEventListener('click', function(e) { e.stopPropagation(); toggleNode(el.dataset.id); });
    });
    updateRotation();
  }

  function toggleNode(id) {
    if (activeNodes.has(id)) activeNodes.delete(id); else activeNodes.add(id);
    updateUI();
  }

  function updateUI() {
    document.querySelectorAll('.node-3d').forEach(function(el) {
      el.classList.toggle('active', activeNodes.has(el.dataset.id));
      el.classList.toggle('dim', !activeNodes.has(el.dataset.id));
    });
    document.getElementById('active-count').textContent = activeNodes.size;
    var html = Array.from(activeNodes).map(function(id) {
      var v = variables.find(function(x){return x.id===id;});
      return '<span class="node-tag '+v.type+'">'+v.name.split(' ')[0]+'</span>';
    }).join('');
    document.getElementById('active-nodes').innerHTML = html || '<span style="color:#666">ì—†ìŒ</span>';
    updateSim();
  }

  function updateSim() {
    var total=0, valid=0;
    paths.forEach(function(p) {
      if (activePaths.has(p.id) && activeNodes.has(p.from) && activeNodes.has(p.to)) { total+=p.effect; valid++; }
    });
    document.getElementById('active-paths').textContent = valid;
    document.getElementById('model-fit').textContent = 'RÂ² = '+(Math.min(0.95, activeNodes.size*0.08+valid*0.05)).toFixed(2);
  }

  function updateRotation() {
    var c = document.getElementById('graph-container');
    if (c) c.style.transform = 'translate(-50%,-50%) rotateX('+rotX+'deg) rotateY('+rotY+'deg)';
  }

  function initGraph() {
    renderNodes();
    updateUI();

    var g = document.getElementById('graph-3d');
    if (!g) return;
    g.addEventListener('mousedown', function(e) {
      if (e.target.closest('.node-3d')) return;
      dragging = true; lx = e.clientX; ly = e.clientY; g.style.cursor = 'grabbing';
    });
    document.addEventListener('mousemove', function(e) {
      if (!dragging) return;
      rotY += (e.clientX - lx) * 0.5;
      rotX -= (e.clientY - ly) * 0.5;
      rotX = Math.max(-60, Math.min(60, rotX));
      lx = e.clientX; ly = e.clientY;
      updateRotation();
    });
    document.addEventListener('mouseup', function() { dragging = false; if (g) g.style.cursor = 'grab'; });

    var tr = document.getElementById('threshold-range');
    var tv = document.getElementById('threshold-value');
    var sr = document.getElementById('strength-range');
    var sv = document.getElementById('strength-value');
    function applyThreshold(val) {
      sThreshold = parseFloat(val);
      if (tv) tv.textContent = sThreshold.toFixed(2);
      if (sv) sv.textContent = sThreshold.toFixed(2);
      if (tr && tr.value !== String(val)) tr.value = val;
      if (sr && sr.value !== String(val)) sr.value = val;
      renderNodes();
    }
    if (tr) tr.addEventListener('input', function(e) { applyThreshold(e.target.value); });
    if (sr) sr.addEventListener('input', function(e) { applyThreshold(e.target.value); });

    document.querySelectorAll('.view-toggle button').forEach(function(btn) {
      btn.addEventListener('click', function() {
        document.querySelectorAll('.view-toggle button').forEach(function(b){b.classList.remove('active');});
        btn.classList.add('active');
      });
    });
  }
</script>
</body>
</html>
