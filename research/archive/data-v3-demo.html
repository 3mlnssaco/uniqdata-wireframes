<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>UniQdata â€” ê°œìš”+í…Œì´ë¸” í†µí•© ë°ëª¨ v3</title>
  <style>
    *{margin:0;padding:0;box-sizing:border-box;}
    body{font-family:-apple-system,BlinkMacSystemFont,'Segoe UI',sans-serif;background:#f5f5f5;color:#1f2937;}
    .layout{display:flex;min-height:100vh;}

    /* === SIDEBAR === */
    .sidebar{width:240px;background:linear-gradient(180deg,#0f172a,#1e293b);color:white;display:flex;flex-direction:column;flex-shrink:0;}
    .logo{padding:20px 24px;font-size:20px;font-weight:700;border-bottom:1px solid rgba(255,255,255,.1);display:flex;align-items:center;gap:10px;}
    .logo-icon{width:32px;height:32px;background:linear-gradient(135deg,#3b82f6,#8b5cf6);border-radius:8px;display:flex;align-items:center;justify-content:center;font-size:16px;}
    .nav-section{padding:16px 12px;border-bottom:1px solid rgba(255,255,255,.05);}
    .nav-item{display:flex;align-items:center;gap:12px;padding:10px 12px;border-radius:8px;color:#94a3b8;cursor:pointer;font-size:14px;text-decoration:none;}
    .nav-item:hover{background:rgba(255,255,255,.05);color:#e2e8f0;}
    .rn-header{display:flex;align-items:center;gap:8px;padding:8px 12px;border-radius:8px;font-size:13px;color:#60a5fa;background:rgba(59,130,246,.1);cursor:pointer;}
    .rn-sub{padding-left:20px;margin-top:4px;border-left:2px solid rgba(255,255,255,.1);margin-left:18px;}
    .ns-item{display:flex;align-items:center;gap:8px;padding:8px 12px;border-radius:6px;color:#94a3b8;font-size:12px;cursor:pointer;text-decoration:none;margin-bottom:2px;}
    .ns-item:hover{background:rgba(255,255,255,.05);color:#e2e8f0;}
    .ns-item.active{background:rgba(59,130,246,.15);color:#60a5fa;}
    .status-dot{width:7px;height:7px;border-radius:50%;background:#22c55e;flex-shrink:0;}
    .sidebar-footer{margin-top:auto;padding:16px;border-top:1px solid rgba(255,255,255,.05);}
    .u-info{display:flex;align-items:center;gap:12px;padding:8px;}
    .u-av{width:36px;height:36px;background:linear-gradient(135deg,#3b82f6,#8b5cf6);border-radius:50%;display:flex;align-items:center;justify-content:center;font-size:14px;}

    /* === MAIN === */
    .main{flex:1;overflow-y:auto;display:flex;flex-direction:column;}
    .content{padding:24px;flex:1;display:flex;flex-direction:column;}
    .breadcrumb{display:flex;align-items:center;gap:8px;margin-bottom:16px;font-size:14px;color:#6b7280;}
    .breadcrumb a{color:#3b82f6;text-decoration:none;}
    .page-title{font-size:20px;font-weight:700;margin-bottom:4px;}
    .page-sub{color:#6b7280;font-size:13px;margin-bottom:20px;}

    /* íƒ­ */
    .tabs{display:flex;gap:0;border-bottom:2px solid #e5e7eb;margin-bottom:20px;}
    .tab{padding:12px 24px;font-size:14px;color:#6b7280;cursor:pointer;border-bottom:2px solid transparent;margin-bottom:-2px;font-weight:500;user-select:none;}
    .tab.active{color:#3b82f6;border-bottom-color:#3b82f6;}
    .tab:hover{color:#374151;}

    /* íƒ­ ì½˜í…ì¸  */
    .tab-content{display:none;flex:1;}
    .tab-content.active{display:flex;flex-direction:column;flex:1;}

    /* ====== ê°œìš” íƒ­ ====== */
    .kpi-grid{display:grid;grid-template-columns:repeat(4,1fr);gap:14px;margin-bottom:20px;}
    .kpi-card{background:white;border:1px solid #e5e7eb;border-radius:12px;padding:16px 20px;}
    .kpi-label{font-size:12px;color:#6b7280;margin-bottom:6px;}
    .kpi-value{font-size:24px;font-weight:700;margin-bottom:2px;}
    .kpi-sub{font-size:11px;color:#9ca3af;}
    .kpi-change{font-size:11px;margin-top:4px;}
    .kpi-change.good{color:#16a34a;}
    .source-tag{display:inline-block;font-size:10px;padding:2px 6px;border-radius:4px;margin:2px 2px 0 0;font-weight:600;}
    .source-tag.emr{background:#dbeafe;color:#0c4a6e;}
    .source-tag.wear{background:#dcfce7;color:#14532d;}
    .source-tag.ema{background:#fce7f3;color:#500724;}
    .source-tag.ext{background:#fed7aa;color:#7c2d12;}

    .section-card{background:white;border:1px solid #e5e7eb;border-radius:12px;padding:20px;margin-bottom:20px;}
    .section-card h3{font-size:15px;font-weight:600;margin-bottom:14px;}

    /* íƒ€ì„ë¼ì¸ */
    .tl-controls{display:flex;justify-content:space-between;align-items:center;margin-bottom:12px;flex-wrap:wrap;gap:8px;}
    .tl-left{display:flex;align-items:center;gap:10px;}
    .zoom-label{font-size:13px;font-weight:600;color:#374151;}
    .zoom-btn{padding:4px 8px;background:#f3f4f6;border:1px solid #d1d5db;border-radius:6px;cursor:pointer;font-size:12px;color:#374151;}
    .source-filters{display:flex;gap:10px;flex-wrap:wrap;}
    .filter-cb{display:flex;align-items:center;gap:5px;cursor:pointer;font-size:12px;color:#6b7280;}
    .metric-sel{display:flex;align-items:center;gap:10px;margin-bottom:12px;}
    .metric-sel label{font-size:13px;font-weight:600;color:#374151;}
    .metric-sel select{padding:6px 10px;border:1px solid #d1d5db;border-radius:6px;font-size:12px;color:#374151;background:white;}
    .tl-container{background:#f9fafb;border-radius:8px;padding:12px;}

    /* ë¹„êµ í…Œì´ë¸” */
    .cmp-table{width:100%;border-collapse:collapse;}
    .cmp-table th{text-align:left;font-size:12px;color:#6b7280;font-weight:600;padding:10px 12px;border-bottom:2px solid #e5e7eb;background:#f9fafb;}
    .cmp-table td{padding:10px 12px;font-size:13px;border-bottom:1px solid #f1f5f9;}
    .cmp-table td:first-child{font-weight:600;color:#374151;}
    .exp-v{color:#1d4ed8;font-weight:600;font-family:'SF Mono',Monaco,monospace;}
    .ctrl-v{color:#be185d;font-weight:600;font-family:'SF Mono',Monaco,monospace;}
    .diff-v{font-weight:700;font-family:'SF Mono',Monaco,monospace;}
    .diff-v.good{color:#16a34a;}
    .p-badge{display:inline-block;padding:2px 8px;border-radius:6px;font-size:11px;font-weight:600;font-family:'SF Mono',Monaco,monospace;}
    .p-badge.sig{background:#dcfce7;color:#166534;}
    .p-badge.hsig{background:#bbf7d0;color:#14532d;}
    .p-badge.ns{background:#f3f4f6;color:#6b7280;}

    /* AI */
    .ai-box{background:linear-gradient(135deg,#faf5ff,#f3e8ff);border:1px solid #ddd6fe;border-radius:12px;padding:20px;margin-bottom:20px;}
    .ai-box h3{font-size:14px;font-weight:600;color:#6d28d9;margin-bottom:12px;}
    .ai-item{display:flex;align-items:flex-start;gap:10px;padding:8px 0;border-bottom:1px solid rgba(139,92,246,.1);font-size:13px;}
    .ai-item:last-child{border-bottom:none;}
    .ai-tag{display:inline-block;padding:2px 8px;border-radius:6px;font-size:10px;font-weight:600;white-space:nowrap;flex-shrink:0;}
    .ai-tag.pos{background:#dcfce7;color:#166534;}
    .ai-tag.alert{background:#fef3c7;color:#92400e;}
    .ai-tag.ins{background:#dbeafe;color:#1d4ed8;}
    .hyp-box{margin-top:10px;padding:10px 14px;background:rgba(139,92,246,.08);border-radius:8px;font-size:12px;color:#4c1d95;}

    /* ops */
    .ops-grid{display:grid;grid-template-columns:1fr 1fr;gap:16px;margin-bottom:20px;}
    .ops-card{background:white;border:1px solid #e5e7eb;border-radius:12px;padding:20px;}
    .ops-card h3{font-size:14px;font-weight:600;margin-bottom:14px;}
    .ops-bar{height:8px;background:#f3f4f6;border-radius:4px;overflow:hidden;display:flex;margin:8px 0;}
    .ops-bar-fill{height:100%;}
    .ops-row{display:flex;justify-content:space-between;padding:6px 0;border-bottom:1px solid #f1f5f9;font-size:13px;}
    .ops-row:last-child{border-bottom:none;}
    .ops-label{color:#6b7280;}
    .ops-val{font-weight:600;font-family:'SF Mono',Monaco,monospace;}

    /* ====== í…Œì´ë¸” íƒ­ ====== */
    .table-area-wrap{display:flex;flex:1;min-height:0;overflow:hidden;}
    .table-area{flex:1;min-width:0;overflow:auto;display:flex;flex-direction:column;transition:flex .3s ease;}
    .table-area.shrunk{flex:0 0 50%;}

    /* ì»¨íŠ¸ë¡¤ */
    .ctrl-section{background:white;border:1px solid #e5e7eb;border-radius:12px;padding:14px 20px;margin-bottom:12px;}
    .ctrl-row{display:flex;gap:14px;align-items:center;flex-wrap:wrap;}
    .ctrl-group{display:flex;align-items:center;gap:8px;}
    .ctrl-group label{font-size:12px;color:#6b7280;font-weight:600;}
    .t-btn{padding:6px 12px;border:1px solid #e5e7eb;border-radius:6px;background:white;color:#6b7280;cursor:pointer;font-size:12px;}
    .t-btn.active{background:#3b82f6;color:white;border-color:#3b82f6;}
    .sel-sm{padding:6px 10px;border:1px solid #e5e7eb;border-radius:6px;font-size:12px;color:#374151;background:white;cursor:pointer;}
    .dn{display:flex;align-items:center;gap:8px;padding:6px 12px;background:#f9fafb;border:1px solid #e5e7eb;border-radius:6px;font-size:12px;color:#374151;}
    .dn button{background:none;border:none;cursor:pointer;font-size:14px;color:#3b82f6;padding:0 4px;}
    .search-in{padding:6px 10px;border:1px solid #e5e7eb;border-radius:6px;font-size:12px;width:150px;}

    /* ì»¤ìŠ¤í…€ ì¸í„°ë²Œ */
    .custom-interval{display:flex;align-items:center;gap:6px;padding:4px 8px;background:#eff6ff;border:1px solid #bfdbfe;border-radius:6px;font-size:12px;}
    .custom-interval input[type=number]{width:40px;padding:3px 6px;border:1px solid #d1d5db;border-radius:4px;font-size:12px;text-align:center;}
    .custom-interval select{padding:3px 6px;border:1px solid #d1d5db;border-radius:4px;font-size:12px;background:white;}
    .custom-interval .ci-label{color:#1d4ed8;font-weight:600;font-size:11px;}

    /* ì†ŒìŠ¤ ë²”ë¡€ */
    .src-legend{display:flex;gap:14px;align-items:center;margin-bottom:8px;font-size:11px;color:#6b7280;}
    .sd{width:8px;height:8px;border-radius:2px;display:inline-block;}
    .sd.emr{background:#3b82f6;}.sd.wear{background:#22c55e;}.sd.ema{background:#a855f7;}.sd.ext{background:#f97316;}

    /* í…Œì´ë¸” */
    .tbl-section{background:white;border:1px solid #e5e7eb;border-radius:12px;overflow:hidden;margin-bottom:12px;flex:1;display:flex;flex-direction:column;}
    .tbl-wrap{overflow:auto;flex:1;}
    table.pt-tbl{width:100%;border-collapse:collapse;font-size:13px;}
    table.pt-tbl thead th{text-align:left;font-size:11px;color:#6b7280;font-weight:600;padding:10px 8px;border-bottom:2px solid #e5e7eb;background:#f9fafb;position:sticky;top:0;z-index:10;white-space:nowrap;cursor:pointer;}
    table.pt-tbl thead th .cs{display:inline-block;width:6px;height:6px;border-radius:2px;margin-right:4px;vertical-align:middle;}
    table.pt-tbl tbody td{padding:10px 8px;border-bottom:1px solid #f1f5f9;font-size:12px;}
    table.pt-tbl tbody tr{cursor:pointer;transition:background .1s;}
    table.pt-tbl tbody tr:hover{background:#f8fafc;}
    table.pt-tbl tbody tr.selected{background:#eff6ff;}
    table.pt-tbl tbody tr.alert-row{background:#fffbeb;}
    table.pt-tbl tbody tr.alert-row:hover{background:#fef3c7;}
    .pid{font-weight:600;color:#374151;white-space:nowrap;}
    .gb{display:inline-block;padding:1px 6px;border-radius:4px;font-size:10px;font-weight:600;margin-left:6px;}
    .gb.exp{background:#dbeafe;color:#1d4ed8;}.gb.ctrl{background:#fce7f3;color:#be185d;}
    .sv{display:inline-block;width:6px;height:6px;border-radius:50%;margin-right:6px;}
    .sv.good{background:#22c55e;}.sv.warn{background:#f59e0b;}.sv.bad{background:#ef4444;}
    .cd{font-weight:700;font-family:'SF Mono',Monaco,monospace;font-size:12px;}
    .cd.good{color:#16a34a;}.cd.bad{color:#dc2626;}.cd.neutral{color:#6b7280;}
    .cr{font-size:11px;color:#9ca3af;display:block;margin-top:1px;}
    .ce{color:#d1d5db;font-style:italic;}

    /* í˜ì´ì§€ë„¤ì´ì…˜ */
    .pag-row{display:flex;align-items:center;justify-content:space-between;padding:12px 20px;background:white;border:1px solid #e5e7eb;border-radius:12px;font-size:12px;color:#6b7280;margin-bottom:12px;}
    .pag-btns{display:flex;gap:4px;}
    .pg-btn{padding:5px 9px;border:1px solid #e5e7eb;border-radius:4px;background:white;color:#6b7280;cursor:pointer;font-size:11px;}
    .pg-btn.active{background:#3b82f6;color:white;border-color:#3b82f6;}

    /* === ë””í…Œì¼ íŒ¨ë„ (ì˜¤ë¥¸ìª½ ìŠ¬ë¼ì´ë“œ) === */
    .detail-panel{width:0;overflow:hidden;border-left:1px solid #e5e7eb;background:white;transition:width .3s ease;flex-shrink:0;display:flex;flex-direction:column;}
    .detail-panel.open{width:50%;}
    .dp-header{display:flex;justify-content:space-between;align-items:center;padding:16px 20px;border-bottom:1px solid #e5e7eb;background:#f9fafb;flex-shrink:0;}
    .dp-title{font-size:15px;font-weight:700;color:#374151;display:flex;align-items:center;gap:8px;}
    .dp-close{padding:6px 10px;border:1px solid #e5e7eb;border-radius:6px;background:white;cursor:pointer;font-size:14px;color:#6b7280;}
    .dp-close:hover{background:#f3f4f6;}
    .dp-nav{display:flex;gap:6px;}
    .dp-nav button{padding:4px 10px;border:1px solid #e5e7eb;border-radius:6px;background:white;cursor:pointer;font-size:12px;color:#374151;}
    .dp-nav button:hover{background:#f3f4f6;}
    .dp-body{flex:1;overflow-y:auto;padding:20px;}

    /* ì°¨íŠ¸ ì¹´ë“œ */
    .chart-card{background:#f9fafb;border:1px solid #e5e7eb;border-radius:10px;padding:16px;margin-bottom:16px;}
    .chart-title{font-size:12px;font-weight:600;color:#374151;margin-bottom:10px;display:flex;align-items:center;gap:6px;}
    .chart-title .cs{display:inline-block;width:6px;height:6px;border-radius:2px;}
    .chart-area{height:100px;}
    .chart-area svg{width:100%;height:100%;}
    .chart-x{display:flex;justify-content:space-between;font-size:10px;color:#9ca3af;margin-top:4px;}
    .chart-summary{display:flex;gap:16px;margin-top:8px;font-size:11px;color:#6b7280;}
    .chart-summary strong{color:#374151;}

    /* í”Œë¡œìš°ì‹œíŠ¸ */
    .fs-title{font-size:13px;font-weight:600;color:#374151;margin-bottom:10px;}
    .fs-table{width:100%;border-collapse:collapse;font-size:11px;}
    .fs-table th{font-size:10px;color:#9ca3af;font-weight:600;padding:5px 6px;border-bottom:1px solid #e5e7eb;text-align:center;}
    .fs-table th:first-child{text-align:left;}
    .fs-table td{padding:5px 6px;text-align:center;border-bottom:1px solid #f1f5f9;font-family:'SF Mono',Monaco,monospace;}
    .fs-table td:first-child{text-align:left;font-weight:600;color:#374151;font-family:-apple-system,sans-serif;}
    .fg{color:#16a34a;background:rgba(34,197,94,.06);}.fw{color:#d97706;background:rgba(245,158,11,.06);}.fb{color:#dc2626;background:rgba(239,68,68,.06);}
    .fc{font-weight:700;outline:1.5px solid #3b82f6;border-radius:3px;}

    /* ë””ìì´ë„ˆ ë…¸íŠ¸ */
    .dn-section{margin-top:24px;}
    .dn-section summary{cursor:pointer;font-size:14px;font-weight:600;color:#6b7280;padding:12px 16px;background:#f9fafb;border:1px solid #e5e7eb;border-radius:8px;}
    .notes-c{margin-top:12px;padding:20px;background:#f9fafb;border:1px solid #e5e7eb;border-radius:12px;font-size:12px;line-height:1.8;color:#374151;}
    .notes-c h4{font-size:13px;margin:16px 0 8px;color:#1f2937;font-weight:600;}
    .notes-c h4:first-child{margin-top:0;}
    .notes-c code{background:#0f172a;color:#a5b4fc;padding:10px;border-radius:6px;display:block;margin:8px 0;font-size:11px;font-family:'SF Mono',Monaco,monospace;white-space:pre-wrap;}

    @media(max-width:1200px){.kpi-grid{grid-template-columns:repeat(2,1fr);}.ops-grid{grid-template-columns:1fr;}.ctrl-row{flex-direction:column;align-items:flex-start;}}
  </style>
</head>
<body>
<div class="layout">

  <!-- SIDEBAR -->
  <nav class="sidebar">
    <div class="logo"><div class="logo-icon">U</div> UniQdata</div>
    <div class="nav-section"><a class="nav-item"><span>ğŸ </span> ì—°êµ¬ í—ˆë¸Œ</a></div>
    <div class="nav-section" style="flex:1;overflow-y:auto;">
      <div style="font-size:11px;text-transform:uppercase;color:#64748b;padding:8px 12px;letter-spacing:.5px;">ë‚´ ì—°êµ¬</div>
      <div style="margin-bottom:2px;">
        <div class="rn-header"><span style="font-size:14px;">ğŸ“</span><span style="flex:1;">ëŒ€ì‚¬ê°œì„  ì•½ë¬¼ ì—°êµ¬</span><span class="status-dot"></span></div>
        <div class="rn-sub">
          <a class="ns-item" id="nav-overview"><span class="sd emr" style="width:6px;height:6px;border-radius:50%;opacity:.5;"></span> ê°œìš”</a>
          <a class="ns-item" id="nav-table"><span class="sd emr" style="width:6px;height:6px;border-radius:50%;opacity:.5;"></span> í…Œì´ë¸”</a>
          <a class="ns-item"><span class="sd emr" style="width:6px;height:6px;border-radius:50%;opacity:.5;"></span> ğŸ”’ í´ë¦°ë£¸</a>
        </div>
      </div>
    </div>
    <div class="sidebar-footer"><div class="u-info"><div class="u-av">ê¹€</div><div><div style="font-size:14px;color:#e2e8f0;">ê¹€ì—°êµ¬</div><div style="font-size:12px;color:#64748b;">ì„œìš¸ëŒ€í•™êµë³‘ì›</div></div></div></div>
  </nav>

  <!-- MAIN -->
  <main class="main">
    <div class="content">

      <div class="breadcrumb"><a href="#">ì—°êµ¬ ê´€ë¦¬</a> / <span id="bc-page">ëŒ€ì‚¬ê°œì„  ì•½ë¬¼ ì—°êµ¬</span></div>
      <div class="page-title">ì—°êµ¬ ë°ì´í„°</div>
      <div class="page-sub">ì²˜ë°© ì•½ë¬¼(2.4mg) ëŒ€ì‚¬ê°œì„  ì—°êµ¬ Â· OMOP CDM Â· ë‹¤ì¤‘ ì†ŒìŠ¤ í†µí•©</div>

      <div class="tabs">
        <div class="tab active" data-tab="overview" id="tab-overview">ê°œìš”</div>
        <div class="tab" data-tab="table" id="tab-table">í…Œì´ë¸”</div>
        <div class="tab">ğŸ”’ í´ë¦°ë£¸</div>
      </div>

      <!-- ==================== ê°œìš” íƒ­ ==================== -->
      <div class="tab-content active" id="tc-overview">

        <!-- KPI -->
        <div class="kpi-grid">
          <div class="kpi-card">
            <div class="kpi-label">ì´ ë ˆì½”ë“œ ìˆ˜</div>
            <div class="kpi-value">1,892K</div>
            <div class="kpi-sub"><span class="source-tag emr">EMR 892K</span> <span class="source-tag wear">ì›¨ì–´ 845K</span><br><span class="source-tag ema">EMA 143K</span> <span class="source-tag ext">ì™¸ë¶€ 12K</span></div>
          </div>
          <div class="kpi-card">
            <div class="kpi-label">ê¸°ê°„ ì»¤ë²„ë¦¬ì§€</div>
            <div class="kpi-value">94<span style="font-size:14px;">%</span></div>
            <div class="kpi-sub">2020.01 ~ 2026.02 (6ë…„ 2ê°œì›”)</div>
            <div class="kpi-change good">+2.1% vs ì§€ë‚œì£¼</div>
          </div>
          <div class="kpi-card">
            <div class="kpi-label">ê²°ì¸¡ë¥ </div>
            <div class="kpi-value">6.2<span style="font-size:14px;">%</span></div>
            <div class="kpi-sub"><span class="source-tag wear">ì›¨ì–´ 3.1%</span> <span class="source-tag ema">EMA 8.4%</span><br><span class="source-tag ext">ì™¸ë¶€ 12.8%</span></div>
            <div class="kpi-change good">âˆ’0.8% ê°œì„ </div>
          </div>
          <div class="kpi-card">
            <div class="kpi-label">ì°¸ì—¬ì í˜„í™©</div>
            <div class="kpi-value">76<span style="font-size:14px;">/80</span></div>
            <div class="kpi-sub">ì‹¤í—˜êµ° 38 Â· ëŒ€ì¡°êµ° 38 Â· íƒˆë½ 4</div>
          </div>
        </div>

        <!-- íƒ€ì„ë¼ì¸ -->
        <div class="section-card">
          <h3>í†µí•© íƒ€ì„ë¼ì¸</h3>
          <div class="tl-controls">
            <div class="tl-left"><span class="zoom-label">ì¤Œ: ì£¼ë³„</span><button class="zoom-btn">+</button><button class="zoom-btn">âˆ’</button></div>
            <div class="source-filters">
              <label class="filter-cb"><input type="checkbox" checked> EMR</label>
              <label class="filter-cb"><input type="checkbox" checked> ì›¨ì–´ëŸ¬ë¸”</label>
              <label class="filter-cb"><input type="checkbox" checked> EMA</label>
              <label class="filter-cb"><input type="checkbox" checked> ì™¸ë¶€</label>
            </div>
          </div>
          <div class="metric-sel"><label>ì§€í‘œ:</label><select class="sel-sm"><option>ì²´ì¤‘ [EMR]</option><option>ì‹¬ë°•ìˆ˜ [ì›¨ì–´ëŸ¬ë¸”]</option><option>SBP [EMR]</option><option>ê±¸ìŒìˆ˜ [ì›¨ì–´ëŸ¬ë¸”]</option></select></div>
          <div class="tl-container">
            <svg viewBox="0 0 800 200" style="width:100%;height:auto;">
              <rect width="800" height="200" fill="white"/>
              <line x1="40" y1="10" x2="40" y2="170" stroke="#e5e7eb" stroke-width="1"/>
              <line x1="40" y1="170" x2="780" y2="170" stroke="#d1d5db" stroke-width="1.5"/>
              <!-- Y labels -->
              <text x="32" y="25" fill="#9ca3af" font-size="9" text-anchor="end">90</text>
              <text x="32" y="65" fill="#9ca3af" font-size="9" text-anchor="end">85</text>
              <text x="32" y="105" fill="#9ca3af" font-size="9" text-anchor="end">80</text>
              <text x="32" y="145" fill="#9ca3af" font-size="9" text-anchor="end">75</text>
              <line x1="40" y1="20" x2="780" y2="20" stroke="#f3f4f6"/>
              <line x1="40" y1="60" x2="780" y2="60" stroke="#f3f4f6"/>
              <line x1="40" y1="100" x2="780" y2="100" stroke="#f3f4f6"/>
              <line x1="40" y1="140" x2="780" y2="140" stroke="#f3f4f6"/>
              <!-- Division line -->
              <line x1="640" y1="5" x2="640" y2="175" stroke="#9ca3af" stroke-width="2" stroke-dasharray="5,4"/>
              <text x="640" y="192" fill="#9ca3af" font-size="9" text-anchor="middle">2026.01.15 ì‹ ê·œìˆ˜ì§‘</text>
              <!-- X labels -->
              <text x="80" y="188" fill="#9ca3af" font-size="9" text-anchor="middle">2020</text>
              <text x="200" y="188" fill="#9ca3af" font-size="9" text-anchor="middle">2021</text>
              <text x="320" y="188" fill="#9ca3af" font-size="9" text-anchor="middle">2022</text>
              <text x="440" y="188" fill="#9ca3af" font-size="9" text-anchor="middle">2023</text>
              <text x="560" y="188" fill="#9ca3af" font-size="9" text-anchor="middle">2024</text>
              <text x="720" y="188" fill="#9ca3af" font-size="9" text-anchor="middle">2026</text>
              <!-- EMR dots -->
              <g opacity="0.5"><circle cx="80" cy="35" r="2" fill="#3b82f6"/><circle cx="140" cy="38" r="2" fill="#3b82f6"/><circle cx="200" cy="32" r="2" fill="#3b82f6"/><circle cx="280" cy="36" r="2" fill="#3b82f6"/><circle cx="360" cy="34" r="2" fill="#3b82f6"/><circle cx="440" cy="40" r="2" fill="#3b82f6"/><circle cx="520" cy="37" r="2" fill="#3b82f6"/><circle cx="600" cy="35" r="2" fill="#3b82f6"/></g>
              <circle cx="680" cy="80" r="2.5" fill="#3b82f6"/><circle cx="740" cy="100" r="2.5" fill="#3b82f6"/>
              <!-- Wearable line -->
              <defs><linearGradient id="wg" x1="0" y1="0" x2="0" y2="1"><stop offset="0%" stop-color="#22c55e" stop-opacity=".15"/><stop offset="100%" stop-color="#22c55e" stop-opacity="0"/></linearGradient></defs>
              <polygon points="40,50 120,48 200,45 300,42 400,38 500,35 600,33 640,32 700,80 760,95 780,100 780,170 40,170" fill="url(#wg)"/>
              <polyline points="40,50 120,48 200,45 300,42 400,38 500,35 600,33 640,32 700,80 760,95" stroke="#22c55e" stroke-width="2" fill="none" stroke-linecap="round"/>
              <!-- EMA bars -->
              <g opacity="0.5"><rect x="75" y="130" width="6" height="25" fill="#a855f7" rx="1"/><rect x="155" y="125" width="6" height="30" fill="#a855f7" rx="1"/><rect x="235" y="135" width="6" height="20" fill="#a855f7" rx="1"/><rect x="355" y="128" width="6" height="27" fill="#a855f7" rx="1"/><rect x="475" y="132" width="6" height="23" fill="#a855f7" rx="1"/><rect x="595" y="130" width="6" height="25" fill="#a855f7" rx="1"/></g>
              <rect x="675" y="125" width="6" height="30" fill="#a855f7" rx="1"/><rect x="735" y="128" width="6" height="27" fill="#a855f7" rx="1"/>
            </svg>
          </div>
        </div>

        <!-- êµ°ê°„ ë¹„êµ + pê°’ -->
        <div class="section-card">
          <h3>êµ°ê°„ í•µì‹¬ ë³€í™”ê°’</h3>
          <table class="cmp-table">
            <thead><tr><th>ì§€í‘œ</th><th>ì‹¤í—˜êµ° (n=38)</th><th>ëŒ€ì¡°êµ° (n=38)</th><th>êµ°ê°„ ì°¨ì´</th><th>pê°’</th></tr></thead>
            <tbody>
              <tr><td><span style="font-size:11px;color:#6b7280;">[EMR]</span> Î” ì²´ì¤‘</td><td class="exp-v">âˆ’6.8 Â±2.1</td><td class="ctrl-v">âˆ’0.3 Â±1.8</td><td class="diff-v good">6.5</td><td><span class="p-badge hsig">p=0.001***</span></td></tr>
              <tr><td><span style="font-size:11px;color:#6b7280;">[EMR]</span> Î” SBP</td><td class="exp-v">âˆ’8.2 Â±4.3</td><td class="ctrl-v">+1.1 Â±3.9</td><td class="diff-v good">9.3</td><td><span class="p-badge sig">p=0.012*</span></td></tr>
              <tr><td><span style="font-size:11px;color:#6b7280;">[ì›¨ì–´]</span> Î” ì‹¬ë°•ìˆ˜</td><td class="exp-v">âˆ’4.2 Â±3.1</td><td class="ctrl-v">+0.8 Â±2.8</td><td class="diff-v good">5.0</td><td><span class="p-badge sig">p=0.034*</span></td></tr>
              <tr><td><span style="font-size:11px;color:#6b7280;">[ì›¨ì–´]</span> Î” ê±¸ìŒìˆ˜</td><td class="exp-v">+2,340 Â±580</td><td class="ctrl-v">+180 Â±420</td><td class="diff-v good">2,160</td><td><span class="p-badge hsig">p=0.008**</span></td></tr>
              <tr><td><span style="font-size:11px;color:#6b7280;">[EMA]</span> ìˆœì‘ë„</td><td class="exp-v">91%</td><td class="ctrl-v">87%</td><td class="diff-v" style="color:#6b7280;">4</td><td><span class="p-badge ns">p=0.342</span></td></tr>
            </tbody>
          </table>
        </div>

        <!-- AI ì¸ì‚¬ì´íŠ¸ -->
        <div class="ai-box">
          <h3>AI ì¸ì‚¬ì´íŠ¸ ìš”ì•½</h3>
          <div class="ai-item"><span class="ai-tag pos">ë°œê²¬</span><span>ì²´ì¤‘ ê°ì†Œ ìƒìœ„ 25% í™˜ìêµ°ì—ì„œ ì•±ì‚¬ìš©ì‹œê°„ 2.1ë°° ì¦ê°€ â€” ì™¸ë¶€ ë°ì´í„° ìƒê´€ ë°œê²¬</span></div>
          <div class="ai-item"><span class="ai-tag alert">ì£¼ì˜</span><span>P-007, P-024 ì›¨ì–´ëŸ¬ë¸” ë°ì´í„° 3ì¼ ë¯¸ìˆ˜ì§‘ â€” ë””ë°”ì´ìŠ¤ ì—°ê²° í™•ì¸ í•„ìš”</span></div>
          <div class="ai-item"><span class="ai-tag ins">ì¶”ì„¸</span><span>ë¶„ê¸°ì„  ì´í›„ ì‹¤í—˜êµ° ê±¸ìŒìˆ˜ +34% ì¦ê°€ íŒ¨í„´ ê°ì§€</span></div>
          <div class="hyp-box"><strong>ê°€ì„¤ ë¶€í•©ë„:</strong> H1(ì²´ì¤‘) <strong style="color:#16a34a;">84%</strong> Â· H2(í˜ˆì••) <strong style="color:#d97706;">62%</strong> Â· H3(í™œë™) <strong style="color:#16a34a;">71%</strong></div>
        </div>

        <!-- ìˆ˜ì§‘Â·ì˜ˆì‚° -->
        <div class="ops-grid">
          <div class="ops-card">
            <h3>ë°ì´í„° ìˆ˜ì§‘ í˜„í™©</h3>
            <div class="ops-bar"><div class="ops-bar-fill" style="width:94%;background:linear-gradient(90deg,#3b82f6,#60a5fa);"></div></div>
            <div style="display:flex;justify-content:space-between;font-size:10px;color:#9ca3af;"><span>ì „ì²´ 94%</span><span>ëª©í‘œ 90%</span></div>
            <div style="margin-top:10px;">
              <div class="ops-row"><span class="ops-label">[EMR]</span><span class="ops-val" style="color:#3b82f6;">100%</span></div>
              <div class="ops-row"><span class="ops-label">[ì›¨ì–´ëŸ¬ë¸”]</span><span class="ops-val" style="color:#22c55e;">94%</span></div>
              <div class="ops-row"><span class="ops-label">[EMA]</span><span class="ops-val" style="color:#a855f7;">87%</span></div>
              <div class="ops-row"><span class="ops-label">[ì™¸ë¶€]</span><span class="ops-val" style="color:#f97316;">84.6%</span></div>
            </div>
          </div>
          <div class="ops-card">
            <h3>ì˜ˆì‚° í˜„í™©</h3>
            <div class="ops-bar"><div class="ops-bar-fill" style="width:26%;background:#3b82f6;"></div><div class="ops-bar-fill" style="width:74%;background:#22c55e;"></div></div>
            <div style="display:flex;justify-content:space-between;font-size:10px;color:#9ca3af;"><span>ì§€ê¸‰ 26%</span><span>ì”ì—¬ 74%</span></div>
            <div style="margin-top:10px;">
              <div class="ops-row"><span class="ops-label">ì´ ì˜ˆì‚°</span><span class="ops-val">25,000 XRP</span></div>
              <div class="ops-row"><span class="ops-label">ì§€ê¸‰ì™„ë£Œ</span><span class="ops-val" style="color:#3b82f6;">6,500</span></div>
              <div class="ops-row"><span class="ops-label">ì”ì—¬</span><span class="ops-val" style="color:#22c55e;">18,500</span></div>
            </div>
          </div>
        </div>
      </div>

      <!-- ==================== í…Œì´ë¸” íƒ­ ==================== -->
      <div class="tab-content" id="tc-table">

        <!-- ì»¨íŠ¸ë¡¤ -->
        <div class="ctrl-section">
          <div class="ctrl-row">
            <div class="ctrl-group">
              <label>ì‹œê°„ ìœˆë„ìš°</label>
              <div style="display:flex;gap:4px;">
                <button class="t-btn tw-btn" data-tw="daily">ì¼ê°„</button>
                <button class="t-btn tw-btn active" data-tw="weekly">ì£¼ê°„</button>
                <button class="t-btn tw-btn" data-tw="monthly">ì›”ê°„</button>
                <button class="t-btn tw-btn" data-tw="custom" id="customTwBtn">ì»¤ìŠ¤í…€</button>
              </div>
            </div>
            <!-- ì»¤ìŠ¤í…€ ì¸í„°ë²Œ (ìˆ¨ê¹€ â†’ ì»¤ìŠ¤í…€ í´ë¦­ ì‹œ í‘œì‹œ) -->
            <div class="custom-interval" id="customInterval" style="display:none;">
              <span class="ci-label">ë§¤</span>
              <input type="number" value="3" min="1" max="90" id="ciNum">
              <select id="ciUnit">
                <option value="day">ì¼</option>
                <option value="week">ì£¼</option>
                <option value="month">ì›”</option>
              </select>
              <span class="ci-label">ë‹¨ìœ„ë¡œ ì§‘ê³„</span>
            </div>
            <div class="ctrl-group">
              <label>ì†ŒìŠ¤</label>
              <select class="sel-sm"><option>ì „ì²´</option><option>[EMR]</option><option>[ì›¨ì–´ëŸ¬ë¸”]</option><option>[EMA]</option></select>
            </div>
            <div class="ctrl-group">
              <div class="dn"><button>â—€</button><span id="dateLabel">2ì›” 2ì£¼ì°¨ (W6)</span><button>â–¶</button></div>
            </div>
            <div class="ctrl-group" style="margin-left:auto;">
              <input type="text" class="search-in" placeholder="í™˜ì ê²€ìƒ‰...">
            </div>
          </div>
        </div>

        <!-- ì†ŒìŠ¤ ë²”ë¡€ -->
        <div class="src-legend">
          <span><span class="sd emr"></span> EMR</span>
          <span><span class="sd wear"></span> ì›¨ì–´ëŸ¬ë¸”</span>
          <span><span class="sd ema"></span> EMA</span>
          <span><span class="sd ext"></span> ì™¸ë¶€</span>
          <span style="margin-left:auto;color:#9ca3af;">í–‰ í´ë¦­ â†’ ìš°ì¸¡ ìƒì„¸ íŒ¨ë„</span>
        </div>

        <!-- í…Œì´ë¸” + ë””í…Œì¼ íŒ¨ë„ -->
        <div class="table-area-wrap">
          <div class="table-area" id="tableArea">
            <div class="tbl-section">
              <div class="tbl-wrap">
                <table class="pt-tbl">
                  <thead><tr>
                    <th style="width:14%;">í™˜ì</th>
                    <th><span class="cs" style="background:#3b82f6;"></span>ì²´ì¤‘</th>
                    <th><span class="cs" style="background:#3b82f6;"></span>SBP</th>
                    <th><span class="cs" style="background:#22c55e;"></span>ì‹¬ë°•ìˆ˜</th>
                    <th><span class="cs" style="background:#22c55e;"></span>ê±¸ìŒìˆ˜</th>
                    <th><span class="cs" style="background:#22c55e;"></span>ìˆ˜ë©´</th>
                    <th><span class="cs" style="background:#a855f7;"></span>ìˆœì‘ë„</th>
                    <th><span class="cs" style="background:#f97316;"></span>ì•±ì‚¬ìš©</th>
                  </tr></thead>
                  <tbody id="tBody"></tbody>
                </table>
              </div>
            </div>
            <div class="pag-row">
              <span>1-10 / 80ëª…</span>
              <div class="pag-btns"><button class="pg-btn">â—€</button><button class="pg-btn active">1</button><button class="pg-btn">2</button><button class="pg-btn">â€¦</button><button class="pg-btn">8</button><button class="pg-btn">â–¶</button></div>
            </div>
          </div>

          <!-- ë””í…Œì¼ íŒ¨ë„ (ì˜¤ë¥¸ìª½) -->
          <div class="detail-panel" id="detailPanel">
            <div class="dp-header">
              <div class="dp-title" id="dpTitle">P001 ê¹€ë¯¼ìˆ˜</div>
              <div style="display:flex;gap:8px;align-items:center;">
                <div class="dp-nav"><button id="dpPrev">â–² ì´ì „</button><button id="dpNext">â–¼ ë‹¤ìŒ</button></div>
                <button class="dp-close" id="dpClose">âœ•</button>
              </div>
            </div>
            <div class="dp-body" id="dpBody"></div>
          </div>
        </div>
      </div>

      <!-- ë””ìì´ë„ˆ ë…¸íŠ¸ -->
      <div class="dn-section">
        <details>
          <summary>ë””ìì´ë„ˆ ë…¸íŠ¸ â€” v3 ì „ëµ</summary>
          <div class="notes-c">
            <h4>í•µì‹¬: ë‘ íƒ­ì˜ ì—­í•  ì™„ì „ ë¶„ë¦¬</h4>
            <code>ê°œìš” = "ì´ ì—°êµ¬ ê´œì°®ì•„?" (ì½”í˜¸íŠ¸ ë ˆë²¨)
  â†’ KPI, íƒ€ì„ë¼ì¸ ê·¸ë˜í”„, êµ°ê°„ ë¹„êµ+pê°’, AI ì¸ì‚¬ì´íŠ¸, ìš´ì˜

í…Œì´ë¸” = "ì´ í™˜ì ê´œì°®ì•„?" (ê°œì¸ ë ˆë²¨)
  â†’ í™˜ì ë¦¬ìŠ¤íŠ¸ + ìš°ì¸¡ íŒ¨ë„ë¡œ ì‹œê³„ì—´ ìƒì„¸

ê²¹ì¹˜ëŠ” ê²ƒ = ì—†ìŒ</code>

            <h4>ì‹œê°„ ìœˆë„ìš° ìœ ì—°ì„± (v3 í•µì‹¬ ì¶”ê°€)</h4>
            ê³ ì • ë²„ì¼“(ì¼/ì£¼/ì›”) ì™¸ì— "ì»¤ìŠ¤í…€" ì˜µì…˜ ì¶”ê°€.<br>
            ì»¤ìŠ¤í…€ ì„ íƒ ì‹œ: [N] Ã— [ì¼/ì£¼/ì›”] ì…ë ¥ í•„ë“œ í‘œì‹œ.<br>
            ì˜ˆ: "ë§¤ 3ì¼", "ë§¤ 2ì£¼" ë“± ì—°êµ¬ìê°€ ììœ ë¡­ê²Œ ì„¤ì •.<br><br>
            <strong>ë°±ì—”ë“œ:</strong> TimescaleDBì˜ time_bucket($interval) ë˜ëŠ” ë™ë“±í•œ í•¨ìˆ˜ ì‚¬ìš©.<br>
            í”„ë¡ íŠ¸ì—ì„œ '3 days' â†’ APIì— interval='3d' ì „ë‹¬ â†’ DBê°€ ë™ì  ì§‘ê³„.<br><br>
            <strong>í–¥í›„ í™•ì¥:</strong><br>
            - ìŠ¤í„°ë”” ë°ì´ ê¸°ì¤€ (Day 0ë¶€í„° ìƒëŒ€ ì‹œê°„)<br>
            - ì´ë²¤íŠ¸ ê¸°ì¤€ (EMR ë°©ë¬¸ ì „í›„ Nì¼)<br>
            - ëª…ëª…ëœ ê¸°ê°„ (Baseline, Washout, Treatment Phase 1 ë“±)<br>
            - ì†ŒìŠ¤ë³„ ìë™ í•´ìƒë„ (EMR=ë°©ë¬¸ ë‹¨ìœ„, ì›¨ì–´ëŸ¬ë¸”=ì‹œê°„ ë‹¨ìœ„, EMA=ì‘ë‹µ ë‹¨ìœ„)<br>

            <h4>ë””í…Œì¼ íŒ¨ë„: ì•„ì½”ë””ì–¸ â†’ ì˜¤ë¥¸ìª½ ìŠ¬ë¼ì´ë“œ</h4>
            - ì•„ì½”ë””ì–¸(ì•„ë˜ í™•ì¥)ì€ í…Œì´ë¸” íë¦„ì„ ëŠì–´ í˜¼ë€<br>
            - ì˜¤ë¥¸ìª½ íŒ¨ë„: í…Œì´ë¸” 50% ì¶•ì†Œ, íŒ¨ë„ 50% ìŠ¬ë¼ì´ë“œ ì¸<br>
            - â–²â–¼ ë²„íŠ¼ìœ¼ë¡œ í™˜ì ê°„ ì´ë™ (í…Œì´ë¸” ë‹«ì§€ ì•Šê³ )<br>
            - íŒ¨ë„ ë‚´ìš©: í•µì‹¬ ì°¨íŠ¸ 3ê°œ + ì „ì²´ ì§€í‘œ í”Œë¡œìš°ì‹œíŠ¸<br>

            <h4>3ì¶• + ë‹¤ì°¨ì› ì»¤ë²„ë¦¬ì§€</h4>
            <code>ì¶•1: í™˜ì (Patient)  â†’ í…Œì´ë¸” í–‰
ì¶•2: ì§€í‘œ (Metric)   â†’ í…Œì´ë¸” ì—´ + íŒ¨ë„ ì°¨íŠ¸
ì¶•3: ì‹œê°„ (Time)     â†’ ë‚ ì§œ ë„¤ë¹„ + íŒ¨ë„ ì°¨íŠ¸ + ì»¤ìŠ¤í…€ ì¸í„°ë²Œ

ì¶”ê°€:
ì†ŒìŠ¤ (Source)  â†’ ì—´ í—¤ë” ì»¬ëŸ¬ + ì†ŒìŠ¤ í•„í„°
êµ° (Group)    â†’ ë±ƒì§€ + ê°œìš” ë¹„êµ í…Œì´ë¸”
í†µê³„ (pê°’)    â†’ ê°œìš” íƒ­ ì „ë‹´
AI ì¸ì‚¬ì´íŠ¸   â†’ ê°œìš” íƒ­ ì „ë‹´</code>
          </div>
        </details>
      </div>

    </div>
  </main>
</div>

<script>
// === íƒ­ ì „í™˜ ===
const tabs = document.querySelectorAll('.tab[data-tab]');
const navOverview = document.getElementById('nav-overview');
const navTable = document.getElementById('nav-table');

function switchTab(name) {
  tabs.forEach(t => t.classList.toggle('active', t.dataset.tab === name));
  document.getElementById('tc-overview').classList.toggle('active', name === 'overview');
  document.getElementById('tc-table').classList.toggle('active', name === 'table');
  navOverview.classList.toggle('active', name === 'overview');
  navTable.classList.toggle('active', name === 'table');
}
tabs.forEach(t => t.addEventListener('click', () => { if(t.dataset.tab) switchTab(t.dataset.tab); }));
navOverview.addEventListener('click', () => switchTab('overview'));
navTable.addEventListener('click', () => switchTab('table'));

// === ì»¤ìŠ¤í…€ ì‹œê°„ ìœˆë„ìš° ===
document.querySelectorAll('.tw-btn').forEach(btn => {
  btn.addEventListener('click', function() {
    document.querySelectorAll('.tw-btn').forEach(b => b.classList.remove('active'));
    this.classList.add('active');
    document.getElementById('customInterval').style.display = this.dataset.tw === 'custom' ? 'flex' : 'none';
  });
});

// === í™˜ì ë°ì´í„° ===
const P = [
  {id:'P001',nm:'ê¹€ë¯¼ìˆ˜',g:'exp',sv:'good',wt:[87.3,85.8,84.2,82.5,80.8,79.2],sbp:[134,132,128,126,124,122],hr:[72,71,69,68,67,66],steps:[7340,7800,8200,8600,8900,9104],sleep:[6.2,6.5,6.8,7,7.1,7.3],comp:[86,88,90,92,93,94],app:[40,42,48,52,56,62]},
  {id:'P005',nm:'ì´ìˆ˜ì§„',g:'exp',sv:'good',wt:[88.3,87.1,85.8,84.5,83.2,82.1],sbp:[132.5,131,129,127,125.5,124],hr:[72,71,70,70,69,69],steps:[6800,7100,7400,7600,7800,7812],sleep:[6,6.2,6.5,6.7,6.9,7],comp:[85,87,88,89,90,90],app:[32,35,38,40,42,45]},
  {id:'P011',nm:'ë°•ì§€í›ˆ',g:'exp',sv:'good',wt:[88.3,86.8,85.2,83.5,82,80.8],sbp:[134.2,132,130,128,126.5,125],hr:[72,71,69,68,68,67],steps:[7000,7500,7800,8100,8300,8512],sleep:[6.5,6.6,6.8,7,7.2,7.4],comp:[86,88,90,91,92,92],app:[36,40,44,48,52,54]},
  {id:'P018',nm:'ìµœì˜ˆë¦°',g:'exp',sv:'warn',al:true,wt:[87.4,86.2,85,83.8,82.6,81.6],sbp:[137.9,136,135,138,139,140],hr:[70,69,null,null,68,null],steps:[5800,6000,6100,6200,6200,6234],sleep:[5.8,6,6.2,6,5.9,5.8],comp:[82,84,86,88,89,89],app:[28,30,34,36,40,42]},
  {id:'P023',nm:'ì •í•˜ëŠ˜',g:'exp',sv:'good',wt:[87.6,86.4,85,83.6,82.4,81.2],sbp:[134.1,132,130,129,128,127],hr:[72,71,70,69,68,68],steps:[6900,7200,7500,7800,8000,8234],sleep:[6.3,6.5,6.7,6.9,7.1,7.2],comp:[85,87,89,90,91,91],app:[34,36,40,44,46,48]},
  {id:'P002',nm:'ìœ¤ì„œì—°',g:'ctrl',sv:'warn',wt:[87.7,87.8,87.9,88,88.1,88.2],sbp:[135.9,136,136.5,137,137.5,138],hr:[72,72,71,71,70,70],steps:[4600,4650,4700,4750,4800,4821],sleep:[6.1,6,6,5.9,5.9,5.8],comp:[85,86,86,87,87,88],app:[null,null,null,null,null,null]},
  {id:'P008',nm:'í•œë„ìœ¤',g:'ctrl',sv:'good',wt:[87.9,87.8,87.6,87.4,87.2,87.1],sbp:[133.1,133.5,133.8,134,134.2,134],hr:[72,72,72,72,72,72],steps:[4200,4200,4180,4190,4200,4201],sleep:[6.5,6.4,6.4,6.3,6.3,6.2],comp:[85,85,86,86,86,86],app:[40,39,38,38,38,38]},
  {id:'P014',nm:'ì†¡ì§€ì•„',g:'ctrl',sv:'good',wt:[87.9,87.8,87.8,87.8,87.8,87.8],sbp:[134.5,134.5,135,135,135,135],hr:[72,72,71,71,71,71],steps:[4500,4520,4550,4580,4600,4621],sleep:[6.2,6.2,6.1,6.1,6,6],comp:[85,85,86,86,87,87],app:[34,34,33,33,32,32]},
  {id:'P031',nm:'ì„ì±„ì›',g:'ctrl',sv:'bad',al:true,wt:[87.9,88,88.3,88.5,88.8,89.1],sbp:[134.2,135,136,137,137.5,138],hr:[73,73,74,74,75,75],steps:[4100,4000,3900,3850,3820,3821],sleep:[5.8,5.7,5.5,5.4,5.3,5.2],comp:[84,82,80,78,75,72],app:[28,26,25,24,23,22]},
  {id:'P036',nm:'ê°•ì‹œìš°',g:'ctrl',sv:'good',wt:[87,87,86.9,86.9,86.8,86.8],sbp:[131.8,132,132.5,132.8,133,133],hr:[74,74,73,73,72,72],steps:[4400,4420,4450,4480,4500,4521],sleep:[6.4,6.3,6.3,6.2,6.2,6.1],comp:[85,86,86,87,88,88],app:[40,39,38,38,38,38]},
];

const WK=['W1','W2','W3','W4','W5','W6'];
const M=[
  {k:'wt',n:'ì²´ì¤‘',u:'kg',d:'down',sc:'#3b82f6'},
  {k:'sbp',n:'SBP',u:'mmHg',d:'down',sc:'#3b82f6'},
  {k:'hr',n:'ì‹¬ë°•ìˆ˜',u:'bpm',d:'down',sc:'#22c55e'},
  {k:'steps',n:'ê±¸ìŒìˆ˜',u:'ë³´',d:'up',sc:'#22c55e'},
  {k:'sleep',n:'ìˆ˜ë©´',u:'h',d:'up',sc:'#22c55e'},
  {k:'comp',n:'ìˆœì‘ë„',u:'%',d:'up',sc:'#a855f7'},
  {k:'app',n:'ì•±ì‚¬ìš©',u:'ë¶„',d:'up',sc:'#f97316'},
];

function dl(a){if(!a||a[0]==null||a[5]==null)return null;return a[5]-a[0];}
function fD(d,m){
  if(d==null)return'<span class="ce">â€”</span>';
  const g=(m.d==='down'&&d<0)||(m.d==='up'&&d>0);
  const b=(m.d==='down'&&d>2)||(m.d==='up'&&d<-2);
  const ar=d>0?'â†‘':d<0?'â†“':'';
  const c=g?'good':b?'bad':'neutral';
  const v=m.k==='steps'?(d>0?'+':'')+Math.round(d).toLocaleString():m.k==='comp'||m.k==='app'?(d>0?'+':'')+d.toFixed(0)+'%':(d>0?'+':'')+d.toFixed(1);
  return`<span class="cd ${c}">${ar}${v}</span>`;
}
function fR(v,m){
  if(v==null)return'';
  if(m.k==='steps')return`<span class="cr">${Math.round(v).toLocaleString()}</span>`;
  if(m.k==='comp'||m.k==='app')return`<span class="cr">${v.toFixed(0)}${m.u}</span>`;
  return`<span class="cr">${v.toFixed(1)}${m.u}</span>`;
}
function cBg(d,m){
  if(d==null)return'';
  const g=(m.d==='down'&&d<-2)||(m.d==='up'&&d>2);
  const b=(m.d==='down'&&d>2)||(m.d==='up'&&d<-5);
  if(g)return'background:rgba(34,197,94,.05);';if(b)return'background:rgba(239,68,68,.05);';return'';
}

// SVG ì°¨íŠ¸
function mkSVG(arr,color,w,h){
  const vd=arr.map((v,i)=>v!=null?{v,i}:null).filter(Boolean);
  if(vd.length<2)return`<svg width="${w}" height="${h}"><text x="${w/2}" y="${h/2+4}" text-anchor="middle" fill="#d1d5db" font-size="10">ë°ì´í„° ì—†ìŒ</text></svg>`;
  const mn=Math.min(...vd.map(d=>d.v)),mx=Math.max(...vd.map(d=>d.v)),rg=mx-mn||1,pd=8;
  const pts=vd.map(d=>{const x=pd+(d.i/(arr.length-1))*(w-pd*2);const y=pd+(1-(d.v-mn)/rg)*(h-pd*2);return`${x},${y}`;});
  const ae=`${pd},${h-pd}`,af=`${pd+(vd[vd.length-1].i/(arr.length-1))*(w-pd*2)},${h-pd}`;
  return`<svg width="${w}" height="${h}"><polygon points="${ae} ${pts.join(' ')} ${af}" fill="${color}" opacity=".08"/><polyline points="${pts.join(' ')}" fill="none" stroke="${color}" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>${vd.map(d=>{const x=pd+(d.i/(arr.length-1))*(w-pd*2);const y=pd+(1-(d.v-mn)/rg)*(h-pd*2);return`<circle cx="${x}" cy="${y}" r="3" fill="white" stroke="${color}" stroke-width="1.5"/>`;}).join('')}</svg>`;
}

// í…Œì´ë¸” ë Œë”
const tBody=document.getElementById('tBody');
let selIdx=null;

P.forEach((p,i)=>{
  const tr=document.createElement('tr');
  if(p.al)tr.className='alert-row';
  let h=`<td class="pid"><span class="sv ${p.sv}"></span>${p.id}${p.al?'âš ï¸':''}<span class="gb ${p.g}">${p.g==='exp'?'ì‹¤í—˜':'ëŒ€ì¡°'}</span><br><span style="font-size:11px;color:#9ca3af;font-weight:400;">${p.nm}</span></td>`;
  M.forEach(m=>{const d=dl(p[m.k]);const v=p[m.k]?p[m.k][5]:null;h+=`<td style="${cBg(d,m)}">${fD(d,m)}${fR(v,m)}</td>`;});
  tr.innerHTML=h;
  tr.addEventListener('click',()=>openDetail(i));
  tBody.appendChild(tr);
});

// ë””í…Œì¼ íŒ¨ë„
const panel=document.getElementById('detailPanel');
const tableArea=document.getElementById('tableArea');
const dpTitle=document.getElementById('dpTitle');
const dpBody=document.getElementById('dpBody');

function openDetail(i){
  selIdx=i;
  const p=P[i];
  // ì„ íƒ í‘œì‹œ
  tBody.querySelectorAll('tr').forEach((r,ri)=>r.classList.toggle('selected',ri===i));
  // íŒ¨ë„ ì—´ê¸°
  tableArea.classList.add('shrunk');
  panel.classList.add('open');

  dpTitle.innerHTML=`<span class="sv ${p.sv}"></span>${p.id} ${p.nm} <span class="gb ${p.g}">${p.g==='exp'?'ì‹¤í—˜':'ëŒ€ì¡°'}</span>`;

  // ì°¨íŠ¸ 3ê°œ
  const cms=[M[0],M[3],M[5]]; // ì²´ì¤‘, ê±¸ìŒìˆ˜, ìˆœì‘ë„
  let ch=cms.map(m=>{
    const a=p[m.k]||[];const d=dl(a);
    const ds=d!=null?(d>0?'+':'')+(m.k==='steps'?Math.round(d).toLocaleString():m.k==='comp'?d.toFixed(0)+'%':d.toFixed(1)+m.u):'â€”';
    return`<div class="chart-card"><div class="chart-title"><span class="cs" style="background:${m.sc};"></span>${m.n} (${m.u})</div><div class="chart-area">${mkSVG(a,m.sc,300,100)}</div><div class="chart-x">${WK.map(w=>`<span>${w}</span>`).join('')}</div><div class="chart-summary"><span>W1: <strong>${a[0]!=null?(m.k==='steps'?Math.round(a[0]).toLocaleString():a[0].toFixed(1)):'â€”'}</strong></span><span>W6: <strong>${a[5]!=null?(m.k==='steps'?Math.round(a[5]).toLocaleString():a[5].toFixed(1)):'â€”'}</strong></span><span>Î”: <strong>${ds}</strong></span></div></div>`;
  }).join('');

  // í”Œë¡œìš°ì‹œíŠ¸
  let fs='<div class="fs-title">ğŸ“‹ ì „ì²´ ì§€í‘œ í”Œë¡œìš°ì‹œíŠ¸</div><table class="fs-table"><thead><tr><th>ì§€í‘œ</th>';
  WK.forEach(w=>fs+=`<th>${w}</th>`);fs+='</tr></thead><tbody>';
  M.forEach(m=>{
    const a=p[m.k]||[];
    fs+=`<tr><td><span style="display:inline-block;width:6px;height:6px;border-radius:2px;background:${m.sc};margin-right:4px;vertical-align:middle;"></span>${m.n}</td>`;
    a.forEach((v,j)=>{
      if(v==null){fs+='<td class="ce">â€”</td>';return;}
      const fmt=m.k==='steps'?Math.round(v).toLocaleString():m.k==='comp'||m.k==='app'?v.toFixed(0):v.toFixed(1);
      let cls='';
      if(j>0&&a[0]!=null){const dd=v-a[0];const ig=(m.d==='down'&&dd<-1)||(m.d==='up'&&dd>1);const ib=(m.d==='down'&&dd>1)||(m.d==='up'&&dd<-1);cls=ig?'fg':ib?'fb':'';}
      if(j===5)cls+=' fc';
      fs+=`<td class="${cls}">${fmt}</td>`;
    });
    fs+='</tr>';
  });
  fs+='</tbody></table>';

  dpBody.innerHTML=ch+fs;
}

document.getElementById('dpClose').addEventListener('click',()=>{
  panel.classList.remove('open');tableArea.classList.remove('shrunk');
  tBody.querySelectorAll('tr').forEach(r=>r.classList.remove('selected'));selIdx=null;
});
document.getElementById('dpPrev').addEventListener('click',()=>{if(selIdx>0)openDetail(selIdx-1);});
document.getElementById('dpNext').addEventListener('click',()=>{if(selIdx<P.length-1)openDetail(selIdx+1);});
</script>
</body>
</html>
