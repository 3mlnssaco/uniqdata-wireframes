<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>UniQdata â€” v7 íƒ€ì„ë¼ì¸ ê°œìš” + í…Œì´ë¸”</title>
<style>
*{margin:0;padding:0;box-sizing:border-box;}
body{font-family:-apple-system,BlinkMacSystemFont,'Segoe UI',sans-serif;background:#f5f5f5;color:#1f2937;font-size:13px;}
.layout{display:flex;height:100vh;overflow:hidden;}

/* ì‚¬ì´ë“œë°” */
.sidebar{width:210px;background:linear-gradient(180deg,#0f172a,#1e293b);color:white;display:flex;flex-direction:column;flex-shrink:0;}
.logo{padding:14px 18px;font-size:17px;font-weight:700;border-bottom:1px solid rgba(255,255,255,.1);display:flex;align-items:center;gap:8px;}
.logo-icon{width:26px;height:26px;background:linear-gradient(135deg,#3b82f6,#8b5cf6);border-radius:6px;display:flex;align-items:center;justify-content:center;font-size:13px;}
.nav-section{padding:10px;border-bottom:1px solid rgba(255,255,255,.05);}
.nav-item{display:flex;align-items:center;gap:8px;padding:7px 10px;border-radius:5px;color:#94a3b8;cursor:pointer;font-size:12px;}
.rn-header{display:flex;align-items:center;gap:5px;padding:5px 8px;border-radius:5px;font-size:11px;color:#60a5fa;background:rgba(59,130,246,.1);}
.rn-sub{padding-left:14px;margin-top:2px;border-left:2px solid rgba(255,255,255,.1);margin-left:12px;}
.ns-item{display:flex;align-items:center;gap:5px;padding:5px 8px;border-radius:4px;color:#94a3b8;font-size:10px;cursor:pointer;margin-bottom:1px;}
.ns-item:hover{background:rgba(255,255,255,.05);}
.ns-item.active{background:rgba(59,130,246,.15);color:#60a5fa;}
.sidebar-footer{margin-top:auto;padding:10px;border-top:1px solid rgba(255,255,255,.05);}
.u-av{width:28px;height:28px;background:linear-gradient(135deg,#3b82f6,#8b5cf6);border-radius:50%;display:flex;align-items:center;justify-content:center;font-size:11px;}

.main{flex:1;overflow:hidden;display:flex;flex-direction:column;}
.content{padding:16px 20px;flex:1;display:flex;flex-direction:column;overflow:hidden;min-height:0;}
.page-header{display:flex;justify-content:space-between;align-items:flex-start;margin-bottom:10px;flex-shrink:0;}
.page-title{font-size:17px;font-weight:700;}
.page-sub{color:#6b7280;font-size:11px;margin-top:2px;}
.study-status{display:flex;align-items:center;gap:6px;padding:5px 10px;background:white;border:1px solid #e5e7eb;border-radius:6px;font-size:11px;}
.st-dot{width:8px;height:8px;border-radius:50%;}
.st-dot.active{background:#22c55e;}.st-dot.paused{background:#f59e0b;}.st-dot.done{background:#3b82f6;}

.tabs{display:flex;border-bottom:2px solid #e5e7eb;margin-bottom:10px;flex-shrink:0;}
.tab{padding:7px 18px;font-size:12px;color:#6b7280;cursor:pointer;border-bottom:2px solid transparent;margin-bottom:-2px;font-weight:500;user-select:none;}
.tab.active{color:#3b82f6;border-bottom-color:#3b82f6;}

.tab-content{display:none;flex:1;min-height:0;overflow:hidden;}
.tab-content.active{display:flex;flex-direction:column;flex:1;min-height:0;}

/* ===== ê°œìš” íƒ­ ===== */
.ov-scroll{flex:1;overflow-y:auto;overflow-x:hidden;}

/* 1. ì—°êµ¬ íŒë‹¨ ìŠ¤íŠ¸ë¦½ */
.verdict-strip{display:flex;gap:8px;margin-bottom:10px;}
.verdict-card{flex:1;background:white;border:1px solid #e5e7eb;border-radius:8px;padding:10px 14px;position:relative;overflow:hidden;}
.verdict-card.primary{border-left:3px solid #3b82f6;}
.verdict-card.warn{border-left:3px solid #f59e0b;}
.verdict-card.ok{border-left:3px solid #22c55e;}
.vc-label{font-size:9px;color:#6b7280;text-transform:uppercase;letter-spacing:.5px;margin-bottom:3px;}
.vc-value{font-size:16px;font-weight:700;}
.vc-sub{font-size:10px;color:#6b7280;margin-top:2px;}
.vc-bar{height:3px;background:#f3f4f6;border-radius:2px;margin-top:6px;overflow:hidden;}
.vc-fill{height:100%;border-radius:2px;}

/* 2. íƒ€ì„ë¼ì¸ */
.timeline-section{background:white;border:1px solid #e5e7eb;border-radius:8px;padding:14px 18px;margin-bottom:10px;}
.tl-header{display:flex;justify-content:space-between;align-items:center;margin-bottom:10px;}
.tl-title{font-size:12px;font-weight:600;color:#374151;}
.tl-toggle{display:flex;gap:3px;font-size:10px;}
.tl-toggle button{padding:2px 8px;border:1px solid #e5e7eb;border-radius:4px;background:white;color:#6b7280;cursor:pointer;font-size:10px;}
.tl-toggle button.active{background:#3b82f6;color:white;border-color:#3b82f6;}

/* íƒ€ì„ë¼ì¸ ë°” */
.tl-bar{position:relative;height:36px;background:#f9fafb;border-radius:6px;overflow:visible;margin-bottom:6px;}
.tl-phase{position:absolute;top:0;height:100%;display:flex;align-items:center;justify-content:center;font-size:9px;font-weight:600;color:white;border-radius:4px;transition:all .2s;}
.tl-phase.screening{background:#94a3b8;}
.tl-phase.enrollment{background:#6366f1;}
.tl-phase.baseline{background:#3b82f6;}
.tl-phase.treatment{background:#0ea5e9;}
.tl-phase.followup{background:#14b8a6;}
.tl-phase.analysis{background:#8b5cf6;}
.tl-phase.future{opacity:.4;border:2px dashed;background:transparent;color:#6b7280;}
.tl-phase.future.treatment{border-color:#0ea5e9;}.tl-phase.future.followup{border-color:#14b8a6;}.tl-phase.future.analysis{border-color:#8b5cf6;}

/* Now ë¼ì¸ */
.tl-now{position:absolute;top:-4px;height:calc(100% + 8px);width:2px;background:#ef4444;z-index:10;}
.tl-now::after{content:'ì˜¤ëŠ˜';position:absolute;top:-14px;left:50%;transform:translateX(-50%);font-size:8px;color:#ef4444;font-weight:600;white-space:nowrap;}

/* íƒ€ì„ë¼ì¸ í•˜ë‹¨ ë¼ë²¨ */
.tl-labels{display:flex;justify-content:space-between;font-size:9px;color:#9ca3af;padding:0 2px;}

/* ë§ˆì¼ìŠ¤í†¤ */
.tl-milestones{display:flex;gap:16px;margin-top:8px;flex-wrap:wrap;}
.ms{display:flex;align-items:center;gap:4px;font-size:10px;color:#6b7280;}
.ms-dot{width:6px;height:6px;border-radius:50%;}
.ms-dot.done{background:#22c55e;}.ms-dot.now{background:#ef4444;}.ms-dot.future{background:#d1d5db;}

/* 3. í•µì‹¬ ì§€í‘œ ê·¸ë¦¬ë“œ (2Ã—3) */
.metrics-grid{display:grid;grid-template-columns:repeat(3,1fr);gap:8px;margin-bottom:10px;}
.metric-card{background:white;border:1px solid #e5e7eb;border-radius:8px;padding:12px;position:relative;cursor:default;}
.mc-header{display:flex;justify-content:space-between;align-items:flex-start;margin-bottom:6px;}
.mc-name{font-size:11px;font-weight:600;color:#374151;display:flex;align-items:center;gap:4px;}
.mc-name .dot{width:5px;height:5px;border-radius:50%;}
.mc-badge{font-size:8px;font-weight:600;padding:1px 5px;border-radius:3px;}
.mc-badge.sig{background:#dcfce7;color:#166534;}.mc-badge.ns{background:#f3f4f6;color:#6b7280;}.mc-badge.alert{background:#fef3c7;color:#92400e;}
.mc-chart{height:60px;position:relative;}
.mc-chart canvas{width:100%;height:100%;}
.mc-footer{display:flex;justify-content:space-between;align-items:center;margin-top:4px;}
.mc-delta{font-size:11px;font-weight:700;font-family:'SF Mono',Monaco,monospace;}
.mc-delta.good{color:#16a34a;}.mc-delta.bad{color:#dc2626;}.mc-delta.neutral{color:#6b7280;}
.mc-range{font-size:9px;color:#9ca3af;}

/* ì°¨íŠ¸ ë‚´ now-line */
.mc-now{position:absolute;top:0;height:100%;width:1px;background:#ef4444;opacity:.5;z-index:5;}

/* 4. AI ì¸ì‚¬ì´íŠ¸ (ì•Œë¦¼ ìŠ¤íŠ¸ë¦½) */
.ai-strip{background:white;border:1px solid #e5e7eb;border-radius:8px;padding:10px 14px;margin-bottom:10px;}
.ai-title{font-size:10px;font-weight:600;color:#6b7280;text-transform:uppercase;letter-spacing:.5px;margin-bottom:6px;}
.ai-items{display:flex;flex-direction:column;gap:4px;}
.ai-item{display:flex;align-items:flex-start;gap:8px;padding:6px 10px;border-radius:6px;font-size:11px;line-height:1.4;}
.ai-item.alert{background:#fef3c7;color:#92400e;}
.ai-item.finding{background:#f0fdf4;color:#166534;}
.ai-item.info{background:#eff6ff;color:#1e40af;}
.ai-icon{font-size:13px;flex-shrink:0;margin-top:1px;}
.ai-text b{font-weight:600;}
.ai-time{font-size:9px;color:#9ca3af;margin-left:auto;flex-shrink:0;white-space:nowrap;}

/* ===== í…Œì´ë¸” íƒ­ (ê¸°ì¡´ ìœ ì§€) ===== */
.table-area-wrap{display:flex;flex:1;min-height:0;overflow:hidden;}
.table-area{flex:1;min-width:0;overflow-y:auto;overflow-x:auto;display:flex;flex-direction:column;transition:flex .3s ease;}
.table-area.shrunk{flex:0 0 50%;}
.ctrl-section{background:white;border:1px solid #e5e7eb;border-radius:8px;padding:8px 14px;margin-bottom:6px;flex-shrink:0;}
.ctrl-row{display:flex;gap:10px;align-items:center;flex-wrap:wrap;}
.ctrl-group{display:flex;align-items:center;gap:5px;}
.ctrl-group label{font-size:10px;color:#6b7280;font-weight:600;}
.t-btn{padding:3px 7px;border:1px solid #e5e7eb;border-radius:4px;background:white;color:#6b7280;cursor:pointer;font-size:10px;}
.t-btn.active{background:#3b82f6;color:white;border-color:#3b82f6;}
.sel-sm{padding:3px 5px;border:1px solid #e5e7eb;border-radius:4px;font-size:10px;background:white;}
.dn-ctrl{display:flex;align-items:center;gap:4px;padding:3px 6px;background:#f9fafb;border:1px solid #e5e7eb;border-radius:4px;font-size:10px;}
.dn-ctrl button{background:none;border:none;cursor:pointer;font-size:11px;color:#3b82f6;}
.search-in{padding:3px 5px;border:1px solid #e5e7eb;border-radius:4px;font-size:10px;width:110px;}

.src-legend{display:flex;gap:8px;align-items:center;margin-bottom:3px;font-size:9px;color:#6b7280;flex-shrink:0;}
.sd{width:6px;height:6px;border-radius:2px;display:inline-block;}
.sd.emr{background:#3b82f6;}.sd.wear{background:#22c55e;}.sd.ema{background:#a855f7;}

.tbl-section{background:white;border:1px solid #e5e7eb;border-radius:8px;overflow:hidden;flex:1;display:flex;flex-direction:column;min-height:0;}
.tbl-wrap{overflow-y:auto;overflow-x:auto;flex:1;min-height:0;}
table.pt-tbl{width:100%;border-collapse:collapse;font-size:11px;}
table.pt-tbl thead th{text-align:left;font-size:9px;color:#6b7280;font-weight:600;padding:6px 5px;border-bottom:2px solid #e5e7eb;background:#f9fafb;position:sticky;top:0;z-index:10;white-space:nowrap;}
table.pt-tbl thead th .cs{display:inline-block;width:4px;height:4px;border-radius:2px;margin-right:2px;vertical-align:middle;}
table.pt-tbl tbody td{padding:6px 5px;border-bottom:1px solid #f1f5f9;font-size:10px;}
table.pt-tbl tbody tr{cursor:pointer;transition:background .1s;}
table.pt-tbl tbody tr:hover{background:#f8fafc;}
table.pt-tbl tbody tr.selected{background:#eff6ff;}
table.pt-tbl tbody tr.alert-row{background:#fffbeb;}
.pid{font-weight:600;color:#374151;white-space:nowrap;}
.gb{display:inline-block;padding:1px 3px;border-radius:3px;font-size:8px;font-weight:600;margin-left:3px;}
.gb.exp{background:#dbeafe;color:#1d4ed8;}.gb.ctrl{background:#fce7f3;color:#be185d;}
.sv{display:inline-block;width:4px;height:4px;border-radius:50%;margin-right:3px;}
.sv.good{background:#22c55e;}.sv.warn{background:#f59e0b;}.sv.bad{background:#ef4444;}
.cd{font-weight:700;font-family:'SF Mono',Monaco,monospace;font-size:10px;}
.cd.good{color:#16a34a;}.cd.bad{color:#dc2626;}.cd.neutral{color:#6b7280;}
.cr{font-size:9px;color:#9ca3af;display:block;}
.ce{color:#d1d5db;font-style:italic;}

.pag-row{display:flex;align-items:center;justify-content:space-between;padding:6px 12px;background:white;border:1px solid #e5e7eb;border-radius:8px;font-size:10px;color:#6b7280;flex-shrink:0;margin-top:6px;}

/* ë””í…Œì¼ íŒ¨ë„ */
.detail-panel{width:0;overflow:hidden;border-left:1px solid #e5e7eb;background:white;transition:width .3s ease;flex-shrink:0;display:flex;flex-direction:column;max-height:100%;}
.detail-panel.open{width:50%;}
.dp-header{display:flex;justify-content:space-between;align-items:center;padding:10px 14px;border-bottom:1px solid #e5e7eb;background:#f9fafb;flex-shrink:0;}
.dp-title{font-size:13px;font-weight:700;color:#374151;display:flex;align-items:center;gap:4px;}
.dp-close{padding:3px 7px;border:1px solid #e5e7eb;border-radius:4px;background:white;cursor:pointer;font-size:11px;color:#6b7280;}
.dp-nav{display:flex;gap:3px;}
.dp-nav button{padding:2px 5px;border:1px solid #e5e7eb;border-radius:4px;background:white;cursor:pointer;font-size:10px;}
.dp-body{flex:1;overflow-y:auto;padding:12px;}
.chart-card{background:#f9fafb;border:1px solid #e5e7eb;border-radius:6px;padding:10px;margin-bottom:10px;}
.chart-card-title{font-size:10px;font-weight:600;color:#374151;margin-bottom:4px;}
.mini-chart{height:65px;}
.mini-chart svg{width:100%;height:100%;}
.chart-x{display:flex;justify-content:space-between;font-size:7px;color:#9ca3af;margin-top:1px;}
.chart-sum{display:flex;gap:8px;margin-top:3px;font-size:9px;color:#6b7280;}
.chart-sum strong{color:#374151;}
.fs-title{font-size:10px;font-weight:600;color:#374151;margin:10px 0 4px;}
.fs-table{width:100%;border-collapse:collapse;font-size:9px;}
.fs-table th{font-size:8px;color:#9ca3af;font-weight:600;padding:3px;border-bottom:1px solid #e5e7eb;text-align:center;}
.fs-table th:first-child{text-align:left;}
.fs-table td{padding:3px;text-align:center;border-bottom:1px solid #f1f5f9;font-family:'SF Mono',Monaco,monospace;font-size:8px;}
.fs-table td:first-child{text-align:left;font-weight:600;color:#374151;font-family:-apple-system,sans-serif;}
.fg{color:#16a34a;background:rgba(34,197,94,.05);}.fb{color:#dc2626;background:rgba(239,68,68,.05);}.fc{font-weight:700;outline:1.5px solid #3b82f6;border-radius:2px;}
</style>
</head>
<body>
<div class="layout">
  <nav class="sidebar">
    <div class="logo"><div class="logo-icon">U</div>UniQdata</div>
    <div class="nav-section"><a class="nav-item">ğŸ  ì—°êµ¬ í—ˆë¸Œ</a></div>
    <div class="nav-section" style="flex:1;overflow-y:auto;">
      <div style="font-size:9px;color:#64748b;padding:5px 8px;">ë‚´ ì—°êµ¬</div>
      <div class="rn-header">ğŸ“ ëŒ€ì‚¬ê°œì„  ì•½ë¬¼ ì—°êµ¬</div>
      <div class="rn-sub">
        <a class="ns-item active" id="nav-ov">ê°œìš”</a>
        <a class="ns-item" id="nav-tb">í…Œì´ë¸”</a>
        <a class="ns-item">ğŸ”’ í´ë¦°ë£¸</a>
      </div>
    </div>
    <div class="sidebar-footer"><div style="display:flex;align-items:center;gap:8px;padding:4px;"><div class="u-av">ê¹€</div><div><div style="font-size:12px;color:#e2e8f0;">ê¹€ì—°êµ¬</div><div style="font-size:10px;color:#64748b;">ì„œìš¸ëŒ€í•™êµë³‘ì›</div></div></div></div>
  </nav>

  <main class="main">
    <div class="content">
      <div class="page-header">
        <div>
          <div class="page-title">ëŒ€ì‚¬ê°œì„  ì•½ë¬¼ ì—°êµ¬</div>
          <div class="page-sub">ì²˜ë°© ì•½ë¬¼(2.4mg) Â· RCT Â· ì‹¤í—˜ 40 / ëŒ€ì¡° 40 Â· 12ì£¼(84ì¼) Â· IRB 2025-0847</div>
        </div>
        <div class="study-status"><span class="st-dot active"></span><b>ì§„í–‰ ì¤‘</b> Â· 6ì£¼ì°¨ / 12ì£¼</div>
      </div>

      <div class="tabs">
        <div class="tab active" data-tab="overview" id="tab-ov">ê°œìš”</div>
        <div class="tab" data-tab="table" id="tab-tb">í…Œì´ë¸”</div>
        <div class="tab">ğŸ”’ í´ë¦°ë£¸</div>
      </div>

      <!-- ===== ê°œìš” íƒ­ ===== -->
      <div class="tab-content active" id="tc-ov">
        <div class="ov-scroll">

          <!-- 1. ì—°êµ¬ íŒë‹¨ ìŠ¤íŠ¸ë¦½: "ì´ ì—°êµ¬ ê´œì°®ì•„?" ì— ëŒ€í•œ ì¦‰ë‹µ -->
          <div class="verdict-strip">
            <div class="verdict-card primary">
              <div class="vc-label">ê²€ì •ë ¥ (Power)</div>
              <div class="vc-value">92% <span style="font-size:11px;color:#22c55e;">âœ“ ì¶©ë¶„</span></div>
              <div class="vc-sub">ëª©í‘œ N=80 ì¤‘ 76ëª… í™œì„± Â· 4ëª… íƒˆë½</div>
              <div class="vc-bar"><div class="vc-fill" style="width:92%;background:#3b82f6;"></div></div>
            </div>
            <div class="verdict-card ok">
              <div class="vc-label">1ì°¨ ê²°ê³¼ë³€ìˆ˜ íš¨ê³¼</div>
              <div class="vc-value" style="color:#16a34a;">âˆ’6.8kg <span style="font-size:11px;">p<0.001***</span></div>
              <div class="vc-sub">ì‹¤í—˜êµ° í‰ê·  ì²´ì¤‘ ë³€í™” (vs ëŒ€ì¡° âˆ’0.6kg)</div>
              <div class="vc-bar"><div class="vc-fill" style="width:85%;background:#22c55e;"></div></div>
            </div>
            <div class="verdict-card warn">
              <div class="vc-label">ì£¼ì˜ í•„ìš”</div>
              <div class="vc-value" style="color:#d97706;">2ê±´</div>
              <div class="vc-sub">P018 SBP ë°˜ë“± Â· P031 ìˆœì‘ë„ ê¸‰ë½</div>
            </div>
            <div class="verdict-card ok">
              <div class="vc-label">ë°ì´í„° ì™„ì„±ë„</div>
              <div class="vc-value">94% <span style="font-size:11px;color:#22c55e;">ì–‘í˜¸</span></div>
              <div class="vc-sub">ê²°ì¸¡ 6.2% Â· ì¿¼ë¦¬ í•´ê²°ë¥  98%</div>
              <div class="vc-bar"><div class="vc-fill" style="width:94%;background:#22c55e;"></div></div>
            </div>
          </div>

          <!-- 2. íƒ€ì„ë¼ì¸: ê³¼ê±°/í˜„ì¬/ë¯¸ë˜ -->
          <div class="timeline-section">
            <div class="tl-header">
              <div class="tl-title">ì—°êµ¬ íƒ€ì„ë¼ì¸</div>
              <div class="tl-toggle">
                <button class="active" id="tlCal">ìº˜ë¦°ë”</button>
                <button id="tlDay">Study Day</button>
              </div>
            </div>

            <div class="tl-bar" id="tlBar">
              <!-- ìŠ¤í¬ë¦¬ë‹: 0~5% -->
              <div class="tl-phase screening" style="left:0;width:5%;">SCR</div>
              <!-- ë“±ë¡: 5~15% -->
              <div class="tl-phase enrollment" style="left:5%;width:10%;">ë“±ë¡</div>
              <!-- ë² ì´ìŠ¤ë¼ì¸: 15~20% -->
              <div class="tl-phase baseline" style="left:15%;width:5%;">BL</div>
              <!-- ì¹˜ë£Œ(ê³¼ê±°): 20~50% -->
              <div class="tl-phase treatment" style="left:20%;width:30%;">ì¹˜ë£Œ (W1~W6)</div>
              <!-- NOW ë¼ì¸: 50% -->
              <div class="tl-now" style="left:50%;" id="tlNow"></div>
              <!-- ì¹˜ë£Œ(ë¯¸ë˜): 50~70% -->
              <div class="tl-phase future treatment" style="left:50%;width:20%;">W7~W12</div>
              <!-- ì¶”ì (ë¯¸ë˜): 70~85% -->
              <div class="tl-phase future followup" style="left:70%;width:15%;">ì¶”ì </div>
              <!-- ë¶„ì„(ë¯¸ë˜): 85~100% -->
              <div class="tl-phase future analysis" style="left:85%;width:15%;">ë¶„ì„</div>
            </div>
            <div class="tl-labels" id="tlLabels">
              <span>2025.11.01</span>
              <span>12.01</span>
              <span>12.15</span>
              <span>2026.01.15</span>
              <span id="tlNowLabel" style="color:#ef4444;font-weight:600;">02.16 (ì˜¤ëŠ˜)</span>
              <span>03.30</span>
              <span>05.01</span>
              <span>06.15</span>
            </div>

            <div class="tl-milestones">
              <div class="ms"><span class="ms-dot done"></span>IRB ìŠ¹ì¸ (11/01)</div>
              <div class="ms"><span class="ms-dot done"></span>ì²« í™˜ì ë“±ë¡ (12/01)</div>
              <div class="ms"><span class="ms-dot done"></span>ë“±ë¡ ì™„ë£Œ (12/15)</div>
              <div class="ms"><span class="ms-dot now"></span>ì¤‘ê°„ë¶„ì„ (ì˜¤ëŠ˜, W6)</div>
              <div class="ms"><span class="ms-dot future"></span>ì¹˜ë£Œ ì¢…ë£Œ (03/30)</div>
              <div class="ms"><span class="ms-dot future"></span>ë°ì´í„° ì ê¸ˆ (05/15)</div>
              <div class="ms"><span class="ms-dot future"></span>ìµœì¢…ë¶„ì„ (06/01)</div>
            </div>
          </div>

          <!-- 3. í•µì‹¬ ì§€í‘œ ê·¸ë¦¬ë“œ â€” ê³¼ê±°(ì‹¤ì„ ) + ë¯¸ë˜(ì ì„ ) -->
          <div class="metrics-grid" id="metricsGrid">
            <!-- JSë¡œ ìƒì„± -->
          </div>

          <!-- 4. AI ì¸ì‚¬ì´íŠ¸ ìŠ¤íŠ¸ë¦½ -->
          <div class="ai-strip">
            <div class="ai-title">AI ë°œê²¬ ì‚¬í•­</div>
            <div class="ai-items">
              <div class="ai-item alert">
                <span class="ai-icon">âš ï¸</span>
                <span class="ai-text"><b>P018 ìµœì˜ˆë¦°:</b> SBP W5ë¶€í„° ë°˜ë“± (135â†’140mmHg). ì•½ë¬¼ ë‚´ì„± ê°€ëŠ¥ì„±. í”„ë¡œí† ì½œ 4.2ì¡° "í˜ˆì•• ë°˜ë“± ì‹œ ìš©ëŸ‰ ì¬ì¡°ì •" í•´ë‹¹ ì—¬ë¶€ í™•ì¸ í•„ìš”.</span>
                <span class="ai-time">2ì‹œê°„ ì „</span>
              </div>
              <div class="ai-item alert">
                <span class="ai-icon">ğŸ“‰</span>
                <span class="ai-text"><b>P031 ì„ì±„ì›:</b> ìˆœì‘ë„ W4ë¶€í„° ì§€ì† í•˜ë½ (84%â†’72%). íƒˆë½ ìœ„í—˜. ì „í™” ìƒë‹´ ë˜ëŠ” ë°©ë¬¸ ì¼ì • í™•ì¸ ê¶Œì¥.</span>
                <span class="ai-time">1ì¼ ì „</span>
              </div>
              <div class="ai-item finding">
                <span class="ai-icon">âœ…</span>
                <span class="ai-text"><b>1ì°¨ ê²°ê³¼ë³€ìˆ˜ ìœ ì˜ë¯¸:</b> ì²´ì¤‘ ê°ì†Œ êµ°ê°„ ì°¨ì´ 6.2kg (95% CI: 4.8â€“7.6). í˜„ì¬ ì¶”ì„¸ ìœ ì§€ ì‹œ W12ì—ì„œ íš¨ê³¼ í¬ê¸° Cohen's d=1.2 ì˜ˆìƒ.</span>
                <span class="ai-time">ì˜¤ëŠ˜</span>
              </div>
              <div class="ai-item info">
                <span class="ai-icon">ğŸ“Š</span>
                <span class="ai-text"><b>ê±¸ìŒìˆ˜ 2ì°¨ ê²°ê³¼:</b> ì‹¤í—˜êµ° +1,764ë³´/ì£¼ ì¦ê°€, ëŒ€ì¡°êµ° ë³€í™” ì—†ìŒ. W12 ì˜ˆì¸¡: ì‹¤í—˜êµ° 10,200ë³´ ë„ë‹¬ ê°€ëŠ¥. p=0.008**</span>
                <span class="ai-time">ì˜¤ëŠ˜</span>
              </div>
            </div>
          </div>

        </div>
      </div>

      <!-- ===== í…Œì´ë¸” íƒ­ ===== -->
      <div class="tab-content" id="tc-tb">
        <div class="ctrl-section">
          <div class="ctrl-row">
            <div class="ctrl-group"><label>ì‹œê°„</label><div style="display:flex;gap:2px;"><button class="t-btn active">ì£¼ê°„</button><button class="t-btn">ì›”ê°„</button></div></div>
            <div class="ctrl-group"><label>ì†ŒìŠ¤</label><select class="sel-sm"><option>ì „ì²´</option></select></div>
            <div class="ctrl-group"><div class="dn-ctrl"><button>â—€</button><span>W6</span><button>â–¶</button></div></div>
            <div class="ctrl-group" style="margin-left:auto;"><input type="text" class="search-in" placeholder="í™˜ì ê²€ìƒ‰..."></div>
          </div>
        </div>
        <div class="src-legend">
          <span><span class="sd emr"></span> EMR</span>
          <span><span class="sd wear"></span> ì›¨ì–´ëŸ¬ë¸”</span>
          <span><span class="sd ema"></span> EMA</span>
          <span style="margin-left:auto;color:#9ca3af;">í–‰ í´ë¦­ â†’ ìƒì„¸</span>
        </div>
        <div class="table-area-wrap">
          <div class="table-area" id="tableArea">
            <div class="tbl-section"><div class="tbl-wrap">
              <table class="pt-tbl">
                <thead><tr>
                  <th style="width:12%;">í™˜ì</th>
                  <th><span class="cs" style="background:#3b82f6;"></span>ì²´ì¤‘</th>
                  <th><span class="cs" style="background:#3b82f6;"></span>SBP</th>
                  <th><span class="cs" style="background:#22c55e;"></span>ì‹¬ë°•ìˆ˜</th>
                  <th><span class="cs" style="background:#22c55e;"></span>ê±¸ìŒìˆ˜</th>
                  <th><span class="cs" style="background:#22c55e;"></span>ìˆ˜ë©´</th>
                  <th><span class="cs" style="background:#a855f7;"></span>ìˆœì‘ë„</th>
                  <th><span class="cs" style="background:#f97316;"></span>ì•±</th>
                </tr></thead>
                <tbody id="tBody"></tbody>
              </table>
            </div></div>
            <div class="pag-row"><span>1-10 / 80ëª…</span><div style="display:flex;gap:2px;"><button class="t-btn" style="padding:2px 5px;">â—€</button><button class="t-btn active" style="padding:2px 5px;">1</button><button class="t-btn" style="padding:2px 5px;">2</button><button class="t-btn" style="padding:2px 5px;">â–¶</button></div></div>
          </div>
          <div class="detail-panel" id="detailPanel">
            <div class="dp-header">
              <div class="dp-title" id="dpTitle"></div>
              <div style="display:flex;gap:3px;align-items:center;">
                <div class="dp-nav"><button id="dpPrev">â–²</button><button id="dpNext">â–¼</button></div>
                <button class="dp-close" id="dpClose">âœ•</button>
              </div>
            </div>
            <div class="dp-body" id="dpBody"></div>
          </div>
        </div>
      </div>
    </div>
  </main>
</div>

<script>
// ===== ë°ì´í„° =====
const WK_PAST=['W1','W2','W3','W4','W5','W6'];
const WK_FUTURE=['W7','W8','W9','W10','W11','W12'];
const WK_ALL=[...WK_PAST,...WK_FUTURE];

const METRICS=[
  {k:'wt',n:'ì²´ì¤‘',u:'kg',d:'down',sc:'#3b82f6',src:'EMR'},
  {k:'sbp',n:'SBP',u:'mmHg',d:'down',sc:'#6366f1',src:'EMR'},
  {k:'hr',n:'ì‹¬ë°•ìˆ˜',u:'bpm',d:'down',sc:'#22c55e',src:'ì›¨ì–´'},
  {k:'steps',n:'ê±¸ìŒìˆ˜',u:'ë³´',d:'up',sc:'#14b8a6',src:'ì›¨ì–´'},
  {k:'comp',n:'ìˆœì‘ë„',u:'%',d:'up',sc:'#a855f7',src:'EMA'},
  {k:'sleep',n:'ìˆ˜ë©´',u:'h',d:'up',sc:'#f59e0b',src:'ì›¨ì–´'},
];

// ê³¼ê±°(W1-W6 ì‹¤ì¦) + ë¯¸ë˜(W7-W12 ì˜ˆì¸¡)
const EXP_DATA=[
  {id:'P001',past:{wt:[87.3,85.8,84.2,82.5,80.8,79.2],sbp:[134,132,128,126,124,122],hr:[72,71,69,68,67,66],steps:[7340,7800,8200,8600,8900,9104],comp:[86,88,90,92,93,94],sleep:[6.2,6.5,6.8,7,7.1,7.3]}},
  {id:'P005',past:{wt:[88.3,87.1,85.8,84.5,83.2,82.1],sbp:[132.5,131,129,127,125.5,124],hr:[72,71,70,70,69,69],steps:[6800,7100,7400,7600,7800,7812],comp:[85,87,88,89,90,90],sleep:[6,6.2,6.5,6.7,6.9,7]}},
  {id:'P011',past:{wt:[88.3,86.8,85.2,83.5,82,80.8],sbp:[134.2,132,130,128,126.5,125],hr:[72,71,69,68,68,67],steps:[7000,7500,7800,8100,8300,8512],comp:[86,88,90,91,92,92],sleep:[6.5,6.6,6.8,7,7.2,7.4]}},
  {id:'P018',past:{wt:[87.4,86.2,85,83.8,82.6,81.6],sbp:[137.9,136,135,138,139,140],hr:[70,69,null,null,68,null],steps:[5800,6000,6100,6200,6200,6234],comp:[82,84,86,88,89,89],sleep:[5.8,6,6.2,6,5.9,5.8]}},
  {id:'P023',past:{wt:[87.6,86.4,85,83.6,82.4,81.2],sbp:[134.1,132,130,129,128,127],hr:[72,71,70,69,68,68],steps:[6900,7200,7500,7800,8000,8234],comp:[85,87,89,90,91,91],sleep:[6.3,6.5,6.7,6.9,7.1,7.2]}},
];
const CTRL_DATA=[
  {id:'P002',past:{wt:[87.7,87.8,87.9,88,88.1,88.2],sbp:[135.9,136,136.5,137,137.5,138],hr:[72,72,71,71,70,70],steps:[4600,4650,4700,4750,4800,4821],comp:[85,86,86,87,87,88],sleep:[6.1,6,6,5.9,5.9,5.8]}},
  {id:'P008',past:{wt:[87.9,87.8,87.6,87.4,87.2,87.1],sbp:[133.1,133.5,133.8,134,134.2,134],hr:[72,72,72,72,72,72],steps:[4200,4200,4180,4190,4200,4201],comp:[85,85,86,86,86,86],sleep:[6.5,6.4,6.4,6.3,6.3,6.2]}},
  {id:'P014',past:{wt:[87.9,87.8,87.8,87.8,87.8,87.8],sbp:[134.5,134.5,135,135,135,135],hr:[72,72,71,71,71,71],steps:[4500,4520,4550,4580,4600,4621],comp:[85,85,86,86,87,87],sleep:[6.2,6.2,6.1,6.1,6,6]}},
  {id:'P031',past:{wt:[87.9,88,88.3,88.5,88.8,89.1],sbp:[134.2,135,136,137,137.5,138],hr:[73,73,74,74,75,75],steps:[4100,4000,3900,3850,3820,3821],comp:[84,82,80,78,75,72],sleep:[5.8,5.7,5.5,5.4,5.3,5.2]}},
  {id:'P036',past:{wt:[87,87,86.9,86.9,86.8,86.8],sbp:[131.8,132,132.5,132.8,133,133],hr:[74,74,73,73,72,72],steps:[4400,4420,4450,4480,4500,4521],comp:[85,86,86,87,88,88],sleep:[6.4,6.3,6.3,6.2,6.2,6.1]}},
];

// êµ° í‰ê·  + ë¯¸ë˜ ì˜ˆì¸¡ (ì„ í˜• ì™¸ì‚½)
function groupAvg(patients,k){return WK_PAST.map((_,i)=>{const vs=patients.map(p=>p.past[k]?p.past[k][i]:null).filter(v=>v!=null);return vs.length?vs.reduce((a,b)=>a+b,0)/vs.length:null;});}
function project(past,n){const l=past.length;if(l<2)return Array(n).fill(null);const slope=(past[l-1]-past[l-3])/(2);return Array.from({length:n},(_,i)=>Math.round((past[l-1]+slope*(i+1))*10)/10);}

const PVALS={wt:'p<0.001***',sbp:'p=0.012*',hr:'p=0.034*',steps:'p=0.008**',comp:'p=0.342',sleep:'p=0.028*'};
const PVALCLS={wt:'sig',sbp:'sig',hr:'sig',steps:'sig',comp:'ns',sleep:'sig'};

// ===== ì§€í‘œ ê·¸ë¦¬ë“œ =====
function buildMetricsGrid(){
  const grid=document.getElementById('metricsGrid');
  grid.innerHTML='';
  METRICS.forEach(m=>{
    const expPast=groupAvg(EXP_DATA,m.k);
    const ctrlPast=groupAvg(CTRL_DATA,m.k);
    const expFuture=project(expPast,6);
    const ctrlFuture=project(ctrlPast,6);

    const d=expPast[5]!=null&&expPast[0]!=null?expPast[5]-expPast[0]:0;
    const isGood=(m.d==='down'&&d<0)||(m.d==='up'&&d>0);
    const dStr=m.k==='steps'?(d>0?'+':'')+Math.round(d).toLocaleString():m.k==='comp'?(d>0?'+':'')+d.toFixed(0)+'%':(d>0?'+':'')+d.toFixed(1)+m.u;

    const card=document.createElement('div');
    card.className='metric-card';
    card.innerHTML=`
      <div class="mc-header">
        <div class="mc-name"><span class="dot" style="background:${m.sc};"></span>${m.n} <span style="font-size:8px;color:#9ca3af;">[${m.src}]</span></div>
        <span class="mc-badge ${PVALCLS[m.k]}">${PVALS[m.k]}</span>
      </div>
      <div class="mc-chart"><canvas id="mc-${m.k}"></canvas></div>
      <div class="mc-footer">
        <span class="mc-delta ${isGood?'good':'bad'}">${dStr}</span>
        <span class="mc-range">W1~W6 ì‹¤ì¦ Â· W7~W12 ì˜ˆì¸¡</span>
      </div>
    `;
    grid.appendChild(card);

    // ì°¨íŠ¸ ê·¸ë¦¬ê¸°
    setTimeout(()=>{
      const cv=document.getElementById('mc-'+m.k);
      if(!cv)return;
      const ctx=cv.getContext('2d');
      const dpr=window.devicePixelRatio||1;
      const rect=cv.parentElement.getBoundingClientRect();
      if(rect.width<10)return;
      cv.width=rect.width*dpr;cv.height=rect.height*dpr;
      cv.style.width=rect.width+'px';cv.style.height=rect.height+'px';
      ctx.setTransform(1,0,0,1,0,0);ctx.scale(dpr,dpr);
      const W=rect.width,H=rect.height;
      ctx.clearRect(0,0,W,H);

      const pad={t:4,b:4,l:4,r:4};
      const cw=W-pad.l-pad.r,ch=H-pad.t-pad.b;

      const expAll=[...expPast,...expFuture];
      const ctrlAll=[...ctrlPast,...ctrlFuture];
      let allV=[...expAll,...ctrlAll].filter(v=>v!=null);
      let mn=Math.min(...allV),mx=Math.max(...allV);
      const mg=(mx-mn)*0.15||5;mn-=mg;mx+=mg;

      function xP(i){return pad.l+(i/11)*cw;}
      function yP(v){return pad.t+(1-(v-mn)/(mx-mn))*ch;}

      // ì‹¤ì¦ ë°°ê²½ (ì™¼ìª½ ë°˜)
      ctx.fillStyle='rgba(59,130,246,.02)';
      ctx.fillRect(pad.l,pad.t,cw/2,ch);

      // ì˜ˆì¸¡ ë°°ê²½ (ì˜¤ë¥¸ìª½ ë°˜)
      ctx.fillStyle='rgba(0,0,0,.01)';
      ctx.fillRect(pad.l+cw/2,pad.t,cw/2,ch);

      // Now line
      ctx.strokeStyle='#ef4444';ctx.lineWidth=1;ctx.globalAlpha=0.3;
      ctx.beginPath();ctx.moveTo(xP(5.5),pad.t);ctx.lineTo(xP(5.5),pad.t+ch);ctx.stroke();
      ctx.globalAlpha=1;

      // ë¼ì¸ ê·¸ë¦¬ê¸°
      function drawLine(past,future,color,bold){
        // ì‹¤ì¦ (ì‹¤ì„ )
        ctx.beginPath();ctx.strokeStyle=color;ctx.lineWidth=bold?1.8:0.8;ctx.globalAlpha=bold?1:0.3;
        ctx.lineJoin='round';ctx.lineCap='round';
        let s=false;
        past.forEach((v,i)=>{if(v==null)return;if(!s){ctx.moveTo(xP(i),yP(v));s=true;}else ctx.lineTo(xP(i),yP(v));});
        ctx.stroke();

        // ì˜ˆì¸¡ (ì ì„ )
        if(future&&bold){
          ctx.setLineDash([3,3]);ctx.globalAlpha=0.5;
          ctx.beginPath();
          if(past[5]!=null)ctx.moveTo(xP(5),yP(past[5]));
          future.forEach((v,i)=>{if(v!=null)ctx.lineTo(xP(6+i),yP(v));});
          ctx.stroke();ctx.setLineDash([]);
        }
        ctx.globalAlpha=1;
      }

      // ê°œë³„ í™˜ì (ì–‡ì€ ì‹¤ì„ ë§Œ, ê³¼ê±°)
      EXP_DATA.forEach(p=>{const a=p.past[m.k];if(a)drawLine(a,null,'#93c5fd',false);});
      CTRL_DATA.forEach(p=>{const a=p.past[m.k];if(a)drawLine(a,null,'#fda4af',false);});

      // êµ° í‰ê·  (ì‹¤ì„  + ì ì„  ì˜ˆì¸¡)
      drawLine(expPast,expFuture,'#3b82f6',true);
      drawLine(ctrlPast,ctrlFuture,'#e11d48',true);

      // gap fill (ê³¼ê±°ë§Œ)
      ctx.globalAlpha=0.06;ctx.fillStyle='#3b82f6';ctx.beginPath();
      for(let i=0;i<6;i++){if(expPast[i]!=null)ctx.lineTo(xP(i),yP(expPast[i]));}
      for(let i=5;i>=0;i--){if(ctrlPast[i]!=null)ctx.lineTo(xP(i),yP(ctrlPast[i]));}
      ctx.closePath();ctx.fill();ctx.globalAlpha=1;
    },80);
  });
}

// ===== íƒ­ ì „í™˜ =====
function switchTab(n){
  document.querySelectorAll('.tab[data-tab]').forEach(t=>t.classList.toggle('active',t.dataset.tab===n));
  document.getElementById('tc-ov').classList.toggle('active',n==='overview');
  document.getElementById('tc-tb').classList.toggle('active',n==='table');
  document.getElementById('nav-ov').classList.toggle('active',n==='overview');
  document.getElementById('nav-tb').classList.toggle('active',n==='table');
}
document.querySelectorAll('.tab[data-tab]').forEach(t=>t.addEventListener('click',()=>t.dataset.tab&&switchTab(t.dataset.tab)));
document.getElementById('nav-ov').addEventListener('click',()=>switchTab('overview'));
document.getElementById('nav-tb').addEventListener('click',()=>switchTab('table'));

// íƒ€ì„ë¼ì¸ í† ê¸€
document.getElementById('tlCal').addEventListener('click',function(){
  this.classList.add('active');document.getElementById('tlDay').classList.remove('active');
  document.getElementById('tlLabels').innerHTML='<span>2025.11.01</span><span>12.01</span><span>12.15</span><span>2026.01.15</span><span style="color:#ef4444;font-weight:600;">02.16 (ì˜¤ëŠ˜)</span><span>03.30</span><span>05.01</span><span>06.15</span>';
});
document.getElementById('tlDay').addEventListener('click',function(){
  this.classList.add('active');document.getElementById('tlCal').classList.remove('active');
  document.getElementById('tlLabels').innerHTML='<span>D-30</span><span>D1</span><span>D15</span><span>D45</span><span style="color:#ef4444;font-weight:600;">D42 (ì˜¤ëŠ˜)</span><span>D84</span><span>D112</span><span>D140</span>';
});

// ===== í…Œì´ë¸” =====
const ALL=[
  {id:'P001',nm:'ê¹€ë¯¼ìˆ˜',g:'exp',sv:'good',wt:[87.3,85.8,84.2,82.5,80.8,79.2],sbp:[134,132,128,126,124,122],hr:[72,71,69,68,67,66],steps:[7340,7800,8200,8600,8900,9104],sleep:[6.2,6.5,6.8,7,7.1,7.3],comp:[86,88,90,92,93,94],app:[40,42,48,52,56,62]},
  {id:'P005',nm:'ì´ìˆ˜ì§„',g:'exp',sv:'good',wt:[88.3,87.1,85.8,84.5,83.2,82.1],sbp:[132.5,131,129,127,125.5,124],hr:[72,71,70,70,69,69],steps:[6800,7100,7400,7600,7800,7812],sleep:[6,6.2,6.5,6.7,6.9,7],comp:[85,87,88,89,90,90],app:[32,35,38,40,42,45]},
  {id:'P011',nm:'ë°•ì§€í›ˆ',g:'exp',sv:'good',wt:[88.3,86.8,85.2,83.5,82,80.8],sbp:[134.2,132,130,128,126.5,125],hr:[72,71,69,68,68,67],steps:[7000,7500,7800,8100,8300,8512],sleep:[6.5,6.6,6.8,7,7.2,7.4],comp:[86,88,90,91,92,92],app:[36,40,44,48,52,54]},
  {id:'P018',nm:'ìµœì˜ˆë¦°',g:'exp',sv:'warn',al:true,wt:[87.4,86.2,85,83.8,82.6,81.6],sbp:[137.9,136,135,138,139,140],hr:[70,69,null,null,68,null],steps:[5800,6000,6100,6200,6200,6234],sleep:[5.8,6,6.2,6,5.9,5.8],comp:[82,84,86,88,89,89],app:[28,30,34,36,40,42]},
  {id:'P023',nm:'ì •í•˜ëŠ˜',g:'exp',sv:'good',wt:[87.6,86.4,85,83.6,82.4,81.2],sbp:[134.1,132,130,129,128,127],hr:[72,71,70,69,68,68],steps:[6900,7200,7500,7800,8000,8234],sleep:[6.3,6.5,6.7,6.9,7.1,7.2],comp:[85,87,89,90,91,91],app:[34,36,40,44,46,48]},
  {id:'P002',nm:'ìœ¤ì„œì—°',g:'ctrl',sv:'warn',wt:[87.7,87.8,87.9,88,88.1,88.2],sbp:[135.9,136,136.5,137,137.5,138],hr:[72,72,71,71,70,70],steps:[4600,4650,4700,4750,4800,4821],sleep:[6.1,6,6,5.9,5.9,5.8],comp:[85,86,86,87,87,88],app:[null,null,null,null,null,null]},
  {id:'P008',nm:'í•œë„ìœ¤',g:'ctrl',sv:'good',wt:[87.9,87.8,87.6,87.4,87.2,87.1],sbp:[133.1,133.5,133.8,134,134.2,134],hr:[72,72,72,72,72,72],steps:[4200,4200,4180,4190,4200,4201],sleep:[6.5,6.4,6.4,6.3,6.3,6.2],comp:[85,85,86,86,86,86],app:[40,39,38,38,38,38]},
  {id:'P014',nm:'ì†¡ì§€ì•„',g:'ctrl',sv:'good',wt:[87.9,87.8,87.8,87.8,87.8,87.8],sbp:[134.5,134.5,135,135,135,135],hr:[72,72,71,71,71,71],steps:[4500,4520,4550,4580,4600,4621],sleep:[6.2,6.2,6.1,6.1,6,6],comp:[85,85,86,86,87,87],app:[34,34,33,33,32,32]},
  {id:'P031',nm:'ì„ì±„ì›',g:'ctrl',sv:'bad',al:true,wt:[87.9,88,88.3,88.5,88.8,89.1],sbp:[134.2,135,136,137,137.5,138],hr:[73,73,74,74,75,75],steps:[4100,4000,3900,3850,3820,3821],sleep:[5.8,5.7,5.5,5.4,5.3,5.2],comp:[84,82,80,78,75,72],app:[28,26,25,24,23,22]},
  {id:'P036',nm:'ê°•ì‹œìš°',g:'ctrl',sv:'good',wt:[87,87,86.9,86.9,86.8,86.8],sbp:[131.8,132,132.5,132.8,133,133],hr:[74,74,73,73,72,72],steps:[4400,4420,4450,4480,4500,4521],sleep:[6.4,6.3,6.3,6.2,6.2,6.1],comp:[85,86,86,87,88,88],app:[40,39,38,38,38,38]},
];
const TMET=[{k:'wt',n:'ì²´ì¤‘',u:'kg',d:'down',sc:'#3b82f6'},{k:'sbp',n:'SBP',u:'mmHg',d:'down',sc:'#3b82f6'},{k:'hr',n:'ì‹¬ë°•ìˆ˜',u:'bpm',d:'down',sc:'#22c55e'},{k:'steps',n:'ê±¸ìŒìˆ˜',u:'ë³´',d:'up',sc:'#22c55e'},{k:'sleep',n:'ìˆ˜ë©´',u:'h',d:'up',sc:'#22c55e'},{k:'comp',n:'ìˆœì‘ë„',u:'%',d:'up',sc:'#a855f7'},{k:'app',n:'ì•±',u:'ë¶„',d:'up',sc:'#f97316'}];

function dl(a){if(!a||a[0]==null||a[5]==null)return null;return a[5]-a[0];}
const tBody=document.getElementById('tBody');
let selIdx=null;
ALL.forEach((p,i)=>{
  const tr=document.createElement('tr');if(p.al)tr.className='alert-row';
  let h=`<td class="pid"><span class="sv ${p.sv}"></span>${p.id}${p.al?'âš ï¸':''}<span class="gb ${p.g}">${p.g==='exp'?'ì‹¤í—˜':'ëŒ€ì¡°'}</span><br><span style="font-size:9px;color:#9ca3af;font-weight:400;">${p.nm}</span></td>`;
  TMET.forEach(m=>{const d=dl(p[m.k]);const v=p[m.k]?p[m.k][5]:null;
    if(d==null||v==null){h+='<td><span class="ce">â€”</span></td>';return;}
    const g=(m.d==='down'&&d<0)||(m.d==='up'&&d>0);const b=(m.d==='down'&&d>2)||(m.d==='up'&&d<-2);
    const ar=d>0?'â†‘':d<0?'â†“':'';const c=g?'good':b?'bad':'neutral';
    const vs=m.k==='steps'?(d>0?'+':'')+Math.round(d).toLocaleString():m.k==='comp'||m.k==='app'?(d>0?'+':'')+d.toFixed(0)+'%':(d>0?'+':'')+d.toFixed(1);
    const bg=g?'background:rgba(34,197,94,.04);':b?'background:rgba(239,68,68,.04);':'';
    const rv=m.k==='steps'?Math.round(v).toLocaleString():m.k==='comp'||m.k==='app'?v.toFixed(0)+'%':v.toFixed(1)+m.u;
    h+=`<td style="${bg}"><span class="cd ${c}">${ar}${vs}</span><span class="cr">${rv}</span></td>`;
  });
  tr.innerHTML=h;tr.addEventListener('click',()=>openDetail(i));tBody.appendChild(tr);
});

// ë””í…Œì¼ íŒ¨ë„
const panel=document.getElementById('detailPanel'),tableArea=document.getElementById('tableArea'),dpTitle=document.getElementById('dpTitle'),dpBody=document.getElementById('dpBody');
function mkSVG(a,c,w,h){const vd=a.map((v,i)=>v!=null?{v,i}:null).filter(Boolean);if(vd.length<2)return'<svg width="'+w+'" height="'+h+'"></svg>';const mn=Math.min(...vd.map(d=>d.v)),mx=Math.max(...vd.map(d=>d.v)),rg=mx-mn||1,pd=3;const pts=vd.map(d=>{const x=pd+(d.i/(a.length-1))*(w-pd*2);const y=pd+(1-(d.v-mn)/rg)*(h-pd*2);return x+','+y;});return'<svg width="'+w+'" height="'+h+'"><polyline points="'+pts.join(' ')+'" fill="none" stroke="'+c+'" stroke-width="1.5" stroke-linecap="round"/></svg>';}

function openDetail(i){
  selIdx=i;const p=ALL[i];
  tBody.querySelectorAll('tr').forEach((r,ri)=>r.classList.toggle('selected',ri===i));
  tableArea.classList.add('shrunk');panel.classList.add('open');
  dpTitle.innerHTML=`<span class="sv ${p.sv}"></span>${p.id} ${p.nm} <span class="gb ${p.g}">${p.g==='exp'?'ì‹¤í—˜':'ëŒ€ì¡°'}</span>`;
  const cms=TMET.slice(0,3);
  let ch=cms.map(m=>{const a=p[m.k]||[];const d=dl(a);const ds=d!=null?(d>0?'+':'')+(m.k==='steps'?Math.round(d).toLocaleString():d.toFixed(1)+m.u):'â€”';return`<div class="chart-card"><div class="chart-card-title">${m.n}</div><div class="mini-chart">${mkSVG(a,m.sc,240,65)}</div><div class="chart-x">${WK_PAST.map(w=>'<span>'+w+'</span>').join('')}</div><div class="chart-sum"><span>W1: <strong>${a[0]!=null?a[0].toFixed(1):'â€”'}</strong></span><span>W6: <strong>${a[5]!=null?a[5].toFixed(1):'â€”'}</strong></span><span>Î”: <strong>${ds}</strong></span></div></div>`;}).join('');
  let fs='<div class="fs-title">ğŸ“‹ í”Œë¡œìš°ì‹œíŠ¸</div><table class="fs-table"><thead><tr><th>ì§€í‘œ</th>';
  WK_PAST.forEach(w=>fs+='<th>'+w+'</th>');fs+='</tr></thead><tbody>';
  TMET.forEach(m=>{const a=p[m.k]||[];fs+='<tr><td>'+m.n+'</td>';a.forEach((v,j)=>{if(v==null){fs+='<td class="ce">â€”</td>';return;}const fmt=m.k==='steps'?Math.round(v).toLocaleString():m.k==='comp'||m.k==='app'?v.toFixed(0):v.toFixed(1);let cls='';if(j>0&&a[0]!=null){const dd=v-a[0];const ig=(m.d==='down'&&dd<-1)||(m.d==='up'&&dd>1);const ib=(m.d==='down'&&dd>1)||(m.d==='up'&&dd<-1);cls=ig?'fg':ib?'fb':'';}if(j===5)cls+=' fc';fs+='<td class="'+cls+'">'+fmt+'</td>';});fs+='</tr>';});
  fs+='</tbody></table>';
  dpBody.innerHTML=ch+fs;
}
document.getElementById('dpClose').addEventListener('click',()=>{panel.classList.remove('open');tableArea.classList.remove('shrunk');tBody.querySelectorAll('tr').forEach(r=>r.classList.remove('selected'));selIdx=null;});
document.getElementById('dpPrev').addEventListener('click',()=>{if(selIdx>0)openDetail(selIdx-1);});
document.getElementById('dpNext').addEventListener('click',()=>{if(selIdx<ALL.length-1)openDetail(selIdx+1);});

// ===== ì´ˆê¸°í™” =====
buildMetricsGrid();
window.addEventListener('resize',buildMetricsGrid);
</script>
</body>
</html>
