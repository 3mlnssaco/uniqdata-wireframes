<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>UniQdata Architecture v6 - 2-Server + 2-DB + XRPL</title>
<style>
  * { margin: 0; padding: 0; box-sizing: border-box; }
  body {
    font-family: 'SF Mono', 'Fira Code', 'Consolas', monospace;
    background: #0d1117;
    color: #e6edf3;
    padding: 24px;
    line-height: 1.5;
  }
  h1 { text-align: center; font-size: 22px; margin-bottom: 4px; letter-spacing: 1px; }
  .subtitle { text-align: center; font-size: 12px; color: #8b949e; margin-bottom: 8px; }

  .nav-links { display: flex; gap: 12px; justify-content: center; margin-bottom: 16px; flex-wrap: wrap; }
  .nav-links a { color: #58a6ff; font-size: 12px; text-decoration: none; }
  .nav-links a:hover { text-decoration: underline; }

  .principle-banner {
    background: linear-gradient(135deg, #1e3a5f, #1e40af);
    border: 2px solid #3b82f6;
    border-radius: 8px;
    padding: 16px;
    margin-bottom: 24px;
    text-align: center;
  }
  .principle-banner .title { font-size: 14px; font-weight: 700; color: #93c5fd; margin-bottom: 8px; }
  .principle-banner .content { font-size: 12px; color: #bfdbfe; }
  .principle-banner code { background: #1e293b; padding: 2px 6px; border-radius: 4px; }

  .section-divider { display: flex; align-items: center; gap: 14px; margin: 32px 0 16px; }
  .section-divider::before, .section-divider::after { content: ''; flex: 1; height: 1px; background: #30363d; }
  .section-divider span { font-size: 15px; font-weight: 700; white-space: nowrap; letter-spacing: 1px; }

  .server-diagram { display: flex; gap: 24px; margin-bottom: 24px; }
  .server-box { flex: 1; border-radius: 12px; overflow: hidden; }
  .server-box.core { border: 2px solid #a78bfa; }
  .server-box.business { border: 2px solid #34d399; }
  .server-header { padding: 16px; font-weight: 700; font-size: 14px; }
  .server-box.core .server-header { background: linear-gradient(135deg, #4c1d95, #5b21b6); color: #e9d5ff; }
  .server-box.business .server-header { background: linear-gradient(135deg, #064e3b, #065f46); color: #a7f3d0; }
  .server-header .tech { font-size: 11px; font-weight: 400; opacity: 0.8; margin-top: 4px; }
  .server-body { padding: 16px; background: #161b22; }
  .server-body ul { list-style: none; }
  .server-body li { padding: 8px 12px; margin-bottom: 6px; background: #0d1117; border-radius: 6px; font-size: 12px; border-left: 3px solid; }
  .server-box.core .server-body li { border-left-color: #a78bfa; }
  .server-box.business .server-body li { border-left-color: #34d399; }
  .server-body li .label { font-weight: 600; }
  .server-body li .desc { color: #8b949e; font-size: 11px; margin-top: 2px; }

  .db-table { width: 100%; border-collapse: collapse; font-size: 11px; margin-bottom: 16px; }
  .db-table th { background: #21262d; padding: 8px; text-align: left; border-bottom: 1px solid #30363d; font-size: 10px; text-transform: uppercase; letter-spacing: 0.5px; }
  .db-table td { padding: 6px 8px; border-bottom: 1px solid #21262d; }
  .db-table tr:hover { background: #161b22; }

  .api-table { width: 100%; border-collapse: collapse; font-size: 12px; margin-bottom: 24px; }
  .api-table th { background: #21262d; padding: 12px; text-align: left; border-bottom: 1px solid #30363d; font-size: 10px; text-transform: uppercase; }
  .api-table td { padding: 10px 12px; border-bottom: 1px solid #21262d; }
  .api-table tr:hover { background: #161b22; }
  .tag { padding: 2px 8px; border-radius: 4px; font-size: 10px; font-weight: 600; }
  .tag-core { background: #4c1d95; color: #e9d5ff; }
  .tag-business { background: #064e3b; color: #a7f3d0; }
  .tag-xrpl { background: #78350f; color: #fbbf24; }

  .example-box { background: #161b22; border: 1px solid #30363d; border-radius: 8px; padding: 20px; margin-bottom: 16px; }
  .example-title { font-size: 13px; font-weight: 700; color: #fbbf24; margin-bottom: 12px; }
  .example-step { display: flex; align-items: flex-start; gap: 12px; margin-bottom: 10px; }
  .step-num { width: 24px; height: 24px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 11px; font-weight: 700; flex-shrink: 0; }
  .step-content { font-size: 12px; }
  .step-content .server { font-weight: 600; }
  .step-content .server.core { color: #a78bfa; }
  .step-content .server.business { color: #34d399; }
  .step-content .action { color: #8b949e; }

  .faq-item { background: #161b22; border: 1px solid #30363d; border-radius: 8px; padding: 16px; margin-bottom: 12px; }
  .faq-q { font-size: 13px; font-weight: 700; color: #f87171; margin-bottom: 8px; }
  .faq-a { font-size: 12px; color: #4ade80; }
  .faq-a code { background: #21262d; padding: 2px 6px; border-radius: 4px; }

  .repo-links { display: flex; gap: 16px; justify-content: center; margin-top: 24px; }
  .repo-link { padding: 12px 24px; border-radius: 8px; text-decoration: none; font-size: 13px; font-weight: 600; }
  .repo-link.core { background: #4c1d95; color: #e9d5ff; border: 1px solid #a78bfa; }
  .repo-link.business { background: #064e3b; color: #a7f3d0; border: 1px solid #34d399; }
  .repo-link:hover { opacity: 0.8; }

  /* Schema SQL blocks */
  .sql-block {
    background: #0d1117;
    border: 1px solid #21262d;
    border-radius: 8px;
    padding: 16px;
    font-size: 11px;
    line-height: 1.7;
    overflow-x: auto;
    white-space: pre;
    margin-bottom: 12px;
  }
  .sql-block .kw { color: #79c0ff; }
  .sql-block .tn { color: #7ee787; font-weight: 700; }
  .sql-block .ty { color: #d2a8ff; }
  .sql-block .cm { color: #484f58; }
  .sql-block .ct { color: #ffa657; }

  /* Collapsible */
  .collapse-btn {
    background: #161b22;
    border: 1px solid #30363d;
    border-radius: 8px;
    padding: 12px 16px;
    color: #e6edf3;
    font-family: inherit;
    font-size: 13px;
    font-weight: 600;
    cursor: pointer;
    width: 100%;
    text-align: left;
    margin-bottom: 4px;
    display: flex;
    align-items: center;
    gap: 8px;
  }
  .collapse-btn:hover { background: #1c2128; }
  .collapse-btn .arrow { transition: transform 0.2s; }
  .collapse-btn.open .arrow { transform: rotate(90deg); }
  .collapse-body { display: none; padding: 0 4px; margin-bottom: 16px; }
  .collapse-body.show { display: block; }

  /* Decision matrix */
  .matrix { border-collapse: collapse; width: 100%; font-size: 12px; margin-bottom: 24px; }
  .matrix th { background: #21262d; padding: 12px; text-align: center; border: 1px solid #30363d; font-size: 11px; }
  .matrix td { padding: 12px; border: 1px solid #30363d; vertical-align: top; }
  .matrix .label-col { font-weight: 600; background: #161b22; width: 160px; }
  .matrix .core-col { background: #1a0a3e; }
  .matrix .biz-col { background: #0a2818; }

  @media (max-width: 768px) {
    .server-diagram { flex-direction: column; }
    body { padding: 12px; }
  }
</style>
</head>
<body>

<h1>UniQdata Architecture v6</h1>
<p class="subtitle">2-Server Â· 2-DB Â· XRPL Â· Full Schema Â· 14 Internal APIs Â· 8 Webhooks</p>

<div class="nav-links">
  <a href="../index.html">â† ì™€ì´ì–´í”„ë ˆì„ ëª©ë¡</a>
  <a href="SportiQue_Architecture_v5.html">v5 (êµ¬ë²„ì „)</a>
  <a href="../erd.html">ERD ë³´ê¸°</a>
</div>

<!-- ====== í•µì‹¬ ì›ì¹™ ====== -->
<div class="principle-banner">
  <div class="title">ğŸ“ ë¶„ë¦¬ ì›ì¹™ (í•œ ì¤„ ê·œì¹™)</div>
  <div class="content">
    <strong>"í™˜ìì˜ ëª¸ì—ì„œ ë‚˜ì˜¨ ë°ì´í„°, í™˜ìì˜ ì§€ê°‘, í™˜ìì˜ ë™ì˜ëŠ” Core. ê·¸ ì™¸ ë¹„ì¦ˆë‹ˆìŠ¤ëŠ” Business."</strong><br><br>
    <code>ğŸŸ¢ Core (NestJS:3000)</code> = Core Team â†’ ì‚¬ìš©ì ì¸ì¦ + ê±´ê°• ë°ì´í„° + XRPL + ë™ì˜ ê´€ë¦¬<br>
    <code>ğŸ”µ Business (Spring Boot:8080)</code> = ë°±ì—”ë“œíŒ€ â†’ ì—°êµ¬ í”„ë¡œì íŠ¸ + IRB + ì •ì‚° + ê¸°ê´€ ê´€ë¦¬
  </div>
</div>

<!-- ====== íŒë‹¨ ê¸°ì¤€: "ì´ ë°ì´í„°ê°€ ìœ ì¶œë˜ë©´ í™˜ìê°€ ì§ì ‘ í”¼í•´ë¥¼ ë³´ëŠ”ê°€?" ====== -->
<div style="background: #450a0a; border: 1px solid #ef4444; border-radius: 8px; padding: 12px; margin-bottom: 24px; text-align: center; font-size: 12px; color: #fca5a5;">
  âš ï¸ ê²½ê³„ íŒë‹¨ ì§ˆë¬¸: <strong>"ì´ ë°ì´í„°ê°€ ìœ ì¶œë˜ë©´ í™˜ìê°€ ì§ì ‘ í”¼í•´ë¥¼ ë³´ëŠ”ê°€?"</strong> â†’ Yesë©´ Core, Noë©´ Business
</div>

<!-- ====== DB ì ‘ê·¼ ë§¤íŠ¸ë¦­ìŠ¤ ====== -->
<div class="section-divider"><span>ğŸ—„ï¸ DB ì ‘ê·¼ ë§¤íŠ¸ë¦­ìŠ¤</span></div>

<div style="background: #161b22; border: 1px solid #30363d; border-radius: 12px; padding: 20px; margin-bottom: 24px;">
  <table style="width: 100%; border-collapse: collapse; font-size: 12px; text-align: center;">
    <thead>
      <tr>
        <th style="background: #21262d; padding: 12px; border-bottom: 1px solid #30363d;"></th>
        <th style="background: #4c1d95; padding: 12px; border-bottom: 1px solid #30363d; color: #e9d5ff;">health_db</th>
        <th style="background: #064e3b; padding: 12px; border-bottom: 1px solid #30363d; color: #a7f3d0;">uniqdata_db</th>
        <th style="background: #312e81; padding: 12px; border-bottom: 1px solid #30363d; color: #c7d2fe;">XRPL</th>
        <th style="background: #7f1d1d; padding: 12px; border-bottom: 1px solid #30363d; color: #fca5a5;">Redis</th>
      </tr>
    </thead>
    <tbody>
      <tr>
        <td style="padding: 12px; font-weight: 700; color: #e9d5ff; border-bottom: 1px solid #21262d;">ğŸŸ¢ Core</td>
        <td style="padding: 12px; color: #4ade80; font-weight: 700; border-bottom: 1px solid #21262d;">R/W âœ…</td>
        <td style="padding: 12px; color: #6b7280; border-bottom: 1px solid #21262d;">âŒ ì ‘ê·¼ ë¶ˆê°€</td>
        <td style="padding: 12px; color: #4ade80; font-weight: 700; border-bottom: 1px solid #21262d;">R/W âœ…</td>
        <td style="padding: 12px; color: #4ade80; font-weight: 700; border-bottom: 1px solid #21262d;">R/W âœ…</td>
      </tr>
      <tr>
        <td style="padding: 12px; font-weight: 700; color: #a7f3d0; border-bottom: 1px solid #21262d;">ğŸ”µ Business</td>
        <td style="padding: 12px; color: #fbbf24; font-size: 11px; border-bottom: 1px solid #21262d;">Internal API ê²½ìœ <br><strong>Readë§Œ</strong></td>
        <td style="padding: 12px; color: #4ade80; font-weight: 700; border-bottom: 1px solid #21262d;">R/W âœ…</td>
        <td style="padding: 12px; color: #fbbf24; font-size: 11px; border-bottom: 1px solid #21262d;">Core ê²½ìœ <br><strong>ìš”ì²­ë§Œ</strong></td>
        <td style="padding: 12px; color: #6b7280; border-bottom: 1px solid #21262d;">âŒ</td>
      </tr>
    </tbody>
  </table>
  <div style="margin-top: 12px; font-size: 10px; color: #8b949e; text-align: center;">
    ğŸ”´ ì ˆëŒ€ ê·œì¹™: BusinessëŠ” health_db ì»¤ë„¥ì…˜ ìŠ¤íŠ¸ë§ì„ ê°–ì§€ ì•ŠìŒ Â· CoreëŠ” uniqdata_dbì— ì ‘ê·¼ ì•ˆ í•¨ Â· XRPL ë¼ì´ë¸ŒëŸ¬ë¦¬ëŠ” Coreë§Œ import
  </div>
</div>

<!-- ====== ì„œë²„ ë¶„ë¦¬ Decision Matrix ====== -->
<div class="section-divider"><span>ğŸ“ ì„œë²„ ë¶„ë¦¬ Decision Matrix</span></div>

<table class="matrix">
  <tr>
    <th class="label-col">íŒë‹¨ ê¸°ì¤€</th>
    <th style="background: #4c1d95; color: #e9d5ff;">ğŸŸ¢ Core (NestJS:3000)</th>
    <th style="background: #064e3b; color: #a7f3d0;">ğŸ”µ Business (Spring:8080)</th>
  </tr>
  <tr>
    <td class="label-col">ë°ì´í„° ë¯¼ê°ë„</td>
    <td class="core-col">ë¯¼ê°ì •ë³´ (ê±´ê°•ë°ì´í„°, ê°œì¸í‚¤, ë™ì˜ ì›ë³¸)</td>
    <td class="biz-col">ë¹„ë¯¼ê° ì—…ë¬´ì •ë³´ (í”„ë¡œì íŠ¸, ì •ì‚°, IRB ë©”íƒ€)</td>
  </tr>
  <tr>
    <td class="label-col">ê·œì œ ì ìš©</td>
    <td class="core-col">PIPA ë¯¼ê°ì •ë³´ ì²˜ë¦¬ì, ìƒëª…ìœ¤ë¦¬ë²• ë™ì˜ ê´€ë¦¬</td>
    <td class="biz-col">ì¼ë°˜ ì‚¬ì—…ì ì •ë³´ ì²˜ë¦¬</td>
  </tr>
  <tr>
    <td class="label-col">ë¸”ë¡ì²´ì¸ ì ‘ê·¼</td>
    <td class="core-col">XRPL ì§ì ‘ R/W (ì§€ê°‘, ì—ìŠ¤í¬ë¡œ, ì•µì»¤ë§)</td>
    <td class="biz-col">XRPL ì ‘ê·¼ ë¶ˆê°€ (Core API ê²½ìœ ë§Œ)</td>
  </tr>
  <tr>
    <td class="label-col">ì¸ì¦ ì±…ì„</td>
    <td class="core-col">Passkey/PRF ì²˜ë¦¬, JWT ë°œê¸‰, JWKS ì œê³µ</td>
    <td class="biz-col">JWT ê²€ì¦ë§Œ (JWKS ê³µê°œí‚¤ë¡œ, ë°œê¸‰ ì•ˆ í•¨)</td>
  </tr>
  <tr>
    <td class="label-col">ì¥ì•  ê²©ë¦¬</td>
    <td class="core-col">Business ì¥ì•  ì‹œì—ë„ í™˜ì ë°ì´í„° ì•ˆì „</td>
    <td class="biz-col">Core ì¥ì•  ì‹œ IRB/ì •ì‚° ë¶ˆê°€ (ë°ì´í„° ì•ˆì „)</td>
  </tr>
  <tr>
    <td class="label-col">íŒ€ ë°°ì¹˜</td>
    <td class="core-col">Core Team (ë³´ì•ˆ í´ë¦¬ì–´ëŸ°ìŠ¤ í•„ìš”)</td>
    <td class="biz-col">ë°±ì—”ë“œíŒ€ (ì¼ë°˜ ê°œë°œì)</td>
  </tr>
  <tr>
    <td class="label-col">ê¸°ìˆ  ìŠ¤íƒ</td>
    <td class="core-col">TypeScript, xrpl.js, @simplewebauthn</td>
    <td class="biz-col">Kotlin, Spring JPA, Claude API</td>
  </tr>
</table>

<!-- ====== ì „ì²´ ì•„í‚¤í…ì²˜ ë‹¤ì´ì–´ê·¸ë¨ ====== -->
<div class="section-divider"><span>ğŸ—ï¸ ì „ì²´ ì•„í‚¤í…ì²˜ ë‹¤ì´ì–´ê·¸ë¨</span></div>

<div style="background: #161b22; border: 1px solid #30363d; border-radius: 12px; padding: 24px; margin-bottom: 24px; overflow-x: auto;">
<pre style="font-size: 11px; line-height: 1.6; color: #e6edf3;">
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        <span style="color:#fbbf24;">API Gateway (nginx)</span>                               â”‚
â”‚  /api/v1/auth/**,health/**,consents/**,wallets/**  â†’ <span style="color:#a78bfa;">ğŸŸ¢ Core:3000</span>      â”‚
â”‚  /api/v1/projects/**,irb/**,enterprises/**         â†’ <span style="color:#34d399;">ğŸ”µ Business:8080</span>  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚                                             â”‚
           â–¼                                             â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  <span style="color:#a78bfa;">ğŸŸ¢ Core (NestJS:3000)</span>          â”‚    â”‚  <span style="color:#34d399;">ğŸ”µ Business (Spring Boot:8080)</span>      â”‚
â”‚                               â”‚    â”‚                                    â”‚
â”‚  Auth (Passkey/PRF/JWT)       â”‚    â”‚  Research (í”„ë¡œì íŠ¸/ë§ˆì¼ìŠ¤í†¤)       â”‚
â”‚  Health (ë°ì´í„° ì…ë ¥/ë¦¬í¬íŠ¸)   â”‚â—„â”€â”€â”€â”‚  IRB (ì œì¶œ/ì‹¬ì˜/ë¬¸ì„œ/ì›Œí¬í”Œë¡œìš°)    â”‚
â”‚  Consent (ë™ì˜/ìŠ¤ì½”í”„/ê°ì‚¬)    â”‚ APIâ”‚  Settlement (ì •ì‚° ê³„ì‚°/ë°°ì¹˜)        â”‚
â”‚  XRPL (ì§€ê°‘/ì—ìŠ¤í¬ë¡œ/ì•µì»¤)    â”‚â”€â”€â”€â–ºâ”‚  Enterprise (ê¸°ê´€/íŒ€/êµ¬ì„±ì›)        â”‚
â”‚  Notification (ì•Œë¦¼)          â”‚ WH â”‚  FL/Marketplace (Phase 2)           â”‚
â”‚                               â”‚    â”‚                                    â”‚
â”‚  ğŸ“¦ <span style="color:#a78bfa;">health_db</span> (15 tables)     â”‚    â”‚  ğŸ“¦ <span style="color:#34d399;">uniqdata_db</span> (16 tables)         â”‚
â”‚  ğŸ“¦ Redis (ì„¸ì…˜/ìºì‹œ)         â”‚    â”‚                                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚
           â–¼
    <span style="color:#fbbf24;">â›“ XRPL Ledger</span>  â† Coreë§Œ ì§ì ‘ ì ‘ê·¼
</pre>
</div>

<!-- ====== ì„œë²„ë³„ ìƒì„¸ ì—­í•  ====== -->
<div class="section-divider"><span>ğŸ—ï¸ ì„œë²„ë³„ ìƒì„¸ ì—­í• </span></div>

<div class="server-diagram">
  <div class="server-box core">
    <div class="server-header">
      ğŸŸ¢ uniqdata-core
      <div class="tech">NestJS (TypeScript) Â· Port 3000 Â· Core Team ë‹´ë‹¹</div>
    </div>
    <div class="server-body">
      <ul>
        <li><div class="label">Auth (Passkey/PRF)</div><div class="desc">WebAuthn Level 3, PRF í‚¤ íŒŒìƒ, JWT ë°œê¸‰/ê°±ì‹ , JWKS ì—”ë“œí¬ì¸íŠ¸ ì œê³µ</div></li>
        <li><div class="label">Data Input â­</div><div class="desc">ê±´ê°• ë°ì´í„° ìˆ˜ì‹  â†’ ê²€ì¦ â†’ AES-256-GCM ì•”í˜¸í™” â†’ health_db.data_points ì €ì¥ â†’ XRPL ì•µì»¤ë§</div></li>
        <li><div class="label">Consent â­</div><div class="desc">ë™ì˜ì„œ ìƒì„±/ì„œëª…(ed25519)/ë²”ìœ„ ê´€ë¦¬/ì² íšŒ + XRPL CONSENT_GRANT/REVOKE ì•µì»¤ë§</div></li>
        <li><div class="label">XRPL / UQD</div><div class="desc">EscrowCreate/Finish/Cancel, UQD ê´€ë¦¬, DATA_INPUT/DATA_ACCESS ì•µì»¤ë§</div></li>
        <li><div class="label">Notification</div><div class="desc">í‘¸ì‹œ ì•Œë¦¼ í†µí•© ê´€ë¦¬ (Core + Business ìš”ì²­ ëª¨ë‘)</div></li>
        <li><div class="label">Internal API</div><div class="desc">14ê°œ ì—”ë“œí¬ì¸íŠ¸: /internal/v1/users/*, /consents/*, /data/*, /escrow/*, /notifications/*</div></li>
      </ul>
    </div>
  </div>

  <div class="server-box business">
    <div class="server-header">
      ğŸ“Š uniqdata-enterprise-backend
      <div class="tech">Spring Boot (Kotlin) Â· Port 8080 Â· ë°±ì—”ë“œíŒ€ ë‹´ë‹¹</div>
    </div>
    <div class="server-body">
      <ul>
        <li><div class="label">Research â­</div><div class="desc">í”„ë¡œì íŠ¸ CRUD, ë§ˆì¼ìŠ¤í†¤ ì¶”ì , ì°¸ì—¬ì ë§¤ì¹­, ì ê²© ê¸°ì¤€, ë°ì´í„° ìš”ì²­</div></li>
        <li><div class="label">IRB â­</div><div class="desc">ì œì¶œ/ì‹¬ì˜/ë¬¸ì„œ ê´€ë¦¬/ì›Œí¬í”Œë¡œìš° íˆìŠ¤í† ë¦¬, AI ë¬¸ì„œ ìƒì„±(Claude API)</div></li>
        <li><div class="label">Settlement â­</div><div class="desc">ë³´ìƒ ê³„ì‚°, settlement_batches/items ìƒì„± â†’ Coreì— EscrowFinish ìš”ì²­</div></li>
        <li><div class="label">Enterprise</div><div class="desc">ê¸°ê´€ ë“±ë¡/ê´€ë¦¬, êµ¬ì„±ì› ê´€ë¦¬, OWNER/PI/IRB_MEMBER/STAFF ì—­í• </div></li>
        <li><div class="label">Synthetic/FL (Phase 2)</div><div class="desc">í•©ì„±ë°ì´í„°ì…‹ ìƒì„±, FL ë¼ìš´ë“œ ê´€ë¦¬</div></li>
        <li><div class="label">Webhook ìˆ˜ì‹ </div><div class="desc">Core â†’ data.submitted, consent.granted/revoked, escrow.*, user.kyc_updated, wallet.created</div></li>
      </ul>
    </div>
  </div>
</div>

<!-- ====== health_db ìŠ¤í‚¤ë§ˆ (15 tables) ====== -->
<div class="section-divider"><span>ğŸŸ¢ health_db â€” 15 Tables (Core ì „ìš©)</span></div>

<div style="display: flex; gap: 16px; margin-bottom: 16px; flex-wrap: wrap;">
  <div style="background: #2e1065; border: 1px solid #a78bfa; padding: 12px 20px; border-radius: 8px; font-size: 12px; color: #e9d5ff; text-align: center;">
    ì´ í…Œì´ë¸”: <strong>15</strong>
  </div>
  <div style="background: #2e1065; border: 1px solid #a78bfa; padding: 12px 20px; border-radius: 8px; font-size: 12px; color: #e9d5ff; text-align: center;">
    1ë…„ ì˜ˆìƒ: <strong>~2.3M ë ˆì½”ë“œ</strong>
  </div>
  <div style="background: #2e1065; border: 1px solid #a78bfa; padding: 12px 20px; border-radius: 8px; font-size: 12px; color: #e9d5ff; text-align: center;">
    í•µì‹¬: <strong>data_points ~500K/ë…„</strong>
  </div>
  <div style="background: #2e1065; border: 1px solid #a78bfa; padding: 12px 20px; border-radius: 8px; font-size: 12px; color: #e9d5ff; text-align: center;">
    ìŠ¤í† ë¦¬ì§€: <strong>PostgreSQL 15 Â· 2GB</strong>
  </div>
</div>

<table class="db-table">
  <tr><th style="color:#c4b5fd;">#</th><th style="color:#c4b5fd;">í…Œì´ë¸”</th><th style="color:#c4b5fd;">ì„¤ëª…</th><th style="color:#c4b5fd;">ì£¼ìš” ì»¬ëŸ¼</th><th style="color:#c4b5fd;">ì˜ˆìƒ/ë…„</th></tr>
  <tr><td>1</td><td style="color:#e9d5ff;"><strong>users</strong></td><td>ì‚¬ìš©ì ì›ì¥ (ì¸ì¦/ì‹ ì›)</td><td>id, email, role, kyc_level, status</td><td>~10K</td></tr>
  <tr><td>2</td><td style="color:#e9d5ff;"><strong>passkey_credentials</strong></td><td>FIDO2 Passkey í¬ë ˆë´ì…œ</td><td>credential_id, public_key, sign_count, prf_supported, prf_salt</td><td>~15K</td></tr>
  <tr><td>3</td><td style="color:#e9d5ff;"><strong>user_profiles</strong></td><td>ê°œì¸ ê±´ê°• í”„ë¡œí•„ (ì•”í˜¸í™”)</td><td>birth_date, gender, blood_type, medications, chronic_conditions</td><td>~10K</td></tr>
  <tr><td>4</td><td style="color:#e9d5ff;"><strong>user_wallets</strong></td><td>XRPL ì§€ê°‘ (ì£¼ì†Œë§Œ, ì‹œë“œ ì—†ìŒ)</td><td>xrpl_address, xrpl_public_key, wallet_type, derivation_method</td><td>~12K</td></tr>
  <tr><td>5</td><td style="color:#e9d5ff;"><strong>wallet_recovery_configs</strong></td><td>í‚¤ ë³µêµ¬ ì„¤ì • (SSS/Social)</td><td>recovery_method, config(JSON)</td><td>~5K</td></tr>
  <tr><td>6</td><td style="color:#fbbf24;font-weight:700;">data_points â­</td><td>ê±´ê°•ë°ì´í„° (í•µì‹¬ í’€)</td><td>category, value(AES-256-GCM), source, data_hash, xrpl_tx_hash</td><td style="color:#fbbf24;font-weight:700;">~500K</td></tr>
  <tr><td>7</td><td style="color:#e9d5ff;"><strong>data_point_tags</strong></td><td>ë°ì´í„° íƒœê¹…/ê²€ìƒ‰</td><td>tag_key, tag_value</td><td>~1M</td></tr>
  <tr><td>8</td><td style="color:#e9d5ff;"><strong>data_access_logs</strong></td><td>ì ‘ê·¼ ê°ì‚¬ì¶”ì </td><td>accessor_id, project_id, irb_number, pseudonymized, xrpl_tx_hash</td><td>~50K</td></tr>
  <tr><td>9</td><td style="color:#fbbf24;font-weight:700;">consents â­</td><td>ë™ì˜ ì›ì¥</td><td>consent_type, status, signature_hash, grant_tx_hash, project_id</td><td>~30K</td></tr>
  <tr><td>10</td><td style="color:#e9d5ff;"><strong>consent_scopes</strong></td><td>ë™ì˜ ë²”ìœ„ ìƒì„¸</td><td>scope_type (DATA_CATEGORY|PURPOSE|RECIPIENT|DURATION|GEOGRAPHY)</td><td>~90K</td></tr>
  <tr><td>11</td><td style="color:#e9d5ff;"><strong>consent_audit_trail</strong></td><td>ë™ì˜ ë³€ê²½ ì´ë ¥</td><td>action, actor_id, changes(JSON), xrpl_tx_hash</td><td>~60K</td></tr>
  <tr><td>12</td><td style="color:#e9d5ff;"><strong>xrpl_transactions</strong></td><td>XRPL tx ê¸°ë¡</td><td>tx_hash, tx_type, memo_type, memo_data(JSON), ledger_index</td><td>~200K</td></tr>
  <tr><td>13</td><td style="color:#e9d5ff;"><strong>notifications</strong></td><td>ì•Œë¦¼</td><td>type, title, body, channel, read</td><td>~300K</td></tr>
  <tr><td>14</td><td style="color:#e9d5ff;"><strong>notification_preferences</strong></td><td>ì•Œë¦¼ ì„¤ì •</td><td>push_enabled, email_enabled, health_alerts, quiet_hours</td><td>~10K</td></tr>
  <tr><td>15</td><td style="color:#e9d5ff;"><strong>refresh_tokens</strong></td><td>JWT ë¦¬í”„ë ˆì‹œ í† í°</td><td>token_hash, device_info, expires_at, revoked</td><td>~30K</td></tr>
</table>

<!-- health_db CREATE TABLE statements (collapsible) -->
<button class="collapse-btn" onclick="toggle('hdb-auth')"><span class="arrow">â–¶</span> users + passkey_credentials + user_profiles DDL</button>
<div class="collapse-body" id="hdb-auth">
<div class="sql-block"><span class="kw">CREATE TABLE</span> <span class="tn">users</span> (
    id              <span class="ty">UUID PRIMARY KEY</span> DEFAULT gen_random_uuid(),
    email           <span class="ty">VARCHAR(255)</span> UNIQUE NOT NULL,
    phone           <span class="ty">VARCHAR(20)</span>,
    display_name    <span class="ty">VARCHAR(100)</span>,
    role            <span class="ty">VARCHAR(20)</span> NOT NULL DEFAULT 'PATIENT',
                    <span class="cm">-- PATIENT | RESEARCHER | IRB_MEMBER | ADMIN</span>
    kyc_level       <span class="ty">SMALLINT</span> NOT NULL DEFAULT 0,
                    <span class="cm">-- 0:ë¯¸ì¸ì¦ 1:ì´ë©”ì¼ 2:ì „í™” 3:ì‹ ë¶„ì¦</span>
    status          <span class="ty">VARCHAR(20)</span> NOT NULL DEFAULT 'ACTIVE',
    last_login_at   <span class="ty">TIMESTAMP</span>,
    created_at      <span class="ty">TIMESTAMP</span> NOT NULL DEFAULT NOW(),
    updated_at      <span class="ty">TIMESTAMP</span> NOT NULL DEFAULT NOW()
);

<span class="kw">CREATE TABLE</span> <span class="tn">passkey_credentials</span> (
    id              <span class="ty">UUID PRIMARY KEY</span>,
    user_id         <span class="ty">UUID</span> NOT NULL <span class="ct">REFERENCES users(id)</span>,
    credential_id   <span class="ty">TEXT</span> NOT NULL UNIQUE,
    public_key      <span class="ty">TEXT</span> NOT NULL,        <span class="cm">-- COSE ê³µê°œí‚¤</span>
    sign_count      <span class="ty">BIGINT</span> DEFAULT 0,
    device_type     <span class="ty">VARCHAR(30)</span>,         <span class="cm">-- 'platform'|'cross-platform'</span>
    device_name     <span class="ty">VARCHAR(100)</span>,
    prf_supported   <span class="ty">BOOLEAN</span> DEFAULT FALSE,
    prf_salt        <span class="ty">BYTEA</span>,              <span class="cm">-- PRFìš© salt (32ë°”ì´íŠ¸)</span>
    created_at      <span class="ty">TIMESTAMP</span> NOT NULL DEFAULT NOW()
);

<span class="kw">CREATE TABLE</span> <span class="tn">user_profiles</span> (
    id              <span class="ty">UUID PRIMARY KEY</span>,
    user_id         <span class="ty">UUID</span> NOT NULL UNIQUE <span class="ct">REFERENCES users(id)</span>,
    birth_date      <span class="ty">DATE</span>,              <span class="cm">-- ì•”í˜¸í™” ì €ì¥</span>
    gender          <span class="ty">VARCHAR(10)</span>,
    height_cm       <span class="ty">DECIMAL(5,1)</span>,
    weight_kg       <span class="ty">DECIMAL(5,1)</span>,
    blood_type      <span class="ty">VARCHAR(5)</span>,
    chronic_conditions <span class="ty">TEXT[]</span>,
    medications     <span class="ty">JSONB</span>,
    encrypted_fields <span class="ty">JSONB</span>,
    created_at      <span class="ty">TIMESTAMP</span> NOT NULL DEFAULT NOW()
);</div>
</div>

<button class="collapse-btn" onclick="toggle('hdb-data')"><span class="arrow">â–¶</span> data_points + data_point_tags + data_access_logs DDL</button>
<div class="collapse-body" id="hdb-data">
<div class="sql-block"><span class="kw">CREATE TABLE</span> <span class="tn">data_points</span> (
    id              <span class="ty">UUID PRIMARY KEY</span>,
    user_id         <span class="ty">UUID</span> NOT NULL <span class="ct">REFERENCES users(id)</span>,
    category        <span class="ty">VARCHAR(30)</span> NOT NULL,
                    <span class="cm">-- VITALS | LAB_RESULT | MEDICATION | SYMPTOM |</span>
                    <span class="cm">-- ACTIVITY | SLEEP | DIET | MENTAL_HEALTH |</span>
                    <span class="cm">-- WEARABLE | MY_HEALTHWAY</span>
    sub_category    <span class="ty">VARCHAR(50)</span>,       <span class="cm">-- "blood_pressure", "heart_rate", "glucose"</span>
    value           <span class="ty">JSONB</span> NOT NULL,    <span class="cm">-- AES-256-GCM ì•”í˜¸í™”ëœ ë°ì´í„°</span>
    value_encrypted <span class="ty">BOOLEAN</span> DEFAULT TRUE,
    source          <span class="ty">VARCHAR(30)</span> NOT NULL,
                    <span class="cm">-- MANUAL | WEARABLE | MY_HEALTHWAY | EMR_IMPORT | FHIR</span>
    measured_at     <span class="ty">TIMESTAMP</span> NOT NULL,
    data_hash       <span class="ty">VARCHAR(64)</span> NOT NULL,   <span class="cm">-- SHA-256(raw + ts)</span>
    xrpl_tx_hash    <span class="ty">VARCHAR(64)</span>,            <span class="cm">-- XRPL ì•µì»¤ë§ tx</span>
    xrpl_anchored   <span class="ty">BOOLEAN</span> DEFAULT FALSE,
    quality_score   <span class="ty">DECIMAL(3,2)</span>,
    created_at      <span class="ty">TIMESTAMP</span> NOT NULL DEFAULT NOW()
);
<span class="kw">CREATE INDEX</span> idx_dp_user_cat ON data_points(user_id, category);
<span class="kw">CREATE INDEX</span> idx_dp_user_time ON data_points(user_id, measured_at DESC);
<span class="kw">CREATE INDEX</span> idx_dp_hash ON data_points(data_hash);

<span class="kw">CREATE TABLE</span> <span class="tn">data_point_tags</span> (
    id              <span class="ty">UUID PRIMARY KEY</span>,
    data_point_id   <span class="ty">UUID</span> <span class="ct">REFERENCES data_points(id)</span>,
    tag_key         <span class="ty">VARCHAR(50)</span>,
    tag_value       <span class="ty">VARCHAR(200)</span>
);

<span class="kw">CREATE TABLE</span> <span class="tn">data_access_logs</span> (
    id              <span class="ty">UUID PRIMARY KEY</span>,
    data_point_ids  <span class="ty">UUID[]</span> NOT NULL,
    accessor_type   <span class="ty">VARCHAR(20)</span>,      <span class="cm">-- SELF | RESEARCHER | SYSTEM | AI</span>
    accessor_id     <span class="ty">UUID</span>,
    project_id      <span class="ty">UUID</span>,             <span class="cm">-- uniqdata_db.projects.id</span>
    irb_number      <span class="ty">VARCHAR(50)</span>,
    consent_id      <span class="ty">UUID</span> <span class="ct">REFERENCES consents(id)</span>,
    access_purpose  <span class="ty">VARCHAR(50)</span>,
    record_count    <span class="ty">INT</span> NOT NULL,
    pseudonymized   <span class="ty">BOOLEAN</span> DEFAULT FALSE,
    xrpl_tx_hash    <span class="ty">VARCHAR(64)</span>,
    accessed_at     <span class="ty">TIMESTAMP</span> DEFAULT NOW()
);</div>
</div>

<button class="collapse-btn" onclick="toggle('hdb-consent')"><span class="arrow">â–¶</span> consents + consent_scopes + consent_audit_trail DDL</button>
<div class="collapse-body" id="hdb-consent">
<div class="sql-block"><span class="kw">CREATE TABLE</span> <span class="tn">consents</span> (
    id              <span class="ty">UUID PRIMARY KEY</span>,
    user_id         <span class="ty">UUID</span> NOT NULL <span class="ct">REFERENCES users(id)</span>,
    consent_type    <span class="ty">VARCHAR(30)</span> NOT NULL,
                    <span class="cm">-- SERVICE_TERMS | PRIVACY_POLICY | RESEARCH_PARTICIPATION |</span>
                    <span class="cm">-- DATA_SHARING | SENSITIVE_DATA | MARKETING</span>
    status          <span class="ty">VARCHAR(20)</span> DEFAULT 'ACTIVE',
                    <span class="cm">-- PENDING | ACTIVE | REVOKED | EXPIRED</span>
    signature_hash  <span class="ty">VARCHAR(64)</span>,        <span class="cm">-- ed25519 ì„œëª… í•´ì‹œ</span>
    signature_method <span class="ty">VARCHAR(30)</span>,       <span class="cm">-- PASSKEY_PRF | E_SIGNATURE | MANUAL</span>
    grant_tx_hash   <span class="ty">VARCHAR(64)</span>,        <span class="cm">-- CONSENT_GRANT XRPL tx</span>
    revoke_tx_hash  <span class="ty">VARCHAR(64)</span>,        <span class="cm">-- CONSENT_REVOKE XRPL tx</span>
    project_id      <span class="ty">UUID</span>,              <span class="cm">-- Businessì—ì„œ ì „ë‹¬ë°›ì€ í”„ë¡œì íŠ¸ ID</span>
    irb_number      <span class="ty">VARCHAR(50)</span>,
    version         <span class="ty">INT</span> DEFAULT 1,
    created_at      <span class="ty">TIMESTAMP</span> DEFAULT NOW()
);

<span class="kw">CREATE TABLE</span> <span class="tn">consent_scopes</span> (
    id              <span class="ty">UUID PRIMARY KEY</span>,
    consent_id      <span class="ty">UUID</span> <span class="ct">REFERENCES consents(id)</span>,
    scope_type      <span class="ty">VARCHAR(30)</span>,
                    <span class="cm">-- DATA_CATEGORY | PURPOSE | RECIPIENT | DURATION | GEOGRAPHY</span>
    scope_key       <span class="ty">VARCHAR(50)</span>,   <span class="cm">-- "vitals", "drug_research", "enterprise_id:xxxx"</span>
    scope_value     <span class="ty">TEXT</span>
);

<span class="kw">CREATE TABLE</span> <span class="tn">consent_audit_trail</span> (
    id              <span class="ty">UUID PRIMARY KEY</span>,
    consent_id      <span class="ty">UUID</span> <span class="ct">REFERENCES consents(id)</span>,
    action          <span class="ty">VARCHAR(20)</span>,      <span class="cm">-- CREATED | SIGNED | MODIFIED | REVOKED</span>
    actor_id        <span class="ty">UUID</span>,
    changes         <span class="ty">JSONB</span>,
    xrpl_tx_hash    <span class="ty">VARCHAR(64)</span>,
    created_at      <span class="ty">TIMESTAMP</span> DEFAULT NOW()
);</div>
</div>

<button class="collapse-btn" onclick="toggle('hdb-xrpl')"><span class="arrow">â–¶</span> user_wallets + wallet_recovery_configs + xrpl_transactions DDL</button>
<div class="collapse-body" id="hdb-xrpl">
<div class="sql-block"><span class="kw">CREATE TABLE</span> <span class="tn">user_wallets</span> (
    id              <span class="ty">UUID PRIMARY KEY</span>,
    user_id         <span class="ty">UUID</span> <span class="ct">REFERENCES users(id)</span>,
    xrpl_address    <span class="ty">VARCHAR(60)</span> UNIQUE,  <span class="cm">-- rXXXXX...</span>
    xrpl_public_key <span class="ty">VARCHAR(130)</span>,        <span class="cm">-- ed25519 ê³µê°œí‚¤ (hex)</span>
    wallet_type     <span class="ty">VARCHAR(20)</span> DEFAULT 'USER',
                    <span class="cm">-- USER | SERVICE | ESCROW</span>
    derivation_method <span class="ty">VARCHAR(20)</span> DEFAULT 'PASSKEY_PRF',
    uqd_balance     <span class="ty">DECIMAL(18,6)</span> DEFAULT 0,
    xrp_balance     <span class="ty">DECIMAL(18,6)</span> DEFAULT 0,
    status          <span class="ty">VARCHAR(20)</span> DEFAULT 'ACTIVE'
    <span class="cm">-- âš ï¸ private_key, seedëŠ” ì ˆëŒ€ ì €ì¥í•˜ì§€ ì•ŠìŒ!</span>
);

<span class="kw">CREATE TABLE</span> <span class="tn">wallet_recovery_configs</span> (
    id              <span class="ty">UUID PRIMARY KEY</span>,
    user_id         <span class="ty">UUID</span> <span class="ct">REFERENCES users(id)</span>,
    recovery_method <span class="ty">VARCHAR(30)</span>,      <span class="cm">-- SSS | SOCIAL | HSM_BACKUP</span>
    config          <span class="ty">JSONB</span>,            <span class="cm">-- {threshold, shares, guardians, ...}</span>
    created_at      <span class="ty">TIMESTAMP</span> DEFAULT NOW()
);

<span class="kw">CREATE TABLE</span> <span class="tn">xrpl_transactions</span> (
    id              <span class="ty">UUID PRIMARY KEY</span>,
    tx_hash         <span class="ty">VARCHAR(64)</span> UNIQUE,
    tx_type         <span class="ty">VARCHAR(30)</span>,
                    <span class="cm">-- DATA_INPUT | DATA_ACCESS | CONSENT_GRANT | CONSENT_REVOKE |</span>
                    <span class="cm">-- ESCROW_CREATE | ESCROW_FINISH | ESCROW_CANCEL |</span>
                    <span class="cm">-- SYNTH_SALE | FL_ROUND | UQD_TRANSFER</span>
    from_address    <span class="ty">VARCHAR(60)</span>,
    to_address      <span class="ty">VARCHAR(60)</span>,
    amount          <span class="ty">DECIMAL(18,6)</span>,
    currency        <span class="ty">VARCHAR(10)</span>,       <span class="cm">-- XRP | UQD</span>
    memo_type       <span class="ty">VARCHAR(30)</span>,
    memo_data       <span class="ty">JSONB</span>,
    ledger_index    <span class="ty">BIGINT</span>,
    status          <span class="ty">VARCHAR(20)</span>,       <span class="cm">-- SUBMITTED | VALIDATED | FAILED</span>
    related_user_id <span class="ty">UUID</span>,
    related_consent_id <span class="ty">UUID</span>,
    created_at      <span class="ty">TIMESTAMP</span> DEFAULT NOW()
);</div>
</div>

<button class="collapse-btn" onclick="toggle('hdb-notif')"><span class="arrow">â–¶</span> notifications + notification_preferences + refresh_tokens DDL</button>
<div class="collapse-body" id="hdb-notif">
<div class="sql-block"><span class="kw">CREATE TABLE</span> <span class="tn">notifications</span> (
    id              <span class="ty">UUID PRIMARY KEY</span>,
    user_id         <span class="ty">UUID</span> <span class="ct">REFERENCES users(id)</span>,
    type            <span class="ty">VARCHAR(50)</span>,
    title           <span class="ty">VARCHAR(200)</span>,
    body            <span class="ty">TEXT</span>,
    channel         <span class="ty">VARCHAR(20)</span>,      <span class="cm">-- PUSH | EMAIL | IN_APP</span>
    read            <span class="ty">BOOLEAN</span> DEFAULT FALSE,
    metadata        <span class="ty">JSONB</span>,
    created_at      <span class="ty">TIMESTAMP</span> DEFAULT NOW()
);

<span class="kw">CREATE TABLE</span> <span class="tn">notification_preferences</span> (
    id              <span class="ty">UUID PRIMARY KEY</span>,
    user_id         <span class="ty">UUID</span> UNIQUE <span class="ct">REFERENCES users(id)</span>,
    push_enabled    <span class="ty">BOOLEAN</span> DEFAULT TRUE,
    email_enabled   <span class="ty">BOOLEAN</span> DEFAULT TRUE,
    health_alerts   <span class="ty">BOOLEAN</span> DEFAULT TRUE,
    research_updates <span class="ty">BOOLEAN</span> DEFAULT TRUE,
    quiet_hours_start <span class="ty">TIME</span>,
    quiet_hours_end   <span class="ty">TIME</span>
);

<span class="kw">CREATE TABLE</span> <span class="tn">refresh_tokens</span> (
    id              <span class="ty">UUID PRIMARY KEY</span>,
    user_id         <span class="ty">UUID</span> <span class="ct">REFERENCES users(id)</span>,
    token_hash      <span class="ty">VARCHAR(64)</span> UNIQUE,
    device_info     <span class="ty">JSONB</span>,
    expires_at      <span class="ty">TIMESTAMP</span> NOT NULL,
    revoked         <span class="ty">BOOLEAN</span> DEFAULT FALSE,
    created_at      <span class="ty">TIMESTAMP</span> DEFAULT NOW()
);</div>
</div>

<!-- ====== uniqdata_db ìŠ¤í‚¤ë§ˆ (16 tables) ====== -->
<div class="section-divider"><span>ğŸ”µ uniqdata_db â€” 16 Tables (Business ì „ìš©)</span></div>

<div style="display: flex; gap: 16px; margin-bottom: 16px; flex-wrap: wrap;">
  <div style="background: #022c22; border: 1px solid #34d399; padding: 12px 20px; border-radius: 8px; font-size: 12px; color: #a7f3d0; text-align: center;">
    ì´ í…Œì´ë¸”: <strong>16</strong>
  </div>
  <div style="background: #022c22; border: 1px solid #34d399; padding: 12px 20px; border-radius: 8px; font-size: 12px; color: #a7f3d0; text-align: center;">
    1ë…„ ì˜ˆìƒ: <strong>~170K ë ˆì½”ë“œ</strong>
  </div>
  <div style="background: #022c22; border: 1px solid #34d399; padding: 12px 20px; border-radius: 8px; font-size: 12px; color: #a7f3d0; text-align: center;">
    í•µì‹¬: <strong>projects, irb_submissions</strong>
  </div>
  <div style="background: #022c22; border: 1px solid #34d399; padding: 12px 20px; border-radius: 8px; font-size: 12px; color: #a7f3d0; text-align: center;">
    ìŠ¤í† ë¦¬ì§€: <strong>PostgreSQL 15 Â· 1GB</strong>
  </div>
</div>

<table class="db-table">
  <tr><th style="color:#6ee7b7;">#</th><th style="color:#6ee7b7;">í…Œì´ë¸”</th><th style="color:#6ee7b7;">ì„¤ëª…</th><th style="color:#6ee7b7;">ì£¼ìš” ì»¬ëŸ¼</th><th style="color:#6ee7b7;">ì˜ˆìƒ/ë…„</th></tr>
  <tr><td>1</td><td style="color:#a7f3d0;"><strong>enterprises</strong></td><td>ê¸°ê´€ (ë³‘ì›, ì œì•½ì‚¬, CRO)</td><td>name, enterprise_type, irb_committee_id</td><td>~200</td></tr>
  <tr><td>2</td><td style="color:#a7f3d0;"><strong>enterprise_members</strong></td><td>ê¸°ê´€ êµ¬ì„±ì›</td><td>user_id, role (OWNER|PI|IRB_MEMBER|STAFF)</td><td>~2K</td></tr>
  <tr><td>3</td><td style="color:#fbbf24;font-weight:700;">projects â­</td><td>ì—°êµ¬ í”„ë¡œì íŠ¸</td><td>project_type, status, pi_user_id, irb_number, reward_budget</td><td>~500</td></tr>
  <tr><td>4</td><td style="color:#a7f3d0;"><strong>project_milestones</strong></td><td>ë§ˆì¼ìŠ¤í†¤ ì¶”ì </td><td>milestone_type, status, target_date</td><td>~2.5K</td></tr>
  <tr><td>5</td><td style="color:#a7f3d0;"><strong>participants</strong></td><td>ì—°êµ¬ ì°¸ì—¬ì ë§¤í•‘</td><td>user_id, consent_id, status, reward_earned</td><td>~15K</td></tr>
  <tr><td>6</td><td style="color:#a7f3d0;"><strong>participation_criteria</strong></td><td>ì ê²© ê¸°ì¤€</td><td>criteria_type (INCLUSION|EXCLUSION), field, operator, value</td><td>~3K</td></tr>
  <tr><td>7</td><td style="color:#a7f3d0;"><strong>data_requests</strong></td><td>ë°ì´í„° ìš”ì²­ ì¶”ì </td><td>request_type, data_categories, core_request_id</td><td>~5K</td></tr>
  <tr><td>8</td><td style="color:#fbbf24;font-weight:700;">irb_submissions â­</td><td>IRB ì œì¶œë¬¼</td><td>submission_type, status, ai_generated, approval_valid_until</td><td>~1K</td></tr>
  <tr><td>9</td><td style="color:#a7f3d0;"><strong>irb_documents</strong></td><td>IRB ë¬¸ì„œ</td><td>doc_type, version, generated_by (AI|MANUAL|TEMPLATE)</td><td>~5K</td></tr>
  <tr><td>10</td><td style="color:#a7f3d0;"><strong>irb_review_comments</strong></td><td>ì‹¬ì˜ ì˜ê²¬</td><td>reviewer_id, review_type, decision, target_section</td><td>~3K</td></tr>
  <tr><td>11</td><td style="color:#a7f3d0;"><strong>irb_workflow_history</strong></td><td>IRB ìƒíƒœ ë³€ê²½ ì´ë ¥</td><td>from_status, to_status, changed_by, reason</td><td>~5K</td></tr>
  <tr><td>12</td><td style="color:#a7f3d0;"><strong>settlement_batches</strong></td><td>ì •ì‚° ë°°ì¹˜</td><td>batch_type, total_amount, escrow_tx_hash</td><td>~2K</td></tr>
  <tr><td>13</td><td style="color:#a7f3d0;"><strong>settlement_items</strong></td><td>ê°œë³„ ì •ì‚° í•­ëª©</td><td>recipient_user_id, amount, calculation_basis(JSON), paid_tx_hash</td><td>~30K</td></tr>
  <tr><td>14</td><td style="color:#6b7280;"><em>synthetic_datasets</em> (Ph2)</td><td>í•©ì„±ë°ì´í„°ì…‹</td><td>generation_method, quality_score, reidentification_risk</td><td>~100</td></tr>
  <tr><td>15</td><td style="color:#6b7280;"><em>fl_rounds</em> (Ph2)</td><td>FL ë¼ìš´ë“œ</td><td>round_number, participating_nodes, dp_epsilon</td><td>~500</td></tr>
  <tr><td>16</td><td style="color:#a7f3d0;"><strong>webhook_events</strong></td><td>Webhook ì´ë²¤íŠ¸ ë¡œê·¸</td><td>event_type, payload(JSON), status, retry_count</td><td>~100K</td></tr>
</table>

<!-- uniqdata_db CREATE TABLE statements (collapsible) -->
<button class="collapse-btn" onclick="toggle('udb-enterprise')"><span class="arrow">â–¶</span> enterprises + enterprise_members DDL</button>
<div class="collapse-body" id="udb-enterprise">
<div class="sql-block"><span class="kw">CREATE TABLE</span> <span class="tn">enterprises</span> (
    id              <span class="ty">UUID PRIMARY KEY</span>,
    name            <span class="ty">VARCHAR(200)</span> NOT NULL,
    enterprise_type <span class="ty">VARCHAR(30)</span>,
                    <span class="cm">-- HOSPITAL | PHARMA | CRO | UNIVERSITY | INSURANCE | GOVERNMENT</span>
    business_number <span class="ty">VARCHAR(20)</span>,
    irb_committee_id <span class="ty">UUID</span>,
    status          <span class="ty">VARCHAR(20)</span> DEFAULT 'ACTIVE',
    created_at      <span class="ty">TIMESTAMP</span> DEFAULT NOW()
);

<span class="kw">CREATE TABLE</span> <span class="tn">enterprise_members</span> (
    id              <span class="ty">UUID PRIMARY KEY</span>,
    enterprise_id   <span class="ty">UUID</span> <span class="ct">REFERENCES enterprises(id)</span>,
    user_id         <span class="ty">UUID</span> NOT NULL,     <span class="cm">-- health_db.users.id</span>
    role            <span class="ty">VARCHAR(20)</span>,
                    <span class="cm">-- OWNER | PI | IRB_MEMBER | STAFF | VIEWER</span>
    status          <span class="ty">VARCHAR(20)</span> DEFAULT 'ACTIVE',
    created_at      <span class="ty">TIMESTAMP</span> DEFAULT NOW()
);
<span class="kw">CREATE UNIQUE INDEX</span> ON enterprise_members(enterprise_id, user_id);</div>
</div>

<button class="collapse-btn" onclick="toggle('udb-project')"><span class="arrow">â–¶</span> projects + participants + milestones + criteria + data_requests DDL</button>
<div class="collapse-body" id="udb-project">
<div class="sql-block"><span class="kw">CREATE TABLE</span> <span class="tn">projects</span> (
    id              <span class="ty">UUID PRIMARY KEY</span>,
    enterprise_id   <span class="ty">UUID</span> <span class="ct">REFERENCES enterprises(id)</span>,
    title           <span class="ty">VARCHAR(300)</span> NOT NULL,
    project_type    <span class="ty">VARCHAR(30)</span>,
                    <span class="cm">-- CLINICAL_TRIAL | OBSERVATIONAL | RETROSPECTIVE |</span>
                    <span class="cm">-- REGISTRY | DATA_ANALYSIS | FL_STUDY | SYNTHETIC_DATA</span>
    status          <span class="ty">VARCHAR(30)</span> DEFAULT 'DRAFT',
                    <span class="cm">-- DRAFT | IRB_PENDING | IRB_APPROVED | RECRUITING |</span>
                    <span class="cm">-- ACTIVE | DATA_LOCKED | ANALYSIS | COMPLETED</span>
    pi_user_id      <span class="ty">UUID</span> NOT NULL,     <span class="cm">-- ì—°êµ¬ì±…ì„ì (health_db.users.id)</span>
    irb_number      <span class="ty">VARCHAR(50)</span>,
    target_participant_count <span class="ty">INT</span>,
    required_data_categories <span class="ty">TEXT[]</span>,   <span class="cm">-- ['VITALS','LAB_RESULT']</span>
    reward_per_participant   <span class="ty">DECIMAL(18,6)</span>,
    total_reward_budget      <span class="ty">DECIMAL(18,6)</span>,
    escrow_xrpl_tx_hash      <span class="ty">VARCHAR(64)</span>,
    created_at      <span class="ty">TIMESTAMP</span> DEFAULT NOW()
);

<span class="kw">CREATE TABLE</span> <span class="tn">participants</span> (
    id              <span class="ty">UUID PRIMARY KEY</span>,
    project_id      <span class="ty">UUID</span> <span class="ct">REFERENCES projects(id)</span>,
    user_id         <span class="ty">UUID</span> NOT NULL,     <span class="cm">-- health_db.users.id</span>
    consent_id      <span class="ty">UUID</span>,             <span class="cm">-- health_db.consents.id</span>
    status          <span class="ty">VARCHAR(20)</span> DEFAULT 'INVITED',
                    <span class="cm">-- INVITED | CONSENTED | ENROLLED | ACTIVE |</span>
                    <span class="cm">-- COMPLETED | WITHDRAWN | EXCLUDED</span>
    reward_earned   <span class="ty">DECIMAL(18,6)</span> DEFAULT 0,
    reward_paid     <span class="ty">DECIMAL(18,6)</span> DEFAULT 0,
    created_at      <span class="ty">TIMESTAMP</span> DEFAULT NOW()
);
<span class="kw">CREATE UNIQUE INDEX</span> ON participants(project_id, user_id);

<span class="kw">CREATE TABLE</span> <span class="tn">project_milestones</span> (
    id              <span class="ty">UUID PRIMARY KEY</span>,
    project_id      <span class="ty">UUID</span> <span class="ct">REFERENCES projects(id)</span>,
    milestone_type  <span class="ty">VARCHAR(30)</span>,
                    <span class="cm">-- IRB_SUBMISSION | IRB_APPROVAL | RECRUITMENT_START |</span>
                    <span class="cm">-- RECRUITMENT_COMPLETE | DATA_COLLECTION | CLOSURE</span>
    status          <span class="ty">VARCHAR(20)</span> DEFAULT 'PENDING',
    target_date     <span class="ty">DATE</span>,
    completed_at    <span class="ty">TIMESTAMP</span>,
    sequence_order  <span class="ty">INT</span>
);

<span class="kw">CREATE TABLE</span> <span class="tn">participation_criteria</span> (
    id              <span class="ty">UUID PRIMARY KEY</span>,
    project_id      <span class="ty">UUID</span> <span class="ct">REFERENCES projects(id)</span>,
    criteria_type   <span class="ty">VARCHAR(20)</span>,      <span class="cm">-- INCLUSION | EXCLUSION</span>
    field           <span class="ty">VARCHAR(50)</span>,      <span class="cm">-- "age", "gender", "chronic_conditions"</span>
    operator        <span class="ty">VARCHAR(20)</span>,      <span class="cm">-- EQUALS | BETWEEN | IN | NOT_IN | GTE | LTE</span>
    value           <span class="ty">JSONB</span>
);

<span class="kw">CREATE TABLE</span> <span class="tn">data_requests</span> (
    id              <span class="ty">UUID PRIMARY KEY</span>,
    project_id      <span class="ty">UUID</span> <span class="ct">REFERENCES projects(id)</span>,
    requester_id    <span class="ty">UUID</span>,
    request_type    <span class="ty">VARCHAR(30)</span>,      <span class="cm">-- PARTICIPANT_DATA | AGGREGATE | EXPORT</span>
    data_categories <span class="ty">TEXT[]</span>,
    status          <span class="ty">VARCHAR(20)</span> DEFAULT 'PENDING',
    core_request_id <span class="ty">UUID</span>,             <span class="cm">-- Core Internal API ìš”ì²­ ID</span>
    created_at      <span class="ty">TIMESTAMP</span> DEFAULT NOW()
);</div>
</div>

<button class="collapse-btn" onclick="toggle('udb-irb')"><span class="arrow">â–¶</span> irb_submissions + irb_documents + irb_review_comments + irb_workflow_history DDL</button>
<div class="collapse-body" id="udb-irb">
<div class="sql-block"><span class="kw">CREATE TABLE</span> <span class="tn">irb_submissions</span> (
    id              <span class="ty">UUID PRIMARY KEY</span>,
    project_id      <span class="ty">UUID</span> <span class="ct">REFERENCES projects(id)</span>,
    enterprise_id   <span class="ty">UUID</span> <span class="ct">REFERENCES enterprises(id)</span>,
    submission_type <span class="ty">VARCHAR(30)</span>,
                    <span class="cm">-- INITIAL | AMENDMENT | CONTINUING_REVIEW | CLOSURE</span>
    status          <span class="ty">VARCHAR(30)</span> DEFAULT 'DRAFT',
                    <span class="cm">-- DRAFT | SUBMITTED | PRELIMINARY_REVIEW |</span>
                    <span class="cm">-- FULL_BOARD_REVIEW | REVISION_REQUESTED |</span>
                    <span class="cm">-- APPROVED | CONDITIONALLY_APPROVED | REJECTED</span>
    version         <span class="ty">INT</span> DEFAULT 1,
    ai_generated    <span class="ty">BOOLEAN</span> DEFAULT FALSE,
    ai_model_used   <span class="ty">VARCHAR(50)</span>,      <span class="cm">-- "claude-sonnet-4-5"</span>
    approval_valid_until <span class="ty">DATE</span>,
    created_at      <span class="ty">TIMESTAMP</span> DEFAULT NOW()
);

<span class="kw">CREATE TABLE</span> <span class="tn">irb_documents</span> (
    id              <span class="ty">UUID PRIMARY KEY</span>,
    submission_id   <span class="ty">UUID</span> <span class="ct">REFERENCES irb_submissions(id)</span>,
    doc_type        <span class="ty">VARCHAR(50)</span>,
                    <span class="cm">-- PROTOCOL | CONSENT_FORM | INVESTIGATOR_BROCHURE |</span>
                    <span class="cm">-- CASE_REPORT_FORM | AMENDMENT_REPORT | SAFETY_REPORT</span>
    title           <span class="ty">VARCHAR(300)</span>,
    content         <span class="ty">TEXT</span>,              <span class="cm">-- ë§ˆí¬ë‹¤ìš´/HTML</span>
    version         <span class="ty">INT</span> DEFAULT 1,
    generated_by    <span class="ty">VARCHAR(20)</span>,       <span class="cm">-- AI | MANUAL | TEMPLATE</span>
    previous_version_id <span class="ty">UUID</span> <span class="ct">REFERENCES irb_documents(id)</span>,
    created_at      <span class="ty">TIMESTAMP</span> DEFAULT NOW()
);

<span class="kw">CREATE TABLE</span> <span class="tn">irb_review_comments</span> (
    id              <span class="ty">UUID PRIMARY KEY</span>,
    submission_id   <span class="ty">UUID</span> <span class="ct">REFERENCES irb_submissions(id)</span>,
    reviewer_id     <span class="ty">UUID</span>,
    review_type     <span class="ty">VARCHAR(20)</span>,       <span class="cm">-- PRIMARY | SECONDARY | FULL_BOARD</span>
    decision        <span class="ty">VARCHAR(20)</span>,       <span class="cm">-- APPROVE | MINOR_REVISION | REJECT</span>
    comment         <span class="ty">TEXT</span>,
    target_document_id <span class="ty">UUID</span>,
    target_section  <span class="ty">VARCHAR(100)</span>,
    is_confidential <span class="ty">BOOLEAN</span> DEFAULT FALSE,
    created_at      <span class="ty">TIMESTAMP</span> DEFAULT NOW()
);

<span class="kw">CREATE TABLE</span> <span class="tn">irb_workflow_history</span> (
    id              <span class="ty">UUID PRIMARY KEY</span>,
    submission_id   <span class="ty">UUID</span> <span class="ct">REFERENCES irb_submissions(id)</span>,
    from_status     <span class="ty">VARCHAR(30)</span>,
    to_status       <span class="ty">VARCHAR(30)</span>,
    changed_by      <span class="ty">UUID</span>,
    reason          <span class="ty">TEXT</span>,
    created_at      <span class="ty">TIMESTAMP</span> DEFAULT NOW()
);</div>
</div>

<button class="collapse-btn" onclick="toggle('udb-settle')"><span class="arrow">â–¶</span> settlement_batches + settlement_items + webhook_events DDL</button>
<div class="collapse-body" id="udb-settle">
<div class="sql-block"><span class="kw">CREATE TABLE</span> <span class="tn">settlement_batches</span> (
    id              <span class="ty">UUID PRIMARY KEY</span>,
    project_id      <span class="ty">UUID</span> <span class="ct">REFERENCES projects(id)</span>,
    batch_type      <span class="ty">VARCHAR(30)</span>,
                    <span class="cm">-- PARTICIPANT_REWARD | DATA_PURCHASE | FL_CONTRIBUTION</span>
    status          <span class="ty">VARCHAR(20)</span> DEFAULT 'PENDING',
                    <span class="cm">-- PENDING | CALCULATING | CALCULATED |</span>
                    <span class="cm">-- CORE_REQUESTED | ESCROW_PROCESSING | COMPLETED</span>
    total_amount    <span class="ty">DECIMAL(18,6)</span>,
    currency        <span class="ty">VARCHAR(10)</span> DEFAULT 'UQD',
    item_count      <span class="ty">INT</span>,
    escrow_tx_hash  <span class="ty">VARCHAR(64)</span>,
    created_at      <span class="ty">TIMESTAMP</span> DEFAULT NOW()
);

<span class="kw">CREATE TABLE</span> <span class="tn">settlement_items</span> (
    id              <span class="ty">UUID PRIMARY KEY</span>,
    batch_id        <span class="ty">UUID</span> <span class="ct">REFERENCES settlement_batches(id)</span>,
    recipient_user_id <span class="ty">UUID</span>,         <span class="cm">-- health_db.users.id</span>
    recipient_wallet_address <span class="ty">VARCHAR(60)</span>,
    amount          <span class="ty">DECIMAL(18,6)</span>,
    calculation_basis <span class="ty">JSONB</span>,
                    <span class="cm">-- {data_points_count: 150, quality_avg: 0.85, days: 90}</span>
    status          <span class="ty">VARCHAR(20)</span> DEFAULT 'PENDING',
                    <span class="cm">-- PENDING | PAID | FAILED | REFUNDED</span>
    paid_tx_hash    <span class="ty">VARCHAR(64)</span>,
    paid_at         <span class="ty">TIMESTAMP</span>
);

<span class="kw">CREATE TABLE</span> <span class="tn">webhook_events</span> (
    id              <span class="ty">UUID PRIMARY KEY</span>,
    event_type      <span class="ty">VARCHAR(50)</span>,
    source          <span class="ty">VARCHAR(20)</span> DEFAULT 'CORE',
    payload         <span class="ty">JSONB</span>,
    status          <span class="ty">VARCHAR(20)</span> DEFAULT 'RECEIVED',
                    <span class="cm">-- RECEIVED | PROCESSED | FAILED | RETRYING</span>
    retry_count     <span class="ty">INT</span> DEFAULT 0,
    error_message   <span class="ty">TEXT</span>,
    created_at      <span class="ty">TIMESTAMP</span> DEFAULT NOW()
);</div>
</div>

<!-- ====== í†µì‹  êµ¬ì¡° ====== -->
<div class="section-divider"><span>ğŸ”„ ì„œë²„ ê°„ í†µì‹  (14 API + 8 Webhook)</span></div>

<div style="display: flex; gap: 16px; margin-bottom: 24px;">
  <!-- Business â†’ Core (Internal API) -->
  <div style="flex: 1; background: #161b22; border: 1px solid #30363d; border-radius: 12px; padding: 16px;">
    <div style="font-size: 13px; font-weight: 700; color: #58a6ff; margin-bottom: 12px;">
      ğŸ”µ Business â†’ ğŸŸ¢ Core (Internal API REST) â€” 14ê°œ
    </div>
    <table style="width: 100%; font-size: 10px; border-collapse: collapse;">
      <tr><td style="padding: 5px 0; color: #8b949e;">ì‚¬ìš©ì ì¡°íšŒ</td><td style="color: #a78bfa;"><code>GET /internal/v1/users/{id}</code></td></tr>
      <tr><td style="padding: 5px 0; color: #8b949e;">ë‹¤ìˆ˜ ì‚¬ìš©ì</td><td style="color: #a78bfa;"><code>POST /internal/v1/users/batch</code></td></tr>
      <tr><td style="padding: 5px 0; color: #8b949e;">ì§€ê°‘ ì¡°íšŒ</td><td style="color: #a78bfa;"><code>GET /internal/v1/users/{id}/wallet</code></td></tr>
      <tr><td style="padding: 5px 0; color: #8b949e;">ë™ì˜ ê¸°ë°˜ ë°ì´í„°</td><td style="color: #a78bfa;"><code>POST /internal/v1/data/query</code></td></tr>
      <tr><td style="padding: 5px 0; color: #8b949e;">ë°ì´í„° í†µê³„</td><td style="color: #a78bfa;"><code>GET /internal/v1/data/stats/{userId}</code></td></tr>
      <tr><td style="padding: 5px 0; color: #8b949e;">ë™ì˜ ìœ íš¨ì„±</td><td style="color: #a78bfa;"><code>GET /internal/v1/consents/verify</code></td></tr>
      <tr><td style="padding: 5px 0; color: #8b949e;">í”„ë¡œì íŠ¸ ë™ì˜ ëª©ë¡</td><td style="color: #a78bfa;"><code>GET /internal/v1/consents/project/{id}</code></td></tr>
      <tr><td style="padding: 5px 0; color: #8b949e;">ë™ì˜ ìš”ì²­ (ì•Œë¦¼)</td><td style="color: #a78bfa;"><code>POST /internal/v1/consents/request</code></td></tr>
      <tr><td style="padding: 5px 0; color: #8b949e;">ì—ìŠ¤í¬ë¡œ ìƒì„±</td><td style="color: #a78bfa;"><code>POST /internal/v1/escrow/create</code></td></tr>
      <tr><td style="padding: 5px 0; color: #8b949e;">ì—ìŠ¤í¬ë¡œ ì™„ë£Œ</td><td style="color: #a78bfa;"><code>POST /internal/v1/escrow/finish</code></td></tr>
      <tr><td style="padding: 5px 0; color: #8b949e;">ì—ìŠ¤í¬ë¡œ ì·¨ì†Œ</td><td style="color: #a78bfa;"><code>POST /internal/v1/escrow/cancel</code></td></tr>
      <tr><td style="padding: 5px 0; color: #8b949e;">ê°ì‚¬ì¶”ì  ì•µì»¤</td><td style="color: #a78bfa;"><code>POST /internal/v1/anchoring/record</code></td></tr>
      <tr><td style="padding: 5px 0; color: #8b949e;">ì•Œë¦¼ ë°œì†¡</td><td style="color: #a78bfa;"><code>POST /internal/v1/notifications/send</code></td></tr>
      <tr><td style="padding: 5px 0; color: #8b949e;">ì¼ê´„ ì•Œë¦¼</td><td style="color: #a78bfa;"><code>POST /internal/v1/notifications/batch</code></td></tr>
    </table>
    <div style="margin-top: 8px; font-size: 9px; color: #8b949e;">ì¸ì¦: X-Internal-API-Key í—¤ë” (í™˜ê²½ë³€ìˆ˜)</div>
  </div>

  <!-- Core â†’ Business (Webhook) -->
  <div style="flex: 1; background: #161b22; border: 1px solid #30363d; border-radius: 12px; padding: 16px;">
    <div style="font-size: 13px; font-weight: 700; color: #fbbf24; margin-bottom: 12px;">
      ğŸŸ¢ Core â†’ ğŸ”µ Business (Webhook) â€” 8ê°œ
    </div>
    <table style="width: 100%; font-size: 10px; border-collapse: collapse;">
      <tr><td style="padding: 5px 0; color: #8b949e;">ë°ì´í„° ì œì¶œ</td><td style="color: #fbbf24;"><code>data.submitted</code></td><td style="color: #484f58; font-size: 9px;">â†’ ë§ˆì¼ìŠ¤í†¤ ì—…ë°ì´íŠ¸</td></tr>
      <tr><td style="padding: 5px 0; color: #8b949e;">ë™ì˜ ìŠ¹ì¸</td><td style="color: #fbbf24;"><code>consent.granted</code></td><td style="color: #484f58; font-size: 9px;">â†’ participants â†’ CONSENTED</td></tr>
      <tr><td style="padding: 5px 0; color: #8b949e;">ë™ì˜ ì² íšŒ</td><td style="color: #fbbf24;"><code>consent.revoked</code></td><td style="color: #484f58; font-size: 9px;">â†’ participants â†’ WITHDRAWN</td></tr>
      <tr><td style="padding: 5px 0; color: #8b949e;">ì—ìŠ¤í¬ë¡œ ì…ê¸ˆ</td><td style="color: #fbbf24;"><code>escrow.deposited</code></td><td style="color: #484f58; font-size: 9px;">â†’ projects â†’ RECRUITING</td></tr>
      <tr><td style="padding: 5px 0; color: #8b949e;">ì—ìŠ¤í¬ë¡œ ì™„ë£Œ</td><td style="color: #fbbf24;"><code>escrow.finished</code></td><td style="color: #484f58; font-size: 9px;">â†’ settlement_items â†’ PAID</td></tr>
      <tr><td style="padding: 5px 0; color: #8b949e;">ì—ìŠ¤í¬ë¡œ ì·¨ì†Œ</td><td style="color: #fbbf24;"><code>escrow.cancelled</code></td><td style="color: #484f58; font-size: 9px;">â†’ settlement_batches â†’ FAILED</td></tr>
      <tr><td style="padding: 5px 0; color: #8b949e;">KYC ë³€ê²½</td><td style="color: #fbbf24;"><code>user.kyc_updated</code></td><td style="color: #484f58; font-size: 9px;">â†’ ì ê²© ê¸°ì¤€ ì¬í‰ê°€</td></tr>
      <tr><td style="padding: 5px 0; color: #8b949e;">ì§€ê°‘ ìƒì„±</td><td style="color: #fbbf24;"><code>wallet.created</code></td><td style="color: #484f58; font-size: 9px;">â†’ ë¡œê¹…</td></tr>
    </table>
    <div style="margin-top: 8px; font-size: 9px; color: #8b949e;">ì¸ì¦: X-Webhook-Secret + HMAC-SHA256 ì„œëª…</div>
  </div>
</div>

<!-- ====== API Gateway ë¼ìš°íŒ… ====== -->
<div class="section-divider"><span>ğŸ›£ï¸ API Gateway ë¼ìš°íŒ… (nginx)</span></div>

<table class="api-table">
  <thead><tr><th>ê²½ë¡œ íŒ¨í„´</th><th>ì„œë²„</th><th>ì„¤ëª…</th><th>ì‚¬ìš©ì</th></tr></thead>
  <tbody>
    <tr><td><code>/api/v1/auth/*</code></td><td><span class="tag tag-core">Core</span></td><td>Passkey ë“±ë¡/ì¸ì¦, JWT ë°œê¸‰</td><td>ì „ì²´</td></tr>
    <tr><td><code>/api/v1/health/*</code></td><td><span class="tag tag-core">Core</span></td><td>ê±´ê°• ë°ì´í„° ì…ë ¥, ëŒ€ì‹œë³´ë“œ</td><td>ì•± ì‚¬ìš©ì</td></tr>
    <tr><td><code>/api/v1/consents/*</code></td><td><span class="tag tag-core">Core</span></td><td>ë™ì˜ ì„œëª…/ì² íšŒ/ì¡°íšŒ</td><td>ì•± ì‚¬ìš©ì</td></tr>
    <tr><td><code>/api/v1/wallets/*</code></td><td><span class="tag tag-core">Core</span></td><td>ì§€ê°‘ ìƒì„±, ì”ì•¡, ì¶œê¸ˆ</td><td>ì•± ì‚¬ìš©ì</td></tr>
    <tr><td><code>/api/v1/notifications/*</code></td><td><span class="tag tag-core">Core</span></td><td>ì•Œë¦¼ ì¡°íšŒ, ì½ìŒ ì²˜ë¦¬</td><td>ì „ì²´</td></tr>
    <tr><td colspan="4" style="text-align:center;color:#30363d;">â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€</td></tr>
    <tr><td><code>/api/v1/projects/*</code></td><td><span class="tag tag-business">Business</span></td><td>í”„ë¡œì íŠ¸ CRUD, ë§ˆì¼ìŠ¤í†¤, ì°¸ì—¬ì</td><td>ì—°êµ¬ì</td></tr>
    <tr><td><code>/api/v1/irb/*</code></td><td><span class="tag tag-business">Business</span></td><td>IRB ì œì¶œ/ì‹¬ì˜/ë¬¸ì„œ</td><td>ì—°êµ¬ì/IRB ìœ„ì›</td></tr>
    <tr><td><code>/api/v1/enterprises/*</code></td><td><span class="tag tag-business">Business</span></td><td>ê¸°ê´€ ê´€ë¦¬, êµ¬ì„±ì›</td><td>ê¸°ê´€ ê´€ë¦¬ì</td></tr>
    <tr><td><code>/api/v1/settlements/*</code></td><td><span class="tag tag-business">Business</span></td><td>ì •ì‚° ì¡°íšŒ, ë°°ì¹˜ ê´€ë¦¬</td><td>ì—°êµ¬ì/ì•± ì‚¬ìš©ì</td></tr>
    <tr><td><code>/api/v1/my/projects/*</code></td><td><span class="tag tag-business">Business</span></td><td>ë‚´ ì°¸ì—¬ í”„ë¡œì íŠ¸</td><td>ì•± ì‚¬ìš©ì</td></tr>
  </tbody>
</table>

<!-- ====== ë°ì´í„° íë¦„ ì˜ˆì‹œ ====== -->
<div class="section-divider"><span>ğŸ“‹ í•µì‹¬ ë°ì´í„° íë¦„ (3 ì‹œë‚˜ë¦¬ì˜¤)</span></div>

<div class="example-box">
  <div class="example-title">ğŸ”¥ ì‹œë‚˜ë¦¬ì˜¤ 1: í™˜ì ë°ì´í„° ì…ë ¥ â†’ XRPL ì•µì»¤ë§ â†’ Webhook</div>
  <div class="example-step"><div class="step-num" style="background:#8b5cf6;">1</div><div class="step-content"><span class="server" style="color:#93c5fd;">[ğŸ“± App]</span> <span class="action">í™˜ìê°€ ê±´ê°•ë°ì´í„° ì…ë ¥ (í˜ˆì••, í˜ˆë‹¹ ë“±) â†’ POST /api/v1/health/data</span></div></div>
  <div class="example-step"><div class="step-num" style="background:#a78bfa;">2</div><div class="step-content"><span class="server core">[Core]</span> <span class="action">Passkey ì¸ì¦ â†’ ë°ì´í„° ê²€ì¦ â†’ AES-256-GCM ì•”í˜¸í™” â†’ <code>health_db.data_points</code> ì €ì¥</span></div></div>
  <div class="example-step"><div class="step-num" style="background:#a78bfa;">3</div><div class="step-content"><span class="server core">[Core]</span> <span class="action">SHA-256 í•´ì‹œ â†’ XRPL DATA_INPUT ì•µì»¤ë§ â†’ <code>xrpl_transactions</code> ê¸°ë¡</span></div></div>
  <div class="example-step"><div class="step-num" style="background:#f59e0b;">4</div><div class="step-content"><span class="server" style="color:#fbbf24;">[XRPL]</span> <span class="action">EscrowCreate (UQD í¬ë ˆë”§ ì ë¦½)</span></div></div>
  <div class="example-step"><div class="step-num" style="background:#a78bfa;">5</div><div class="step-content"><span class="server core">[Core]</span> â†’ <span class="server business">[Business]</span> <span class="action">Webhook <code>data.submitted</code></span></div></div>
  <div class="example-step"><div class="step-num" style="background:#34d399;">6</div><div class="step-content"><span class="server business">[Business]</span> <span class="action"><code>webhook_events</code> ê¸°ë¡ â†’ ì°¸ì—¬ í”„ë¡œì íŠ¸ <code>project_milestones</code> ì—…ë°ì´íŠ¸</span></div></div>
</div>

<div class="example-box">
  <div class="example-title">ì—°êµ¬ì ë°ì´í„° ìš”ì²­ (B2B)</div>
  <div class="example-step"><div class="step-num" style="background:#34d399;">1</div><div class="step-content"><span class="server business">[Business]</span> <span class="action">ë°ì´í„° ì ‘ê·¼ ìš”ì²­ (IRB ìŠ¹ì¸ ë²ˆí˜¸ í¬í•¨) â†’ <code>data_requests</code> ìƒì„±</span></div></div>
  <div class="example-step"><div class="step-num" style="background:#34d399;">2</div><div class="step-content"><span class="server business">[Business]</span> â†’ <span class="server core">[Core]</span> <span class="action"><code>POST /internal/v1/consents/verify</code> + <code>POST /internal/v1/data/query</code></span></div></div>
  <div class="example-step"><div class="step-num" style="background:#a78bfa;">3</div><div class="step-content"><span class="server core">[Core]</span> <span class="action">ë™ì˜ ìŠ¤ì½”í”„ ê²€ì¦ â†’ health_db ì¡°íšŒ â†’ ê°€ëª…ì²˜ë¦¬ (k-anonymity kâ‰¥5) â†’ XRPL DATA_ACCESS ì•µì»¤ë§</span></div></div>
  <div class="example-step"><div class="step-num" style="background:#34d399;">4</div><div class="step-content"><span class="server business">[Business]</span> <span class="action">ê°€ëª… ë°ì´í„° ìˆ˜ì‹  â†’ <code>settlement_batches</code> + <code>settlement_items</code> ìƒì„± â†’ Coreì— EscrowFinish ìš”ì²­</span></div></div>
</div>

<div class="example-box">
  <div class="example-title">ë™ì˜ ìƒì„± + Passkey PRF ì„œëª… + XRPL ì•µì»¤ë§</div>
  <div class="example-step"><div class="step-num" style="background:#8b5cf6;">1</div><div class="step-content"><span class="server" style="color:#93c5fd;">[ğŸ“± App]</span> <span class="action">í™˜ì "ë™ì˜í•©ë‹ˆë‹¤" í„°ì¹˜ â†’ Passkey ìƒì²´ì¸ì¦ â†’ PRF ì„œëª…í‚¤ íŒŒìƒ</span></div></div>
  <div class="example-step"><div class="step-num" style="background:#8b5cf6;">2</div><div class="step-content"><span class="server" style="color:#93c5fd;">[ğŸ“± App]</span> <span class="action">ed25519.sign(SHA256(consent_payload), derived_key) â†’ ì„œëª… + ë™ì˜ ë‚´ìš© ì„œë²„ ì „ì†¡</span></div></div>
  <div class="example-step"><div class="step-num" style="background:#a78bfa;">3</div><div class="step-content"><span class="server core">[Core]</span> <span class="action">ê³µê°œí‚¤ë¡œ ì„œëª… ê²€ì¦ â†’ <code>consents</code> + <code>consent_scopes</code> ì €ì¥ â†’ <code>consent_audit_trail</code> ê¸°ë¡</span></div></div>
  <div class="example-step"><div class="step-num" style="background:#f59e0b;">4</div><div class="step-content"><span class="server" style="color:#fbbf24;">[XRPL]</span> <span class="action">CONSENT_GRANT ì•µì»¤ë§ + EscrowCreate (ë³´ìƒë¶„)</span></div></div>
  <div class="example-step"><div class="step-num" style="background:#a78bfa;">5</div><div class="step-content"><span class="server core">[Core]</span> â†’ <span class="server business">[Business]</span> <span class="action">Webhook <code>consent.granted</code></span></div></div>
  <div class="example-step"><div class="step-num" style="background:#34d399;">6</div><div class="step-content"><span class="server business">[Business]</span> <span class="action"><code>participants.status</code> â†’ CONSENTED â†’ í”„ë¡œì íŠ¸ ì°¸ì—¬ì ìˆ˜ ì—…ë°ì´íŠ¸</span></div></div>
</div>

<!-- ====== ë³´ì•ˆ ====== -->
<div class="section-divider"><span>ğŸ”’ ì¸ì¦/ë³´ì•ˆ ê³„ì¸µ</span></div>

<div style="background: #161b22; border: 1px solid #30363d; border-radius: 12px; padding: 20px; margin-bottom: 16px; overflow-x: auto;">
<pre style="font-size: 11px; line-height: 1.6; color: #e6edf3;">
<span style="color:#fbbf24;">[ì¸ì¦ íë¦„]</span>
1. ì‚¬ìš©ì â†’ ğŸŸ¢ Core: Passkey ì¸ì¦ (WebAuthn Level 3 + PRF Extension)
2. ğŸŸ¢ Core â†’ ì‚¬ìš©ì: Access Token (JWT, 15ë¶„) + Refresh Token (7ì¼)
3. ì‚¬ìš©ì â†’ Gateway: Authorization: Bearer {access_token}
4. Gateway â†’ ğŸŸ¢ Core ë˜ëŠ” ğŸ”µ Business: ìš”ì²­ ì „ë‹¬

<span style="color:#fbbf24;">[JWT ê²€ì¦]</span>
ğŸŸ¢ Core:     ì§ì ‘ ê²€ì¦ (signing key ë³´ìœ )
ğŸ”µ Business: JWKS ê³µê°œí‚¤ë¡œ ê²€ì¦ (Coreê°€ /.well-known/jwks.json ì œê³µ)
</pre>
</div>

<table class="api-table">
  <tr><th>ê³„ì¸µ</th><th>ê¸°ìˆ </th><th>ì ìš© ëŒ€ìƒ</th></tr>
  <tr><td style="font-weight:700;">ì „ì†¡</td><td>TLS 1.3</td><td>í´ë¼ì´ì–¸íŠ¸ â†” Gateway â†” ì„œë²„ ê°„ ëª¨ë“  í†µì‹ </td></tr>
  <tr><td style="font-weight:700;">ì €ì¥</td><td>AES-256-GCM</td><td>data_points.value, user_profiles.birth_date, emergency_contact</td></tr>
  <tr><td style="font-weight:700;">í•´ì‹±</td><td>SHA-256</td><td>data_hash, consent_hash â†’ XRPL Memoì— ê¸°ë¡</td></tr>
  <tr><td style="font-weight:700;">ì„œëª…</td><td>ed25519 (Passkey PRF íŒŒìƒ)</td><td>ë™ì˜ ì„œëª…, íŠ¸ëœì­ì…˜ ì„œëª…</td></tr>
  <tr><td style="font-weight:700;">ì•µì»¤ë§</td><td>XRPL ì›ì¥</td><td>DATA_INPUT, DATA_ACCESS, CONSENT_GRANT/REVOKE ë“±</td></tr>
  <tr><td style="font-weight:700;">í‚¤ ê²©ë¦¬</td><td>Secure Enclave / TPM</td><td>Passkey ê°œì¸í‚¤, PRF ì—°ì‚° â€” ì„œë²„ ì ‘ê·¼ ë¶ˆê°€</td></tr>
</table>

<div style="display: grid; grid-template-columns: repeat(4, 1fr); gap: 12px; margin-bottom: 24px;">
  <div style="background: #161b22; border: 1px solid #30363d; border-radius: 8px; padding: 12px; font-size: 11px;">
    <div style="font-weight: 700; color: #e9d5ff; margin-bottom: 4px;">PATIENT</div>
    <div style="color: #8b949e;">Core: ë³¸ì¸ ë°ì´í„° R/W, ë™ì˜ R/W, ì§€ê°‘ R<br>Business: ë³¸ì¸ ì°¸ì—¬ í”„ë¡œì íŠ¸ R</div>
  </div>
  <div style="background: #161b22; border: 1px solid #30363d; border-radius: 8px; padding: 12px; font-size: 11px;">
    <div style="font-weight: 700; color: #a7f3d0; margin-bottom: 4px;">RESEARCHER</div>
    <div style="color: #8b949e;">Core: â€”<br>Business: ì†Œì† ê¸°ê´€ í”„ë¡œì íŠ¸ R/W, IRB R/W</div>
  </div>
  <div style="background: #161b22; border: 1px solid #30363d; border-radius: 8px; padding: 12px; font-size: 11px;">
    <div style="font-weight: 700; color: #93c5fd; margin-bottom: 4px;">IRB_MEMBER</div>
    <div style="color: #8b949e;">Core: â€”<br>Business: ë°°ì • í”„ë¡œì íŠ¸ R, ì‹¬ì˜ ì˜ê²¬ W</div>
  </div>
  <div style="background: #161b22; border: 1px solid #30363d; border-radius: 8px; padding: 12px; font-size: 11px;">
    <div style="font-weight: 700; color: #f87171; margin-bottom: 4px;">ADMIN</div>
    <div style="color: #8b949e;">Core: ëª¨ë“  ì‚¬ìš©ì R<br>Business: ëª¨ë“  ê¸°ê´€/í”„ë¡œì íŠ¸ R/W</div>
  </div>
</div>

<!-- ====== ì¸í”„ë¼ ====== -->
<div class="section-divider"><span>ğŸ—ï¸ ì¸í”„ë¼ (Railway)</span></div>

<div style="background: #161b22; border: 1px solid #30363d; border-radius: 12px; padding: 20px; margin-bottom: 24px;">
  <div style="display: flex; justify-content: center; gap: 24px; flex-wrap: wrap;">
    <div style="background: #2e1065; border: 1px solid #a78bfa; padding: 12px 20px; border-radius: 8px; font-size: 11px; color: #e9d5ff; text-align: center;">
      ğŸŸ¢ core-server<br>NestJS Â· Port 3000<br><span style="font-size: 9px; color: #8b949e;">RAM: 256MB~ Â· $5/ì›”</span>
    </div>
    <div style="background: #022c22; border: 1px solid #34d399; padding: 12px 20px; border-radius: 8px; font-size: 11px; color: #a7f3d0; text-align: center;">
      ğŸ”µ business-server<br>Spring Boot Â· Port 8080<br><span style="font-size: 9px; color: #8b949e;">RAM: 1GB~ Â· $10-15/ì›”</span>
    </div>
    <div style="background: #1e1b4b; border: 1px solid #818cf8; padding: 12px 20px; border-radius: 8px; font-size: 11px; color: #c7d2fe; text-align: center;">
      ğŸ“¦ health-db<br>PostgreSQL 15<br><span style="font-size: 9px; color: #8b949e;">2GB Â· $10/ì›”</span>
    </div>
    <div style="background: #1e293b; border: 1px solid #64748b; padding: 12px 20px; border-radius: 8px; font-size: 11px; color: #cbd5e1; text-align: center;">
      ğŸ“¦ uniqdata-db<br>PostgreSQL 15<br><span style="font-size: 9px; color: #8b949e;">1GB Â· $5/ì›”</span>
    </div>
    <div style="background: #7f1d1d; border: 1px solid #ef4444; padding: 12px 20px; border-radius: 8px; font-size: 11px; color: #fca5a5; text-align: center;">
      ğŸ”´ Redis<br>ì„¸ì…˜/ìºì‹œ<br><span style="font-size: 9px; color: #8b949e;">$5/ì›”</span>
    </div>
  </div>
</div>

<!-- ====== FAQ ====== -->
<div class="section-divider"><span>â“ FAQ</span></div>

<div class="faq-item">
  <div class="faq-q">Q: ë¶„ë¦¬ ê¸°ì¤€ì´ "ë¯¼ê°/ë¹„ë¯¼ê° ë°ì´í„°"ì¸ê°€?</div>
  <div class="faq-a">A: í•µì‹¬ ê¸°ì¤€ì€ <strong>"í™˜ìì— ëŒ€í•œ ì •ë³´ vs í™œë™ì— ëŒ€í•œ ì •ë³´"</strong>.<br>
  ì‚¬ëŒ <em>ìì²´</em>ì— ëŒ€í•œ ê²ƒ(ê±´ê°•, ì‹ ì›, í‚¤, ë™ì˜, ì§€ê°‘) â†’ Core<br>
  ì‚¬ëŒì´ ì°¸ì—¬í•˜ëŠ” <em>í™œë™</em>ì— ëŒ€í•œ ê²ƒ(í”„ë¡œì íŠ¸, IRB, ì •ì‚°, ê¸°ê´€) â†’ Business</div>
</div>

<div class="faq-item">
  <div class="faq-q">Q: health_dbì—ëŠ” ì´ ëª‡ ê°œ í…Œì´ë¸”?</div>
  <div class="faq-a">A: <code>15ê°œ</code>. users, passkey_credentials, user_profiles, user_wallets, wallet_recovery_configs, data_points, data_point_tags, data_access_logs, consents, consent_scopes, consent_audit_trail, xrpl_transactions, notifications, notification_preferences, refresh_tokens</div>
</div>

<div class="faq-item">
  <div class="faq-q">Q: uniqdata_dbì—ëŠ” ì´ ëª‡ ê°œ í…Œì´ë¸”?</div>
  <div class="faq-a">A: <code>16ê°œ</code> (Phase 2 í¬í•¨). enterprises, enterprise_members, projects, project_milestones, participants, participation_criteria, data_requests, irb_submissions, irb_documents, irb_review_comments, irb_workflow_history, settlement_batches, settlement_items, synthetic_datasets(Ph2), fl_rounds(Ph2), webhook_events</div>
</div>

<div class="faq-item">
  <div class="faq-q">Q: IRB ê´€ë ¨ í…Œì´ë¸”ì€ ì–´ë””ì—?</div>
  <div class="faq-a">A: <code>ğŸ”µ uniqdata_db</code>ì— 4ê°œ: irb_submissions, irb_documents, irb_review_comments, irb_workflow_history. IRBëŠ” ì—°êµ¬ "í™œë™"ì´ë¯€ë¡œ Business ë‹´ë‹¹.</div>
</div>

<div class="faq-item">
  <div class="faq-q">Q: ì •ì‚°ì€ ì–´ë””ì„œ?</div>
  <div class="faq-a">A: ì •ì‚° <strong>ê³„ì‚°</strong>(ëŒ€ìƒì ì‚°ì •, ê¸ˆì•¡ ê³„ì‚°, settlement_batches ìƒì„±) â†’ <code>ğŸ”µ Business</code><br>
  ì •ì‚° <strong>ì‹¤í–‰</strong>(XRPL EscrowFinish, UQD í¬ë ˆë”§ ì ë¦½) â†’ <code>ğŸŸ¢ Core</code><br>
  Businessê°€ <code>POST /internal/v1/escrow/finish</code>ë¡œ ìš”ì²­ â†’ Coreê°€ ì‹¤í–‰ â†’ tx_hash ë°˜í™˜</div>
</div>

<div class="faq-item">
  <div class="faq-q">Q: Internal APIì™€ Webhook ê°¯ìˆ˜ëŠ”?</div>
  <div class="faq-a">A: Businessâ†’Core <strong>Internal API: 14ê°œ</strong> (REST, X-Internal-API-Key ì¸ì¦)<br>
  Coreâ†’Business <strong>Webhook: 8ê°œ</strong> (HMAC-SHA256 ì„œëª…)</div>
</div>

<!-- ====== ë ˆí¬ ====== -->
<div class="section-divider"><span>ğŸ”— ë ˆí¬ì§€í† ë¦¬</span></div>

<div class="repo-links">
  <a href="https://github.com/SportiQue-UniQdata/uniqdata-core" class="repo-link core" target="_blank">
    uniqdata-core (NestJS)
  </a>
  <a href="https://github.com/SportiQue-UniQdata/uniqdata-enterprise-backend" class="repo-link business" target="_blank">
    uniqdata-enterprise-backend (Spring)
  </a>
</div>

<p style="text-align: center; color: #6b7280; font-size: 11px; margin-top: 32px;">
  v6.0 | 2026-02-12 | ì „ë©´ ë¦¬ë‰´ì–¼: 31 Tables DDL Â· 14 Internal APIs Â· 8 Webhooks Â· Decision Matrix Â· ë³´ì•ˆ ê³„ì¸µ Â· RBAC
</p>

<script>
function toggle(id) {
  const el = document.getElementById(id);
  const btn = el.previousElementSibling;
  el.classList.toggle('show');
  btn.classList.toggle('open');
}
</script>
</body>
</html>
